define("typescript/component_libraries/files_components/src/blades/comments/data/uuid",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.v4=void 0;const n=(()=>{let e,t;const n=[];for(e=0,t=e;e<=255;e++,t=e)n.push((t+256).toString(16).substr(1));return n})();function i(e){return e.map(e=>n[e]).join("")}t.v4=function(){const e=(function(){const e=new Uint8Array(16);return window.crypto&&window.crypto.getRandomValues(e),e})();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(i).join("-")}})),define("typescript/component_libraries/files_components/src/blades/comments/component/meatball_menu",["require","exports","tslib","react","dig-components/icons/src","dig-components/icons","dig-components/buttons","dig-components/menu","react-redux","react-intl","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/selectors","typescript/component_libraries/files_components/src/blades/comments/data/transform","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/types","typescript/component_libraries/flows/src/components/approval-forms/index"],(function(e,t,n,i,r,s,a,o,c,d,l,m,u,p,f,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentsMeatball=void 0,i=n.__importStar(i);const g=d.defineMessage({id:"U75RtN",defaultMessage:"Hide resolved comments"}),h=d.defineMessage({id:"fKXJUR",defaultMessage:"Show resolved comments"}),v=d.defineMessage({id:"w904jy",defaultMessage:"Unsubscribe"}),_=d.defineMessage({id:"cnLKs9",defaultMessage:"Subscribe"}),y=d.defineMessage({id:"/XlCxM",defaultMessage:"Disable comments"}),C=d.defineMessage({id:"bppWf8",defaultMessage:"Enable comments"}),A=d.defineMessage({id:"PUErCn",defaultMessage:"Get approval"});t.CommentsMeatball=i.default.memo(({className:e,fileId:t,sharedLinkURL:n,size:I,approvalVariant:O,approvalsLogger:T})=>{const S=c.useDispatch(),E=d.useIntl(),w=u.createStreamFromFileOrSharedLink(t,n),M=f.createCommentFileIdentifier(t,n),j=c.useSelector(e=>e.showResolvedComments),R=c.useSelector(e=>{var t;return null===(t=e.permissions[M])||void 0===t?void 0:t.can_enable_commenting}),U=c.useSelector(e=>m.areCommentsEnabled(e,M)),L=c.useSelector(e=>{var t;return null===(t=e.permissions[M])||void 0===t?void 0:t.can_subscribe}),D=c.useSelector(e=>m.isUserSubscribed(e,M)),k=i.useCallback(()=>{S(l.updateShowResolvedComments(!j))},[S,j]),x=i.useCallback(()=>S(p.subscribeAction({arg:{stream:w}})),[S,w]),F=i.useCallback(()=>S(p.unsubscribeAction({arg:{stream:w}})),[S,w]),N=i.useCallback(()=>S(p.enableCommentingAction({arg:{stream:w}})),[S,w]),P=i.useCallback(()=>S(p.disableCommentingAction({arg:{stream:w}})),[S,w]),V=i.useCallback(()=>{T&&T(),S(b.setApprovalForm({[M]:{activeForm:"request",threadId:void 0}}))},[S,M,T]);return U||R?i.default.createElement(o.Menu.Wrapper,{className:e},({getContentProps:e,getTriggerProps:t})=>i.default.createElement(i.default.Fragment,null,i.default.createElement(a.IconButton,Object.assign({variant:"transparent"},t(),{size:I,"aria-label":E.formatMessage({id:"OD3YF0",defaultMessage:"Other actions"})}),i.default.createElement(s.UIIcon,{src:r.MoreHorizontalLine,size:I})),i.default.createElement(o.Menu.Content,Object.assign({},e()),i.default.createElement(o.Menu.Segment,null,i.default.createElement(o.Menu.ActionItem,{value:j?"hide-resolve-comments":"show-resolve-comments",onClick:k,disabled:!U},j?E.formatMessage(g):E.formatMessage(h)),L?i.default.createElement(o.Menu.ActionItem,{value:D?"unsubscribe":"subscribe",onClick:D?F:x,disabled:!U},D?E.formatMessage(v):E.formatMessage(_)):null,R?i.default.createElement(o.Menu.ActionItem,{value:D?"enableComments":"disableComments",onClick:U?P:N},U?E.formatMessage(y):E.formatMessage(C)):null,b.isApprovalEnabled(O)&&i.default.createElement(o.Menu.ActionItem,{value:"requestApproval",onClick:V},E.formatMessage(A)))))):null}),t.CommentsMeatball.displayName="CommentsMeatball"})),define("typescript/component_libraries/files_components/src/blades/comments/data/transform",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/uuid"],(function(e,t,n){"use strict";function i(e){return{type:{".tag":"file"},identifier:{".tag":"file_path_or_id",file_path_or_id:e}}}function r(e){return{type:{".tag":"file"},identifier:{".tag":"shared_link_details",url:e}}}Object.defineProperty(t,"__esModule",{value:!0}),t.createStreamFromFileOrSharedLink=t.createStreamFromSharedLink=t.createStreamFromFileId=t.newCommentFromICommentContent=t.accountToCommentStreamUser=void 0,t.accountToCommentStreamUser=function(e){return{id:e.account_id,name:{display:e.name.display_name,initials:e.name.abbreviated_name,public:e.name.display_name},photoUrl:e.profile_photo_url}},t.newCommentFromICommentContent=function({content:e,threadId:t,author:i}){const r=new Date;return{id:n.v4(),timestamp:r,threadId:t,author:i,content:e,userPermissions:{canDelete:!1,canEdit:!1},revisionInfo:{isCurrent:!0,timestamp:r}}},t.createStreamFromFileId=i,t.createStreamFromSharedLink=r,t.createStreamFromFileOrSharedLink=function(e,t){return t?r(t):i(e)}})),define("typescript/component_libraries/files_components/src/blades/comments/data/logging_middleware",["require","exports","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/actions"],(function(e,t,n,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.createCommentsBladeLoggingMiddleware=t.CommentsEventName=void 0,(r=t.CommentsEventName||(t.CommentsEventName={})).ADD_COMMENT="add_comment",r.DELETE_COMMENT="delete_comment",r.REPLY_COMMENT="reply_comment",r.EDIT_COMMENT="edit_comment",r.SUBSCRIBE_COMMENTS="subscribe_comments",r.UNSUBSCRIBE_COMMENTS="unsubscribe_comments",r.DISABLE_COMMENTS="disable_comments",r.ENABLE_COMMENTS="enable_comments",r.SHOW_RESOLVED_COMMENTS="show_resolved_comments",r.HIDE_RESOLVED_COMMENTS="hide_resolved_comments",r.SORT_COMMENTS="sort_comments",t.createCommentsBladeLoggingMiddleware=e=>({})=>r=>s=>{switch(s.type){case n.Action.AddCommentResult:const r=Boolean(s.payload.arg.thread_id);e({event:r?t.CommentsEventName.REPLY_COMMENT:t.CommentsEventName.ADD_COMMENT});break;case n.Action.DeleteCommentResult:e({event:t.CommentsEventName.DELETE_COMMENT});break;case n.Action.EditCommentResult:e({event:t.CommentsEventName.EDIT_COMMENT});break;case n.Action.UnsubscribeResult:e({event:t.CommentsEventName.UNSUBSCRIBE_COMMENTS});break;case n.Action.SubscribeResult:e({event:t.CommentsEventName.SUBSCRIBE_COMMENTS});break;case n.Action.DisableCommentingResult:e({event:t.CommentsEventName.DISABLE_COMMENTS});break;case n.Action.EnableCommentingResult:e({event:t.CommentsEventName.ENABLE_COMMENTS});break;case i.Action.UpdateShowResolvedComments:e({event:s.payload.showResolvedComments?t.CommentsEventName.SHOW_RESOLVED_COMMENTS:t.CommentsEventName.HIDE_RESOLVED_COMMENTS});break;case i.Action.SortComments:e({event:t.CommentsEventName.SORT_COMMENTS})}return r(s)}})),define("typescript/component_libraries/files_components/src/blades/comments/data/bolt_middleware",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/libraries/api_v2/redux/comments2"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.middleware=void 0;t.middleware=function(e){return({dispatch:t,getState:r})=>(e.onSignal(e=>{e.updatedChannels.filter(e=>"comments2"===e.channelId.appId).map(e=>{const n=r().boltInfo.boltUniqueIdToStream[e.channelId.uniqueId];n&&t(i.listCommentsAction({arg:{include_permissions:!0,stream:n}}))})}),t=>i=>{switch(i.type){case n.Action.BoltSubscribe:e.subscribe(i.payload.map(e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}})));break;case n.Action.BoltUnsubscribe:e.unsubscribe(i.payload.map(e=>({channelId:{appId:e.app_id,uniqueId:e.unique_id},revisionInfo:{revision:+e.revision,token:e.token}})))}return t(i)})}})),define("typescript/libraries/comments2/src/mentions/middleware",["require","exports","tslib","typescript/libraries/comments2/src/mentions/actions"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.middleware=void 0,t.middleware=function(e){return t=>t=>r=>n.__awaiter(this,void 0,void 0,(function*(){let n=t(r);if(r.type===i.MentionsAction.SearchContacts){let s;const a=e();try{s=i.searchContactsResult({query:r.payload,result:(yield a.search(r.payload))[r.payload]})}catch(e){return n}n=t(s)}else r.type===i.MentionsAction.WarmContacts&&e();return n}))}})),define("typescript/libraries/comments2/src/mentions/actions",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.searchContactsResult=t.searchContacts=t.warmContacts=t.MentionsAction=void 0,(n=t.MentionsAction||(t.MentionsAction={})).WarmContacts="@@contacts/warm",n.SearchContacts="@@contacts/search",n.SearchContactsResult="@@contacts/searchResult",t.warmContacts=function(e){return{type:t.MentionsAction.WarmContacts,payload:e}},t.searchContacts=function(e){return{type:t.MentionsAction.SearchContacts,payload:e}},t.searchContactsResult=function(e){return{type:t.MentionsAction.SearchContactsResult,payload:e}}})),define("typescript/component_libraries/files_components/src/blades/comments/data/actions",["require","exports"],(function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.updateShowResolvedComments=t.resolveNavigationToActiveThreadAnnotation=t.focusEditor=t.editorDidFocus=t.deleteAndCommitThread=t.deleteAndCommitComment=t.editAndCommitComment=t.addAndCommitComment=t.sortComments=t.cancelAnnotating=t.confirmDraftAnnotation=t.startAnnotating=t.clearDraftAnnotation=t.updateDraftAnnotation=t.focusThread=t.hoverThread=t.boltUnsubscribe=t.boltSubscribe=t.deactivateAllThreads=t.activateInitialThread=t.activateThread=t.Action=void 0,(n=t.Action||(t.Action={})).ActivateThread="@@comments/activateThread",n.ActivateInitialThread="@@comments/activateInitialThread",n.DeactivateAllThreads="@@comments/deactivateThread",n.FocusThread="@@comments/focusThread",n.HoverThread="@@comments/hoverThread",n.BoltSubscribe="@@comments/bolt/subscribe",n.BoltUnsubscribe="@@comments/bolt/unsubscribe",n.UpdateDraftAnnotation="@@comments/updateDraftAnnotation",n.ClearDraftAnnotation="@@comments/clearDraftAnnotation",n.FocusEditor="@@comments/focusEditor",n.EditorDidFocus="@@comments/editorDidFocus",n.ResolveNavigationToActiveThreadAnnotation="@@comments/resolveNavigationToActiveThreadAnnotation",n.UpdateShowResolvedComments="@@comments/updateShowResolvedComments",n.StartAnnotating="@@comments/startAnnotating",n.ConfirmDraftAnnotation="@@comments/confirmDraftAnnotation",n.CancelAnnotating="@@comments/cancelAnnotating",n.AddAndCommitComment="@@comments/addAndCommitComment",n.EditAndCommitComment="@@comments/editAndCommitComment",n.DeleteAndCommitComment="@@comments/deleteAndCommitComment",n.DeleteAndCommitThread="@@comments/deleteAndCommitThread",n.SortComments="@@comments/sortComments",t.activateThread=function(e){return{type:t.Action.ActivateThread,payload:e}},t.activateInitialThread=function(e){return{type:t.Action.ActivateInitialThread,payload:e}},t.deactivateAllThreads=function(e){return{type:t.Action.DeactivateAllThreads,payload:e}},t.boltSubscribe=function(e){return{type:t.Action.BoltSubscribe,payload:e}},t.boltUnsubscribe=function(e){return{type:t.Action.BoltUnsubscribe,payload:e}},t.hoverThread=function(e,n){return{type:t.Action.HoverThread,payload:{fileViewerId:e,threadId:n}}},t.focusThread=function(e,n){return{type:t.Action.FocusThread,payload:{fileViewerId:e,threadId:n}}},t.updateDraftAnnotation=function(e,n){return{type:t.Action.UpdateDraftAnnotation,payload:{fileViewerId:e,annotation:n}}},t.clearDraftAnnotation=function(e){return{type:t.Action.ClearDraftAnnotation,payload:{fileViewerId:e}}},t.startAnnotating=function(e,n){return{type:t.Action.StartAnnotating,payload:{fileViewerId:e,accessible:n}}},t.confirmDraftAnnotation=function(e){return{type:t.Action.ConfirmDraftAnnotation,payload:{fileViewerId:e}}},t.cancelAnnotating=function(e){return{type:t.Action.CancelAnnotating,payload:{fileViewerId:e}}},t.sortComments=function(){return{type:t.Action.SortComments,payload:{}}},t.addAndCommitComment=function(e,n,i,r){return{type:t.Action.AddAndCommitComment,payload:{author:e,content:i,fileIdentifier:n,threadId:r}}},t.editAndCommitComment=function(e,n,i,r,s){return{type:t.Action.EditAndCommitComment,payload:{author:e,content:s,fileIdentifier:n,threadId:i,commentId:r}}},t.deleteAndCommitComment=function(e,n,i,r){return{type:t.Action.DeleteAndCommitComment,payload:{author:e,fileIdentifier:n,threadId:i,commentId:r}}},t.deleteAndCommitThread=function(e,n,i){return{type:t.Action.DeleteAndCommitThread,payload:{author:e,fileIdentifier:n,threadId:i}}},t.editorDidFocus=function(e){return{type:t.Action.EditorDidFocus,payload:{fileViewerId:e}}},t.focusEditor=function(e){return{type:t.Action.FocusEditor,payload:{fileViewerId:e}}},t.resolveNavigationToActiveThreadAnnotation=function(e){return{type:t.Action.ResolveNavigationToActiveThreadAnnotation,payload:{fileViewerId:e}}},t.updateShowResolvedComments=function(e){return{type:t.Action.UpdateShowResolvedComments,payload:{showResolvedComments:e}}}})),define("typescript/component_libraries/files_components/src/blades/comments/data/read_thread_middleware",["require","exports","tslib","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/transform","typescript/component_libraries/files_components/src/blades/comments/data/types"],(function(e,t,n,i,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMiddleware=void 0,t.createMiddleware=()=>({dispatch:e,getState:t})=>o=>c=>n.__awaiter(void 0,void 0,void 0,(function*(){const n=o(c);if(c.type===r.Action.ActivateThread||c.type===r.Action.ActivateInitialThread){const{threadId:r,fileId:o,sharedLinkURL:d}=c.payload,l=t().threads[a.createCommentFileIdentifier(o,d)];if(null==l)return n;const m=l[r];if(m&&!m.read&&!m.readonly){const t=s.createStreamFromFileOrSharedLink(o,d);e(i.markThreadReadAction({arg:{id:m.id,stream:t}}))}}return n}))})),define("typescript/component_libraries/files_components/src/blades/comments/data/reducer",["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/libraries/comments2/src/mentions/index","typescript/libraries/comments2/src/transforms/index","typescript/component_libraries/files_components/src/blades/comments/data/transform","redux","typescript/libraries/api_v2/redux/comments2","typescript/libraries/api_v2/redux/media_addon","typescript/component_libraries/flows/src/components/approval-forms/reducer","typescript/component_libraries/files_components/src/blades/comments/data/uuid"],(function(e,t,n,i,r,s,a,o,c,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=t.reducers=t.DEFAULT_STATE=t.Status=void 0;var m;(m=t.Status||(t.Status={}))[m.Disabled=0]="Disabled",m[m.ReadOnly=1]="ReadOnly",m[m.FullyEnabled=2]="FullyEnabled",t.DEFAULT_STATE={threads:{},supportedEnhancements:{},boltInfo:{fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},activeThreadID:{},focusedThreadID:{},hoverThreadID:{},mentionsSearchResult:{currentQuery:"",result:[]},draftAnnotation:{},annotationState:null,permissions:{},editorFocusRequest:{},pendingNavigationToActiveThreadAnnotation:{},status:{},thirdPartySource:{},mediaAddonFeatures:null,subscriptionStatus:{},enableCommentStatus:{},showResolvedComments:!1,approvalFormStatus:{}};const u=e=>{const{payload:{arg:{stream:t}}}=e;return p(t)};function p(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function f(e){const{stream:t,id:n}=e.payload.arg;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:n}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:n}:{}}function b(e){var t;const{payload:{arg:{id:n,stream:{identifier:i}}}}=e,r=null===(t=e.meta)||void 0===t?void 0:t.threadId;return"file_path_or_id"===i[".tag"]?{fileIdOrUrl:i.file_path_or_id,commentId:n,threadId:r}:"shared_link_details"===i[".tag"]?{fileIdOrUrl:i.url,commentId:n,threadId:r}:{}}function g(e,t,n,i){return Object.assign(Object.assign({},e),{[t]:n,pending:{action:i,originalValue:e[t],pendingValue:n}})}function h(e,t,n,i,r){const{comments:s}=e,a=s.findIndex(e=>e.id===t),o=s[a];if(!o)return e;const c=Object.assign(Object.assign({},o),{[n]:i}),d=[...s];return d.splice(a,1,c),g(e,"comments",d,r)}function v(e,t,n){return Object.assign(Object.assign({},e),{[t]:n?e.pending.originalValue:e[t],pending:void 0})}t.reducers={boltInfo:(e=t.DEFAULT_STATE.boltInfo,n)=>{if(n.type===o.Action.ListCommentsResult){const{payload:{arg:t,result:i}}=n,r=p(t.stream);if(r&&i)return{fileIdentifierToBoltMap:Object.assign(Object.assign({},e.fileIdentifierToBoltMap),{[r]:i.bolt_info}),boltUniqueIdToStream:Object.assign(Object.assign({},e.boltUniqueIdToStream),{[i.bolt_info.unique_id]:t.stream})}}return e},threads:(e=t.DEFAULT_STATE.threads,i)=>{const r=!!i.error;switch(i.type){case o.Action.AddComment:return _(e,i);case o.Action.AddCommentResult:return y(e,i,r);case o.Action.MarkThreadRead:case o.Action.MarkThreadUnread:return C(e,i);case o.Action.MarkThreadReadResult:case o.Action.MarkThreadUnreadResult:return A(e,i,r);case o.Action.ResolveThread:case o.Action.UnresolveThread:return I(e,i);case o.Action.ResolveThreadResult:case o.Action.UnresolveThreadResult:return O(e,i,r);case o.Action.EditComment:return T(e,i);case o.Action.EditCommentResult:return S(e,i,r);case o.Action.DeleteComment:return E(e,i);case o.Action.DeleteCommentResult:return w(e,i,r);case o.Action.ListCommentsResult:case o.Action.LoggedOutListCommentsResult:return M(e,i);case n.Action.AddAndCommitComment:return L(e,i);case n.Action.EditAndCommitComment:return U(e,i);case n.Action.DeleteAndCommitComment:return D(e,i);case n.Action.DeleteAndCommitThread:return k(e,i);default:return e}},supportedEnhancements:(e={},t)=>{var n;if(t.type===o.Action.ListCommentsResult){const{payload:{arg:i,result:r}}=t,s=p(i.stream);if(null!=s&&null!=r)return Object.assign(Object.assign({},e),{[s]:null!==(n=r.supported_enhancements)&&void 0!==n?n:{}})}return e},activeThreadID:(e=t.DEFAULT_STATE.activeThreadID,i)=>{switch(i.type){case n.Action.ActivateThread:case n.Action.ActivateInitialThread:return Object.assign(Object.assign({},e),{[i.payload.fileViewerId]:i.payload.threadId});case n.Action.DeactivateAllThreads:return Object.assign(Object.assign({},e),{[i.payload.fileViewerId]:""});case o.Action.AddComment:if(i.meta&&i.meta.tempThreadId)return Object.assign(Object.assign({},e),{[i.meta.fileViewerId]:i.meta.tempThreadId});break;case o.Action.AddCommentResult:const{meta:t,payload:{result:r}}=i;if(r&&t&&t.tempThreadId===e[t.fileViewerId])return Object.assign(Object.assign({},e),{[t.fileViewerId]:r.id})}return e},focusedThreadID:(e=t.DEFAULT_STATE.hoverThreadID,{type:i,payload:r})=>{if(i===n.Action.FocusThread){const t=Object.assign({},e);return null==r.threadId?delete t[r.fileViewerId]:t[r.fileViewerId]=r.threadId,t}return e},hoverThreadID:(e=t.DEFAULT_STATE.hoverThreadID,{type:i,payload:r})=>{if(i===n.Action.HoverThread){const t=Object.assign({},e);return null==r.threadId?delete t[r.fileViewerId]:t[r.fileViewerId]=r.threadId,t}return e},mentionsSearchResult:(e=t.DEFAULT_STATE.mentionsSearchResult,n)=>{switch(n.type){case i.MentionsAction.SearchContacts:return Object.assign(Object.assign({},e),{currentQuery:n.payload});case i.MentionsAction.SearchContactsResult:if(n.payload.query===e.currentQuery)return Object.assign(Object.assign({},e),{result:n.payload.result})}return e},permissions:(e=t.DEFAULT_STATE.permissions,n)=>{if(n.type!==o.Action.ListCommentsResult&&n.type!==o.Action.LoggedOutListCommentsResult)return e;const{payload:{arg:i,result:r}}=n,s=p(i.stream);if(!s||!r)return e;const a=r.permissions;return Object.assign(Object.assign({},e),{[s]:a})},draftAnnotation:(e=t.DEFAULT_STATE.draftAnnotation,i)=>{switch(i.type){case n.Action.UpdateDraftAnnotation:{const{fileViewerId:t,annotation:n}=i.payload;return n===e[t]?e:Object.assign(Object.assign({},e),{[t]:n})}case n.Action.CancelAnnotating:case n.Action.ClearDraftAnnotation:{const{fileViewerId:t}=i.payload;if(!(t in e))return e;const n=Object.assign({},e);return delete n[t],n}case o.Action.AddComment:if(null!=i.meta){const{fileViewerId:t}=i.meta;if(!(t in e))return e;const n=Object.assign({},e);return delete n[t],n}}return e},annotationState:(e=t.DEFAULT_STATE.annotationState,i)=>{switch(i.type){case n.Action.CancelAnnotating:case o.Action.AddComment:return null;case n.Action.ActivateThread:case n.Action.ActivateInitialThread:return null===e?"viewing":"viewing"!==e?null:e;case n.Action.DeactivateAllThreads:return"viewing"===e?null:e;case n.Action.StartAnnotating:return i.payload.accessible?"annotating-ax":"annotating";case n.Action.ConfirmDraftAnnotation:return"commenting"}return e},editorFocusRequest:(e=t.DEFAULT_STATE.editorFocusRequest,{type:i,payload:r})=>{if(i===n.Action.ConfirmDraftAnnotation&&!e[r.fileViewerId])return Object.assign(Object.assign({},e),{[r.fileViewerId]:!0});if(i===n.Action.FocusEditor&&!e[r.fileViewerId])return Object.assign(Object.assign({},e),{[r.fileViewerId]:!0});if(i===n.Action.EditorDidFocus&&e[r.fileViewerId]){const t=Object.assign({},e);return delete t[r.fileViewerId],t}return e},pendingNavigationToActiveThreadAnnotation:(e=t.DEFAULT_STATE.pendingNavigationToActiveThreadAnnotation,{type:i,payload:r})=>{if(i===n.Action.ActivateThread||i===n.Action.ActivateInitialThread)return Object.assign({[r.fileViewerId]:!0},e);if(i===n.Action.ResolveNavigationToActiveThreadAnnotation){const t=Object.assign({},e);return delete t[r.fileViewerId],t}return e},status:(e=t.DEFAULT_STATE.status,n)=>{if(n.type===o.Action.ListCommentsResult){const{payload:{arg:i,result:r}}=n,s=p(i.stream);if(s&&r)switch(r.status[".tag"]){case"disabled":return Object.assign(Object.assign({},e),{[s]:t.Status.Disabled});case"enabled":return Object.assign(Object.assign({},e),{[s]:t.Status.FullyEnabled});case"readonly":return Object.assign(Object.assign({},e),{[s]:t.Status.ReadOnly})}}if(n.type===o.Action.LoggedOutListCommentsResult){const{payload:{arg:i}}=n,r=p(i.stream);if(r)return Object.assign(Object.assign({},e),{[r]:t.Status.FullyEnabled})}return e},thirdPartySource:(e=t.DEFAULT_STATE.thirdPartySource,n)=>{if(n.type!==o.Action.ListCommentsResult)return e;const{payload:{arg:i,result:s}}=n,a=p(i.stream);if(!a||!s)return e;const c=s.supported_enhancements&&s.supported_enhancements.third_party_source;return Object.assign(Object.assign({},e),{[a]:c?r.thirdPartySourceToIThirdPartySource(c):void 0})},mediaAddonFeatures:(e=null,t)=>{var n;return t.type===c.Action.GetFeaturesResult?null!==(n=t.payload.result)&&void 0!==n?n:null:e},subscriptionStatus:(e=t.DEFAULT_STATE.subscriptionStatus,n)=>{if(n.type!==o.Action.SubscribeResult&&n.type!==o.Action.UnsubscribeResult)return e;const i=u(n);if(void 0===i)return e;switch(n.type){case o.Action.SubscribeResult:return Object.assign(Object.assign({},e),{[i]:{isSubscribed:!0,canSubscribe:!0}});case o.Action.UnsubscribeResult:return Object.assign(Object.assign({},e),{[i]:{isSubscribed:!1,canSubscribe:!0}});default:return e}},enableCommentStatus:(e=t.DEFAULT_STATE.enableCommentStatus,n)=>{var i;if(n.type!==o.Action.EnableCommentingResult&&n.type!==o.Action.DisableCommentingResult&&n.type!==o.Action.ListCommentsResult&&n.type!==o.Action.LoggedOutListCommentsResult)return e;const r=u(n);if(void 0===r)return e;switch(n.type){case o.Action.EnableCommentingResult:return Object.assign(Object.assign({},e),{[r]:{commentsEnabled:!0,canEnableCommenting:!0}});case o.Action.DisableCommentingResult:return Object.assign(Object.assign({},e),{[r]:{commentsEnabled:!1,canEnableCommenting:!0}});case o.Action.ListCommentsResult:case o.Action.LoggedOutListCommentsResult:const t=n.payload.result;return t?Object.assign(Object.assign({},e),{[r]:{commentsEnabled:!("disabled"===t.status[".tag"]),canEnableCommenting:!!(null===(i=t.permissions)||void 0===i?void 0:i.can_enable_commenting)}}):e;default:return e}},showResolvedComments:(e=t.DEFAULT_STATE.showResolvedComments,i)=>{switch(i.type){case n.Action.UpdateShowResolvedComments:return i.payload.showResolvedComments;default:return e}},approvalFormStatus:d.approvalReducer};const _=(e,t)=>{const{payload:{arg:{thread_id:n,stream:i}}}=t,r=p(i);if(!r||!t.meta)return e;const a=e[r],{content:o,author:c,annotation:d}=t.meta;if(n){const i=a[n],{comments:l}=i,m=Object.assign(Object.assign({},i),{comments:[...l,s.newCommentFromICommentContent({content:o,threadId:n,author:c})],annotation:d||i.annotation});return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},a),{[n]:Object.assign(Object.assign({},m),{pending:{action:t.type,originalValue:i,newValue:m}})})})}const{tempThreadId:l}=t.meta;if(l){const n=s.newCommentFromICommentContent({threadId:l,author:c,content:o}),i={id:l,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[n],annotation:d,isThirdParty:!1},m=Object.assign(Object.assign({},i),{pending:{action:t.type,originalValue:void 0,pendingValue:i}});return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},a),{[l]:m})})}return e},y=(e,t,n)=>{const{payload:{arg:{thread_id:i,stream:r}}}=t,s=p(r);if(!s||!t.meta)return e;const a=e[s];if(i){const t=Object.assign({},a[i]),{originalValue:r}=t.pending;return t.pending=void 0,Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},a),{[i]:n?r:t})})}const{tempThreadId:o}=t.meta;let c=a;if(!n&&o in a&&t.payload.result){c=Object.assign({},a),delete c[o];const e=a[o],{id:n}=t.payload.result;e.readonly=!1,e.id=n,c[n]=Object.assign(Object.assign({},e),{pending:void 0})}return Object.assign(Object.assign({},e),{[s]:c})},C=(e,t)=>{const{fileIdOrUrl:n,threadId:i}=f(t);if(!n||!i)return e;const r=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},r),{[i]:g(r[i],"read",t.type===o.Action.MarkThreadRead,t.type)})})},A=(e,t,n)=>{const{fileIdOrUrl:i,threadId:r}=f(t);if(!i||!r)return e;const s=e[i];return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},s),{[r]:v(s[r],"read",n)})})},I=(e,t)=>{const{fileIdOrUrl:n,threadId:i}=f(t);if(!n||!i)return e;const r=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},r),{[i]:g(r[i],"resolved",t.type===o.Action.ResolveThread,t.type)})})},O=(e,t,n)=>{const{fileIdOrUrl:i,threadId:r}=f(t);if(!i||!r)return e;const s=e[i];return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},s),{[r]:v(s[r],"resolved",n)})})},T=(e,t)=>{const{fileIdOrUrl:n,threadId:i,commentId:r}=b(t);if(!(n&&i&&r&&t.meta))return e;const s=e[n],{content:a}=t.meta;return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},s),{[i]:h(s[i],r,"content",a,t.type)})})},S=(e,t,n)=>{const{fileIdOrUrl:i,threadId:r,commentId:s}=b(t);if(!i||!r||!s)return e;const a=e[i];return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},a),{[r]:v(a[r],"comments",n)})})},E=(e,t)=>{const{fileIdOrUrl:n,threadId:i,commentId:r}=b(t);if(!n||!i||!r)return e;const s=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},s),{[i]:h(s[i],r,"deleted",!0,t.type)})})},w=(e,t,n)=>{const{fileIdOrUrl:i,threadId:r,commentId:s}=b(t);if(!i||!r||!s)return e;const a=e[i];return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},a),{[r]:v(a[r],"comments",n)})})},M=(e,t)=>{const{payload:{arg:n,result:i}}=t,s=p(n.stream);return s&&i?Object.assign(Object.assign({},e),{[s]:r.threadsToIThreadMap(i.threads,r.usersToIUserMap(i.users))}):e};function j(e,t,n){return Object.assign(Object.assign({},e),{[t]:n})}function R(e,t,n,i){const{comments:r}=e,s=r.findIndex(e=>e.id===t),a=r[s];if(!a)return e;const o=Object.assign(Object.assign({},a),{[n]:i}),c=[...r];return c.splice(s,1,o),j(e,"comments",c)}t.reducer=a.combineReducers(t.reducers);const U=(e,t)=>{const{payload:{content:n,threadId:i,fileIdentifier:r,commentId:s}}=t,a=e[r],o=a[i];return o?Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},a),{[i]:R(o,s,"content",n)})}):e},L=(e,t)=>{const{payload:{author:n,content:i,threadId:r,fileIdentifier:a}}=t,o=e[a];if(r){const t=o[r];if(!t)return e;const{comments:c}=t,d=Object.assign(Object.assign({},t),{comments:[...c,s.newCommentFromICommentContent({content:i,threadId:r,author:n})]});return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},o),{[r]:Object.assign({},d)})})}{const t=l.v4(),r=s.newCommentFromICommentContent({threadId:t,author:n,content:i}),c={id:t,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[r],isThirdParty:!1};return Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},o),{[t]:c})})}},D=(e,t)=>{const{payload:{threadId:n,fileIdentifier:i,commentId:r}}=t;if(!i||!n||!r)return e;const s=e[i],a=s[n];return a?Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},s),{[n]:R(a,r,"deleted",!0)})}):e},k=(e,t)=>{const{payload:{threadId:n,fileIdentifier:i}}=t;if(!i||!n)return e;const r=e[i],s=r[n];return s?Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{[n]:j(s,"comments",s.comments.map(e=>Object.assign(Object.assign({},e),{deleted:!0})))})}):e}})),define("typescript/component_libraries/files_components/src/blades/comments/data/selectors",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUnreadThreadCount=t.getAnnotationType=t.isUserSubscribed=t.areCommentsEnabled=void 0,t.areCommentsEnabled=(e,t)=>{var n;const i=e.permissions[t],r=e.enableCommentStatus[t];return Boolean(null!==(n=null==r?void 0:r.commentsEnabled)&&void 0!==n?n:null==i?void 0:i.can_see_comment_editor)},t.isUserSubscribed=(e,t)=>{var n;const i=e.permissions[t],r=e.subscriptionStatus[t];return Boolean(null!==(n=null==r?void 0:r.isSubscribed)&&void 0!==n?n:null==i?void 0:i.is_subscribed)},t.getAnnotationType=(e,t)=>{var n;const i=e.threads[t],r=i?Object.values(i).find(e=>void 0!==e.annotation):void 0;return null===(n=null==r?void 0:r.annotation)||void 0===n?void 0:n.type},t.getUnreadThreadCount=(e,t)=>{const n=e.threads[t];return n?Object.values(n).filter(e=>!e.read&&e.comments.some(e=>!e.deleted)).length:0}})),define("typescript/component_libraries/files_components/src/blades/comments/component/comments_blade",["require","exports","tslib","react","react-intl","dig-components/icons","dig-components/icons/src","dig-components/badges","typescript/component_libraries/files_components/src/right-rail/index","typescript/component_libraries/files_components/src/blades/comments/component/meatball_menu","react-redux","typescript/component_libraries/files_components/src/blades/comments/data/selectors","typescript/component_libraries/files_components/src/blades/comments/data/types","dig-components/typography"],(function(e,t,n,i,r,s,a,o,c,d,l,m,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollapsedCommentsBladeButton=t.CommentsBlade=void 0,i=n.__importStar(i);const f=r.defineMessage({id:"5PJLxb",defaultMessage:"{unreadCount} unread"}),b=r.defineMessage({id:"ZKwnCD",defaultMessage:"An error occurred."}),g=e=>l.useSelector(t=>e?m.getUnreadThreadCount(t,e):0);class h extends i.PureComponent{constructor(){super(...arguments),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){const{intl:e}=this.props;return this.state.hasError?i.createElement(p.Text,null,e.formatMessage(b)):this.props.children}}h.displayName="CommentsBladeErrorBoundary";const v=({fileId:e,sharedLinkURL:t,showOverflowMenu:n,approvalVariant:s,approvalsLogger:a})=>{const c=g(u.createCommentFileIdentifier(e,t)),l=r.useIntl();return i.createElement("div",{className:"comments-blade-header-accessory-wrapper"},c>0?i.createElement("div",{className:"comments-blade-header-badge"},i.createElement(o.NotificationBadge,{status:"attention"},l.formatMessage(f,{unreadCount:c}))):null,n&&i.createElement("div",{className:"comments-blade-header-menu"},i.createElement(d.CommentsMeatball,{fileId:e,sharedLinkURL:t,size:"small",approvalVariant:s,approvalsLogger:a})))};v.displayName="CommentsBladeRightAccessory",t.CommentsBlade=({id:e,intl:t,children:n,fileId:o,sharedLinkURL:d,comments2UsabilityRevamp:l,approvalVariant:m,approvalsLogger:u})=>{const p=c.useIsExpanded(e);return i.createElement(r.RawIntlProvider,{value:t},i.createElement(c.RightRail.Blade,{withTitle:t.formatMessage({id:"TxGYML",defaultMessage:"Comments"}),withIcon:i.createElement(s.UIIcon,{src:a.CommentLine}),id:e,withTitleRightAccessory:i.createElement(v,{fileId:o,sharedLinkURL:d,showOverflowMenu:p,comments2UsabilityRevamp:l,approvalVariant:m,approvalsLogger:u})},i.createElement(h,{intl:t},n)))},t.CommentsBlade.displayName="CommentsBlade",t.CollapsedCommentsBladeButton=({id:e,intl:t,fileId:n,sharedLinkURL:r})=>{const o=g(n?u.createCommentFileIdentifier(n,r):void 0);return i.createElement(c.RightRail.CollapsedBladeIcon,{id:e,withIcon:i.createElement(s.UIIcon,{src:a.CommentLine,"aria-label":t.formatMessage({id:"JrjHYo",defaultMessage:"Open comments panel"})}),tooltip:t.formatMessage({id:"GSZlCi",defaultMessage:"Comments"}),withNotificationBadge:o})},t.CollapsedCommentsBladeButton.displayName="CollapsedCommentsBladeButton"})),define("typescript/libraries/comments2/src/components/utils/thread_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findCommentThread=void 0,t.findCommentThread=function(e,t){for(const n of e){const e=n.comments;for(const i of e)if(i.id===t)return{comment:i,thread:n}}return null}})),define("typescript/libraries/file-viewer/src/comments2/plugin/markers",["require","exports","tslib","typescript/component_libraries/files_components/src/blades/comments/index","react","react-dom","react-redux","lodash","typescript/libraries/file-viewer/src/hooks/useStabilizedCallback","typescript/libraries/file-viewer/src/css/toolbar_v2.module.css","typescript/libraries/file-viewer/src/toolbar/video_thumbnails_v2","typescript/libraries/file-viewer/src/core/logging/video","typescript/component_libraries/files_components/src/blades/comments/data/types"],(function(e,t,n,i,r,s,a,o,c,d,l,m,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentMarkers=void 0,r=n.__importStar(r),d=n.__importStar(d);const p=({fileId:e,duration:t,fileViewerId:n,audioVideoMetadata:s,logVideoAction:p,sharedLinkInfo:b})=>{const g=u.createCommentFileIdentifier(e,null==b?void 0:b.url),h=a.useDispatch(),v=a.useSelector(e=>e.threads[g]||{}),_=a.useSelector(e=>e.showResolvedComments)?Object.entries(v):Object.entries(v).filter(e=>!e[1].resolvedInfo),[y,C]=r.useState(),A=c.useStabilizedCallback(t=>{h(i.activateThread({fileId:e,fileViewerId:n,isThirdParty:t.isThirdParty,threadId:t.id}))}),I="video"===(null==s?void 0:s[".tag"])?null==s?void 0:s.thumb_scrubber_vtt_url:void 0,O=r.useCallback(o.once(e=>{p(e?m.VideoPreviewEvent.ScrubberThumbnailsLoaded:m.VideoPreviewEvent.ScrubberThumbnailsFailed)}),[p]);return r.default.createElement(r.default.Fragment,null,r.default.createElement("div",{className:d.commentMarkersContainer},_.map(e=>r.default.createElement(f,{key:e[0],duration:t,thread:e[1],setHoveredThread:C}))),I&&r.default.createElement(l.VideoThumbnailsComponent,{vttUrl:I,onScrubberThumbnailsLoaded:O,duration:t,lastHighlightedThread:y,openThreadInRightRail:A}))};p.displayName="CommentMarkersComponent";const f=({duration:e,thread:t,setHoveredThread:n})=>{const i=c.useStabilizedCallback(()=>n(t)),s=l.getTimeForThread(t);if(void 0===s)return null;const a=0===e?0:100*s/e;return r.default.createElement("div",{className:d.commentMarker,style:{left:`${a}%`},onMouseEnter:i})};f.displayName="Marker",t.CommentMarkers=e=>{var{container:t}=e,i=n.__rest(e,["container"]);return s.createPortal(r.default.createElement(p,Object.assign({},i)),t)},t.CommentMarkers.displayName="CommentMarkers",t.CommentMarkers.displayName="CommentMarkers"})),define("typescript/component_libraries/files_components/src/blades/comments/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCommentFileIdentifier=void 0,t.createCommentFileIdentifier=(e,t)=>t||e})),define("typescript/libraries/file-viewer/src/comments2/plugin/navigation_middleware",["require","exports","typescript/libraries/file-viewer/src/plugins/index","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/types","typescript/libraries/api_v2/redux/comments2"],(function(e,t,n,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createMiddleware=void 0,t.createMiddleware=e=>({getState:t,dispatch:a})=>o=>c=>{var d;switch(o(c),c.type){case i.Action.ResolveNavigationToActiveThreadAnnotation:return;case i.Action.ActivateInitialThread:case i.Action.ActivateThread:case s.Action.ListCommentsResult:{const s=t();for(const t of Object.getOwnPropertyNames(s.pendingNavigationToActiveThreadAnnotation)){if(t===e.fileViewerId){const{file:o,navigation:c,sharedLinkInfo:l}=e.getPluginData();if(null!=o){const e=r.createCommentFileIdentifier(o.fileId,null==l?void 0:l.url),m=s.activeThreadID[t],u=null===(d=s.threads[e])||void 0===d?void 0:d[m];if(u&&u.annotation){const e=u.annotation;"document"===e.type&&"navigateToPage"in c&&c.navigateToPage((e.regions[0].page||1)-1,n.UserActionContext.Sidebar),("audio"===e.type||"video"===e.type)&&"seek"in c&&c.seek(e.time),a(i.resolveNavigationToActiveThreadAnnotation(t))}}}return}}}}})),define("typescript/libraries/file-viewer/src/comments2/logging_middleware",["require","exports","typescript/libraries/api_v2/redux/comments2","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/component_libraries/files_components/src/blades/comments/data/transform"],(function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.middleware=void 0;function s({event:e,stream:t,thread_id:i,comment_id:r,is_third_party:s,error:a}){return n.logEventAction({arg:{event:a?{".tag":"comment_error"}:e,stream:t,thread_id:i,comment_id:r,is_third_party:s,oref:"dfv",product_surface:{".tag":"file_preview"},product_surface_context:{".tag":"file_preview"},error_message:a?a.message:void 0}})}t.middleware=({dispatch:e})=>t=>a=>{const o=t(a);if(a.type===n.Action.AddCommentResult)e(s({event:a.payload.arg.thread_id?{".tag":"reply_to_comment"}:{".tag":"new_comment"},stream:a.payload.arg.stream,thread_id:a.payload.arg.thread_id,error:a.error}));else if(a.type===n.Action.MarkThreadReadResult)e(s({event:{".tag":"mark_thread_as_read"},stream:a.payload.arg.stream,thread_id:a.payload.arg.id,error:a.error}));else if(a.type===n.Action.MarkThreadUnreadResult)e(s({event:{".tag":"mark_thread_as_unread"},stream:a.payload.arg.stream,thread_id:a.payload.arg.id,error:a.error}));else if(a.type===n.Action.ResolveThreadResult)e(s({event:{".tag":"resolve_thread"},stream:a.payload.arg.stream,thread_id:a.payload.arg.id,error:a.error}));else if(a.type===n.Action.UnresolveThreadResult)e(s({event:{".tag":"unresolve_thread"},stream:a.payload.arg.stream,thread_id:a.payload.arg.id,error:a.error}));else if(a.type===n.Action.DeleteCommentResult)e(s({event:{".tag":"delete_comment"},stream:a.payload.arg.stream,thread_id:a.meta?a.meta.threadId:void 0,comment_id:a.payload.arg.id,error:a.error}));else if(a.type===n.Action.EditCommentResult)e(s({event:{".tag":"edit_comment"},stream:a.payload.arg.stream,thread_id:a.meta?a.meta.threadId:void 0,comment_id:a.payload.arg.id,error:a.error}));else if(a.type===i.Action.ActivateThread){const{fileId:t,isThirdParty:n,threadId:i}=a.payload,o=r.createStreamFromFileId(t);e(s({event:{".tag":"activate_thread"},stream:o,thread_id:i,is_third_party:n}))}return o}})),define("typescript/component_libraries/files_components/src/blades/comments/data/store",["require","exports","typescript/libraries/api_v2/redux/comments2","typescript/libraries/api_v2/redux/files","typescript/libraries/api_v2/redux/media_addon","typescript/component_libraries/files_components/src/blades/comments/data/bolt_middleware","typescript/libraries/comments2/src/mentions/index","redux","typescript/component_libraries/files_components/src/blades/comments/data/reducer","typescript/component_libraries/files_components/src/blades/comments/data/read_thread_middleware","typescript/component_libraries/files_components/src/blades/comments/data/logging_middleware"],(function(e,t,n,i,r,s,a,o,c,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeStore=void 0,t.makeStore=function({apiv2ClientBase:e,boltIOClient:t,mentionsIOClient:m,logger:u},p){const f=[i.middleware(e.ns("files")),n.middleware(e.ns("comments2")),r.middleware(e.ns("media_addon")),s.middleware(t),d.createMiddleware()];m&&f.push(a.middleware(m)),u&&f.push(l.createCommentsBladeLoggingMiddleware(u)),p&&f.push(...p);const b=o.applyMiddleware(...f),g=window.__REDUX_DEVTOOLS_EXTENSION__,h=null==g?b:o.compose(b,g({name:"FVSDK Comments2 Plugin"}));return o.createStore(c.reducer,h)}})),define("typescript/libraries/comments2/src/mentions/index",["require","exports","typescript/libraries/comments2/src/mentions/actions","typescript/libraries/comments2/src/mentions/middleware"],(function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MentionsIOClient=t.middleware=t.SearchContactsResultAction=t.SearchContactsAction=t.searchContactsResult=t.searchContacts=t.MentionsAction=void 0,Object.defineProperty(t,"MentionsAction",{enumerable:!0,get:function(){return n.MentionsAction}}),Object.defineProperty(t,"searchContacts",{enumerable:!0,get:function(){return n.searchContacts}}),Object.defineProperty(t,"searchContactsResult",{enumerable:!0,get:function(){return n.searchContactsResult}}),Object.defineProperty(t,"SearchContactsAction",{enumerable:!0,get:function(){return n.SearchContactsAction}}),Object.defineProperty(t,"SearchContactsResultAction",{enumerable:!0,get:function(){return n.SearchContactsResultAction}}),Object.defineProperty(t,"middleware",{enumerable:!0,get:function(){return i.middleware}}),Object.defineProperty(t,"MentionsIOClient",{enumerable:!0,get:function(){return i.MentionsIOClient}})})),define("typescript/libraries/file-viewer/src/comments2/plugin/snackbar",["require","exports","tslib","react","react-redux","react-intl","dig-components/banner","typescript/component_libraries/files_components/src/blades/comments/data/actions","dig-components/buttons","typescript/libraries/file-viewer/src/css/header.module.css","typescript/libraries/file-viewer/src/plugins/index"],(function(e,t,n,i,r,s,a,o,c,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationSnackbar=void 0,i=n.__importStar(i);const m=s.defineMessage({id:"IKrBL8",defaultMessage:"Highlight a section to comment on"}),u=s.defineMessage({id:"+qSSeW",defaultMessage:"Highlight an area to comment on\n"}),p=s.defineMessage({id:"VYvI4T",defaultMessage:"Using the arrow keys, select an area to comment on, then hit enter."}),f=s.defineMessage({id:"pCmwyu",defaultMessage:"Now, add your comment in the comments pane"}),b=s.defineMessage({id:"8UKHBA",defaultMessage:"Using the arrow keys, select a timestamp to comment on, then hit enter"}),g=s.defineMessage({id:"DeTJfa",defaultMessage:"Add your comment in the comments pane"}),h=s.defineMessage({id:"55kTfU",defaultMessage:"Cancel"});t.AnnotationSnackbar=i.memo(({fileViewerId:e,previewType:t})=>{const n=r.useSelector(e=>e.annotationState),v=r.useDispatch(),_=s.useIntl();if(null==n||"viewing"==n)return null;let y;if(t===l.PreviewType.Audio||t===l.PreviewType.Video)if("commenting"===n)y=_.formatMessage(g);else{if("annotating-ax"!==n)return null;y=_.formatMessage(b)}else if("annotating"===n)y=t===l.PreviewType.Image?_.formatMessage(u):_.formatMessage(m);else if("annotating-ax"===n)y=_.formatMessage(p);else{if("commenting"!==n)return null;y=_.formatMessage(f)}return i.createElement("div",{className:d.floatingHeader},i.createElement(a.Banner,{type:"attention",withLeftIcon:!1},i.createElement(a.Banner.Message,null,y),i.createElement(a.Banner.Actions,null,i.createElement(c.Button,{variant:"transparent",onClick:()=>{v(o.cancelAnnotating(e))}},_.formatMessage(h)))))}),t.AnnotationSnackbar.displayName="AnnotationSnackbar",t.AnnotationSnackbar.displayName="AnnotationSnackbar"})),define("typescript/component_libraries/files_components/src/blades/comments/index",["require","exports","tslib","typescript/component_libraries/files_components/src/blades/comments/component/comments_blade","typescript/component_libraries/files_components/src/blades/comments/data/selectors","typescript/component_libraries/files_components/src/blades/comments/data/reducer","typescript/component_libraries/files_components/src/blades/comments/data/read_thread_middleware","typescript/component_libraries/files_components/src/blades/comments/data/store","typescript/component_libraries/files_components/src/blades/comments/data/actions"],(function(e,t,n,i,r,s,a,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(i,t),n.__exportStar(r,t),n.__exportStar(s,t),n.__exportStar(a,t),n.__exportStar(o,t),n.__exportStar(c,t)})),define("typescript/libraries/file-viewer/src/comments2/plugin/sidebar_control",["require","exports","tslib","classnames","react","react-redux","typescript/libraries/file-viewer/src/plugins/components/plugin_control","typescript/libraries/file-viewer/src/css/modes/sidebar/control.module.css"],(function(e,t,n,i,r,s,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TestOnlyCommentsSidebarControl=t.CommentsPluginSidebarControl=void 0,i=n.__importDefault(i),r=n.__importStar(r),o=n.__importStar(o);const c=e=>{const{areAnyThreadsUnread:t,disabled:n,platform:{intl:s},threadCount:c,ui:{isSidebarVisible:d}}=e,l=n?s.formatMessage({id:"UPO/6i",defaultMessage:"Comments are disabled on this file"}):s.formatMessage({id:"uFbQOk",defaultMessage:"Comments"}),m=s.formatMessage({id:"j0qRv4",defaultMessage:"Toggle Comments Sidebar"});return d||null==c||0===c?r.createElement(a.BasePluginSidebarControl,Object.assign({},e,{ariaLabel:m,iconId:"comments",label:l})):r.createElement(a.BasePluginSidebarControl,Object.assign({},e,{ariaLabel:m,className:i.default({[o.closedUnreadVariant]:t,[o.closedReadVariant]:!t,[o.plus]:c>99}),disabled:n,iconId:"comments",label:l}),r.createElement("div",{className:o.threadCount},Math.min(c,99)))};t.TestOnlyCommentsSidebarControl=c,c.displayName="UnconnectedCommentsPluginSidebarControl";const d=s.connect((function(e,t){const n={threadCount:0,areAnyThreadsUnread:!1},{file:i}=t.context.getPluginData();if(null==i)return n;const r=e.threads[i.fileId];if(null!=r)for(const e of Object.getOwnPropertyNames(r)){const t=r[e],i=t.comments.some(e=>!e.deleted);null==t.resolvedInfo&&i&&(++n.threadCount,n.areAnyThreadsUnread=n.areAnyThreadsUnread||!t.read)}return n}))(c);t.CommentsPluginSidebarControl=d})),define("typescript/libraries/file-viewer/src/comments2/plugin/loader/eager",["require","exports","tslib","typescript/libraries/file-viewer/src/comments2/plugin/types","typescript/libraries/file-viewer/src/comments2/plugin/index"],(function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeLoader=void 0,t.makeLoader=function(e,t={}){return{pluginId:i.COMMENTS_PLUGIN_ID,load:(i,s)=>n.__awaiter(this,void 0,void 0,(function*(){return new r.Comments2Plugin(i,s,t,e)}))}}})),define("typescript/libraries/file-viewer/src/comments2/plugin/index",["require","exports","tslib","react","react-redux","typescript/libraries/file-viewer/src/plugins/types","typescript/libraries/api_v2/redux/comments2","typescript/libraries/api_v2/redux/media_addon","typescript/libraries/file-viewer/src/comments2/plugin/sidebar_control","typescript/component_libraries/files_components/src/blades/comments/index","typescript/component_libraries/flows/src/components/approval-forms/index","typescript/libraries/file-viewer/src/comments2/plugin/types","typescript/libraries/file-viewer/src/comments2/plugin/snackbar","typescript/libraries/comments2/src/mentions/index","typescript/component_libraries/files_components/src/blades/comments/data/store","typescript/libraries/file-viewer/src/comments2/logging_middleware","typescript/libraries/file-viewer/src/comments2/plugin/navigation_middleware","typescript/component_libraries/files_components/src/blades/comments/data/types","typescript/libraries/file-viewer/src/comments2/plugin/markers","typescript/libraries/file-viewer/src/keyboard/index","ts-keycode-enum","typescript/libraries/comments2/src/components/utils/thread_utils","typescript/libraries/comments2/src/components/utils/approval_utils","typescript/libraries/file-viewer/src/core/extension_constants","typescript/libraries/file-viewer/src/core/utils/index","dig-components/progress_indicators"],(function(e,t,n,i,r,s,a,o,c,d,l,m,u,p,f,b,g,h,v,_,y,C,A,I,O,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Comments2Plugin=t.DEFAULT_COMMENTS_CONFIGURATION=t.MentionsIOClient=void 0,i=n.__importStar(i),Object.defineProperty(t,"MentionsIOClient",{enumerable:!0,get:function(){return p.MentionsIOClient}}),t.DEFAULT_COMMENTS_CONFIGURATION={showCommentsMeatball:!1,comments2UsabilityRevamp:!1,isInBladeRightRail:!1,showApproval:!0,approvalVariant:"OFF"};const S=i.lazy(()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{CommentsPluginPane:t}=yield new Promise((t,n)=>{e(["typescript/libraries/file-viewer/src/comments2/plugin/pane"],t,n)}).then(n.__importStar);return{default:t}})));S.displayName="LazyCommentsPluginPane";const E=i.lazy(()=>n.__awaiter(void 0,void 0,void 0,(function*(){const{AnnotationLayer:t}=yield new Promise((t,n)=>{e(["typescript/libraries/file-viewer/src/comments2/plugin/layer/index"],t,n)}).then(n.__importStar);return{default:t}})));E.displayName="LazyAnnotationLayer";const w=()=>i.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}},i.createElement(T.Spinner,{className:"comments-blade-loading-spinner",size:"standard"}));w.displayName="LoadingIndicator";const M=e=>i.createElement(i.Suspense,{fallback:i.createElement(w,null)},i.createElement(S,Object.assign({},e)));M.displayName="AsyncCommentsPluginPane";const j=e=>i.createElement(i.Suspense,{fallback:i.createElement(i.Fragment,null,e.children)},i.createElement(E,Object.assign({},e)));j.displayName="AsyncAnnotationLayer";t.Comments2Plugin=class{constructor(e,p,T={},S){this.didRequestComments=!1,this.didRequestfocus=!1,this.didRequestActivateThread=!1,this.loadMediaFeatures=()=>n.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.platform.apiv2ClientBase.ns("media_addon").rpc("get_features",void 0,{});this.store.dispatch(o.getFeaturesResultAction({result:e,arg:void 0}));const t=e.frame_precise_comments;null!=t&&this.context.getPluginData().navigation.toggleVideoFrameSteppers(t)}catch(e){this.store.dispatch(o.getFeaturesResultAction({arg:void 0},null,e))}})),this.isSupported=e=>I.resolvePreviewTypeFromExtension(O.getFileExtension(e.name))!==s.PreviewType.CloudDoc,this.handleCancelAnnotating=()=>{this.store.getState().annotationState&&this.store.dispatch(d.cancelAnnotating(this.context.fileViewerId))},this.layerUI={LayerWithEventBubbling:e=>i.createElement(r.Provider,{store:this.store},i.createElement(j,Object.assign({platform:this.platform,context:this.context,config:this.config},e)))},this.rightRailUI={Control:e=>{var t,n;return e.file&&this.isSupported(e.file)?this.config.isInBladeRightRail?i.createElement(r.Provider,{store:this.store},i.createElement(d.CollapsedCommentsBladeButton,{id:m.COMMENTS_PLUGIN_ID,intl:this.platform.intl,fileId:null===(t=e.file)||void 0===t?void 0:t.fileId,sharedLinkURL:null===(n=e.sharedLinkInfo)||void 0===n?void 0:n.url})):i.createElement(r.Provider,{store:this.store},i.createElement(c.CommentsPluginSidebarControl,Object.assign({platform:this.platform,context:this.context,config:this.config},e))):null},Header:()=>{const e=this.context.getPluginData().previewType;return i.createElement(r.Provider,{store:this.store},i.createElement(u.AnnotationSnackbar,{fileViewerId:this.context.fileViewerId,previewType:e}))},VideoSeekBarLayer:e=>i.createElement(r.Provider,{store:this.store},i.createElement(v.CommentMarkers,Object.assign({},e))),Sidebar:e=>{var t;if(!this.isSupported(e.file))return null;if(this.config.isInBladeRightRail){const n=()=>{var t;null===(t=this.approvalIOClient)||void 0===t||t.logger.logRequestApprovalClick("comments_meatball_menu",e.file.fileId)};return i.createElement(r.Provider,{store:this.store},i.createElement(_.KeyboardBindingConnector,{keyboardBindings:this.keybinding}),i.createElement(d.CommentsBlade,{id:m.COMMENTS_PLUGIN_ID,intl:this.platform.intl,fileId:e.file.fileId,sharedLinkURL:null===(t=e.sharedLinkInfo)||void 0===t?void 0:t.url,comments2UsabilityRevamp:this.config.comments2UsabilityRevamp,approvalVariant:this.config.approvalVariant,approvalsLogger:n},i.createElement(M,Object.assign({getAccountData:this.promisedAccount,intl:this.platform.intl,context:this.context,config:this.config,approvalIOClient:this.approvalIOClient},e))))}return i.createElement(r.Provider,{store:this.store},i.createElement(M,Object.assign({getAccountData:this.promisedAccount,intl:this.platform.intl,context:this.context,config:this.config,approvalIOClient:this.approvalIOClient},e)))},isBladeSupported:e=>this.isSupported(e),mediaScrubber:{onClickOutsideMarkers:()=>{this.store.dispatch(d.deactivateAllThreads({fileViewerId:this.context.fileViewerId}))},markers:(e,t)=>{const n=this.store.getState().threads[h.createCommentFileIdentifier(e,t)];return n?Object.values(n).reduce((n,i)=>{const r=(function(e){var t;switch(null===(t=e.annotation)||void 0===t?void 0:t.type){case"audio":case"video":return e.annotation.time;default:return}})(i);return void 0===r?n:[...n,{time:r,onClick:()=>{this.store.dispatch(d.activateThread({fileId:e,sharedLinkURL:t,fileViewerId:this.context.fileViewerId,isThirdParty:i.isThirdParty,threadId:i.id}))}}]},[]):[]}}},this.lifecycle={previewWillInitialize:(e,t,n)=>{if(this.didRequestComments=!1,"fileId"in e){if(t){const e={include_permissions:!0,stream:{identifier:{".tag":"shared_link_details",url:t.url},type:{".tag":"file"}}};n?this.store.dispatch(a.loggedOutListCommentsAction({arg:e})):this.store.dispatch(a.listCommentsAction({arg:e}))}else this.store.dispatch(a.listCommentsAction({arg:{include_permissions:!0,stream:{identifier:{".tag":"file_path_or_id",file_path_or_id:e.fileId},type:{".tag":"file"}}}}));this.didRequestComments=!0}},previewDidInitialize:({threadId:e,shouldFocusApproval:t,shouldFocusComment:n,commentId:i})=>{const r=this.context.getPluginData(),{file:o,sharedLinkInfo:c}=r;if(null==o)throw new Error("Expected non-null file when preview initialized");if(this.didRequestComments||(this.store.dispatch(a.listCommentsAction({arg:{include_permissions:!0,stream:{identifier:{".tag":"file_path_or_id",file_path_or_id:o.fileId},type:{".tag":"file"}}}})),this.didRequestComments=!0),"string"!=typeof e||this.didRequestActivateThread){if("string"==typeof i&&!this.didRequestActivateThread){r.navigation.openSidebar(s.UserActionContext.Sidebar);const e=(null==c?void 0:c.url)||o.fileId,t=Object.values(this.store.getState().threads[e]),n=C.findCommentThread(t,i);n&&this.store.dispatch(d.activateThread({fileId:o.fileId,sharedLinkURL:null==c?void 0:c.url,fileViewerId:this.context.fileViewerId,threadId:n.thread.id,isThirdParty:n.thread.isThirdParty})),this.didRequestActivateThread=!0}}else r.navigation.openSidebar(s.UserActionContext.Sidebar),this.store.dispatch(d.activateInitialThread({fileViewerId:this.context.fileViewerId,threadId:e,fileId:o.fileId})),this.didRequestActivateThread=!0;if(t&&this.store.dispatch(l.setApprovalForm({[o.fileId]:{activeForm:"request",threadId:void 0}})),"string"==typeof i){const e=(null==c?void 0:c.url)||o.fileId,t=Object.values(this.store.getState().threads[e]),n=C.findCommentThread(t,i);if(n){const t=A.findActionableApprovalCommentId(n.thread),i=n.thread.comments.find(({id:e})=>e===t);i&&A.canRespondToApproval(i)&&this.store.dispatch(l.setApprovalForm({[e]:{activeForm:"respond",threadId:n.thread.id}}))}}n&&!this.didRequestfocus&&(r.navigation.openSidebar(s.UserActionContext.Sidebar),this.store.dispatch(d.focusEditor(this.context.fileViewerId)),this.didRequestfocus=!0)},previewWillTeardown:()=>{null!=this.store.getState().annotationState&&this.store.dispatch(d.cancelAnnotating(this.context.fileViewerId))}};const E=g.createMiddleware(p);this.store=f.makeStore({apiv2ClientBase:e.apiv2ClientBase,boltIOClient:S.boltIOClient,mentionsIOClient:S.mentionsIOClient,logger:e=>{p.logUserAction({action:e.event,context:"right_sidebar"})}},[E,b.middleware]),this.platform=e,this.context=p,this.config=Object.assign(Object.assign({},t.DEFAULT_COMMENTS_CONFIGURATION),T),this.approvalIOClient=S.approvalIOClient,this.keybinding=_.getKeyboardBinding({keyCode:y.Key.Escape,callback:this.handleCancelAnnotating}),this.promisedAccount=e.apiv2ClientBase.ns("users").rpc("get_current_account",void 0,{}),this.loadMediaFeatures()}}}));
//# sourceMappingURL=pkg-comments.min.js-vfltk0_AW.map