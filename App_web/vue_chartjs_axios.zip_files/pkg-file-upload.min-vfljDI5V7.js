define("metaserver/static/js/modules/clean/react/file_uploader/api",["require","exports","tslib","metaserver/static/js/modules/clean/csrf","metaserver/static/js/modules/clean/react/browse/crypto_subtle_digest","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/core/uri","metaserver/static/js/modules/clean/react/file_uploader/api_v2_client","metaserver/static/js/modules/clean/react/file_uploader/api_helper"],(function(e,t,s,r,o,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadBlock=t.commitBlocksBatch=t.commitBlocks=void 0,t.commitBlocks=function(e,t,s,o,n,d,c){return new Promise((u,p)=>{try{const p={_subject_uid:e.toString(),dest:t,name:s,overwrite:"1",reported_total_size:o.toString(),t:r.readCsrfToken()||"",client_root_ns_id:d.toString()};c>0&&(p.last_modified=c.toString());const m=new a.URI({scheme:"https",authority:"www.dropbox.com",path:"/commit_web_upload_by_token",query:p}),h=new XMLHttpRequest;h.withCredentials=!0;const _=()=>{let e;return e=507===h.status?l.getErrorOnStatus507(h):0===h.status?i.UploadErrorType.CONNECTION_ERROR:i.UploadErrorType.COMMIT_HTTP_ERROR,{type:e}};return h.onreadystatechange=()=>{if(h.readyState===XMLHttpRequest.DONE)if(200===h.status){const e=JSON.parse(h.responseText);"complete"===e.status?u(l.ok({})):u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.error,method:"commitBlocks/request.onreadystatechange"}))}else u(l.err(_()))},h.open("POST",m.toString(),!0),h.setRequestHeader("Content-Type","application/octet-stream"),h.send(JSON.stringify(n)),h}catch(e){return void u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.message,method:"commitBlocks/try-catch"}))}})},t.commitBlocksBatch=function(e,t,s){return new Promise((r,o)=>{const a={};s.map(e=>{a[e.id]=e});const d=[];n.commitWebUploadTokenBatch(e,t).then(e=>{var t,s;null===(t=e.completed)||void 0===t||t.forEach(e=>{d.push({uploadItem:a[e.local_identifier],status:{isError:!1}})}),null===(s=e.failed)||void 0===s||s.forEach(e=>{const t=e.status.status;let s=i.UploadErrorType.COMMIT_HTTP_ERROR;if("failure"===t[".tag"]){s=(function(e){var t;switch(null===(t=e.failure_reason)||void 0===t?void 0:t[".tag"]){case"invalid_argument":return i.UploadErrorType.COMMIT_INVALID_ARGS;case"too_large_file":case"too_many_blocks":return i.UploadErrorType.FILE_SIZE_ERROR;case"no_write_permission":return i.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR;case"insufficient_quota":return i.UploadErrorType.OVER_QUOTA_ERROR;case"file_ignored":return i.UploadErrorType.IGNORED;case"others":default:return i.UploadErrorType.COMMIT_HTTP_ERROR}})(t)}d.push({uploadItem:a[e.local_identifier],status:{isError:!0,error:{type:s,method:"commitWebUploadTokenBatch"}}})}),r(l.ok(d))}).catch(e=>{r(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.toString(),method:"commitWebUploadTokenBatch/try-catch"}))})})},t.uploadBlock=(e,t,n,d,c)=>new Promise(u=>s.__awaiter(void 0,void 0,void 0,(function*(){try{let s;if(o.windowHasCryptoSubtleDigest()){const e=yield l.hashBlob(d);if(e.isError)return u(e);s=e.result.hash}const p=new a.URI({scheme:"https",authority:"dl-web.dropbox.com",path:"/put_block_returning_token",query:{owner_id:e.toString(),_subject_uid:e.toString(),t:r.readCsrfToken()||"",reported_block_size:d.size.toString(),num_blocks:Math.ceil(n/d.size).toString(),ns_id_for_routing:t.toString()}}),m=new XMLHttpRequest;m.withCredentials=!0;const h=()=>{let e;return e=507===m.status?l.getErrorOnStatus507(m):0===m.status?i.UploadErrorType.CONNECTION_ERROR:i.UploadErrorType.UPLOAD_BLOCK_ERROR,{type:e}};return m.onreadystatechange=()=>{if(m.readyState!==XMLHttpRequest.DONE)return;if(0!==m.status&&200!==m.status)return u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:`request status was ${m.status}`,method:"uploadBlock/request.onreadystatechange"}));const e=JSON.parse(m.responseText);return e.token?o.windowHasCryptoSubtleDigest()&&e.block_hash!==s?u(l.err({type:i.UploadErrorType.HASHES_NOT_EQUAL_ERROR})):void u(l.ok({token:e.token})):u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:`no token in response, block hash:${e.block_hash}, request status:${m.status}`,method:"uploadBlock/request.onreadystatechange"}))},m.onerror=()=>{u(l.err(h()))},m.upload&&(m.upload.onprogress=c),m.onload=()=>{m.status>=400&&u(l.err(h()))},m.open("POST",p.toString(),!0),m.setRequestHeader("Content-Type","application/octet-stream"),m.send(d),m}catch(e){return void u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.message,method:"uploadBlock/try-catch"}))}})))})),define("metaserver/static/js/modules/clean/react/file_uploader/api_helper",["require","exports","tslib","metaserver/static/js/modules/clean/react/browse/crypto_subtle_digest","metaserver/static/js/modules/clean/react/file_uploader/constants"],(function(e,t,s,r,o){"use strict";function i(e){return{isError:!1,result:e}}function a(e){return{isError:!0,error:e}}function n(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}function l(e){for(;e.endsWith("=");)e=e.slice(0,-1);return e}function d(e){return new Promise(t=>{const s=new FileReader;s.onloadend=function(e){if(!(null!==e&&e.target&&e.target.result instanceof ArrayBuffer))throw new Error;t(e.target.result)},s.readAsArrayBuffer(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorOnStatus507=t.hashBlob=t.blobToArrayBuffer=t.removeDigestPadding=t.urlSafeEncodeTranslation=t.err=t.ok=void 0,t.ok=i,t.err=a,t.urlSafeEncodeTranslation=n,t.removeDigestPadding=l,t.blobToArrayBuffer=d,t.hashBlob=function(e){return s.__awaiter(this,void 0,void 0,(function*(){let t;try{t=yield d(e)}catch(e){return a({type:o.UploadErrorType.FILE_READER_NULL_RESULT_ERROR})}try{const e=yield r.encryptArrayBuffer(t),s=l(n(btoa(String.fromCharCode.apply(null,new Uint8Array(e)))));return s?i({hash:s}):a({type:o.UploadErrorType.CLIENT_HASH_EMPTY_ERROR})}catch(e){return a({type:o.UploadErrorType.CLIENT_HASH_DIGEST_ERROR})}}))},t.getErrorOnStatus507=function(e){return"locked_team"===e.error?o.UploadErrorType.LOCKED_TEAM_ERROR:o.UploadErrorType.OVER_QUOTA_ERROR}})),define("metaserver/static/js/modules/clean/react/file_uploader/api_v2_client",["require","exports","metaserver/static/js/api_v2/user_client"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadSessionStart=t.commitWebUploadTokenBatch=void 0,t.commitWebUploadTokenBatch=function(e,t){const r={entries:t};return(new s.UserApiV2Client).ns("upload_backend").rpc("commit_web_upload_token_batch",r,{subjectUserId:e})},t.uploadSessionStart=function(e){return(new s.UserApiV2Client).ns("files").upload("upload_session/start",{close:!1,session_type:{".tag":"concurrent"}},"",{subjectUserId:e})}})),define("metaserver/static/js/modules/clean/react/vault/vault_browse_root_async",["require","exports","tslib","react"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncVaultRoot=void 0,r=s.__importStar(r);const{lazy:o,Suspense:i}=r,a=o(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{VaultRoot:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/vault/vault_browse_root"],t,s)}).then(s.__importStar);return{default:t}})));t.AsyncVaultRoot=e=>r.createElement(i,{fallback:r.createElement("div",null)},r.createElement(a,Object.assign({},e)))})),define("metaserver/static/js/modules/clean/react/browse/controller",["require","exports","tslib","lodash","react","react-router-dom","spectrum-sharing/utils/sharing_constants","metaserver/static/js/modules/clean/analytics","metaserver/static/js/modules/clean/css/css","metaserver/static/js/modules/clean/em_string","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/filetypes","metaserver/static/js/modules/clean/history","metaserver/static/js/modules/clean/navigation","metaserver/static/js/modules/clean/pagelet_logger","metaserver/static/js/modules/clean/pagination_manager","metaserver/static/js/modules/clean/react/app_actions/education/async_extensions_edu_modal","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/browse/actions","metaserver/static/js/modules/clean/react/browse/actions_navigate","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/clean/react/browse/browse_prefetch_loader","metaserver/static/js/modules/clean/react/browse/browse_upload_provider","metaserver/static/js/modules/clean/react/browse/browse_view","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/browse/uri_helper","metaserver/static/js/modules/clean/react/file_uploader/file_uploader","metaserver/static/js/modules/clean/react/file_uploader/store","metaserver/static/js/modules/clean/react/file_uploader/utils","metaserver/static/js/modules/clean/react/file_viewer/async_controller","metaserver/static/js/modules/clean/react/file_viewer/toggle_browse_elements_util","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/clean/react/vault/constants","metaserver/static/js/modules/clean/react/vault/lib/browse_utils","metaserver/static/js/modules/clean/sharing/browse_exports","metaserver/static/js/modules/clean/sharing/ui_notifications_util","metaserver/static/js/modules/core/persistence/storage","metaserver/static/js/modules/clean/upsell/prompt_event_emitter","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/constants/python","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/core/html","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify","metaserver/static/js/modules/core/uri","react-redux","metaserver/static/js/modules/clean/react/browse/async_extensions","metaserver/static/js/modules/clean/react/browse/data/action_creators/index","metaserver/static/js/modules/clean/react/browse/data/folder_overview_selectors","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/folder_overview/data/action_creators","metaserver/static/js/modules/clean/web_user_action_logger","metaserver/static/js/modules/core/transport/query_string_helpers","metaserver/static/js/modules/clean/react/content_suggestions/suggestions_context","metaserver/static/js/modules/clean/react/content_suggestions/gating","metaserver/static/js/modules/clean/react/content_suggestions/api","metaserver/static/js/modules/clean/react/edison/router_utils","metaserver/static/js/modules/clean/react/content_suggestions/actions","metaserver/static/js/modules/clean/react/edison/spa_timing_logger","metaserver/static/js/modules/clean/react/content_suggestions/suggest_dws_prefetch_loader","metaserver/static/js/modules/clean/user_survey/user_survey","metaserver/static/js/modules/clean/sync_everything/constants","metaserver/static/js/modules/clean/react/onboarding_survey/lib/oa_pulsar_campaigns","metaserver/static/js/modules/clean/react/onboarding_survey/components/oa_pulsar_effect_async","metaserver/static/js/modules/clean/business_space/api/internal_client","metaserver/static/js/modules/clean/business_space/browse/data/action_creators","metaserver/static/js/modules/clean/business_space/browse/data/store","metaserver/static/js/modules/clean/business_space/browse/data/selectors","metaserver/static/js/modules/clean/business_space/browse/data/reducer","metaserver/static/js/modules/clean/business_space/browse/constants","metaserver/static/js/modules/constants/web_experience_constants","metaserver/static/js/modules/constants/global_file_upload","metaserver/static/js/modules/clean/react/file_uploader/clean/data/selectors"],(function(e,t,s,r,o,i,a,n,l,d,c,u,p,m,h,_,f,g,v,S,w,y,b,T,F,E,P,I,C,A,U,R,L,x,O,j,N,k,M,D,B,V,q,Q,H,W,z,G,K,X,Z,Y,J,$,ee,te,se,re,oe,ie,ae,ne,le,de,ce,ue,pe,me,he,_e,fe,ge,ve,Se,we,ye,be,Te,Fe,Ee,Pe,Ie){"use strict";function Ce(e){return!!e&&e.isShown()}function Ae(e){return r.pick(e,F.BrowseQueryArg.d,F.BrowseQueryArg.select,F.BrowseQueryArg.preview,F.BrowseQueryArg.activity,F.BrowseQueryArg.rewind,F.BrowseQueryArg.folder_history,F.BrowseQueryArg.from_desktop_client,F.BrowseQueryArg.preselected_for_showcase,F.BrowseQueryArg.folder_overview,F.BrowseQueryArg.unfollow_folder,F.BrowseQueryArg.manage_folder_subscription,F.BrowseQueryArg.highlight,F.BrowseQueryArg.naming_convention,F.BrowseQueryArg.tidy_up,F.BrowseQueryArg.automations,F.BrowseQueryArg.show,...F.FRAMEWORK_ARGS)}function Ue(t){return s.__awaiter(this,void 0,void 0,(function*(){const r=P.getQueryArgs();if("manage"===r.automations&&!r.tidy_up&&!r.naming_convention&&t.autoFoldersEnabled&&t.isInsideFlowsEligibleFolder){const{asyncLaunchAddOrEditAutoFolderModal:r}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/flows/utils/folder_rules"],t,s)}).then(s.__importStar);r({fqPath:t.fqPath,nsId:t.nsId,user:t.user,entryPoint:"desktop"})}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedBrowseControllerElementWithRouter=t.ConnectedBrowseControllerElement=t.BrowseController=t.maybeShowAutoFolderModal=t.showTidyUpModalIfNeeded=t.showNamingConventionsModalIfNeeded=void 0,r=s.__importStar(r),o=s.__importDefault(o),c=s.__importStar(c),p=s.__importDefault(p),g=s.__importStar(g),w=s.__importStar(w),A=s.__importStar(A),q=s.__importStar(q),z=s.__importStar(z),G=s.__importStar(G),ee=s.__importStar(ee),te=s.__importStar(te),se=s.__importStar(se),re=s.__importStar(re),oe=s.__importStar(oe),ie=s.__importStar(ie),t.showNamingConventionsModalIfNeeded=(t,r,o,i,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(P.getQueryArgs().naming_convention&&t){const[{showNamingConventionsModal:t},{NamingConventionOrigin:n}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/naming_conventions_modal"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/types"],t,s)}).then(s.__importStar)]);t({currentUserId:o,targetPath:i,namespaceId:a,origin:n.from_desktop}),yield ae.WebUserActionLog.log(o,Q.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:a,origin:n.from_desktop,positioning:r?1:0})}})),t.showTidyUpModalIfNeeded=(t,r,o,i,a,n,l,d)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(P.getQueryArgs().tidy_up&&t){const{showTidyUpModal:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/tidy_up/modal/tidy_up_modal"],t,s)}).then(s.__importStar);t({currentUserId:r,targetPath:o,namespaceId:i,isRewindEnabled:n,features:a,actionSurface:Q.ActionSurfaceLogValue.DESKTOP_ENTRYPOINT,subfolders:l,isInsideFlowsEligibleFolder:d})}})),t.maybeShowAutoFolderModal=Ue;class Re extends o.default.Component{constructor(o){super(o),this.deferredCheckForMissingStarredData=r.noop,this.updateStarredData=r.noop,this.showEmailVerificationModalsIfNeeded=()=>s.__awaiter(this,void 0,void 0,(function*(){if(!(this.props.emailJustVerified||this.props.emailJustVerifiedAndChanged||this.props.sendVerificationEmail))return;const{EmailVerification:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/account/email"],t,s)}).then(s.__importStar);this.props.emailJustVerified?t.getForRole(this.props.user.role).show_verified_modal():this.props.emailJustVerifiedAndChanged?t.getForRole(this.props.user.role).show_verified_and_changed_modal():this.props.sendVerificationEmail&&t.getForRole(this.props.user.role).show_sent_modal()})),this.handlePostTTIPrefetchComplete=r=>s.__awaiter(this,void 0,void 0,(function*(){const o=r["exp-browse-post-tti-experiments"],i=r["exp-uploader-post-tti-experiments"],a=!!r["is-over-free-quota"],n=!!r["maybe-render-team-admin-modals"],l=!!r["has-excluded-ns-ids"],d=r["preferred-editors"],c=r["first-task-props"],u=r["mobile-web-invites"],m=r["family-member-count"],h=r["imm-experiments"],_=r["suggested-items-to-move-info"],f=r["users-jtbd-interest-info"],g=r["user-has-shared-file-or-folder-info"];o.expShouldShowNcctPaywall&&z.redirect("/ncct-trial-end"),this.props.setBrowsePostTTIExperiments({browsePostTTIExperiments:o}),this.props.setBrowsePostTTIData({browsePostTTIData:{isOverFreeQuota:a,hasExcludedNsIds:l,uploaderPostTTIExperiments:i,preferredEditors:d,firstTaskProps:c,mobileWebInvites:u,familyMemberCount:m,immExperiments:h,suggestedItemsToMoveInfo:_,usersJtbdInterestInfo:f,userHasSharedFileOrFolderInfo:g}}),V.promptBufferedEventEmitter.on(V.Events.ON_PROMPT_INITIALIZED,t=>s.__awaiter(this,void 0,void 0,(function*(){if((!t||!t.didMainCampaignLoad()&&!t.didCampaignForUserEducationLoad())&&n){const{postTTINCCTReminderModal:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/ncct/post_tti_ncct_modal"],t,s)}).then(s.__importStar);t()}})));const{markClinkTooltipSeenAndHide:v,showClinkTooltip:S,TooltipType:w}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/growth/first_task/first_task"],t,s)}).then(s.__importStar),y=null==c?void 0:c.seen_desktop_tooltip,b=null==c?void 0:c.member_info;y?v():(void 0!==m&&m>1||b&&b.users.length>1)&&S(w.Members),yield t.showNamingConventionsModalIfNeeded(o.expNamingConventionsDesktopEntrypoint,o.expNamingConventionsPositioning,this.props.userId,this.props.initFqPath,this.props.nsId),yield t.showTidyUpModalIfNeeded(o.expTidyUpDesktopEntrypoint,this.props.userId,this.props.initFqPath,this.props.nsId,o,this.props.browseExperiments.folderHistoryRollbacks,this.props.unsortedFiles.filter(e=>e.is_dir).toArray(),this.props.isInsideFlowsEligibleFolder),Ue({autoFoldersEnabled:o.expFlowsAutomatedFolderUI,isInsideFlowsEligibleFolder:this.props.isInsideFlowsEligibleFolder,fqPath:this.props.initFqPath,nsId:this.props.nsId,user:this.props.user}),o.expEnableBackupWeb?this.props.setBackupFolders(this.props.user):fe.isBackupBrowse()&&p.default.replace_state(this.getUrlForFQPath("/home",this.props.path)),o.expTeamSpaceTeamTypesSprigSurvey&&_e.UserSurvey.addAttribute("launchTeamSpaceTeamTypesSurvey","true"),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/business_space/browse/browse_exports"],t,s)}).then(s.__importStar).then(({renderPrivacyColumnClientAccessCell:e})=>{const t=ye.getStoreForClientPortal();!o.expBsxBusinessSpaceBrowse&&o.expBsxClientSpaceVariant!==Fe.BsxClientSpaceVariant.V0||fe.isBackupBrowse()||(this.setState({bsxBusinessSpaceBrowseEnabled:!0}),this.businessSpaceClient.browse_find(this.props.initFqPath).then(s=>{s.found&&this.setState({renderPrivacyColumnClientAccessCell:e}),o.expBsxClientSpaceVariant===Fe.BsxClientSpaceVariant.V0&&(this.setState({bsxClientSpaceVariant:Fe.BsxClientSpaceVariant.V0}),t.dispatch(we.getActionForSetBusinessSpaceInfo(s)),this.updateVisibilities(s))}))})})),this.updateVisibilities=e=>{const t=ye.getStoreForClientPortal();if(this.props.files&&e.found){const s=e.business_space_xgid,r={".tag":"unknown_object_visibility_type"},o=this.props.files.map(e=>e.fq_path).toArray();this.businessSpaceClient.get_objects_visibility(s,r,o).then(e=>{e.objects_visibility&&t.dispatch(we.getActionForSetVisibilities({objects_visibility:e.objects_visibility}))})}},this.handlePostTTIPrefetchError=e=>{G.reportException({err:new Error("failed to load post TTI experiments")})},this.handlePreviewAndShareModalsOnLoad=e=>{const t=this.getPathFromProps(),{user:s}=this.props,r=!!this.props.openPreview,o=!!this.props.showShareModal,i=this.props.sharePrefillEmail,a=i?i.split(","):void 0;if(r&&!e){Z.Notify.error(X.intl.formatMessage({id:"D+KIIm",defaultMessage:"The file doesn’t exist"}));const{urlPrefix:e}=this.props,s=this.getUrlForFQPath(e,t),r=p.default.deconstruct_url().qargs;delete r.preview,p.default.replace_state(s,r)}e?(U.asyncOpenPreview({containerId:F.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[e],fileViewAction:H.FileViewActionType.CLICK,fileViewOrigin:H.FileViewOriginType.BROWSE,fileViewTarget:H.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:s,onFileViewerDidMount:()=>{R.hideElementsBehindFileViewer(),this.props.setIsFileViewerShown({isShown:!0})},onFileViewerUnmount:()=>{R.showElementsBehindFileViewer(),this.props.setIsFileViewerShown({isShown:!1}),this.restoreUrlAfterFileViewClose()}}),o&&q.waitForTTI().then(()=>{this.mounted&&M.asyncShowPrefilledShareModal({user:s,sharePrefillEmails:a,content:e,setUrl:this.props.setUrl})})):o&&this.showShareModalForCurrentPath(a)},this.receiveStateFromStores=()=>{this.setState(this.getStateFromStores())},this.handleComponentTTI=e=>{var t;const s=null!==q.time_to_interactive(),r=(null===(t=this.browseLogger)||void 0===t?void 0:t.ttiLogged)&&"FilesViewController"===e;s||r?this.ajaxRequestWebTimer?(this.ajaxRequestWebTimer.markTimeToInteractive(),delete this.ajaxRequestWebTimer):r||me.markTimeToInteractive(!0):this.browseLogger&&this.browseLogger.componentReady(e)},this.getFileByFilename=e=>this.props.files.find(t=>c.filename(t.fq_path)===e)||null,this.toggleRewindIfNecessary=()=>{const e=P.getQueryArgs().activity||P.getQueryArgs().rewind;e&&!this.props.isRewindVisible&&this.props.showRewind(),!e&&this.props.isRewindVisible&&this.props.hideRewind()},this.toggleFolderHistoryIfNecessary=()=>{const e=P.getQueryArgs().folder_history;e&&!this.props.isFolderHistoryVisible&&this.props.showFolderHistoryPanel(),!e&&this.props.isFolderHistoryVisible&&this.props.hideFolderHistoryPanel()},this.showShareModalForCurrentPath=e=>{const{user:t}=this.props,s=this.getPathFromProps();q.waitForTTI().then(()=>{if(!this.mounted)return;const r=this.props.nsId,o=this.props.nsPath;M.asyncShowPrefilledShareModal({user:t,sharePrefillEmails:e,content:{fqPath:s,isFolder:!0,nsId:r&&o?r:null,targetNsId:r&&!o?r:null},setUrl:this.props.setUrl})})},this.handleMaestroNavigationAction=e=>{if(e.method!==m.NavigationMethod.REDIRECT)return!1;const t=Y.URI.parse(e.url);return p.default.push_state(t.getPath(),Ae(t.getQuery())),!0},this.handleFileLocationChange=(e,t)=>{var s;e=`/${Y.URI.decode(e)}`,this.ensureFileViewerIsOpenedOrClosedIfNeeded(t),this.toggleRewindIfNecessary(),this.toggleFolderHistoryIfNecessary();const r=!c.paths_are_equal(this.props.path,e);t.share&&!this.props.showShareModal&&this.showShareModalForCurrentPath();const o="1"===t.d!=!!this.props.shouldShowDeletedFiles;if(!(r||o||t.reload))return;t.reload&&(delete t.reload,this.props.setUrl({path:this.props.path,qargs:t})),this.props.setPath({path:e}),this.props.setLoadingState({loadingState:x.LoadingState.LOADING_FIRST_PAGE,path:e}),this.props.setShouldShowDeletedFiles({shouldShowDeletedFiles:"1"===t.d}),(null!==q.time_to_interactive()||(null===(s=this.browseLogger)||void 0===s?void 0:s.ttiLogged))&&this.ensureTimer("browse_ajax","browse_ajax_nav");const i=this.props.currentSort.sortDirection===O.SortDirection.ASCENDING,a="1"===t.d;this.loadPathApi2({path:e,sortIsAscending:i,includeDeleted:a,hasPathChanged:r})},this.sortType=()=>L.SortIsFilename.includes(this.props.currentSort.sortField)?{".tag":"files_by_name"}:this.props.currentSort.sortField===O.SortField.MODIFIED?{".tag":"files_by_modified"}:{".tag":"files_by_size"},this.loadPathApi2=({path:e,sortIsAscending:t,includeDeleted:r,hasPathChanged:o})=>s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield w.loadPath2({userId:this.props.user.id,path:e,sortType:this.sortType(),sortIsAscending:t,includeDeleted:r,rootNsId:fe.isBackupBrowse()?this.props.rootNsId:void 0});this.ajaxRequestWebTimer&&(this.ajaxRequestWebTimer.fetchedDataRequiredForTTI(),this.ajaxRequestWebTimer.end()),this.handleFileLocationChangeSuccess(e,s,o)}catch(t){const s=(function(e){let t="";return void 0!==e.status&&("auth_failed"===e.status[".tag"]?t=X.intl.formatMessage({id:"8nB2Fu",defaultMessage:"Not authorized to browse {path}."},{path:e.path}):"rate_limited"===e.status[".tag"]?t=X.intl.formatMessage({id:"2NDCop",defaultMessage:"Too many attempts. Try again later."}):"invalid_path"===e.status[".tag"]?t=X.intl.formatMessage({id:"o19fmC",defaultMessage:"Unsupported path provided {path}."},{path:e.path}):"folder_not_found"===e.status[".tag"]?t=X.intl.formatMessage({id:"VZE6IM",defaultMessage:"The folder ‘{path}’ doesn’t exist."},{path:e.path}):"folder_is_deleted"===e.status[".tag"]&&(t=X.intl.formatMessage({id:"qZpUNY",defaultMessage:"The folder ‘{path}’ is deleted."},{path:e.path}))),t})(t.error);s?j.Snackbar.fail(s,"browse"):(G.reportException({err:t,force:!0,severity:G.SEVERITY.CRITICAL,tags:["browse","component:browse"],exc_extra:Object.assign({},t)}),j.Snackbar.fail(X.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}),"browse")),c.paths_are_equal(e,"/")?this.props.setLoadingState({path:e,loadingState:x.LoadingState.LOAD_ERROR}):this.props.setUrl({path:"/"})}})),this.handleFileLocationChangeSuccess=(e,t,s)=>{if(this.props.setIsRewindButtonEnabled({path:e,userId:this.props.user.id,userSkuHasRewind:!!this.browseExperiments.folderHistoryRollbacks}),this.props.setFolderMemberCounts({contentId:String(t.context.currentNSID),userId:this.props.user.id}),!P.getQueryArgs().query){if(s&&this.props.handleFolderOverviewPrefetch(Object.assign(Object.assign({},t.folderOverview),{path:e,componentNamespace:F.BrowseFolderOverviewComponentNamespace})),this.props.setPath({path:e}),this.props.setMountPoints({mountPoints:t.mountPoints}),this.state.bsxBusinessSpaceBrowseEnabled){const t=ye.getStoreForClientPortal();this.businessSpaceClient.browse_find(e).then(e=>{this.state.bsxClientSpaceVariant===Fe.BsxClientSpaceVariant.V0&&(t.dispatch(we.getActionForSetBusinessSpaceInfo(e)),this.updateVisibilities(e))})}if(t.hasMore){this.props.setPathData({path:e,files:[],context:t.context,paginatedTotalNumFiles:t.paginatedTotalNumFiles,currentFolderInfo:t.currentFolderInfo?E.File.fromApiV2Object(t.currentFolderInfo):void 0}),_.PaginationManager.create({firstPage:{items:t.items,has_more_items:!0,next_request_voucher:t.nextRequestVoucher},keyName:"sjid",userID:this.props.user.id,newDataAvailableCallback:(t,s)=>{const r=t.areAllItemsReady()?x.LoadingState.LOADED:x.LoadingState.LOADING_REMAINING_PAGES;this.props.appendFiles({path:e,files:s.map(e=>"object"==typeof e.type?E.File.fromApiV2Object(e):E.File.fromServerObject(e))}),this.props.setLoadingState({path:e,loadingState:r}),t.areAllItemsReady()&&t.stopAutoFetching()},fetchNextFn:y.apiV2FetchNextFn}).startAutoFetching()}else this.props.setPathData({path:e,files:t.items.map(e=>"object"==typeof e.type?E.File.fromApiV2Object(e):E.File.fromServerObject(e)),paginatedTotalNumFiles:t.paginatedTotalNumFiles,context:t.context,currentFolderInfo:t.currentFolderInfo?E.File.fromApiV2Object(t.currentFolderInfo):void 0}),this.props.setLoadingState({loadingState:x.LoadingState.LOADED,path:e})}},this.getPathFromProps=()=>this.props.initFqPath||"/",this.markTTVIfNeeded=()=>{!this.hasTTVBeenLogged&&this.mounted&&this.state.hasPrefetchLoaded&&(me.markTimeToView(),this.hasTTVBeenLogged=!0)},this.handleFileListUpdated=()=>{Ce(this.state.fileViewerController)?this.props.files.isEmpty()?this.state.fileViewerController.close():this.state.fileViewerController.updateFiles(this.props.files.toJS()):this.ensureFileViewerIsOpenedOrClosedIfNeeded(P.getQueryArgs()),this.prefetchPreviewData(this.props.files.toArray(),this.props.user)},this.handleOnNavigateToFileOrFolder=(e,t={})=>{const{actionSource:s}=t;this.props.hideRewind();const r=window.pageYOffset;this.completeNavigateToFileOrFolder(e,s,()=>{window.scrollTo({top:r})})},this.completeNavigateToFileOrFolder=(e,t,s)=>{const{vaultApi:r,vaultLoggingTypes:o}=this.state,{user:i,viewer:a,viewType:l,rightRailCollapsed:d}=this.props,{ns_id:p,sjid:m,file_id:h,fq_path:_,bytes:f,ext:v,request_id:w}=e;g.logOpenRow({uid:i.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:l,file_nsid:p,file_sjid:m,file_id:h,file_name:c.filename(e.fq_path),file_path:_,file_size:f,file_type:e.type,file_extension:v,request_id:w,action_source:t,vaultApi:r,vaultLoggingTypes:o,rightRailState:d?"collapsed":"opened"}),e.type===u.FileTypes.TEAM_SHARED_FOLDER&&n.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:a.team_id}),S.browseNavigateActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:s,fileViewAction:H.FileViewActionType.CLICK,skipFileViewerRouting:ue.shouldUseReactRouter(),performSpaRouting:ue.shouldUseReactRouter()})},this.uploadAjaxInterceptor={interceptUploadPrecheck:e=>e,interceptUpload:(e,t)=>{let s=t.ns_id_for_routing;if(!s){const t=this.props.mountPoints,{rootNSID:r}=this.props.browseContext;W.assert(null!=t,"mountPoints is null"),W.assert(null!=r,"rootNSID is null"),s=A.getNsId(t,r,e.dest)}return Object.assign(Object.assign({},t),{ns_id_for_routing:s,ns_id:s})}},this.fileViewerIsShown=()=>Ce(this.state.fileViewerController),this.ensureFileViewerClosedIfNotPreviewing=e=>{e&&!e.preview&&Ce(this.state.fileViewerController)&&this.state.fileViewerController.close()},this.prefetchPreviewData=(e,t)=>{this.state.fileViewerController&&this.state.fileViewerController.prewarmPreviewData(e,t)},this.ensureFileViewerIsOpenedOrClosedIfNeeded=e=>{if(e.preview&&!Ce(this.state.fileViewerController)){const t=this.getFileByFilename(e.preview);t&&S.browseNavigateActions.navigateToFileOrFolder({file:t,skipFileViewerRouting:ue.shouldUseReactRouter()})}else!e.preview&&Ce(this.state.fileViewerController)&&this.state.fileViewerController.close()},this.getLearnMoreLinkHandler=()=>{window.open("/help/business/unsynced-team-folder","_blank")},this.getAndClearHighlightQarg=()=>{const e=P.getQueryArgs()[F.BrowseQueryArg.highlight];if(e&&p.default.remove_query_param(F.BrowseQueryArg.highlight),null!=e&&ge.isOAPulsarCampaign(e))return e},this.businessSpaceClient=new Se.BusinessSpaceClient(this.props.user),C.uploaderStore.add_change_listener(this.receiveStateFromStores),this.state=Object.assign(Object.assign({},this.getStateFromStores()),{hasPrefetchLoaded:!1,highlight:null,bsxBusinessSpaceBrowseEnabled:!1})}get browseExperiments(){return this.props.browseExperiments}UNSAFE_componentWillMount(){const{urlPrefix:e,user:t,viewer:s}=this.props,r=this.props.shareLink,o=!!this.props.openPreview,i=this.getPathFromProps();this.browseLogger=new h.PageletLogger("browse",["FilesViewController"],!0,{view_type:this.props.viewType.toLowerCase()}),r||o||(function(e){const t=P.getQueryArgs();p.default.replace_state(e,Ae(t))})(this.getUrlForFQPath(e,i));const a=s.get_users().map(e=>e.id);B.UserLocalStorage.clearOtherUsers(a);const n=new y.BrowsePrefetchLoader({user:t,path:i,fqPathsToSelect:this.props.selectFqPaths},{onPrefetchComplete:e=>{if(this.setState({hasPrefetchLoaded:!0}),e.isError())this.handlePreviewAndShareModalsOnLoad(null);else{this.handlePreviewAndShareModalsOnLoad(e.fromPreviewFileInfo());const t=e.fromCurrentFolderFileInfo();t?this.props.handleFolderOverviewPrefetch(Object.assign(Object.assign({},t),{path:i,componentNamespace:F.BrowseFolderOverviewComponentNamespace})):this.props.addFolderOverviewLoadedComponent({componentNamespace:F.BrowseFolderOverviewComponentNamespace,component:"draftjs"})}me.markFetchedDataRequiredForTTI(),this.markTTVIfNeeded()},onPrefetchError:e=>{if(k.isInsideVault(i)){const e=void 0===z.get_hash()?"":"#"+z.get_hash();z.redirect(N.VAULT_URL+e)}else this.setState({hasPrefetchLoaded:!0}),G.reportException({err:e||new Error("Failed to prefetch browse data"),severity:"user-error",exc_extra:{path:i}}),this.props.setUrl({path:""}),this.props.setLoadingState({loadingState:x.LoadingState.LOAD_ERROR,path:i}),this.handleFileLocationChange("",{})},onLoadComplete:()=>{},onPostTTIPrefetchComplete:this.handlePostTTIPrefetchComplete,onPostTTIPrefetchError:this.handlePostTTIPrefetchError},{onInitializeEverything:v.browseActions.initializeEverything,onAddFilesAndSetLoadingState:v.browseActions.addFilesAndSetLoadingState});n.isPrefetching()&&n.handlePrefetch();for(const e of F.browseSidebarNavigationCommandIds)m.navigationActionDispatcher.handle(this.handleMaestroNavigationAction,{actionId:e});ue.shouldUseReactRouter()||p.default.add_callback(e,this.handleFileLocationChange,!0)}componentDidMount(){this.mounted=!0;const t=this.getPathFromProps(),{user:o}=this.props,i=this.props.shareLink,n=!!this.props.openPreview,u=this.props.fromSclSyncModal;if(this.props.setIsRewindButtonEnabled({path:t,userId:this.props.user.id,userSkuHasRewind:this.browseExperiments.folderHistoryRollbacks}),this.props.setFolderMemberCounts({contentId:String(this.props.nsId),userId:this.props.user.id}),u&&(o.is_cdm_member?(function(e){const t=X.intl.formatMessage({id:"7sFPiN",defaultMessage:"Added “{folder_name}” <a>Learn More</a>"},{folder_name:d.Emstring.em_snippet(c.filename(e),a.SNIPPET_SIZES.FILENAME),a:e=>`<a href="/help/business/team-space-overview#acceptfolder">${e}</a>`});Z.Notify.success(new K.HTML(t))})(t):(function(e){Z.Notify.success(X.intl.formatMessage({id:"YYLxxv",defaultMessage:"{file_name} added to your Dropbox."},{file_name:c.filename(e)}))})(t)),this.props.showShareSuccessSnackbar){const e=c.filename(t);D.showInBandShareSuccessSnackbar(e)}this.shouldShowUnsyncNotification()&&this.showUnsyncNotification(),i&&!n&&o.is_cdm_member&&(function(e){const t=c.parent_dir(e);"/"!==t&&Z.Notify.success(X.intl.formatMessage({id:"nZ/TMQ",defaultMessage:"Folder is in {path}"},{path:d.Emstring.em_snippet(t,22)}))})(t),this.toggleRewindIfNecessary(),this.toggleFolderHistoryIfNecessary(),this.markTTVIfNeeded(),Re.mountFileViewerTarget();const p=this.getAndClearHighlightQarg();p&&this.setState({highlight:p}),q.waitForTTI().then(()=>{l.require_css("/static/css/main_browse_post_tti-vflGSYMOr.css");const t=([[e,{SharedWithStore:t},{checkForMissingStarredData:s,StarredStore:o,getStoreForStarred:i,fetchMissingStarredStatuses:a,idTypePairFromStarrableItem:n},l,d],[c,u,{BloodhoundContactsV2:p},m,h,_],[g,v]])=>{if(!this.mounted)return;const{user:S,path:w,files:y}=this.props,b=y.toArray();if(t.initializeWith({path:w,files:b}),Ee.STARRED_STORE_REDUX){const e=i();this.updateStarredData=()=>e.dispatch(a(this.props.files.toArray().map(n))),this.updateStarredData()}else{s({items:b,user:S});const e=o.addListener(()=>{this.setState({starredState:o.getLoadingStates()})});this.deferredCheckForMissingStarredData=()=>r.defer(()=>{s({items:this.props.files.toArray(),user:S})}),this.removeStarredStoreListener=()=>{e()}}p.getOrCreateForUser(S),this.setState({fileViewerController:e,vaultApi:g,vaultLoggingTypes:v}),this.props.setArePostTTIModulesLoaded({arePostTTIModulesLoaded:!0}),this.showEmailVerificationModalsIfNeeded(),this.prefetchPreviewData(y.toArray(),S);const T=this.props.shouldOpenExtensionsEduModal;T&&f.asyncShowExtensionsEduModal(S.id,T)};t.perfName="browse_post_tti",Promise.all([Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/file_viewer/controller"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/shared_with"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/starred/browse_exports"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/file_modal_controller"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/sharing/share_modal_util"],t,s)}).then(s.__importStar)]),Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/sharing/ui_util"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/sharing/wizard/wizard_modals"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/contacts/bloodhound_contacts_v2"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/unity_browse_interface"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/unity/features"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/unity/check_file_cache"],t,s)}).then(s.__importStar)]),Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/vault/lib/api"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["typescript/component_libraries/vault/src/common/logging-types"],t,s)}).then(s.__importStar)])]).then(t)})}UNSAFE_componentWillUpdate(e,t){e.files.equals(this.props.files)||r.defer(this.handleFileListUpdated)}componentDidUpdate(e){e.loadingState===x.LoadingState.LOADING_FIRST_PAGE&&this.props.loadingState!==e.loadingState&&this.markTTVIfNeeded();const t=e.files!==this.props.files;t&&(Ee.STARRED_STORE_REDUX?this.updateStarredData():this.deferredCheckForMissingStarredData());const s=!e.businessSpaceInfo.found&&this.props.businessSpaceInfo.found;if((t||s)&&this.updateVisibilities(this.props.businessSpaceInfo),ue.shouldUseReactRouter()&&e.location&&this.props.location&&(e.location.pathname!==this.props.location.pathname||e.location.search!==this.props.location.search)){const e=new RegExp(`^${this.props.urlPrefix}/|^${this.props.urlPrefix}|^/`),t=this.props.location.pathname.replace(e,"");this.handleFileLocationChange(t,ne.parseQueryString(this.props.location.search))}if(e.user!==this.props.user&&(this.businessSpaceClient=new Se.BusinessSpaceClient(this.props.user)),e.selectedFiles!==this.props.selectedFiles&&this.state.bsxBusinessSpaceBrowseEnabled){const e=ye.getStoreForClientPortal();if(1===this.props.selectedFiles.count()){const t=this.props.selectedFiles.first().fq_path;this.businessSpaceClient.browse_find(t).then(t=>{this.state.bsxClientSpaceVariant===Fe.BsxClientSpaceVariant.V0&&e.dispatch(we.getActionForSetSelectedFileBusinessSpaceInfo(t))})}else e.dispatch(we.getActionForSetSelectedFileBusinessSpaceInfo(Te.defaultClientPortalState.selectedFileBusinessSpaceInfo))}}componentWillUnmount(){this.removeStarredStoreListener&&this.removeStarredStoreListener(),Re.unmountFileViewerTarget(),C.uploaderStore.remove_change_listener(this.receiveStateFromStores),V.promptBufferedEventEmitter.reset(),this.mounted=!1}getStateFromStores(){return{isDraggingInternalFiles:I.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:I.FileUploaderController.isDraggingExternalFiles(),isUploadModalOpen:I.FileUploaderController.isUploadModalOpen()}}restoreUrlAfterFileViewClose(){let e;const{urlPrefix:t}=this.props,s=this.getUrlForFQPath(t,this.props.path);e=this.props.openPreview?r.omit(P.getQueryArgs(),F.BrowseQueryArg.preview,F.BrowseQueryArg.select):{},p.default.replace_state(s,e)}getUrlForFQPath(e,t){const{backupFolderPath:s}=this.props;return e===fe.BACKUP_BROWSE_ROOT&&null!==s&&(t=t.substr(t.indexOf(s))),e+("/"===t?"":Y.URI.encode_parts(t))}ensureTimer(e,t){this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&(this.ajaxRequestWebTimer.abort(),q.delete_timer(this.ajaxRequestWebTimer.getContextName()),this.ajaxRequestWebTimer=void 0),this.ajaxRequestWebTimer?this.ajaxRequestWebTimer.restart():(q.delete_timer(e),this.ajaxRequestWebTimer=q.get_timer(e),this.ajaxRequestWebTimer.initialize({requireTTI:!0,requireTTV:!1,url:t}))}shouldShowUnsyncNotification(){return this.props.shouldShowUnsyncNotification}showUnsyncNotification(){j.Snackbar.show(o.default.createElement(j.Snackbar,{variant:"generic",title:X.intl.formatMessage({id:"Imk9XS",defaultMessage:"Do you also need this on your computer?"}),timeoutDelayMs:1e5,actionButtonText:X.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),closeButtonText:X.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),onActionClick:this.getLearnMoreLinkHandler,id:"browse-unsync"}))}render(){const{isUploadModalOpen:e,starredState:t,isDraggingExternalFiles:s,isDraggingInternalFiles:r,highlight:i,renderPrivacyColumnClientAccessCell:a}=this.state,{browseContext:n,selection:l,selectedFiles:d,browsePostTTIExperiments:c,canDisplayFolderSizes:u,clickFolderHistoryTimestamp:p,clickRewindTimestamp:m,extensionsFeatureFlags:h,files:_,hideRewind:f,hideFolderHistoryPanel:g,showFolderHistoryPanel:v,isQueryingFolderSizes:S,isRewindVisible:w,isFolderHistoryVisible:y,loadingState:F,paginatedTotalNumFiles:E,path:P,setUrl:I,shouldShowDeletedFiles:C,showRewind:A,user:U,viewType:R,viewTypeColumns:L,sharingServiceInfo:x,shouldShowVaultEmptyState:O,shouldShowFamilyEmptyState:j,pinnedItems:N,emptyFolder:k,browsePostTTIData:M,setHideFilesAndSidebar:D,shouldHideFilesAndSidebar:B,clearSelection:V,rightRailCollapsed:q,unsortedFiles:Q,isInsideFlowsEligibleFolder:H,isInsideBackupFolder:W,backupFolderPath:z,backupFolders:G}=this.props,K=o.default.createElement(b.BrowseUploadProvider,{user:U},o.default.createElement(T.BrowseView,{userVersionHistoryLength:this.props.userVersionHistoryLength,onNavigateToFileOrFolder:this.handleOnNavigateToFileOrFolder,clickRewindTimestamp:m,clickFolderHistoryTimestamp:p,context:n,encryptionOptions:this.props.encryptionOptions,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,files:_,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:Pe.FILE_UPLOAD_USE_REDUX?this.props.isDraggingExternalFilesRedux:s,isDraggingInternalFiles:Pe.FILE_UPLOAD_USE_REDUX?this.props.isDraggingInternalFilesRedux:r,isFileViewerShown:this.fileViewerIsShown,isFolderHistoryVisible:y,isRewindVisible:w,isUploadModalOpen:e,isInsideBackupFolder:W,backupFolderPath:z,backupFolders:G,loadingState:F,path:P,selectedFiles:d,selection:l,shouldOpenUploadModal:this.props.shouldOpenUploadModal,shouldShowDeletedFiles:C,starredState:t,totalNumItems:E,uploadAjaxInterceptor:this.uploadAjaxInterceptor,user:U,viewType:R,canDisplayFolderSizes:u,columns:L[R],viewTypeColumns:L,isQueryingFolderSizes:S,nsId:this.props.nsId,browseExperiments:this.browseExperiments,browsePostTTIExperiments:c,browsePostTTIData:M,onShowRewind:A,onCloseRewind:f,onCloseFolderHistoryPanel:g,onShowFolderHistoryPanel:v,extensionsFeatureFlags:h,sharingServiceInfo:x,shouldShowVaultEmptyState:O,shouldShowFamilyEmptyState:j,pinnedItems:N,onSetUrl:I,emptyFolder:k,setHideFilesAndSidebar:D,shouldHideFilesAndSidebar:B,clearSelection:V,rightRailCollapsed:q,showPlusPlusSetupModal:this.props.showPlusPlusSetupModal,isSmbPersonalization:this.props.isSmbPersonalization,unsortedFiles:Q,isInsideFlowsEligibleFolder:H,renderPrivacyColumnClientAccessCell:a}),i&&o.default.createElement(ve.AsyncOAPulsarEffect,{campaign:i}));return!W&&de.isBrowseSuggestionsEnabled(this.browseExperiments.browseContentSuggestionsVariant)?o.default.createElement(le.SuggestionsContextProvider,{user:U,fetchSuggestedItemsInFolder:ce.fetchSuggestedItemsInFolder,source:"browse",trackDismissSuggestedItem:ce.trackDismissSuggestedItem,openSuggestedItem:pe.createOpenSuggestedItemFromBrowseFn(this.handleOnNavigateToFileOrFolder),openSuggestedParent:pe.createOpenSuggestedParentFromBrowseFn(e=>{I({path:e})},U),folderPathString:P,prefetchSuggestedItems:he.prefetchSuggestions},K):K}}t.BrowseController=Re,Re.mountFileViewerTarget=()=>{let e=document.getElementById(F.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=F.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},Re.unmountFileViewerTarget=()=>{const e=document.getElementById(F.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},Re.displayName="BrowseController";const Le={appendFiles:ee.appendFiles,setIsRewindButtonEnabled:ee.setIsRewindButtonEnabled,hideRewind:ee.hideRewind,showRewind:ee.showRewind,hideFolderHistoryPanel:ee.hideFolderHistoryPanel,showFolderHistoryPanel:ee.showFolderHistoryPanel,setBrowsePostTTIExperiments:ee.setBrowsePostTTIExperiments,setBrowsePostTTIData:ee.setBrowsePostTTIData,setLoadingState:ee.setLoadingState,setMountPoints:ee.setMountPoints,setPath:ee.setPath,setPathData:ee.setPathData,setShouldShowDeletedFiles:ee.setShouldShowDeletedFiles,setUrl:ee.setUrl,setArePostTTIModulesLoaded:ee.setArePostTTIModulesLoaded,setIsFileViewerShown:ee.setIsFileViewerShown,handleFolderOverviewPrefetch:ie.handlePrefetch,addFolderOverviewLoadedComponent:ie.addLoadedComponent,setHideFilesAndSidebar:ee.setHideFilesAndSidebar,clearSelection:ee.clearSelection,setFolderMemberCounts:ee.setFolderMemberCounts,setBackupFolders:ee.setBackupFolders},xe=J.connect(e=>{const{context:t,sortedFilesWithFolderSizes:s,isFolderHistoryVisible:r,path:o,selection:i,selectedFiles:a,shouldShowDeletedFiles:n,isRewindVisible:l,urlPrefix:d,canDisplayFolderSizes:c,isQueryingFolderSizes:u,user:p,viewer:m,browsePostTTIExperiments:h,mountPoints:_,clickRewindTimestamp:f,clickFolderHistoryTimestamp:g,sortOrder:v,browsePostTTIData:S,shouldHideFilesAndSidebar:w,isRightRailCollapsed:y,isSelectedBackupFolder:b,isInsideBackupFolder:T,backupFolderPath:E,backupFolders:P,unsortedFiles:I,isInsideFlowsEligibleFolder:C,getCurrentFolderInfo:A,browseLoadingState:U}=se,{paginatedTotalNumFiles:R,folderOverviewPinnedItems:L,shouldShowVaultEmptyState:x,shouldShowFamilyEmptyState:O}=te,{viewTypeColumns:j}=re,{selectViewType:N}=oe;return $.asyncExtensions.init(),{files:s(e),paginatedTotalNumFiles:R(e),loadingState:U(e),path:o(e),shouldShowDeletedFiles:n(e),isFolderHistoryVisible:r(e),isRewindVisible:l(e),clickRewindTimestamp:f(e),clickFolderHistoryTimestamp:g(e),urlPrefix:d(e),canDisplayFolderSizes:c(e),viewTypeColumns:j(e),isQueryingFolderSizes:u(e),user:p(e),viewer:m(e),currentSort:v(e),browsePostTTIExperiments:h(e),browseContext:t(e),selection:i(e),selectedFiles:a(e),mountPoints:_(e),viewType:N(e,{instanceId:F.BROWSE_FILES_VIEW_ID}),sharingServiceInfo:$.asyncExtensions.sharingServiceInfo(e),extensionsFeatureFlags:$.asyncExtensions.getFeatureFlags(e),pinnedItems:L(e),emptyFolder:0===s(e).count(),shouldShowVaultEmptyState:x(e),shouldShowFamilyEmptyState:O(e),browsePostTTIData:S(e),shouldHideFilesAndSidebar:w(e),rightRailCollapsed:y(e),isSelectedBackupFolder:b(e),isInsideBackupFolder:T(e),backupFolderPath:E(e),backupFolders:P(e),unsortedFiles:I(e),isInsideFlowsEligibleFolder:C(e),currentFolderInfo:A(e),isDraggingInternalFilesRedux:Ie.getIsDraggingFiles(e)&&Ie.isInternalTransfer(e),isDraggingExternalFilesRedux:Ie.getIsDraggingFiles(e)&&!Ie.isInternalTransfer(e),businessSpaceInfo:be.selectBusinessSpaceInfo(e)}},Le);t.ConnectedBrowseControllerElement=xe(Re),t.ConnectedBrowseControllerElementWithRouter=i.withRouter(t.ConnectedBrowseControllerElement)})),define("metaserver/static/js/modules/clean/react/file_uploader/store",["require","exports","tslib","immutable","metaserver/static/js/modules/clean/flux/base_store","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/react/file_uploader/team_access_levels_definition","metaserver/static/js/modules/clean/react/file_uploader/utils","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/core/exception"],(function(e,t,s,r,o,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploaderStore=t.UploaderStoreClass=void 0,r=s.__importStar(r);class c extends o.Store{_init(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._folderNsId=null,this._user=null,this._fileList=r.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._inlineStatusShouldBeDismissed=!1,this._isMovingIntoVault=!1,this._isPermissionsAtUploadModalOpen=!1,this._numSecondsLeft=0,this._currentFileNumSecondsLeft=0,this._confirmedFSWs=[],this._confirmedFSWBatchIds=[],this._hasOverquotaError=!1,this._allUploadsComplete=!1,this._teamAccessLevelsDefinition=new a.TeamAccessLevelsDefinition,this._targetSurface="none"}fileList(){return this._fileList}currentUpload(){const e=this._currentUploadId;if(!e)return null;const t=this._fileList.get(e);return t||null}uploadById(e){let t;return e&&(t=this._fileList.get(e)),t||void 0}numSecondsLeft(){return this._numSecondsLeft}currentFileNumSecondsLeft(){return this._currentFileNumSecondsLeft}isUploadCancelled(e){const t=this._fileList.get(e);return!!t&&t.status===i.FileStatusType.CANCELLED}inlineStatusShouldBeDismissed(){return this._inlineStatusShouldBeDismissed}isMovingIntoVault(){return this._isMovingIntoVault}isPermissionsAtUploadModalOpen(){return this._isPermissionsAtUploadModalOpen}path(){return this._path}folderNsId(){return this._folderNsId}hasPermissionToUploadToFolder(){return this._hasPermissionToUploadToFolder}user(){return this._user}nextUpload(){return this._fileList.find(e=>e.status===i.FileStatusType.PENDING)}numDraggingFiles(){return this._numDraggingFiles}isInternalTransfer(){return this._isInternalTransfer}isUploadInProgress(){return this._fileList.some(e=>e.status===i.FileStatusType.UPLOADING||e.status===i.FileStatusType.PENDING)}isUploadModalOpen(){return this._isUploadModalOpen}confirmedFSWs(){return this._confirmedFSWs}confirmedFSWBatchIds(){return this._confirmedFSWBatchIds}hasOverquotaError(){return this._hasOverquotaError}allUploadsComplete(){return this._allUploadsComplete}getTeamAccessLevelsDefinition(){return this._teamAccessLevelsDefinition}getTeamAccessLevel(e){return this._teamAccessLevelsDefinition.getTeamAccessLevel(e)}targetSurface(){return this._targetSurface}setUser({user:e}){this._user=e,this.emit_change()}setPath({path:e,hasPermissionToUploadToFolder:t=!0,isMovingIntoVault:s=!1,targetSurface:r="none"}){this._path=e,this._hasPermissionToUploadToFolder=t,this._confirmedFSWs=[],this._isMovingIntoVault=s,this._targetSurface=r,this.emit_change()}setFolderNsId({folderNsId:e}){this._folderNsId=e}setHasOverquotaError({hasOverquotaError:e}){this._hasOverquotaError=e,this.emit_change()}addTeamAccessLevel({path:e,accessLevel:t}){this._teamAccessLevelsDefinition=this._teamAccessLevelsDefinition.addTeamAccessLevel(e,t),this.emit_change()}resetTeamAccessLevels(){this._teamAccessLevelsDefinition=new a.TeamAccessLevelsDefinition,this.emit_change()}queueUploads({files:e}){const t={};for(const s of e)t[s.uploadId]=s;this._fileList=this._fileList.merge(t),this.emit_change()}readyUploads({files:e}){for(const t of e)this._fileList=this._fileList.update(t.uploadId,e=>e.set("status",i.FileStatusType.PENDING));this.emit_change()}handleAllUploadsComplete(){this._allUploadsComplete=!0,this.emit_change()}startUpload({file:e,allowParallelUpload:t}){t||l.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),l.assert(null!=e,"missing file to upload"),l.assert(this._fileList.get(e.uploadId)===e,"failed to find file in file list"),this._fileList.get(e.uploadId)&&(this._fileList=this._fileList.update(e.uploadId,e=>e.set("status",i.FileStatusType.UPLOADING)),this._currentUploadId=t?null:e.uploadId,this._allUploadsComplete=!1),this.emit_change()}completeUpload({uploadId:e,allowParallelUpload:t}){const s=this._fileList.get(e);s&&((e!==this._currentUploadId&&!t||s.status!==i.FileStatusType.UPLOADING)&&d.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:s.toString(),fileListLength:this._fileList.count(),uploadId:e,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(e,e=>e.set("status",i.FileStatusType.COMPLETE))),this._currentUploadId=null,this.emit_change()}cancelUploads({files:e}){for(const t of e)this._fileList=this._fileList.update(t.uploadId,(function(e){return e.status===i.FileStatusType.SET_PERMISSIONS||e.status===i.FileStatusType.PENDING||e.status===i.FileStatusType.UPLOADING?e.set("status",i.FileStatusType.CANCELLED):e})),t.uploadId===this._currentUploadId&&(this._currentUploadId=null);this.emit_change()}setCurrentUploadProgress({percentComplete:e,numSecondsLeft:t}){const s=this._currentUploadId;s&&(this._fileList=this._fileList.update(s,t=>t.set("percentUploaded",e)),void 0!==t&&(this._numSecondsLeft=t)),this.emit_change()}handleUploadError({uploadId:e,errorType:t,errorMessage:s,allowParallelUpload:r}){const o=this._fileList.get(e);o&&(o.uploadId===this._currentUploadId||r||d.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:o.toString(),fileListLength:this._fileList.count(),uploadId:e,currentUploadId:this._currentUploadId,errorType:t,errorMessage:s}}),this._fileList=this._fileList.update(o.uploadId,e=>e.set("status",i.FileStatusType.FAILED).set("errorType",t).set("errorMessage",s))),this._currentUploadId=null,this.emit_change()}setNumDraggingFiles({numDraggingFiles:e,isInternalTransfer:t=!1}){this._numDraggingFiles=e,this._isInternalTransfer=t,this.emit_change()}setIsUploadModalOpen({isUploadModalOpen:e}){this._isUploadModalOpen=e,this.emit_change()}setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:e}){this._inlineStatusShouldBeDismissed=e,this.emit_change()}setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:e}){this._isPermissionsAtUploadModalOpen=e,this.emit_change()}addNewFailedFile({file:e,errorType:t,errorMessage:s}){null==e.uploadId&&(e=e.set("uploadId",n.generateUploadId())),e=e.set("status",i.FileStatusType.FAILED).set("errorType",t).set("errorMessage",s),this._fileList=this._fileList.set(e.uploadId,e),this.emit_change()}confirmFSW({fswIds:e,batchId:t}){e.forEach(e=>{this._confirmedFSWs.includes(e)||this._confirmedFSWs.push(e)}),this._confirmedFSWBatchIds.includes(t)||this._confirmedFSWBatchIds.push(t)}setUploadProgress({uploadId:e,percentComplete:t,numSecondsLeft:s}){if(e&&(this._fileList=this._fileList.update(e,e=>e.set("percentUploaded",t)),void 0!==s&&(this._numSecondsLeft=s),t>0&&t<100)){this._fileList.get(e)&&(this._fileList=this._fileList.update(e,e=>e.set("status",i.FileStatusType.UPLOADING)))}this.emit_change()}setFileUploadTimeLeft({uploadId:e,numSecondsLeft:t}){e&&(this._fileList=this._fileList.update(e,e=>e.set("numSecondsLeft",t)),this.emit_change())}_new_payload(e){const{action:t}=e;switch(t.type){case i.UploaderActionType.SET_USER:this.setUser(t.data);break;case i.UploaderActionType.SET_PATH:this.setPath(t.data);break;case i.UploaderActionType.SET_FOLDER_NS_ID:this.setFolderNsId(t.data);break;case i.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case i.UploaderActionType.READY_UPLOADS:this.readyUploads(t.data);break;case i.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case i.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case i.UploaderActionType.ALL_UPLOADS_COMPLETE:this.handleAllUploadsComplete();break;case i.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case i.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case i.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case i.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case i.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case i.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED:this.setInlineStatusShouldBeDismissed(t.data);break;case i.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case i.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data);break;case i.UploaderActionType.SET_HAS_OVERQUOTA_ERROR:this.setHasOverquotaError(t.data);break;case i.UploaderActionType.SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN:this.setIsPermissionsAtUploadModalOpen(t.data);break;case i.UploaderActionType.ADD_TEAM_ACCESS_LEVEL:this.addTeamAccessLevel(t.data);break;case i.UploaderActionType.RESET_TEAM_ACCESS_LEVELS:this.resetTeamAccessLevels();break;case i.UploaderActionType.SET_UPLOAD_PROGRESS:this.setUploadProgress(t.data);break;case i.UploaderActionType.SET_FILE_UPLOAD_TIME_LEFT:this.setFileUploadTimeLeft(t.data)}}}t.UploaderStoreClass=c,t.uploaderStore=new c})),define("metaserver/static/js/modules/clean/react/browse/components/file_breadcrumb",["require","exports","tslib","react","dig-components/breadcrumb","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/viewer","metaserver/static/js/modules/clean/browse_uri_interface","metaserver/static/js/modules/clean/pnm/utils"],(function(e,t,s,r,o,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileBreadcrumb=void 0,r=s.__importStar(r),i=s.__importStar(i),t.FileBreadcrumb=r.memo(e=>{var{path:t,size:d,user:c,useFullPath:u,isForCurrentPath:p,setUrl:m}=e,h=s.__rest(e,["path","size","user","useFullPath","isForCurrentPath","setUrl"]);const _=i.normalize(t),f=a.Viewer.get_root_name(c),g=i.parent_dirs(_).reverse();return g.unshift(""),u&&""!==_&&g.push(_),r.createElement(o.Breadcrumb,Object.assign({size:d,isRootOverflow:!0},h),g.map((e,t)=>{const s=p&&t===g.length-1,a=s?void 0:n.browse_uri_for_fq_path(c,e).toString(),d=s?void 0:(function(e,t){return s=>{0===s.button&&(s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)||(s.preventDefault(),t(e))}})(e,m);return r.createElement(o.Breadcrumb.Link,{key:i.filename(e,f),href:a,isCurrentPath:s,onClick:d,className:"file-breadcrumb-link"},l.getDisplayedFilename(i.filename(e,f)))}))}),t.FileBreadcrumb.displayName="FileBreadcrumb"})),define("metaserver/static/js/modules/clean/sync_everything/components/backup_breadcrumb",["require","exports","tslib","react","react-intl","dig-components/breadcrumb","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/browse_uri_interface","metaserver/static/js/modules/clean/pnm/utils","metaserver/static/js/modules/core/browser"],(function(e,t,s,r,o,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackupBreadcrumb=void 0,r=s.__importStar(r),a=s.__importStar(a),d=s.__importStar(d);const c="https://www.dropbox.com/backup/all?_source=breadcrumb";function u(e,t){return s=>{0===s.button&&(s.altKey||s.ctrlKey||s.metaKey||s.shiftKey)||(s.preventDefault(),t(e))}}t.BackupBreadcrumb=r.memo(e=>{var{basePath:t,path:p,size:m,user:h,useFullPath:_,isForCurrentPath:f,setUrl:g,hasBackupsLoaded:v}=e,S=s.__rest(e,["basePath","path","size","user","useFullPath","isForCurrentPath","setUrl","hasBackupsLoaded"]);if(!t&&!v)return null;const w=t?a.normalize(a.parent_dir(t)):"",y=a.normalize(p).replace(w,""),b=a.parent_dirs(y).reverse().map(e=>w+e);return _&&""!==y&&b.push(w+y),r.createElement(i.Breadcrumb,Object.assign({size:m,isRootOverflow:!0},S),r.createElement(i.Breadcrumb.Link,{key:"breadcrumb-backup",href:c,isCurrentPath:!1,onClick:u(c,d.redirect),className:"file-breadcrumb-link"},r.createElement(o.FormattedMessage,{id:"96Ymix",defaultMessage:"Backups"})),b.map((e,t)=>{const s=f&&t===b.length-1,o=s?void 0:n.browse_uri_for_fq_path(h,e).toString(),d=s?void 0:u(e,g);return r.createElement(i.Breadcrumb.Link,{key:a.filename(e),href:o,isCurrentPath:s,onClick:d,className:"file-breadcrumb-link"},l.getDisplayedFilename(a.filename(e)))}))}),t.BackupBreadcrumb.displayName="BackupBreadcrumb"})),define("metaserver/static/js/modules/clean/react/file_uploader/upload_kit_provider",["require","exports","tslib","react","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/file_uploader/actions_adapter","metaserver/static/js/modules/clean/react/file_uploader/api","metaserver/static/js/modules/clean/react/file_uploader/parallel_scheduler_with_batch_commit","metaserver/static/js/modules/clean/react/file_uploader/parallel_upload_session_scheduler","metaserver/static/js/modules/clean/react/file_uploader/processors","metaserver/static/js/modules/clean/react/file_uploader/store","metaserver/static/js/modules/clean/react/file_uploader/utils","metaserver/static/js/modules/clean/react/upload_kit/uploader/context","metaserver/static/js/modules/constants/global_file_upload"],(function(e,t,s,r,o,i,a,n,l,d,c,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadKitProvider=void 0,r=s.__importDefault(r),o=s.__importStar(o),a=s.__importStar(a);class h extends r.default.Component{constructor(){super(...arguments),this.allProcessedFiles=[],this.onBeforeUpload=e=>new Promise(t=>{i.ActionsAdapter.emit("beforeUpload",{uploadItems:e,beforeUploadComplete:({items:e})=>{t(e)}})}),this.onFilesAdded=(e,t)=>new Promise(s=>{i.ActionsAdapter.emit("filesAdded",{uploadItems:e,allUploadItems:t,filesAddedComplete:s,chooseDestination:this.props.chooseDestination})}),this.processFiles=(e,t)=>s.__awaiter(this,void 0,void 0,(function*(){let s;t.forEach(({item:e,error:t})=>{i.ActionsAdapter.emit("error",{user:this.props.user,uploadItem:e,errorType:i.convertValidationError(t),loggingOnly:!0})});try{s=this.props.processFiles?yield this.props.processFiles(e,t):yield d.processFiles(e,t)}catch(e){s=[]}return m.UPLOAD_SESSION_MIGRATION&&(yield d.startUploadSession(this.props.user.id,s)),this.allProcessedFiles=[...this.allProcessedFiles,...s],s=yield this.onFilesAdded(s,this.allProcessedFiles),s=yield this.onBeforeUpload(s),this.allProcessedFiles=[],{items:s,errors:t}})),this.nsIdForRouting=e=>{if(this.props.nsIdForRouting)return this.props.nsIdForRouting(e);const t=c.uploaderStore.path(),s=c.uploaderStore.folderNsId();return""===o.normalize(t)?this.props.user.root_ns_id:null!==s?s:this.props.user.root_ns_id},this.uploadBlock=(e,t,r)=>s.__awaiter(this,void 0,void 0,(function*(){const s=t=>{r&&r(t.loaded),i.ActionsAdapter.emit("uploadProgress",{uploadItem:e})};i.ActionsAdapter.emit("blockUploadStart",{blob:t});let o=0;const{response:n,retryCount:l}=yield u.promiseWithRetries(()=>a.uploadBlock(this.props.user.id,this.nsIdForRouting(e),e.bytes,t,s),2);if(o+=l,n.isError)throw i.ActionsAdapter.emit("error",{uploadItem:e,errorType:n.error.type,user:this.props.user,errorMessage:n.error.message,errorMethodSource:n.error.method,totalRetryCount:o}),new Error;return i.ActionsAdapter.emit("blockUploadEnd",{blob:t,totalRetryCount:o}),n.result.token})),this.commitBlocksBatchAPIV2=e=>s.__awaiter(this,void 0,void 0,(function*(){if(e.length>3){const t=e.map(({info:e,tokens:t})=>({file_name:o.filename(e.destPath),destination:u.getDestinationDir(e.parentPath||"",e.destPath),file_size:e.bytes,block_tokens:t,local_identifier:e.id}));let s=0;const{response:r,retryCount:n}=yield u.promiseWithRetries(()=>a.commitBlocksBatch(this.props.user.id,t,e.map(e=>e.info)),2);s+=n;const l=[];return r.isError?e.map(({info:e,tokens:t})=>{i.ActionsAdapter.emit("error",{uploadItem:e,errorType:r.error.type,user:this.props.user,errorMessage:r.error.message,errorMethodSource:r.error.method,totalRetryCount:s,useBatchCommit:!0}),l.push({filePath:e.destPath,success:!1})}):r.result.forEach(e=>{e.status.isError?(i.ActionsAdapter.emit("error",{uploadItem:e.uploadItem,errorType:e.status.error.type,user:this.props.user,errorMessage:e.status.error.message,errorMethodSource:e.status.error.method,totalRetryCount:s,useBatchCommit:!0}),l.push({filePath:e.uploadItem.destPath,success:!1})):(i.ActionsAdapter.emit("fileUploaded",{uploadItem:e.uploadItem,totalRetryCount:s,useBatchCommit:!0}),l.push({filePath:e.uploadItem.destPath,success:!0}))}),Promise.resolve(l)}{const t=[];for(const{info:s,tokens:r}of e){let e=0;const{response:n,retryCount:l}=yield u.promiseWithRetries(()=>{var e;return a.commitBlocks(this.props.user.id,u.getDestinationDir(s.parentPath||"",s.destPath),o.filename(s.destPath),s.bytes,r,this.props.user.root_ns_id,null!==(e=s.file.lastModified)&&void 0!==e?e:0)},2);e+=l,n.isError?(i.ActionsAdapter.emit("error",{uploadItem:s,errorType:n.error.type,user:this.props.user,errorMessage:n.error.message,errorMethodSource:n.error.method,totalRetryCount:e,useBatchCommit:!0}),t.push({filePath:s.destPath,success:!1})):(i.ActionsAdapter.emit("fileUploaded",{uploadItem:s,totalRetryCount:e,useBatchCommit:!0}),t.push({filePath:s.destPath,success:!0}))}return Promise.resolve(t)}}))}render(){return r.default.createElement(p.UploadProvider,{userId:this.props.user.id,selectMultiple:!0,onChoose:this.props.onChoose,onChooseDropboxFile:this.props.onChooseDropboxFile,processFiles:this.processFiles,commitBlocksBatch:this.commitBlocksBatchAPIV2,uploadBlock:this.uploadBlock,maxFileSize:524288e5,startUploadOnAdd:!0,Scheduler:m.UPLOAD_SESSION_MIGRATION?l.ParallelUploadSessionScheduler:n.ParallelUploadSchedulerWithBatchCommit},this.props.children)}}t.UploadKitProvider=h,h.displayName="UploadKitProvider"})),define("metaserver/static/js/modules/clean/react/file_uploader/actions_adapter",["require","exports","tslib","eventemitter3","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/file_uploader/store","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/react/upload_kit/lib/types"],(function(e,t,s,r,o,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertValidationError=t.convertUploadItem=t.ActionsAdapter=void 0,r=s.__importDefault(r),o=s.__importStar(o);const l=new r.default;t.ActionsAdapter={emit(e,t){l.emit(e,t)},on:(e,t)=>l.on(e,t),removeListener:(e,t)=>l.removeListener(e,t),removeAllListeners(){l.removeAllListeners()},eventNames:()=>l.eventNames()},t.convertUploadItem=function({bytes:e,destPath:t,id:s,parentPath:r,bytesUploaded:n},l={}){var d;const c=null===(d=i.uploaderStore.user())||void 0===d?void 0:d.id,u=o.parent_dir(t),p=o.normalize(r)+o.normalize(u);return new a.FileUpload(Object.assign({uploadId:s,dest:p,name:o.filename(t),size:e,userId:c,percentUploaded:e>0?Math.ceil(n/e*100):100},l))},t.convertValidationError=function(e){switch(e){case n.UploadErrorType.EmptyFile:return a.UploadErrorType.EMPTY_OR_FOLDER;case n.UploadErrorType.IgnoredFile:return a.UploadErrorType.IGNORED;case n.UploadErrorType.OverMaxFileSize:return a.UploadErrorType.FILE_SIZE_ERROR;case n.UploadErrorType.PointerFile:case n.UploadErrorType.TemporaryFile:return a.UploadErrorType.INVALID_EXTENSION;case n.UploadErrorType.CloudDoc:case n.UploadErrorType.Unknown:default:return a.UploadErrorType.GENERIC}}}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t};define("metaserver/static/js/modules/clean/react/growth/invite_facepile_loader",["require","exports","metaserver/static/js/modules/clean/react/async/loadable"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InviteFacepileLoadable=void 0;const r={loader:()=>new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/growth/invite_facepile"],t,s)}).then(__importStar).then(({InviteFacepile:e})=>e)};t.InviteFacepileLoadable=s.Loadable(r)})),define("metaserver/static/js/modules/clean/react/file_uploader/team_access_levels_definition",["require","exports","metaserver/static/js/modules/clean/filepath/filepath"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TeamAccessLevelsDefinition=void 0;class r{constructor(e){this.teamAccessLevelsDefinition=e||[]}hasDefinitions(){return!!this.teamAccessLevelsDefinition.length}addTeamAccessLevel(e,t){const s=this.teamAccessLevelsDefinition.filter(t=>t.path!==e);return new r([...s,{path:e,accessLevel:t}])}getTeamAccessLevel(e){if(!this.teamAccessLevelsDefinition.length)return null;const t=this.teamAccessLevelsDefinition.reduce((t,r)=>{const o=s.inSubDirectory(r.path,e)||s.paths_are_equal(r.path,e);if(!t)return o?r:null;const i=s.normalize(t.path),a=s.normalize(r.path),n=i.length<a.length;return o&&n?r:t},null);return t?t.accessLevel:null}}t.TeamAccessLevelsDefinition=r})),define("metaserver/static/js/modules/clean/react/file_uploader/processors",["require","exports","tslib","metaserver/static/js/modules/clean/react/upload_kit/lib/processors","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/file_uploader/utils","metaserver/static/js/modules/clean/react/upload_kit/lib/types","metaserver/static/js/modules/clean/react/file_uploader/api_v2_client"],(function(e,t,s,r,o,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleUploadSessionStart=t.startUploadSession=t.processFiles=void 0,t.processFiles=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){return e=r.resolveDuplicates(e),yield(function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){e.length&&(yield i.showInvalidFileWarning(e.map(({item:e,error:t})=>({name:o.filename(e.destPath),validationError:t})),t,!0))}))})(t,0===e.length),(function(e){s.__awaiter(this,void 0,void 0,(function*(){e.forEach(e=>{e.file instanceof File&&!a.isChooserFile(e.file)&&!a.isWebkitFile(e.file)&&(e.file.webkitRelativePath="/")})}))})(e),e}))};t.startUploadSession=function(e,r){return s.__awaiter(this,void 0,void 0,(function*(){return r.forEach(s=>{try{t.handleUploadSessionStart(e,s,3)}catch(e){}}),r}))},t.handleUploadSessionStart=(e,s,r)=>{try{n.uploadSessionStart(e).then(e=>{s.uploadSessionID=e.session_id})}catch(o){if(!(r>0))throw o;r--,t.handleUploadSessionStart(e,s,r)}}})),define("metaserver/static/js/modules/clean/react/family/family_browse_root_async",["require","exports","tslib","react"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncFamilyRoot=void 0,r=s.__importStar(r);const{lazy:o,Suspense:i}=r,a=o(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{FamilyBrowseRoot:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/family/family_browse_root"],t,s)}).then(s.__importStar);return{default:t}})));t.AsyncFamilyRoot=e=>r.createElement(i,{fallback:r.createElement("div",null)},r.createElement(a,Object.assign({},e)))})),define("metaserver/static/js/modules/clean/react/browse/browse_view",["require","exports","tslib","classnames","immutable","react","metaserver/static/js/modules/clean/browse_uri_interface","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/browse/browse_async_modules","metaserver/static/js/modules/clean/react/browse/browse_files_view","metaserver/static/js/modules/clean/react/browse/uri_helper","metaserver/static/js/modules/clean/react/family/family_browse_root_async","metaserver/static/js/modules/clean/react/file_uploader/file_uploader","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/folder_subscriptions/customization/async_customization_modal","metaserver/static/js/modules/clean/react/folder_subscriptions/follow/async_folder_unfollower","metaserver/static/js/modules/clean/react/plusplus/loadables","metaserver/static/js/modules/clean/react/activation/activation_root_async","metaserver/static/js/modules/clean/react/vault/vault_browse_root_async","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/flows/components/flows_browse_root_async","metaserver/static/js/modules/clean/react/browse/components/file_breadcrumb","metaserver/static/js/modules/clean/react/browse/browse_view_mode_toggle","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/browse/selection_indicator","metaserver/static/js/modules/clean/user_survey/user_survey","metaserver/static/js/modules/clean/filepath/filepath","dig-components/typography","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/sync_everything/components/backup_breadcrumb","metaserver/static/js/modules/clean/react/browse/tidy_up_actions","metaserver/static/js/modules/clean/react/browse/data/store","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/edison/spa_chrome","metaserver/static/js/modules/clean/react/edison/router_utils","metaserver/static/js/modules/clean/react/activation/experiments_context"],(function(e,t,s,r,o,i,a,n,l,d,c,u,p,m,h,_,f,g,v,S,w,y,b,T,F,E,P,I,C,A,U,R,L,x,O,j,N,k,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseView=void 0,r=s.__importDefault(r),o=s.__importStar(o),i=s.__importDefault(i),n=s.__importStar(n),R=s.__importStar(R),j=s.__importStar(j);class D extends i.default.PureComponent{constructor(t){super(t),this.vaultEmptyContentSlot=i.default.createRef(),this.vaultContentSlot=i.default.createRef(),this.vaultLockButtonSlot=i.default.createRef(),this.migrationTooltipRef=i.default.createRef(),this.handleUploadButtonClick=e=>{p.FileUploaderController.setPath(this.props.path),p.FileUploaderController.handleUploadButtonClick(e)},this.handleShowFileUploader=()=>{p.FileUploaderController.setPath(this.props.path),p.FileUploaderController.showModal()},this.isInTeamSpaceRoot=()=>this.props.context.isInsideMyTeamFolderTree&&this.props.context.isCurrentlyInRoot,this.isModifiedFamilyRoomFacepile=()=>this.props.context.isInsideFamilySharedFolder,this.showFamilyRoomFacepileEnhancements=()=>this.props.context.isInsideFamilySharedFolder,this.isFirstTaskEmptyState=()=>this.props.browsePostTTIData.firstTaskProps.is_eligible_team&&this.isInTeamSpaceRoot()&&1===this.props.totalNumItems,this.setHideFilesAndSidebar=e=>{this.props.setHideFilesAndSidebar({shouldHideFilesAndSidebar:e})},this.setContentSlot=e=>{this.setState({contentSlot:e}),this.vaultContentSlot.current=e},this.setEmptyContentSlot=e=>{this.setState({emptyContentSlot:e}),this.vaultEmptyContentSlot.current=e},this.renderFilesViewController=(e,t)=>this.props.loadingState===m.LoadingState.LOAD_ERROR?i.default.createElement(i.default.Suspense,{fallback:i.default.createElement("div",null,y.intl.formatMessage({id:"zD5i93",defaultMessage:"Something went wrong on our end."}))},i.default.createElement(B,null)):i.default.createElement(d.BrowseFilesView,{responsive:e,contentSlot:this.setContentSlot,emptyContentSlot:this.setEmptyContentSlot,isFirstTaskEmptyState:this.isFirstTaskEmptyState(),initialTotalNumItems:this.state.initialTotalNumItems,handleUploadButtonClick:this.handleUploadButtonClick,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isUploadModalOpen:this.props.isUploadModalOpen,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,isFileViewerShown:this.props.isFileViewerShown,handleComponentTTI:this.props.handleComponentTTI,starredState:this.props.starredState,initialHideState:this.state.initialHideState,uploadAjaxInterceptor:this.props.uploadAjaxInterceptor,isActive:!!t,isRightRailEnabled:!0,renderPrivacyColumnClientAccessCell:this.props.renderPrivacyColumnClientAccessCell}),this.renderSidebar=e=>this.props.shouldHideFilesAndSidebar?null:i.default.createElement(l.AsyncBrowseRightRail,{responsive:e,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,isCollapsed:this.props.rightRailCollapsed}),this.wrapBreadcrumb=t=>{const{user:r}=this.props,o=j.ggToCdmMigrationVariant(O.getStoreForBrowse().getState());if(!o||"OFF"===o)return t;const a=i.default.lazy(()=>s.__awaiter(this,void 0,void 0,(function*(){const{MigrationTooltip:t,MigrationTooltipStep:a}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/gg_to_cdm_migration/migration_tooltip"],t,s)}).then(s.__importStar);return{default:e=>i.default.createElement(t,Object.assign({},e,{step:a.Three,ggToCdmMigrationVariant:o,user:r,triggerRef:this.migrationTooltipRef}))}})));return i.default.createElement("span",{ref:this.migrationTooltipRef},t,i.default.createElement(i.default.Suspense,{fallback:i.default.createElement(i.default.Fragment,null)},i.default.createElement(a,null)))},this.renderTitle=()=>e=>{const{context:t,path:s,user:o,selectedFiles:a,rightRailCollapsed:n,isInsideBackupFolder:d,backupFolderPath:c,backupFolders:u}=this.props,p=this.isModifiedFamilyRoomFacepile(),m=!e.isResponsive||e.isMatchedLarge,h=p&&n,_=this.showFamilyRoomFacepileEnhancements(),f=this.wrapBreadcrumb(d?i.default.createElement(L.BackupBreadcrumb,{path:s,basePath:c,size:_?"small":"standard",user:o,useFullPath:!0,isForCurrentPath:!0,setUrl:this.setUrl,className:r.default({"browse-title-file-pathbar":!_}),key:s,hasBackupsLoaded:null!==u}):i.default.createElement(T.FileBreadcrumb,{path:s,size:_?"small":"standard",user:o,useFullPath:!0,isForCurrentPath:!0,setUrl:this.setUrl,className:r.default({"browse-title-file-pathbar":!_}),key:s}));return i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:r.default("brws-file-pathbar-row",{"family-brws-file-pathbar-row":_}),onClick:this.clearSelection},t.isInsideVaultFolder&&i.default.createElement("div",{ref:this.vaultLockButtonSlot}),_&&i.default.createElement("div",{className:"browse-title-file-pathbar"},i.default.createElement(U.Title,{className:"family-browse-title"},R.filename(s)),f),!_&&f,i.default.createElement("div",{className:"brws-selection-view-mode-container"},!_&&i.default.createElement(I.SelectionIndicator,{responsive:e,selectedFilesCount:a.size,rightRailCollapsed:n,isInFamilyFolder:t.isInFamilySharedFolder}),!p&&i.default.createElement(F.BrowseViewModeToggle,{user:o}),h&&i.default.createElement("div",{className:"family-room-sharing-view"},i.default.createElement(l.AsyncBrowseSharingView,{useCompactMode:!m})))))},this.setUrl=e=>{if(""===e){const e=O.getStoreForBrowse().getState();j.postTTIExperiments(e)&&j.postTTIExperiments(e).expTidyUpBrowse&&j.context(e).isCurrentPathWriteable()&&setTimeout(()=>{"/"===j.path(O.getStoreForBrowse().getState())&&x.promptTidyUp(j.user(e).id,"",j.context(e).currentNSID)},5e3)}this.props.onSetUrl({path:e})},this.clearSelection=e=>{P.shouldClickDeselect(e,!0)&&this.props.clearSelection({actionSource:E.ActionSourceValue.WHITESPACE})},this.state={searchBarProps:this.getCurrentSearchBarProps(this.props),initialTotalNumItems:this.props.totalNumItems||1,initialHideState:!!this.props.isSmbPersonalization,hideFilesAndSidebar:!1,contentSlot:null,emptyContentSlot:null}}UNSAFE_componentWillReceiveProps(e){e.path!==this.props.path&&this.setState({searchBarProps:this.getCurrentSearchBarProps(e)})}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){yield w.waitForTTI(),p.FileUploaderController.loadCoreComponent(),this.props.shouldOpenUploadModal&&this.handleShowFileUploader(),n.logPageView(this.getPageViewerBrowseLoadedData()),C.UserSurvey.trackEvent("folder_viewed","browse")}))}componentDidUpdate(e){void 0!==this.props.browsePostTTIExperiments.expPersonalizedFirstPaths&&this.state.initialHideState&&this.setState({initialHideState:!1}),this.props.loadingState===m.LoadingState.LOADED&&e.loadingState===m.LoadingState.LOADING_FIRST_PAGE&&(n.logBrowseLoaded(this.getPageViewerBrowseLoadedData()),this.setState({initialTotalNumItems:this.props.totalNumItems}))}getCurrentFolderType(){const{context:e,user:t}=this.props;if(e.isInsideVaultFolder)return"vault";if(t.is_cdm_member){if("/"===e.currentFQPath&&e.currentNSID===e.rootNSID)return"root";if(e.isCurrentlyInRoot)return"team_member_folder"}else if(e.isCurrentlyInRoot)return"root";return e.isInsideTeamFolderTree?"team_shared_folder":e.isInsideSharedFolder&&""===e.currentNSPath?"shared_folder":"folder"}getPageViewerBrowseLoadedData(){const{context:e,user:t,viewType:s,rightRailCollapsed:r}=this.props,o=e.currentFQPath.split("/").filter(e=>!!e).length,i=t.is_cdm_member&&(A.paths_are_equal(t.cdm_tmf_path,e.currentFQPath)||A.inSubDirectory(t.cdm_tmf_path,e.currentFQPath)),n=r?"collapsed":"opened";return 0===o?{uid:t.id,view_type:s,url:a.get_browse_root(t),baseUrl:a.get_browse_root(t),folder_type:this.getCurrentFolderType(),right_sidebar_state:n,role:t.role}:{uid:t.id,view_type:s,url:a.get_browse_root(t)+"/*",baseUrl:a.get_browse_root(t),folder_type:this.getCurrentFolderType(),right_sidebar_state:n,navigation_depth:o,is_under_tmf:i,role:t.role}}getCurrentSearchBarProps(e){return{searchVariant:"full-page",currentPath:e.path}}render(){const{user:e,clickRewindTimestamp:t,clickFolderHistoryTimestamp:s,context:o,handleComponentTTI:a,isRewindVisible:n,isFolderHistoryVisible:d,browsePostTTIExperiments:{expVaultAutoLockWeb:p,expFlowsAutomatedFolderUI:m},browsePostTTIData:h,browseExperiments:{folderHistoryRollbacks:w,plusPlusEnabled:y},showPlusPlusSetupModal:T,path:F,onCloseRewind:E,onCloseFolderHistoryPanel:P,userVersionHistoryLength:I,shouldShowVaultEmptyState:C,shouldShowFamilyEmptyState:A}=this.props,{userHasSharedFileOrFolderInfo:U}=h,R=r.default("exp-details-pane-variants",{"mobile-web-invites":h.mobileWebInvites}),L=r.default(R,"dig2--enabled","browse-view--chrome","browse-right-rail--v2");return i.default.createElement("div",{className:R},i.default.createElement(l.AsyncRewindPanel,{clickBrowseButtonTimestampMs:t,user:e,fromDesktopClient:"true"===c.getQueryArgs().from_desktop_client,browseContext:o,close:E,isVisible:n,expFolderHistoryRollbacks:w||!1,userVersionHistoryLength:I}),i.default.createElement(l.AsyncFolderHistoryPanel,{folderFQPath:o.currentFQPath,clickFolderHistoryButtonInBrowseTimestampMs:s,close:P,isVisible:d,user:e,userVersionHistoryLength:I}),y?i.default.createElement(g.AsyncPlusPlusSetupModal,{userId:e.id,forceShow:T}):null,o.isInsideVaultFolder&&i.default.createElement(S.AsyncVaultRoot,{contentSlot:this.vaultContentSlot,vaultEmptyContentSlot:this.vaultEmptyContentSlot,lockButtonSlot:this.vaultLockButtonSlot,handleComponentTTI:a,shouldShowVaultEmptyState:C,encryptionOptions:this.props.encryptionOptions,expVaultAutoLockWeb:p,setHideFilesAndSidebar:this.setHideFilesAndSidebar,path:F,user:e}),m&&i.default.createElement(b.AsyncFlowsRoot,{user:e,path:F}),o.isInFamilySharedFolder&&i.default.createElement(u.AsyncFamilyRoot,{user:e,path:F,contentSlot:this.state.contentSlot,emptyContentSlot:this.state.emptyContentSlot,shouldShowFamilyEmptyState:A,setHideFilesAndSidebar:this.setHideFilesAndSidebar}),c.getQueryArgs().unfollow_folder&&i.default.createElement(f.AsyncFolderUnfollower,null),i.default.createElement(v.AsyncActivationRootForBrowse,{user:e}),i.default.createElement(_.AsyncCustomizationModal,{path:o.currentFQPath}),i.default.createElement(M.ExperimentsContext.Provider,{value:{userHasSharedFileOrFolderInfo:U}},i.default.createElement(N.ChromeWrapper,{user:e,titleRegion:this.renderTitle(),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderFilesViewController,actionSidebarRegion:this.renderSidebar,searchBarProps:this.state.searchBarProps,chromeClass:L,useMaestroPortal:!0,useRightRailOutsideSearch:!0,useRightRail:k.shouldUseReactRouter()})))}}t.BrowseView=D,D.defaultProps={selectedFiles:o.OrderedMap(),viewType:h.ViewType.List},D.displayName="BrowseView";const B=i.default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{ErrorComponent:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/components/post_tti/error"],t,s)}).then(s.__importStar);return{default:t}})))})),define("metaserver/static/js/modules/clean/react/browse/browse_prefetch_loader",["require","exports","tslib","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/pagination_manager","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/clean/react/browse/browse_server_response_helper"],(function(e,t,s,r,o,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowsePrefetchLoader=t.apiV2FetchNextFn=void 0,n=s.__importStar(n),l=s.__importStar(l),t.apiV2FetchNextFn=(e,t,s)=>l.loadPath2Continue(e,s).then(e=>{const s=new Array;for(const o of e.paginated_file_info){r.assert(void 0!==o.file_info,"file_info is undefined");const e=o.file_info;e.fq_path=t+e.fq_path,s.push(i.File.fromApiV2Object(e))}return{next_request_voucher:e.next_request_voucher||null,has_more_items:e.has_more||!1,items:s}});t.BrowsePrefetchLoader=class{constructor({user:e,path:s,fqPathsToSelect:i},{onPrefetchComplete:l,onPrefetchError:c,onLoadComplete:u,onPostTTIPrefetchComplete:p,onPostTTIPrefetchError:m},{onInitializeEverything:h,onAddFilesAndSetLoadingState:_},f=window){this.isPrefetching=()=>!!this.browsePreloadHandler&&!!this.firstPagePreloadHandler,this.handlePrefetch=()=>{r.assert(this.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),this.browsePreloadHandler(this.handlePrefetchDataSuccess,this.onPrefetchError),n.waitForTTI().then(()=>{this.postTTIPreloadHandler(this.handlePostTTIDataSuccess,this.onPostTTIPrefetchError)})},this.handlePostTTIDataSuccess=e=>{let t=void 0;try{t=JSON.parse(e)}catch(e){return void this.onPostTTIPrefetchError(e)}t?this.onPostTTIPrefetchComplete(t):this.onPostTTIPrefetchError()},this.handlePrefetchDataSuccess=e=>{const t=new d.BrowseContextServerResponse;if(t.init(e),t.isError())return void this.onPrefetchError();const s=t.fromServerBrowseContext(),r=t.fromServerNsidToMountPoint(),o=t.fromTeamFolders(),i=t.fromCurrentFolderFile();this.firstPagePreloadHandler(e=>{this.handleFirstPagePrefetchDataSuccess(e,t,r,o,i,s)},this.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=(e,t,s,r,i,a)=>{const n=new d.BrowseGetNextServerResponse;if(n.init(e),n.isError())return void this.onPrefetchError();const l=n.fromPrefetchFiles(),c=n.fromPaginatedTotalNumFiles(),u=n.fromLoadingState(),p=n.fromNextRequestVoucher();this.onInitializeEverything({path:this.path,files:u===o.LoadingState.LOADING_REMAINING_PAGES?[]:l,paginatedTotalNumFiles:c,context:a,mountPoints:s,fqPathsToSelect:this.fqPathsToSelect,loadingState:u,teamFolders:r,currentFolderInfo:i}),u===o.LoadingState.LOADING_REMAINING_PAGES?this.initializePaginationManager(c,l,!0,p):this.onLoadComplete(),this.onPrefetchComplete(t)},this.initializePaginationManager=(e,s=[],r=!0,i="")=>{const l=a.PaginationManager.create({firstPage:{items:s,has_more_items:r,next_request_voucher:i},keyName:"sjid",userID:this.user.id,newDataAvailableCallback:(t,s)=>{const r=t.areAllItemsReady(),i=r?o.LoadingState.LOADED:o.LoadingState.LOADING_REMAINING_PAGES;this.onAddFilesAndSetLoadingState({path:this.path,files:s,paginatedTotalNumFiles:e,loadingState:i}),r&&(t.stopAutoFetching(),this.onLoadComplete())},fetchNextFn:t.apiV2FetchNextFn});n.waitForTTI().then(()=>l.startAutoFetching())},this.user=e,this.path=s,this.fqPathsToSelect=i,this.onPrefetchComplete=l,this.onPrefetchError=c,this.onLoadComplete=u,this.onPostTTIPrefetchComplete=p,this.onPostTTIPrefetchError=m,this.onInitializeEverything=h,this.onAddFilesAndSetLoadingState=_,this.browsePreloadHandler=f.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=f.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER,this.postTTIPreloadHandler=f.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER}}})),define("metaserver/static/js/modules/clean/react/browse/browse_server_response_helper",["require","exports","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/core/notify","metaserver/static/js/modules/clean/react/files_view/types"],(function(e,t,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maybeNotifyErrorResponse=t.BrowseGetNextServerResponse=t.BrowseContextServerResponse=void 0;t.BrowseContextServerResponse=class{init(e){try{const t=JSON.parse(e);let s;s=t.context?new a:new n,s.init(t),this.browseContextResponse=s}catch(t){i(e)}}isError(){return!this.browseContextResponse}fromServerBrowseContext(){return this.browseContextResponse.fromServerBrowseContext()}fromServerNsidToMountPoint(){return this.browseContextResponse.fromServerNsidToMountPoint()}fromTeamFolders(){return this.browseContextResponse.fromTeamFolders()}fromCurrentFolderFileInfo(){return this.browseContextResponse.fromCurrentFolderFileInfo()}fromCurrentFolderFile(){return this.browseContextResponse.fromCurrentFolderFile()}fromPreviewFileInfo(){return this.browseContextResponse.fromPreviewFileInfo()}};function i(e){if(0===e.indexOf("err:")){const t=e.substr("err:".length);r.Notify.error(t)}}t.BrowseGetNextServerResponse=class{init(e){try{const t=JSON.parse(e);let s;s="total_count"in t?new l:new d,s.init(t),this.browseGetNextResponse=s}catch(t){i(e)}}isError(){return!this.browseGetNextResponse}fromPrefetchFiles(){return this.browseGetNextResponse.fromPrefetchFiles()}fromPaginatedTotalNumFiles(){return this.browseGetNextResponse.fromPaginatedTotalNumFiles()}fromLoadingState(){return this.browseGetNextResponse.fromLoadingState()}fromNextRequestVoucher(){return this.browseGetNextResponse.fromNextRequestVoucher()}},t.maybeNotifyErrorResponse=i;class a{init(e){this.browseContextResponse=e}fromServerBrowseContext(){const e=this.browseContextResponse.context;return s.BrowseContext.fromApiV2Object(e)}fromServerNsidToMountPoint(){let e={};const t=this.browseContextResponse.context;if(t.ns_id_infos){e=t.ns_id_infos.filter(e=>!!e&&!!e.mount_point&&!!e.ns_id).reduce((e,t)=>Object.assign(Object.assign({},e),{[t.ns_id.toString()]:t.mount_point}),{})}return e}fromTeamFolders(){let e=[];const t=this.browseContextResponse.context;return t.team_folders_js_info&&(e=t.team_folders_js_info.map(s.File.fromApiV2Object)),e}fromCurrentFolderFileInfo(){let e=void 0;const t=this.browseContextResponse.folder_info;return t&&t.file_info&&(e=t.file_info),e}fromCurrentFolderFile(){const e=this.fromCurrentFolderFileInfo();if(e)return s.File.fromApiV2Object(e)}fromPreviewFileInfo(){const e=this.browseContextResponse.context;return(null==e?void 0:e.preview_file_info)?s.File.fromApiV2Object(null==e?void 0:e.preview_file_info):null}}class n{init(e){this.browseContextResponse=e}fromServerBrowseContext(){const e=this.browseContextResponse;return s.BrowseContext.fromServerObject(e)}fromServerNsidToMountPoint(){return this.browseContextResponse.ns_id_to_mount_point}fromTeamFolders(){let e=[];const t=this.browseContextResponse;return t.team_folders_js_info&&(e=t.team_folders_js_info.map(s.File.fromAnyFileObject)),e}fromCurrentFolderFileInfo(){let e=void 0;const t=this.browseContextResponse;return t.folder_info&&(e=t.folder_info),e}fromCurrentFolderFile(){const e=this.fromCurrentFolderFileInfo();if(e)return s.File.fromApiV2Object(e)}fromPreviewFileInfo(){const e=this.browseContextResponse;return e.preview_file_info?s.File.fromAnyFileObject(e.preview_file_info):null}}class l{init(e){this.browseGetNextResponse=e}fromPrefetchFiles(){let e;return e=this.browseGetNextResponse.paginated_file_info.map(e=>e.file_info).filter(e=>!!e),e.map(s.File.fromApiV2Object)}fromPaginatedTotalNumFiles(){var e;return null!==(e=this.browseGetNextResponse.total_count)&&void 0!==e?e:0}fromLoadingState(){return this.browseGetNextResponse.has_more?o.LoadingState.LOADING_REMAINING_PAGES:o.LoadingState.LOADED}fromNextRequestVoucher(){var e;return null!==(e=this.browseGetNextResponse.next_request_voucher)&&void 0!==e?e:""}}class d{init(e){this.browseGetNextResponse=e}fromPrefetchFiles(){const e=this.browseGetNextResponse.file_info,t=this.browseGetNextResponse.first_page;return t?t.items.map(s.File.fromAnyFileObject):e?e.map(s.File.fromAnyFileObject):[]}fromPaginatedTotalNumFiles(){const e=this.browseGetNextResponse.file_info,t=this.browseGetNextResponse.first_page;return t?t.total_num_items:e?e.length:0}fromLoadingState(){const e=this.browseGetNextResponse.file_info;return this.browseGetNextResponse.first_page?o.LoadingState.LOADING_REMAINING_PAGES:e?o.LoadingState.LOADED:o.LoadingState.LOADING_FIRST_PAGE}fromNextRequestVoucher(){var e;const t=this.browseGetNextResponse.first_page;return t&&null!==(e=t.next_request_voucher)&&void 0!==e?e:""}}})),define("metaserver/static/js/modules/clean/react/browse/browse_invite_experiment_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFirstTaskPage=t.isInSplitTmfTsdTeamFolder=t.isLetMembersInviteEligible=t.shouldShowFacePile=void 0,t.shouldShowFacePile=e=>{const{selectedFiles:s,showInviteSidePanel:r}=e,o=s&&0!==s.size;return(r||t.isFirstTaskPage(e)||t.isInSplitTmfTsdTeamFolder(e)||t.isLetMembersInviteEligible(e))&&!o},t.isLetMembersInviteEligible=({browsePostTTIExperiments:e,context:t})=>!!e.expLetMembersInviteData&&(e.expLetMembersInviteData.shouldShowLetMembersInviteCta&&t.isInsideTeamFolderTree&&t.isCurrentlyInRoot),t.isInSplitTmfTsdTeamFolder=({browseExperiments:e,context:t})=>!!e&&e.splitTmfTsd&&"/Team Files"===t.currentFQPath,t.isFirstTaskPage=({browsePostTTIExperiments:e,browsePostTTIData:t,context:s})=>t.firstTaskProps.is_eligible_team&&s.isInsideTeamFolderTree&&s.isCurrentlyInRoot})),define("metaserver/static/js/modules/clean/react/browse/browse_upload_provider",["require","exports","tslib","react","react-redux","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/file_uploader/upload_kit_provider","metaserver/static/js/modules/clean/react/file_uploader/utils","metaserver/static/js/modules/core/assert"],(function(e,t,s,r,o,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseUploadProvider=t.UnconnectedBrowseUploadProvider=void 0,r=s.__importDefault(r),i=s.__importStar(i),n=s.__importStar(n);class d extends r.default.Component{constructor(){super(...arguments),this.onChoose=e=>s.__awaiter(this,void 0,void 0,(function*(){return e.map(e=>[e,{parentPath:this.props.context.currentFQPath}])})),this.onChooseDropboxFile=e=>s.__awaiter(this,void 0,void 0,(function*(){return e.map(e=>[e,{parentPath:this.props.context.currentFQPath}])})),this.nsIdForRouting=e=>{const t=""===this.props.context.currentFQPath,s=n.getDestinationDir(e.parentPath||"",e.destPath);return t?this.props.user.root_ns_id:(l.assert(null!=this.props.mountPoints,"mountPoints is null"),l.assert(null!=this.props.context.rootNSID,"rootNSID is null"),n.getNsId(this.props.mountPoints,this.props.context.rootNSID,s))}}render(){return r.default.createElement(a.UploadKitProvider,{user:this.props.user,nsIdForRouting:this.nsIdForRouting,onChoose:this.onChoose,onChooseDropboxFile:this.onChooseDropboxFile,chooseDestination:this.props.chooseDestination},this.props.children)}}t.UnconnectedBrowseUploadProvider=d,d.displayName="UnconnectedBrowseUploadProvider",t.BrowseUploadProvider=o.connect(e=>({context:i.context(e),mountPoints:i.mountPoints(e)}))(d)})),define("metaserver/static/js/modules/clean/react/browse/browse",["require","exports","tslib","react","react-intl","react-redux","metaserver/static/js/dropbox/proto/js_init_data/browse_web/browse_web","metaserver/static/js/dropbox/proto/js_init_data/web_timing_logger/web_timing_logger","metaserver/static/js/proto_utils/unpack","metaserver/static/js/modules/clean/bug_reporting/routing","metaserver/static/js/modules/clean/react/browse/controller","metaserver/static/js/modules/clean/react/browse/data/action_creators/index","metaserver/static/js/modules/clean/react/browse/data/store","metaserver/static/js/modules/clean/react/files_view/data/action_creators","metaserver/static/js/modules/clean/react/files_view/data/store","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/folder_overview/data/action_creators","metaserver/static/js/modules/clean/react/maestro_nav/folder_explorer/data/store","metaserver/static/js/modules/clean/react/file_uploader/clean/data/store","metaserver/static/js/modules/clean/viewer","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/core/browser_detection","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/folder_overview/data/store","metaserver/static/js/modules/clean/tagging/experiments","metaserver/static/js/modules/clean/react/edison/router_utils","metaserver/static/js/modules/clean/react/edison/spa_timing_logger","metaserver/static/js/modules/clean/react/snackbar_manager","metaserver/static/js/modules/clean/react/snackbar"],(function(e,t,s,r,o,i,a,n,l,d,c,u,p,m,h,_,f,g,v,S,w,y,b,T,F,E,P,I,C,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootComponent=t.ConditionalBrowseApp=t.BrowseApp=t.AsyncBoltHandler=void 0,r=s.__importStar(r),u=s.__importStar(u),m=s.__importStar(m),g=s.__importStar(g),y=s.__importStar(y);const U=()=>r.default.createElement(r.default.Fragment,null,r.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.file_actions",componentName:"File Actions"}),r.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.right_rail",componentName:"Right Rail"}),r.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"desktop.unknown",componentName:"Desktop App"}),r.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.browse_web",componentName:"Browse"}),r.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.search_web",componentName:"Search"}),r.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.upload_web",componentName:"Upload"}),r.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"Previews"}));t.AsyncBoltHandler=r.default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){yield y.waitForTTI();const{ConnectedBoltHandler:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/bolt/handler"],t,s)}).then(s.__importStar);return{default:t}})));class R extends r.default.PureComponent{constructor(e){var t;super(e),I.markApplicationStart(),h.getStoreForFilesView(),v.getStoreForFolderExplorer(),S.getStoreForUpload(),this.reduxStore=p.getStoreForBrowse(),P.shouldUseReactRouter()&&this.reduxStore.dispatch(u.handleAppCleanup());const s=w.Viewer.get_viewer(),r=s.get_user_by_id(e.userId),o=b.is_supported_mobile_browser()?void 0:f.ViewType.CondensedList;this.reduxStore.dispatch(m.loadViewTypes({user:r,defaultViewType:o})),this.reduxStore.dispatch(m.loadViewTypeColumns({user:r})),this.reduxStore.dispatch(u.setPath({path:e.initFqPath||"/"})),E.isTagsColumnOnBrowseEnabled(null===(t=e.browseExperiments)||void 0===t?void 0:t.manualTagging)||this.reduxStore.dispatch(m.filterOutColumns([_.SortField.TAGS])),this.reduxStore.dispatch(u.appInit({props:e,user:r,viewer:s})),F.getStoreForFolderOverview().dispatch(g.initializeUserInteractionState(!0))}render(){const e=P.shouldUseReactRouter()?r.default.createElement(c.ConnectedBrowseControllerElementWithRouter,Object.assign({},this.props)):r.default.createElement(c.ConnectedBrowseControllerElement,Object.assign({},this.props));return r.default.createElement(i.Provider,{store:this.reduxStore},r.default.createElement(o.RawIntlProvider,{value:T.intl},r.default.createElement(r.default.Fragment,null,e,r.default.createElement(r.default.Suspense,{fallback:r.default.createElement(r.default.Fragment,null)},r.default.createElement(t.AsyncBoltHandler,null)),r.default.createElement(U,null))))}}t.BrowseApp=R,R.displayName="BrowseApp",t.ConditionalBrowseApp=e=>{const{browseAppProps:t}=e;return t?r.default.createElement(r.default.Fragment,null,r.default.createElement(R,Object.assign({},t))):null},t.RootComponent=e=>{const t=l.unpackProto(e.encodedProto,a.browse_web.BrowseWebPageProps),{webTimingLoggerServerContext:o}=t,i=s.__rest(t,["webTimingLoggerServerContext"]),d=r.useRef(null);return r.useEffect(()=>{A.Snackbar.manager=d.current}),y.initialize({log_time_to_view:!0,log_time_to_interactive:!0},l.unpackProto(o,n.web_timing_logger.WebTimingLoggerServerContext)),r.default.createElement(r.default.Fragment,null,r.default.createElement(R,Object.assign({},i)),r.default.createElement(C.SnackbarManager,{ref:d,getParentElement:C.SnackbarManager.getEmbeddedAppPagelet,useDigSnackbars:!0}))}})),define("metaserver/static/js/modules/clean/react/browse/browse_view_mode_toggle",["require","exports","tslib","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/files_view/util","react","typescript/component_libraries/retrieval-components/src/view-mode-toggle/index","react-redux","metaserver/static/js/modules/clean/react/browse/data/action_creators/index","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/browse/constants"],(function(e,t,s,r,o,i,a,n,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseViewModeToggle=void 0,r=s.__importStar(r),i=s.__importDefault(i),t.BrowseViewModeToggle=i.default.memo(({user:e,className:t})=>{const s=n.useDispatch(),u=n.useSelector(e=>d.selectViewType(e,{instanceId:c.BROWSE_FILES_VIEW_ID})),p=i.default.useCallback((t,i)=>{const a=o.viewTypeFromViewMode(t);i.stopPropagation(),r.logSwitchViewType({uid:e.id,isSearchMode:!1,viewType:a}),s(l.setViewType(a))},[s,e]);return i.default.createElement(a.ViewModeToggle,{className:t,currentMode:o.viewModeFromViewType(u),onSelection:p})}),t.BrowseViewModeToggle.displayName="BrowseViewModeToggle"})),define("metaserver/static/js/modules/clean/pagination_manager",["require","exports","tslib","metaserver/static/js/modules/clean/deprecated_ajax/ajax","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify","metaserver/static/js/modules/clean/react/snackbar"],(function(e,t,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaginationManager=t.LegacyFetchNextFn=t.BasePaginationManager=void 0,r=s.__importStar(r);class n{constructor(e){this.hasMoreItems=e}areAllItemsReady(){return!this.hasMoreItems}invalidateHasMore(){this.hasMoreItems=!0}addDataToAjax(e){}}class l{constructor(e){this.handleNextPageSuccess=e=>{this.nextRequestVoucher=e.next_request_voucher,this.mode.hasMoreItems=e.has_more_items,this.autoFetching&&this.fetchNext(),this.addPage(e.items)},this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items),this.fetchNextFn=e.fetchNextFn}areAllItemsReady(){return this.mode.areAllItemsReady()}addPage(e){const t=[],s=[];for(const r of e){const e=r[this.keyName];if(null==e)return void i.Notify.warning(o.intl.formatMessage({id:"xlabvw",defaultMessage:"Invalid server response"}));null==this.items[e]&&(this.items[e]=r,s.push(r),t.push(e))}this.pages.push(t),this.newDataCallback(this,s)}startAutoFetching(){this.autoFetching=!0,this.fetchNext()}stopAutoFetching(){this.autoFetching=!1}reSync(e=!1){e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);const t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()}fetchNext(){if(this.mode.areAllItemsReady())return;const e={};this.nextRequestVoucher&&(e.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(e),this.fetchNextFn(this.nextRequestVoucher||"",this.fqPathPrefix,this.userID,e).then(e=>{this.handleNextPageSuccess(e)}).catch(()=>{a.Snackbar.fail(o.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}),"browse")})}loadedPageCount(){return this.pages.length}getLoadedPage(e){const t=this.pages[e];return null==t?null:t.map(e=>this.items[e])}getLastLoadedPage(){return this.getLoadedPage(this.loadedPageCount()-1)}}t.BasePaginationManager=l,t.LegacyFetchNextFn=(e,t)=>(s,o,i,a)=>(s&&(a.voucher=s),new Promise((s,n)=>{r.WebRequest({url:e,data:a,dataType:"text",subject_user:i,success:(e,r)=>{s(t(r,o))},error:n})}));class d extends l{constructor(e){super(Object.assign(Object.assign({},e),{mode:new n(e.firstPage.has_more_items)}))}static create(e){return new d(e)}}t.PaginationManager=d})),define("metaserver/static/js/modules/clean/react/plusplus/loadables",["require","exports","tslib","metaserver/static/js/modules/clean/react/async/loadable"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncPlusPlusSetupModal=void 0,t.AsyncPlusPlusSetupModal=r.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{PlusPlusSetupModal:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/plusplus/setup_modal"],t,s)}).then(s.__importStar);return t}))}),t.AsyncPlusPlusSetupModal.displayName="AsyncPlusPlusSetupModal"})),define("metaserver/static/js/modules/clean/react/browse/actions_navigate",["require","exports","tslib","metaserver/static/js/modules/clean/cloud_docs/open_with_utils","metaserver/static/js/modules/clean/cloud_docs/preferred_editor_utils","metaserver/static/js/modules/clean/cloud_docs/types","metaserver/static/js/modules/clean/file_operations/notifications","metaserver/static/js/modules/clean/filetypes","metaserver/static/js/modules/clean/react/async_file_modal_controller","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/browse/data/action_creators/index","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/data/store","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/file_viewer/async_controller","metaserver/static/js/modules/clean/react/file_viewer/toggle_browse_elements_util","metaserver/static/js/modules/clean/pnm/utils","metaserver/static/js/modules/clean/react/plusplus/logging","metaserver/static/js/modules/clean/react/plusplus/file_actions","metaserver/static/js/modules/clean/react/vault/constants","metaserver/static/js/modules/constants/python","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/clean/react/browse/tidy_up_actions","metaserver/static/js/modules/clean/history_singleton","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/browse/naming_conventions_actions","metaserver/static/js/modules/clean/react/browse/data/helpers","metaserver/static/js/modules/clean/sync_everything/constants"],(function(e,t,s,r,o,i,a,n,l,d,c,u,p,m,h,_,f,g,v,S,w,y,b,T,F,E,P,I,C,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browseNavigateActions=void 0,a=s.__importStar(a),l=s.__importStar(l),d=s.__importStar(d),u=s.__importStar(u),m=s.__importStar(m),T=s.__importStar(T);t.browseNavigateActions=new class{constructor(){this.setUrl=({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:r})=>{this.reduxStore.dispatch(u.setUrl({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:r}))},this.onRestore=(e,t,s)=>{d.restoreFiles({files:t,userId:e,onSuccess:()=>{a.notifyRestoreSuccess(t)},isSearchMode:s})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=m.user(this.reduxStore.getState()),s=m.context(this.reduxStore.getState());l.showUnifiedTrashModal({userId:t.id,context:s,files:e,onRestore:(e,t)=>{this.onRestore(e,t,!1)}})},this.reduxStore=h.getStoreForBrowse()}reloadCurrentPath(){this.setUrl({path:m.path(this.reduxStore.getState()),qargs:{reload:!0}})}navigateToFileOrFolder({file:e,shouldFocusComment:t=!1,activeCommentThreadId:s,onFileViewerUnmount:r,fileViewAction:i=b.FileViewActionType.CLICK,fileViewOrigin:a=b.FileViewOriginType.BROWSE,skipFileViewerRouting:d=!1,performSpaRouting:c=!1}){const u=m.user(this.reduxStore.getState()),p=m.context(this.reduxStore.getState()),f=m.browsePostTTIExperiments(h.getStoreForBrowse().getState());if(e.isDeleted)this.doRestoreFilesWithUnifiedTrashModal({files:[e]});else{if(v.isSupportedLinkNodeClickAction(e.per_node_metadata))return void w.handleLinkNodeAction(e.per_node_metadata,e=>{S.logProductAnalytics(u.id,"web","select",e,"files_main_bar")});if(e.is_dir)if(e.type===n.FileTypes.VAULT_FOLDER)T.redirect(y.VAULT_URL);else if(C.isBackupFolder(e)&&f.expEnableBackupWeb&&!A.isBackupBrowse())T.open_tab(A.backupUrlForFqPath(e.fq_path));else if(_.File.isNoAccessSharedFolder(e))l.showNoAccess(u,e.fq_path,p);else{const t=f.expTidyUpBrowse,s="V1"===f.expOEXNamingConventionsGrowth;(t||s)&&p.isCurrentPathWriteable()&&setTimeout(()=>{m.context(this.reduxStore.getState()).currentFQPath===e.fq_path&&(t&&s?0===Math.floor(2*Math.random())?F.promptTidyUp(u.id,e.fq_path,e.ns_id).then(t=>{!1===t&&I.promptNamingConventions(u.id,e.fq_path,e.ns_id)}):I.promptNamingConventions(u.id,e.fq_path,e.ns_id).then(t=>{!1===t&&F.promptTidyUp(u.id,e.fq_path,e.ns_id)}):t?F.promptTidyUp(u.id,e.fq_path,e.ns_id):s&&I.promptNamingConventions(u.id,e.fq_path,e.ns_id))},5e3),this.setUrl({path:e.fq_path})}else{const n=()=>{this.openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:s,user:u,fileViewAction:i,fileViewOrigin:a,onFileViewerUnmount:r,skipFileViewerRouting:d,performSpaRouting:c})},{preferredEditors:l}=m.browsePostTTIData(this.reduxStore.getState());!t&&l&&o.hasPreferredEditorSupport(e)?o.openInPreferredEditor(u,e,l,n,{fileViewAction:i,fileViewOrigin:a}):n()}}}openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:s,user:o,fileViewAction:a,fileViewOrigin:n,onFileViewerUnmount:l,shouldFocusApproval:d,skipFileViewerRouting:h,performSpaRouting:_}){const v=m.context(this.reduxStore.getState()),{isOverFreeQuota:S,hasExcludedNsIds:w}=m.browsePostTTIData(this.reduxStore.getState());let y=p.getIndexOfFile(e,this.reduxStore.getState());const T=y<0?[e]:m.sortedFilesWithFolderSizes(this.reduxStore.getState()).toArray();if(y<0?y=0:T[y]=e,e.is_cloud_doc)r.openCloudDoc(e,o,a===b.FileViewActionType.SEARCH?i.WebSearchSource:i.WebBrowseSource);else{let r;const i=()=>{g.showElementsBehindFileViewer(),this.reduxStore.dispatch(u.setIsFileViewerShown({isShown:!1})),l&&l(),r&&r.focus()},p=()=>{r=document.querySelector(":focus"),g.hideElementsBehindFileViewer(),this.reduxStore.dispatch(u.setIsFileViewerShown({isShown:!0}))},m=h?()=>{const e=E.getBrowserHistory(),{location:t}=e,s=new URLSearchParams(t.search);s.delete("preview"),e.replace(`${t.pathname}?${s.toString()}`)}:void 0;f.asyncOpenPreview({containerId:c.BROWSE_FILE_VIEWER_ELEMENT_ID,files:T,indexOfPreviewFile:y,shouldFocusComment:t,activeCommentThreadId:s,user:o,onFileViewerDidMount:p,onFileViewerUnmount:i,fileViewAction:a,fileViewOrigin:n,fileViewTarget:b.FileViewTargetType.PRIVATE,browseContext:v,browseExceptions:{hasExcludedNsIds:w,isOverFreeQuota:S},shouldFocusApproval:d,skipFileViewerRouting:h,onCloseViewer:m}).then(()=>{if(_){const t=E.getBrowserHistory(),{location:s}=t,r=new URLSearchParams(s.search);r.append("preview",P.getFilename(e)),t.push(`${s.pathname}?${r.toString()}`)}})}}}})),define("metaserver/static/js/modules/clean/react/app_actions/education/async_extensions_edu_modal",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/components/modal"],(function(e,t,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowExtensionsEduModal=void 0,r=s.__importDefault(r),t.asyncShowExtensionsEduModal=function(t,i){return new Promise(t=>s.__awaiter(this,void 0,void 0,(function*(){const{AppActionsEduModal:a}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/app_actions/education/edu_modal_component"],t,s)}).then(s.__importStar);o.Modal.showInstance(r.default.createElement(a,{appName:i})),t()})))}})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/follow/async_folder_unfollower",["require","exports","tslib","react"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncFolderUnfollower=void 0;const o=(r=s.__importDefault(r)).default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{FolderUnfollower:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/folder_subscriptions/follow/folder_unfollower"],t,s)}).then(s.__importStar);return{default:t}})));t.AsyncFolderUnfollower=()=>r.default.createElement(r.default.Suspense,{fallback:null},r.default.createElement(o,null))})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/customization/async_customization_modal",["require","exports","tslib","metaserver/static/js/modules/clean/react/async/loadable"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCustomizationModal=void 0,t.AsyncCustomizationModal=r.Loadable({displayName:"AsyncCustomizationModal",loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{CustomizationModalController:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/folder_subscriptions/customization/customization_modal_controller"],t,s)}).then(s.__importStar);return t}))})})),define("metaserver/static/js/modules/clean/react/flows/components/flows_browse_root_async",["require","exports","tslib","react"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncFlowsRoot=void 0,r=s.__importStar(r);const{lazy:o,Suspense:i}=r,a=o(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{FlowsRoot:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/flows/components/flows_browse_root"],t,s)}).then(s.__importStar);return{default:t}})));t.AsyncFlowsRoot=e=>r.createElement(i,{fallback:r.createElement("div",null)},r.createElement(a,Object.assign({},e)))})),define("metaserver/static/js/modules/clean/react/file_uploader/parallel_scheduler_with_batch_commit",["require","exports","tslib","metaserver/static/js/modules/clean/react/upload_kit/scheduler/types"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParallelUploadSchedulerWithBatchCommit=t.CHUNK_SIZE=t.COMMIT_REQUEST_BATCH_SIZE=t.MAX_PARALLEL_COMMIT_REQUESTS=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=void 0,t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=8,t.MAX_PARALLEL_COMMIT_REQUESTS=1,t.COMMIT_REQUEST_BATCH_SIZE=100,t.CHUNK_SIZE=4194304;class o extends r.UploadScheduler{constructor(e){super(e),this.itemQueue=new Map,this.commitQueue=[],this.availableBlockRequests=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS,this.availableCommitRequests=t.MAX_PARALLEL_COMMIT_REQUESTS,this.onCompleteSubscribers=[],this.handleUploadBlocks=e.handleUploadBlocks,this.handleCommitBlocks=e.handleCommitBlocks,this.handleProgress=e.handleProgress,this.handleItemExit=e.handleItemExit}itemExit(e,t){const s=this.itemQueue.get(e);s&&(s.status=t,this.itemQueue.delete(e),this.handleItemExit(s.info,t))}dispenseChunkData(){if(!this.currentFileChunkReader||this.currentFileChunkReader.isEmpty()||!this.isItemUploading(this.currentFileChunkReader.item.destPath)){const e=Array.from(this.itemQueue.values()).find(e=>"Queued"===e.status&&e.file.size>0);if(!e)return null;this.currentFileChunkReader=new i(e),e.status="Uploading"}const e=this.currentFileChunkReader.getNextChunk();if(!e)return null;const t=this.currentFileChunkReader.item,s=t.blockTokens.length;return t.blockTokens.push(""),{item:t,chunk:e,blockIndex:s}}commitNext(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===this.availableCommitRequests)return;if(0===this.commitQueue.length)return void(this.isUploading()||this.fireComplete());this.availableCommitRequests--;const e=[],s=[];let r=t.COMMIT_REQUEST_BATCH_SIZE;for(;r>0&&this.commitQueue.length>0;){const t=this.commitQueue.shift(),o=this.itemQueue.get(t);if(!o)continue;const{info:i,blockTokens:a,destPath:n}=o;e.push({info:i,tokens:a}),s.push(n),r--}try{(yield this.handleCommitBlocks(e)).forEach(e=>{this.itemExit(e.filePath,e.success?"Completed":"Error")})}catch(e){s.forEach(e=>{this.itemExit(e,"Error")})}this.availableCommitRequests++,this.commitNext()}))}queueCommit(e){this.commitQueue.push(e),this.commitNext()}uploadNextBlock(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.availableBlockRequests<=0)return;const e=this.dispenseChunkData();if(!e)return void(this.isUploading()||this.fireComplete());const{item:t,chunk:s,blockIndex:r}=e;let o=0;const i=e=>{if(this.isItemUploading(t.destPath)){const r=Math.min(s.size,t.file.size),i=Math.min(e,r),a=Math.max(i-o,0);o+=a;const n=Math.min(t.totalBytesUploaded+a,t.file.size);t.totalBytesUploaded=n,this.handleProgress(t.info,n)}};this.availableBlockRequests--;try{const e=yield this.handleUploadBlocks(t.info,s,i);this.isItemUploading(t.destPath)&&(i(s.size),t.blockTokens[r]=e,a(t)&&(t.status="Committing",this.queueCommit(t.destPath)))}catch(e){this.itemExit(t.destPath,"Error")}this.availableBlockRequests++,this.uploadNextBlock()}))}addFile(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){this.itemQueue.set(t,{file:e,destPath:t,status:"Queued",bytesUploaded:0,info:r,blockTokens:[],totalBytesUploaded:0}),this.isUploading()&&this.startUploading()}))}startUploading(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.onComplete(),t=this.availableBlockRequests;for(let e=0;e<t;e++)this.uploadNextBlock();return e}))}cancelFile(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.itemQueue.get(e);t&&!a(t)&&this.itemExit(e,"Cancelled")}))}stopUploading(){this.itemQueue.forEach(({destPath:e})=>{this.cancelFile(e)})}isQueueEmpty(){return 0===this.itemQueue.size}isItemUploading(e){const t=this.itemQueue.get(e);return Boolean(t&&"Uploading"===t.status)}isUploading(){return this.availableBlockRequests<t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS||this.availableCommitRequests<t.MAX_PARALLEL_COMMIT_REQUESTS}fireComplete(){for(;this.onCompleteSubscribers.length>0;){const e=this.onCompleteSubscribers.shift();e&&e()}}onComplete(){return new Promise(e=>{this.onCompleteSubscribers.push(e)})}}t.ParallelUploadSchedulerWithBatchCommit=o;class i{constructor(e){this.currentOffset=0,this.item=e}getNextChunk(){if(this.isEmpty())return null;const e=this.item.file.slice(this.currentOffset,t.CHUNK_SIZE+this.currentOffset);return this.currentOffset+=t.CHUNK_SIZE,e}isEmpty(){return this.item.file.size<=this.currentOffset}}const a=({blockTokens:e,file:s})=>{if(e.every(e=>""!==e)){const r=Math.ceil(s.size/t.CHUNK_SIZE);return e.length===r}return!1}})),define("metaserver/static/js/modules/clean/react/file_uploader/parallel_upload_session_scheduler",["require","exports","tslib","metaserver/static/js/modules/clean/react/upload_kit/scheduler/types"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParallelUploadSessionScheduler=t.CHUNK_SIZE=t.COMMIT_REQUEST_BATCH_SIZE=t.MAX_PARALLEL_COMMIT_REQUESTS=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=void 0,t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=6,t.MAX_PARALLEL_COMMIT_REQUESTS=1,t.COMMIT_REQUEST_BATCH_SIZE=100,t.CHUNK_SIZE=4194304;class o extends r.UploadScheduler{constructor(e){super(e),this.itemQueue=new Map,this.commitQueue=[],this.availableBlockRequests=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS,this.availableCommitRequests=t.MAX_PARALLEL_COMMIT_REQUESTS,this.onCompleteSubscribers=[],this.handleUploadBlocks=e.handleUploadBlocks,this.handleCommitBlocks=e.handleCommitBlocks,this.handleProgress=e.handleProgress,this.handleItemExit=e.handleItemExit}itemExit(e,t){const s=this.itemQueue.get(e);s&&(s.status=t,this.itemQueue.delete(e),this.handleItemExit(s.info,t))}dispenseChunkData(){if(!this.currentFileChunkReader||this.currentFileChunkReader.isEmpty()||!this.isItemUploading(this.currentFileChunkReader.item.destPath)){const e=Array.from(this.itemQueue.values()).find(e=>"Queued"===e.status&&e.file.size>0);if(!e)return null;this.currentFileChunkReader=new i(e),e.status="Uploading"}const e=this.currentFileChunkReader.getNextChunk();if(!e)return null;const t=this.currentFileChunkReader.item,s=t.blockTokens.length;return t.blockTokens.push(""),{item:t,chunk:e,blockIndex:s}}commitNext(){return s.__awaiter(this,void 0,void 0,(function*(){if(0===this.availableCommitRequests)return;if(0===this.commitQueue.length)return void(this.isUploading()||this.fireComplete());this.availableCommitRequests--;const e=[],s=[];let r=t.COMMIT_REQUEST_BATCH_SIZE;for(;r>0&&this.commitQueue.length>0;){const t=this.commitQueue.shift(),o=this.itemQueue.get(t);if(!o)continue;const{info:i,blockTokens:a,destPath:n}=o;e.push({info:i,tokens:a}),s.push(n),r--}try{(yield this.handleCommitBlocks(e)).forEach(e=>{this.itemExit(e.filePath,e.success?"Completed":"Error")})}catch(e){s.forEach(e=>{this.itemExit(e,"Error")})}this.availableCommitRequests++,this.commitNext()}))}queueCommit(e){this.commitQueue.push(e),this.commitNext()}uploadNextBlock(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.availableBlockRequests<=0)return;const e=this.dispenseChunkData();if(!e)return void(this.isUploading()||this.fireComplete());const{item:t,chunk:s,blockIndex:r}=e;let o=0;const i=e=>{if(this.isItemUploading(t.destPath)){const r=Math.min(s.size,t.file.size),i=Math.min(e,r),a=Math.max(i-o,0);o+=a;const n=Math.min(t.totalBytesUploaded+a,t.file.size);t.totalBytesUploaded=n,this.handleProgress(t.info,n)}};this.availableBlockRequests--;try{const e=yield this.handleUploadBlocks(t.info,s,i);this.isItemUploading(t.destPath)&&(i(s.size),t.blockTokens[r]=e,a(t)&&(t.status="Committing",this.queueCommit(t.destPath)))}catch(e){this.itemExit(t.destPath,"Error")}this.availableBlockRequests++,this.uploadNextBlock()}))}addFile(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){this.itemQueue.set(t,{file:e,destPath:t,status:"Queued",bytesUploaded:0,info:r,blockTokens:[],totalBytesUploaded:0}),this.isUploading()&&this.startUploading()}))}startUploading(){return s.__awaiter(this,void 0,void 0,(function*(){const e=this.onComplete(),t=this.availableBlockRequests;for(let e=0;e<t;e++)this.uploadNextBlock();return e}))}cancelFile(e){return s.__awaiter(this,void 0,void 0,(function*(){const t=this.itemQueue.get(e);t&&!a(t)&&this.itemExit(e,"Cancelled")}))}stopUploading(){this.itemQueue.forEach(({destPath:e})=>{this.cancelFile(e)})}isQueueEmpty(){return 0===this.itemQueue.size}isItemUploading(e){const t=this.itemQueue.get(e);return Boolean(t&&"Uploading"===t.status)}isUploading(){return this.availableBlockRequests<t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS||this.availableCommitRequests<t.MAX_PARALLEL_COMMIT_REQUESTS}fireComplete(){for(;this.onCompleteSubscribers.length>0;){const e=this.onCompleteSubscribers.shift();e&&e()}}onComplete(){return new Promise(e=>{this.onCompleteSubscribers.push(e)})}}t.ParallelUploadSessionScheduler=o;class i{constructor(e){this.currentOffset=0,this.item=e}getNextChunk(){if(this.isEmpty())return null;const e=this.item.file.slice(this.currentOffset,t.CHUNK_SIZE+this.currentOffset);return this.currentOffset+=t.CHUNK_SIZE,e}isEmpty(){return this.item.file.size<=this.currentOffset}}const a=({blockTokens:e,file:s})=>{if(e.every(e=>""!==e)){const r=Math.ceil(s.size/t.CHUNK_SIZE);return e.length===r}return!1}})),define("metaserver/static/js/modules/clean/react/browse/tidy_up_actions",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/web_user_action_logger","metaserver/static/js/modules/clean/web_user_action_events","react-intl","metaserver/static/js/modules/clean/pap/analytics_client"],(function(e,t,s,r,o,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.snackbarTitle=t.promptTidyUp=t.snackbarCloseActionButtonText=t.snackbarActionButtonText=t.snackbarId=t.millisecondSnackbarTimeout=void 0,r=s.__importDefault(r);t.millisecondSnackbarTimeout=1e4,t.snackbarId="tidyup-feature-growth",t.snackbarActionButtonText=i.intl.formatMessage({id:"V4/4Hh",defaultMessage:"Open Organize"}),t.snackbarCloseActionButtonText=i.intl.formatMessage({id:"cK/p7/",defaultMessage:"Dismiss"}),t.promptTidyUp=function(t,r,o){return s.__awaiter(this,void 0,void 0,(function*(){const{dismissSnackbar:i,getNumAddedFilesAndFolders:a,shouldShowSnackbar:n}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/tidy_up/api_v2"],t,s)}).then(s.__importStar),{openTidyUpModal:l}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/tidy_up/feature_growth"],t,s)}).then(s.__importStar),{TidySpecificActionSurfaceLogValue:d}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/tidy_up/modal/types"],t,s)}).then(s.__importStar);if(!(yield n(t)))return!1;const c=yield a(t,r);if(c.num_added_files>=5||c.num_added_folders>=2){return u(t,o,()=>l(r,t,o,d.GROWTH_SNACKBAR_CTA),()=>i(t)),!0}return!1}))};const c=l.defineMessages({DEFAULT:{id:"1uNp68",defaultMessage:"It looks like you’ve added multiple files to this folder recently – organize them with our new folder organization tools."}});t.snackbarTitle=i.intl.formatMessage(c.DEFAULT);const u=(i,l,c,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){o.Snackbar.show(r.default.createElement(o.Snackbar,{actionButtonText:t.snackbarActionButtonText,onActionClick:c,closeButtonText:t.snackbarCloseActionButtonText,onCloseClick:u,timeoutDelayMs:t.millisecondSnackbarTimeout,title:t.snackbarTitle,variant:"generic",id:t.snackbarId})),a.WebUserActionLog.log(i,n.WebUserActionLogEvent.FEATURE_DISCOVERY_SNACKBAR_SHOW,{ns_id:l,trigger:"bulk_upload",feature:"tidy_up"});const{pap_events:p}=yield new Promise((t,s)=>{e(["metaserver/static/js/dropbox/proto/pap_events/tidyup/shown_tidyup_growth_snackbar"],t,s)}).then(s.__importStar);d.logEvent(p.tidyup.Shown_TidyupGrowthSnackbar.create({actionSurface:n.ActionSurfaceLogValue.FEATURE_GROWTH,tidyupFeatureDiscoveryTrigger:p.tidyup.Shown_TidyupGrowthSnackbar.TidyupFeatureDiscoveryTrigger.BULK_UPLOAD_TIDYUP_FEATURE_DISCOVERY_TRIGGER}))}))})),define("metaserver/static/js/modules/clean/react/browse/naming_conventions_actions",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/web_user_action_logger","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/data/store","react-intl","metaserver/static/js/modules/clean/react/browse/data/action_creators/index","metaserver/static/js/modules/clean/react/naming_conventions/types"],(function(e,t,s,r,o,i,a,n,l,d,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openNamingConventionsModal=t.promptNamingConventions=t.snackbarCloseActionButtonText=t.snackbarActionButtonText=t.snackbarId=t.millisecondSnackbarTimeout=void 0,r=s.__importDefault(r),l=s.__importStar(l),u=s.__importStar(u),t.millisecondSnackbarTimeout=1e4,t.snackbarId="naming-conventions-feature-growth",t.snackbarActionButtonText=i.intl.formatMessage({id:"ghdSnP",defaultMessage:"Show me"}),t.snackbarCloseActionButtonText=i.intl.formatMessage({id:"3ps1+a",defaultMessage:"Dismiss"}),t.promptNamingConventions=function(r,o,i){return s.__awaiter(this,void 0,void 0,(function*(){const{shouldShowSnackbar:c,snackbarDismissed:u}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/api_v2"],t,s)}).then(s.__importStar),p={".tag":"date_open",source_path:o},{should_show:m}=yield c(r,p);if(!m)return!1;const h=d.getStoreForBrowse().getState();if(l.path(h)===o){return a.WebUserActionLog.log(r,n.WebUserActionLogEvent.FEATURE_DISCOVERY_SNACKBAR_SHOW,{ns_id:i,trigger:"folder_open_with_dates",feature:"naming_conventions"}),_(()=>t.openNamingConventionsModal(o,r,i),()=>u(r)),!0}return!1}))};const m=c.defineMessages({DEFAULT:{id:"MsPjEI",defaultMessage:"This folder has some files with dates in them. Did you know you can set up naming conventions in Dropbox?"}}),h=i.intl.formatMessage(m.DEFAULT),_=(e,s)=>{o.Snackbar.show(r.default.createElement(o.Snackbar,{actionButtonText:t.snackbarActionButtonText,onActionClick:e,closeButtonText:t.snackbarCloseActionButtonText,onCloseClick:s,timeoutDelayMs:t.millisecondSnackbarTimeout,title:h,variant:"complete",id:t.snackbarId}))};t.openNamingConventionsModal=(r,i,c)=>{o.Snackbar.close(t.snackbarId);const m=d.getStoreForBrowse(),h=m.getState(),{expNamingConventionsPositioning:_}=l.browsePostTTIExperiments(h);l.path(h)!==r&&m.dispatch(u.setUrl({path:r})),a.WebUserActionLog.log(i,n.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:c,origin:p.NamingConventionOrigin.from_open_snackbar,positioning:_?1:0}),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/naming_conventions_modal"],t,s)}).then(s.__importStar).then(({showNamingConventionsModal:e})=>e({currentUserId:i,targetPath:r,namespaceId:c,origin:p.NamingConventionOrigin.from_open_snackbar}))}})),define("metaserver/static/js/modules/clean/react/naming_conventions/types",["require","exports"],(function(e,t){"use strict";var s,r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.WhenToShowError=t.ErrorType=t.dateFormatStrToEnum=t.ruleStrToEnum=t.TextDataState=t.LearnMoreLink=t.NamingConventionModal=t.NamingConventionOrigin=t.defaultNamingConventionParameters2WithSenderNameRule=t.defaultNamingConventionsParametersDataWithSenderNameRule=t.defaultNamingConventionParameters2=t.defaultNamingConventionsParametersData=t.emptyNamingConventionParameters=t.defaultNamingConventionParameters=t.ConsistentSeparatorSelection=t.DateFormatSelection=t.NamingConventionML=t.NamingConventionAutomation=t.NamingConventionType=t.APIRequestState=void 0,(function(e){e[e.IN_PROGRESS=0]="IN_PROGRESS",e[e.FAILED=1]="FAILED",e[e.SUCCEEDED=2]="SUCCEEDED"})(t.APIRequestState||(t.APIRequestState={})),(function(e){e.none="none",e.upload_date="upload_date",e.parent_folder_name="include_parent_folder_name",e.sender_name="sender_name",e.keyword="keyword",e.capture_date="capture_date",e.camera_make="camera_make",e.camera_model="camera_model",e.dimensions="dimensions",e.dots_per_inch="dots_per_inch",e.lens_model="lens_model",e.dots_per_cm="dots_per_cm",e.original_snippet="original_snippet",e.capitalize_all_initials="capitalize_all_initials",e.consistent_separators="change_all_separators"})(s=t.NamingConventionType||(t.NamingConventionType={})),t.NamingConventionAutomation="automation",t.NamingConventionML="ml",(function(e){e.yyyy_mm="yyyy_mm",e.yyyy_mm_dd="yyyy_mm_dd",e.yyyymmdd="yyyymmdd",e.yyyy_abbr_dd="yyyy_abbr_dd",e.yyyy_mm_hh_mm="yyyy_mm_hh_mm",e.yyyy_mm_dd_hh_mm="yyyy_mm_dd_hh_mm",e.yyyy_abbr_dd_hh_mm="yyyy_abbr_dd_hh_mm",e.yyyymmdd_hh_mm="yyyymmdd_hh_mm"})(r=t.DateFormatSelection||(t.DateFormatSelection={})),(function(e){e.spaces="spaces",e.dashes="dashes",e.underscores="underscores"})(o=t.ConsistentSeparatorSelection||(t.ConsistentSeparatorSelection={})),t.defaultNamingConventionParameters={selectedRules:[s.upload_date],dateFormatSelection:r.yyyy_mm_dd,consistentSeparatorSelection:o.spaces,mlFilenameParsing:!1,data:{keyword:""}},t.emptyNamingConventionParameters={selectedRules:[],dateFormatSelection:r.yyyy_mm_dd,consistentSeparatorSelection:o.spaces,mlFilenameParsing:!1,data:{keyword:""}},t.defaultNamingConventionsParametersData={dateInfo:[{mlFilenameParsing:!1,dateFormatSelection:r.yyyy_mm_dd},{mlFilenameParsing:!1,dateFormatSelection:r.yyyy_mm_dd}],consistentSeparatorSelection:o.spaces,keywords:["",""]},t.defaultNamingConventionParameters2={componentList:[s.none,s.original_snippet],capitalizeAllInitials:!1,changeAllSeparators:!1,data:t.defaultNamingConventionsParametersData},t.defaultNamingConventionsParametersDataWithSenderNameRule={dateInfo:[{mlFilenameParsing:!1,dateFormatSelection:r.yyyy_mm_dd},{mlFilenameParsing:!1,dateFormatSelection:r.yyyy_mm_dd}],consistentSeparatorSelection:o.spaces,keywords:["",""]},t.defaultNamingConventionParameters2WithSenderNameRule={componentList:[s.original_snippet,s.sender_name],capitalizeAllInitials:!1,changeAllSeparators:!1,data:t.defaultNamingConventionsParametersDataWithSenderNameRule},(function(e){e.from_desktop="from_desktop",e.from_menu="from_menu",e.from_upload_snackbar="from_upload_snackbar",e.from_rename_snackbar="from_rename_snackbar",e.from_open_snackbar="from_open_snackbar",e.from_file_request="from_file_request",e.from_automation="from_automation",e.from_renaming_bar="from_renaming_bar"})(t.NamingConventionOrigin||(t.NamingConventionOrigin={})),(function(e){e.rule_selection_page="rule_selection_page",e.automation_change_warning_page="automation_change_warning_page",e.automation_delete_warning_page="automation_delete_warning_page"})(t.NamingConventionModal||(t.NamingConventionModal={})),(function(e){e.ml="https://help.dropbox.com/en-us/files-folders/sort-preview/naming-conventions"})(t.LearnMoreLink||(t.LearnMoreLink={})),(function(e){e.empty="empty",e.invalid="invalid",e.valid="valid",e.lengthError="lengthError"})(t.TextDataState||(t.TextDataState={})),t.ruleStrToEnum=new Map([["upload_date",s.upload_date],["include_parent_folder_name",s.parent_folder_name],["sender_name",s.sender_name],["keyword",s.keyword],["capture_date",s.capture_date],["camera_make",s.camera_make],["camera_model",s.camera_model],["dimensions",s.dimensions],["dots_per_inch",s.dots_per_inch],["lens_model",s.lens_model],["dots_per_cm",s.dots_per_cm]]),t.dateFormatStrToEnum=new Map([["yyyy_mm",r.yyyy_mm],["yyyy_mm_dd",r.yyyy_mm_dd],["yyyy_abbr_dd",r.yyyy_abbr_dd],["yyyymmdd",r.yyyymmdd],["yyyy_mm_hh_mm",r.yyyy_mm_hh_mm],["yyyy_mm_dd_hh_mm",r.yyyy_mm_dd_hh_mm],["yyyy_abbr_dd_hh_mm",r.yyyy_abbr_dd_hh_mm],["yyyymmdd_hh_mm",r.yyyymmdd_hh_mm]]),(function(e){e[e.TEXT_ERROR=0]="TEXT_ERROR",e[e.RULE_ERROR=1]="RULE_ERROR"})(t.ErrorType||(t.ErrorType={})),(function(e){e[e.IMMEDIATELY=0]="IMMEDIATELY",e[e.WHEN_BUTTON_CLICKED=1]="WHEN_BUTTON_CLICKED"})(t.WhenToShowError||(t.WhenToShowError={}))})),define("metaserver/static/js/modules/clean/react/plusplus/file_actions",["require","exports","tslib","metaserver/static/js/modules/clean/pnm/constants","metaserver/static/js/modules/clean/pnm/utils","metaserver/static/js/modules/clean/react/plusplus/constants","metaserver/static/js/modules/core/browser"],(function(e,t,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLinkNodeEventObject=t.handleLinkNodeAction=t.openPasswords=void 0,a=s.__importStar(a),t.openPasswords=()=>{a.redirect(i.PASSWORDS_POST_SETUP_URL)},t.handleLinkNodeAction=(i,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const{openBackupsModal:n,setupPasswords:l,setupVault:d}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/plusplus/setup_actions"],t,s)}).then(s.__importStar);switch(o.getLinkNodeAction(i)){case r.BACKUP_PRE_SETUP_ACTION:null==a||a("backup_set_up"),n();break;case r.PASSWORDS_PRE_SETUP_ACTION:null==a||a("passwords_set_up"),l();break;case r.PASSWORDS_POST_SETUP_ACTION:null==a||a("passwords_open"),t.openPasswords();break;case r.VAULT_PRE_SETUP_ACTION:null==a||a("vault_set_up"),d()}})),t.getLinkNodeEventObject=function(e){switch(o.getLinkNodeAction()){case r.BACKUP_PRE_SETUP_ACTION:return"backup_set_up";case r.PASSWORDS_PRE_SETUP_ACTION:return"passwords_set_up";case r.PASSWORDS_POST_SETUP_ACTION:return"passwords_open";case r.VAULT_PRE_SETUP_ACTION:return"vault_set_up"}return null}})),define("metaserver/static/js/modules/clean/react/edison/spa_timing_logger",["require","exports","tslib","metaserver/static/js/modules/clean/web_timing_logger"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markTimeToInteractive=t.markTimeToView=t.markFetchedDataRequiredForTTI=t.markApplicationStart=t.isClientSideNavigation=t.FILES_SPA_TIMER=void 0,r=s.__importStar(r),t.FILES_SPA_TIMER="files_spa_timer",t.isClientSideNavigation=()=>null!==r.time_to_interactive();const o=e=>{const s=t.isClientSideNavigation()||e;return{usingSpaTimer:s,timer:s?r.get_timer(t.FILES_SPA_TIMER):r.get_timer()}};t.markApplicationStart=e=>{const{usingSpaTimer:t,timer:s}=o(e);t||s.applicationStart()},t.markFetchedDataRequiredForTTI=e=>{const{usingSpaTimer:t,timer:s}=o(e);t||s.fetchedDataRequiredForTTI()},t.markTimeToView=e=>{o(e).timer.markTimeToView()},t.markTimeToInteractive=e=>{const{usingSpaTimer:t,timer:s}=o(e);s.markTimeToInteractive(),t&&s.end()}})),define("metaserver/static/js/modules/clean/react/edison/spa_chrome",["require","exports","tslib","classnames","react","metaserver/static/js/modules/clean/react/edison/router_utils","metaserver/static/js/modules/clean/react/maestro/layout/chrome","metaserver/static/js/modules/clean/react/maestro/layout/search"],(function(e,t,s,r,o,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChromeWrapper=void 0,r=s.__importDefault(r),o=s.__importDefault(o),t.ChromeWrapper=e=>{if(i.shouldUseReactRouter()){const{chromeClass:t}=e,i=s.__rest(e,["chromeClass"]);return o.default.createElement(a.MaestroChrome,Object.assign({},i,{chromeClass:r.default({"maestro-chrome--right-rail":e.useRightRailOutsideSearch},t)}))}return o.default.createElement(n.SearchChrome,Object.assign({searchBarProps:{searchVariant:"full-page"}},e))}})),define("metaserver/static/js/modules/clean/tagging/components/context_providers",["require","exports","tslib","react"],(function(e,t,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsContext=void 0,r=s.__importDefault(r),t.TagsContext=r.default.createContext({onSelection:e=>{},onTagDelete:e=>{},fetchAllTagsSuggestions:e=>{},allTagsSuggestions:void 0})})),define("metaserver/static/js/modules/clean/react/file_uploader/clean/data/initial_state",["require","exports","tslib","metaserver/static/js/modules/clean/react/file_uploader/team_access_levels_definition","immutable","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/active_user"],(function(e,t,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initialUploadState=void 0,o=s.__importStar(o),t.initialUploadState={path:"/",hasPermissionToUploadToFolder:!0,folderNsId:null,user:a.getActiveUser(),fileList:o.OrderedMap(),currentUploadId:null,numDraggingFiles:0,isInternalTransfer:!1,isUploadModalOpen:!1,inlineStatusShouldBeDismissed:!1,isMovingIntoVault:!1,isPermissionsAtUploadModalOpen:!1,numSecondsLeft:0,currentFileNumSecondsLeft:0,confirmedFSWs:[],confirmedFSWBatchIds:[],hasOverquotaError:!1,allUploadsComplete:!1,teamAccessLevelsDefinition:new r.TeamAccessLevelsDefinition,targetSurface:"none",overQuotaStatus:i.OverQuotaStatusType.NONE,uploadModalType:null,lastFileUploadMethod:"upm"}})),define("metaserver/static/js/modules/clean/react/file_uploader/clean/data/selectors",["require","exports","@reduxjs/toolkit","metaserver/static/js/modules/clean/react/file_uploader/clean/data/initial_state","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/redux/selectors","metaserver/static/js/modules/clean/react/file_uploader/constants"],(function(e,t,s,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLastFileUploadMethod=t.getUploadModalType=t.getOverQuotaDetails=t.getOverQuotaStatus=t.getTargetSurface=t.getTeamAccessLevel=t.getTeamAccessLevelsDefinition=t.allUploadsComplete=t.hasOverquotaError=t.getConfirmedFSWBatchIds=t.getConfirmedFSWs=t.isUploadModalOpen=t.isUploadInProgress=t.isInternalTransfer=t.getIsDraggingFiles=t.getNumDraggingFiles=t.getNextUpload=t.hasPermissionToUploadToFolder=t.getFolderNsId=t.isPermissionsAtUploadModalOpen=t.isMovingIntoVault=t.inlineStatusShouldBeDismissed=t.isUploadCancelled=t.getCurrentFileNumSecondsLeft=t.getNumSecondsLeft=t.getUploadById=t.getCurrentUpload=t.getPath=t.getUser=t.getFileList=t.getUploadState=void 0,t.getUploadState=e=>i.getStateAtNamespace(e,o.UPLOAD_NAMESPACE_KEY)||r.initialUploadState,t.getFileList=e=>t.getUploadState(e).fileList,t.getUser=e=>t.getUploadState(e).user,t.getPath=e=>t.getUploadState(e).path;t.getCurrentUpload=e=>{const s=(e=>t.getUploadState(e).currentUploadId)(e);if(!s)return null;const r=t.getFileList(e).get(s);return r||null},t.getUploadById=(e,s)=>{let r;return s&&(r=t.getFileList(e).get(s)),r},t.getNumSecondsLeft=e=>t.getUploadState(e).numSecondsLeft,t.getCurrentFileNumSecondsLeft=e=>t.getUploadState(e).currentFileNumSecondsLeft,t.isUploadCancelled=(e,s)=>{const r=t.getFileList(e).get(s);return!!r&&r.status===a.FileStatusType.CANCELLED},t.inlineStatusShouldBeDismissed=e=>t.getUploadState(e).inlineStatusShouldBeDismissed,t.isMovingIntoVault=e=>t.getUploadState(e).isMovingIntoVault,t.isPermissionsAtUploadModalOpen=e=>t.getUploadState(e).isPermissionsAtUploadModalOpen,t.getFolderNsId=e=>t.getUploadState(e).folderNsId,t.hasPermissionToUploadToFolder=e=>t.getUploadState(e).hasPermissionToUploadToFolder,t.getNextUpload=s.createSelector(t.getFileList,e=>e.find(e=>e.status===a.FileStatusType.PENDING)),t.getNumDraggingFiles=e=>t.getUploadState(e).numDraggingFiles,t.getIsDraggingFiles=e=>t.getUploadState(e).numDraggingFiles>0,t.isInternalTransfer=e=>t.getUploadState(e).isInternalTransfer,t.isUploadInProgress=s.createSelector(t.getFileList,e=>e.some(e=>e.status===a.FileStatusType.UPLOADING||e.status===a.FileStatusType.PENDING)),t.isUploadModalOpen=e=>t.getUploadState(e).isUploadModalOpen,t.getConfirmedFSWs=e=>t.getUploadState(e).confirmedFSWs,t.getConfirmedFSWBatchIds=e=>t.getUploadState(e).confirmedFSWBatchIds,t.hasOverquotaError=e=>t.getUploadState(e).hasOverquotaError,t.allUploadsComplete=e=>t.getUploadState(e).allUploadsComplete,t.getTeamAccessLevelsDefinition=e=>t.getUploadState(e).teamAccessLevelsDefinition,t.getTeamAccessLevel=(e,s)=>t.getUploadState(e).teamAccessLevelsDefinition.getTeamAccessLevel(s),t.getTargetSurface=e=>t.getUploadState(e).targetSurface,t.getOverQuotaStatus=e=>t.getUploadState(e).overQuotaStatus,t.getOverQuotaDetails=e=>t.getUploadState(e).overQuotaDetails,t.getUploadModalType=e=>t.getUploadState(e).uploadModalType,t.getLastFileUploadMethod=e=>t.getUploadState(e).lastFileUploadMethod})),define("metaserver/static/js/modules/clean/react/file_uploader/clean/data/slice",["require","exports","tslib","@reduxjs/toolkit","metaserver/static/js/modules/clean/react/file_uploader/team_access_levels_definition","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/viewer","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/clean/react/file_uploader/utils","metaserver/static/js/modules/clean/react/file_uploader/clean/data/initial_state","metaserver/static/js/modules/core/exception","@reduxjs/toolkit","metaserver/static/js/modules/clean/deprecated_ajax/ajax_jquery","metaserver/static/js/modules/clean/react/file_uploader/clean/data/selectors"],(function(e,t,s,r,o,i,a,n,l,d,c,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=t.uploadActionCreators=t.fetchQuotaUpsell=void 0,p=s.__importStar(p),t.fetchQuotaUpsell=u.createAsyncThunk("UPLOAD/fetchQuotaUpsell",(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const e=t.getState(),s=m.getUser(e);return yield p.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:s.id}})})));const h=r.createSlice({name:"UPLOAD",initialState:d.initialUploadState,reducers:{setUser(e,{payload:t}){t&&(e.user=t)},setPath(e,{payload:t}){const{path:s,hasPermissionToUploadToFolder:r=!0,isMovingIntoVault:o=!1,targetSurface:i="none"}=t;e.path=s,e.hasPermissionToUploadToFolder=r,e.isMovingIntoVault=o,e.targetSurface=i},setFolderNsId(e,{payload:t}){e.folderNsId=t},setHasOverquotaError(e,{payload:t}){e.hasOverquotaError=t},addTeamLevelAccess(e,{payload:t}){e.teamAccessLevelsDefinition=e.teamAccessLevelsDefinition.addTeamAccessLevel(t.path,t.accessLevel)},resetTeamAccessLevel(e){e.teamAccessLevelsDefinition=new o.TeamAccessLevelsDefinition},queueUploads(e,{payload:t}){const s={};for(const e of t)s[e.uploadId]=e;e.fileList=e.fileList.merge(s)},readyUploads(e,{payload:t}){for(const s of t)e.fileList=e.fileList.update(s.uploadId,e=>e.set("status",i.FileStatusType.PENDING))},cancelUploads(e,{payload:t}){for(const s of t)e.fileList=e.fileList.update(s.uploadId,e=>e.status===i.FileStatusType.SET_PERMISSIONS||e.status===i.FileStatusType.PENDING||e.status===i.FileStatusType.UPLOADING?e.set("status",i.FileStatusType.CANCELLED):e),s.uploadId===e.currentUploadId&&(e.currentUploadId=null)},setCurrentUploadProgress(e,{payload:t}){const{percentComplete:s,numSecondsLeft:r}=t;e.currentUploadId&&(e.fileList=e.fileList.update(e.currentUploadId,e=>e.set("percentUploaded",s)),void 0!==e.numSecondsLeft&&r&&(e.numSecondsLeft=r))},startUpload(e,{payload:t}){const{file:s,allowParallelUpload:r}=t;if(!r){const t=()=>{const t=e.currentUploadId;if(!t)return null;const s=e.fileList.get(t);return s||null};n.assert(null==t(),"can't start an upload while one is ongoing")}n.assert(null!=s,"missing file to upload"),n.assert(e.fileList.has(s.uploadId),"failed to find file in file list"),e.fileList.get(s.uploadId)&&(e.fileList=e.fileList.update(s.uploadId,e=>e.set("status",i.FileStatusType.UPLOADING)),e.currentUploadId=r?null:s.uploadId,e.allUploadsComplete=!1)},completeUpload(e,{payload:t}){const{uploadId:s,allowParallelUpload:r}=t,o=e.fileList.get(s);o&&((s!==e.currentUploadId&&!r||o.status!==i.FileStatusType.UPLOADING)&&c.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:o.toString(),fileListLength:e.fileList.count(),uploadId:s,currentUploadId:e.currentUploadId}}),e.fileList=e.fileList.update(s,e=>e.set("status",i.FileStatusType.COMPLETE))),e.currentUploadId=null},handleUploadError(e,{payload:t}){const{uploadId:s,errorType:r,errorMessage:o,allowParallelUpload:a}=t,n=e.fileList.get(s);n&&(n.uploadId===e.currentUploadId||a||c.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:n.toString(),fileListLength:e.fileList.count(),uploadId:s,currentUploadId:e.currentUploadId,errorType:r,errorMessage:o}}),e.fileList=e.fileList.update(n.uploadId,e=>e.set("status",i.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o))),e.currentUploadId=null},setNumDraggingFiles(e,{payload:t}){const{numDraggingFiles:s,isInternalTransfer:r=!1}=t;e.numDraggingFiles=s,e.isInternalTransfer=r},setIsUploadModalOpen(e,{payload:t}){e.isUploadModalOpen=t},setInlineStatusShouldBeDismissed(e,{payload:t}){e.inlineStatusShouldBeDismissed=t},setIsPermissionsAtUploadModalOpen(e,{payload:t}){e.isPermissionsAtUploadModalOpen=t},addNewFailedFile(e,{payload:t}){const{file:s,errorType:r,errorMessage:o}=t;let a=s;null==a.uploadId&&(a=a.set("uploadId",l.generateUploadId())),a=a.set("status",i.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o),e.fileList=e.fileList.set(a.uploadId,a)},confirmFSW(e,{payload:t}){const{fswIds:s,batchId:r}=t;s.forEach(t=>{e.confirmedFSWs.includes(t)||e.confirmedFSWs.push(t)}),e.confirmedFSWBatchIds.includes(r)||e.confirmedFSWBatchIds.push(r)},setUploadProgress(e,{payload:t}){const{uploadId:s,percentComplete:r,numSecondsLeft:o,secondsLeftForFile:a}=t;if(s){if(e.fileList=e.fileList.update(s,e=>e.set("percentUploaded",r)),void 0!==o&&(e.numSecondsLeft=o),r>0&&r<100){e.fileList.get(s)&&(e.fileList=e.fileList.update(s,e=>e.set("status",i.FileStatusType.UPLOADING)))}a&&(e.fileList=e.fileList.update(s,e=>e.set("numSecondsLeft",a)))}},setUploadModalType(e,{payload:t}){e.uploadModalType=t},setLastFileUploadMethod(e,{payload:t}){e.lastFileUploadMethod=t}},extraReducers:e=>{e.addCase(t.fetchQuotaUpsell.fulfilled,(e,t)=>{try{const s=JSON.parse(t.payload),r={userQuotaUsageRatio:s.user_quota_usage_ratio,tsdQuotaUsageRatio:s.tsd_quota_usage_ratio,inExcludedNses:s.in_excluded_nses,promptAdminToUpgradeEmailTemplateUrl:s.prompt_admin_to_upgrade_email_template_url,numTeamMembers:s.num_team_members,numTeamAdmins:s.num_team_admins,teamAdminEmail:s.team_admin_email,teamAdminFname:s.team_admin_fname};e.overQuotaDetails=r,e.overQuotaStatus=(function({path:e,user:t,tsdQuotaUsageRatio:s,inExcludedNses:r,userQuotaUsageRatio:o}){if(n.assert(null!=t,"user is null"),t.paid||r)return i.OverQuotaStatusType.NONE;if("personal"===t.role){if(o>1)return i.OverQuotaStatusType.BASIC_OVER_QUOTA;if(o>.9)return i.OverQuotaStatusType.BASIC_NEAR_QUOTA}if(t.is_team&&a.Viewer.get_viewer().team_is_limited){const r=t.cdm_tmf_path;if(!t.is_cdm_member||r&&e.startsWith(r)){if(o>1)return i.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA}else if(s>1)return i.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA}if(t.is_team&&a.Viewer.get_viewer().team_is_locked)return i.OverQuotaStatusType.LOCKED_TEAM_USER_OVER_QUOTA;return i.OverQuotaStatusType.NONE})({user:e.user,path:e.path,tsdQuotaUsageRatio:r.tsdQuotaUsageRatio,inExcludedNses:r.inExcludedNses,userQuotaUsageRatio:r.userQuotaUsageRatio})}catch(e){c.reportException({err:e,severity:"non-critical",exc_extra:{data:t.payload}})}})}});t.uploadActionCreators=h.actions,t.reducer=h.reducer})),define("metaserver/static/js/modules/clean/react/file_uploader/clean/data/store",["require","exports","metaserver/static/js/modules/clean/react/file_uploader/clean/data/slice","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/redux/store"],(function(e,t,s,r,o){"use strict";let i;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForUpload=void 0,t.getStoreForUpload=()=>(i||(i=o.getStoreAndRegisterReducers({[r.UPLOAD_NAMESPACE_KEY]:s.reducer})),i)}));
//# sourceMappingURL=pkg-file-upload.min.js-vflwNrID3.map