define("metaserver/static/js/modules/clean/react/browse/model_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FetchFolderSizeState=void 0,(function(e){e.LOADING="LOADING",e.COMPLETE="COMPLETE",e.NO_ACCESS="NO_ACCESS",e.ERROR="ERROR"})(t.FetchFolderSizeState||(t.FetchFolderSizeState={}))})),define("metaserver/static/js/modules/clean/cloud_docs/create_api",["require","exports","tslib","apex-metrics/index","metaserver/static/js/api_v2/user_client","metaserver/static/js/modules/clean/cloud_docs/constants","metaserver/static/js/modules/clean/cloud_docs/create_pointer_modal","metaserver/static/js/modules/clean/cloud_docs/event_logging","metaserver/static/js/modules/clean/cloud_docs/types","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/logging/hive/schemas/web-modal-activity","metaserver/static/js/modules/clean/react/async_file_modal_controller","metaserver/static/js/modules/clean/react/folder_dialog/async","metaserver/static/js/modules/clean/react/components/modal","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/cookies","metaserver/static/js/modules/core/i18n","spectrum/util/uuid_generator","metaserver/static/js/modules/clean/metrics/index","metaserver/static/js/modules/clean/cloud_docs/constants"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCreateActionSource=t.createNewPointer=t.createNewCloudOnlyDoc=t.createPlaceholderTabForNewCloudDoc=t.constructFormForCreateNewMicrosoftFile=t.createNewFile=t.showAsyncFolderDialog=t.logCreateFileSuccessCallback=t.logCreateFileCallback=t.logCreateFileAttempt=t.getDepthFromPath=t.CloudDocSnackbarId=void 0,c=s.__importStar(c),u=s.__importStar(u),p=s.__importStar(p),f=s.__importStar(f),S=s.__importStar(S);const w=v.intl.formatMessage({id:"UpDkTB",defaultMessage:"Create file in..."}),C=v.intl.formatMessage({id:"7E4VWP",defaultMessage:"Create shortcut in..."}),O=v.intl.formatMessage({id:"bhV8Xa",defaultMessage:"Create"}),F=v.intl.formatMessage({id:"GDikFY",defaultMessage:"Choose folder"});t.CloudDocSnackbarId="create-cloud-doc",t.getDepthFromPath=e=>(e.replace(/\/$/,"").match(/\//g)||[]).length,t.logCreateFileAttempt=(e,t)=>{n.logUserAction({actionEvent:l.UserActionEventType.PRE_CREATE,userId:t.userId,actionSource:t.action_source,data:{webOpenId:e}})},t.logCreateFileCallback=({ts:e,documentType:t,selectionMode:r,emptyFolder:a,error:o})=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=b.getMetricsReporter(),n={};n.document_type=t||"unknown",n.selection_mode=r||"undefined",n.empty_folder=String(a),n.error=o?"true":"false",s.createStats({ns:I.CLOUD_DOCS_AMP_NAMESPACE,name:"web/createFile"},n).recordDuration(Date.now()-e,i.TimeUnit.MILLISECONDS)})),t.logCreateFileSuccessCallback=({ts:e,openId:s,selection_mode:i,empty_folder:r})=>a=>{t.logCreateFileCallback({ts:Date.now(),documentType:a.documentType,selectionMode:i,emptyFolder:r}),h.logFileCreateSuccess({uid:a.userId,document_type:a.documentType,time_elapsed:Date.now()-e,open_id:s,selection_mode:i,empty_folder:r}),n.logUserAction({actionEvent:l.UserActionEventType.CREATE,userId:a.userId,docPathOrId:a.fq_path,actionSource:a.action_source,data:{webOpenId:s}})},t.showAsyncFolderDialog=({user:e,source:s,documentType:i,selection_mode:r,empty_folder:o,handleClickNewFolder:n,initialPath:l})=>{const c=a.isPointerFileType(i),u=c?C:w,_=c?F:O;p.showFolderDialog({modalName:d.ModalName.CLOUD_DOCS_CREATE,user:e,title:u,primaryActionLabel:_,handleClickNewFolder:n,initialPath:l,useApiV2:!0,onSuccess:(a,n)=>{const l=a||"/";h.logFileCreateClick({uid:e.id,source:s,action:g.WebUserActionLogEvent.FILE_CREATE_HOME_FOLDER_SELECTED,depth_folder_selected:t.getDepthFromPath(l),selection_mode:r,empty_folder:o}),t.createNewFile({user:e,path:l,documentType:i,source:s,selection_mode:r,empty_folder:o})}})},t.createNewFile=({user:i,path:r,documentType:l,source:c,selection_mode:d,empty_folder:u})=>s.__awaiter(void 0,void 0,void 0,(function*(){return Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/account/email"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/account/email_verify_reasons"],t,s)}).then(s.__importStar)]).then(([{EmailVerification:e},{EmailVerificationReasons:s}])=>{if(!e.get_for_user(i).verified_or_show(s.CLOUD_DOCS))return;const p=T.generateUUID("web-create");if(a.isMicrosoftFileType(l)){t.logCreateFileAttempt(p,{userId:i.id,action_source:n.getActionSourceFromNewFileMenuType(c)});const e=t.logCreateFileSuccessCallback({ts:Date.now(),openId:p,selection_mode:d,empty_folder:u});R({userId:i.id,path:r,documentType:l,logSuccessCallback:e,source:c})}else if(a.isPointerFileType(l))o.CreatePointerModal.showInstance({createOnSubmit:e=>{t.logCreateFileAttempt(p,{userId:i.id,action_source:n.getActionSourceFromNewFileMenuType(c)});const s=t.logCreateFileSuccessCallback({ts:Date.now(),openId:p,selection_mode:d,empty_folder:u});t.createNewPointer({userId:i.id,pathName:r,name:e.pointerData.name,url:e.pointerData.url,onError:e.onError,logSuccessCallback:s,source:c})}});else{t.logCreateFileAttempt(p,{userId:i.id,action_source:n.getActionSourceFromNewFileMenuType(c)});const e=t.logCreateFileSuccessCallback({ts:Date.now(),openId:p,selection_mode:d,empty_folder:u});t.createNewCloudOnlyDoc({userId:i.id,pathName:r,title:v.intl.formatMessage({id:"j+AeKy",defaultMessage:"Untitled"}),documentType:l,logSuccessCallback:e,source:c,openId:p,selection_mode:d,empty_folder:u})}})}));const R=({userId:e,path:s,documentType:i,logSuccessCallback:r,source:a})=>{const o={fq_path:s,extension:i,action_source:t.getCreateActionSource(a),_subject_uid:String(e),t:E.Cookies.read("__Host-js_csrf")},l=t.constructFormForCreateNewMicrosoftFile(o);document.body.appendChild(l),l.submit(),r({userId:e,documentType:i,action_source:n.getActionSourceFromNewFileMenuType(a)})};t.constructFormForCreateNewMicrosoftFile=e=>{const t=document.createElement("form");t.action="/ow/msft/create_new_file",t.method="POST",t.target="_blank";for(const s of Object.keys(e)){const i=document.createElement("input");i.type="hidden",i.name=s,i.value=e[s],t.appendChild(i)}return t},t.createPlaceholderTabForNewCloudDoc=()=>S.open_tab(a.LOADING_PAGE_URL,!0),t.createNewCloudOnlyDoc=({userId:e,pathName:s,title:i,documentType:r,logSuccessCallback:a,source:o,openId:l,selection_mode:c,empty_folder:d})=>{const p=v.intl.formatMessage({id:"XcMi4Q",defaultMessage:"Creating new file…"}),_=v.intl.formatMessage({id:"5VrbkU",defaultMessage:"File created!"}),h=e=>(e.preventDefault(),e.returnValue="","");window.addEventListener("beforeunload",h);let g=t.createPlaceholderTabForNewCloudDoc();const S=E=>{m.Snackbar.sync(p,!0,t.CloudDocSnackbarId),f.createCloudDoc({pathName:s,title:i,documentType:r,userId:e,onSuccess:({changesets:s,createdFile:i,failureDetails:p})=>{if(p){const e=()=>{a=t.logCreateFileSuccessCallback({ts:Date.now(),openId:l,selection_mode:c,empty_folder:d}),g=t.createPlaceholderTabForNewCloudDoc(),S(!1)};g.close(),m.Snackbar.close(t.CloudDocSnackbarId),window.removeEventListener("beforeunload",h),u.showFileSystemWarningsModal({fsws:p,confirmText:v.intl.formatMessage({id:"bhV8Xa",defaultMessage:"Create"}),onFinalAccept:e})}else if(m.Snackbar.complete(_,t.CloudDocSnackbarId),window.removeEventListener("beforeunload",h),null!==i&&(a({userId:e,documentType:r,fq_path:i.fq_path,action_source:n.getActionSourceFromNewFileMenuType(o)}),g)){let e=i.open_to_url;try{const t=new URL(e);t.searchParams.set("web_open_id",l),e=t.toString()}catch(e){}g.location.replace(e)}},onError:e=>{t.logCreateFileCallback({ts:Date.now(),documentType:r,selectionMode:c,emptyFolder:d,error:!0}),m.Snackbar.fail(e,t.CloudDocSnackbarId),window.removeEventListener("beforeunload",h)},checkFSWs:E})};S(!0)},t.createNewPointer=({userId:e,pathName:t,name:s,url:i,onError:o,logSuccessCallback:d,source:u})=>{const p=new r.UserApiV2Client,f=v.intl.formatMessage({id:"l6L9q8",defaultMessage:"Creating new shortcut"}),h=v.intl.formatMessage({id:"EqUCHi",defaultMessage:"Created shortcut"});return m.Snackbar.sync(f,!0,"create-cloud-shortcut"),p.ns("cloud_docs").rpc("create",{to_path:c.normalize(t)||"/",title:s,cloud_doc_type:l.SimplePointer,pointer_url:i},{subjectUserId:e}).then(t=>{d({userId:e,documentType:a.PointerFileTypes.SIMPLE_POINTER,fq_path:t.result_path,action_source:n.getActionSourceFromNewFileMenuType(u)}),_.Modal.close(),m.Snackbar.complete(`${h} "${c.filename(t.result_path)}"`,"create-cloud-shortcut")}).catch(e=>{o(),m.Snackbar.fail(v.intl.formatMessage({id:"fi9Okp",defaultMessage:"Oops, something went wrong. Please try again later."}),"create-cloud-shortcut")})},t.getCreateActionSource=e=>{switch(e){case a.NewFileMenuFromType.BROWSE:return a.ActionSourceValue.WEB_BROWSE;case a.NewFileMenuFromType.HOME:return a.ActionSourceValue.WEB_HOME;default:return a.ActionSourceValue.WEB}}})),define("metaserver/static/js/modules/clean/cloud_docs/create_pointer_modal",["require","exports","tslib","react","metaserver/static/js/modules/clean/cloud_docs/pointers_common","metaserver/static/js/modules/clean/react/components/css","metaserver/static/js/modules/clean/react/components/modal","metaserver/static/js/modules/core/i18n","dig-components/modal","dig-components/buttons"],(function(e,t,s,i,r,a,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePointerModal=void 0,i=s.__importDefault(i);const d=n.intl.formatMessage({id:"8yzGEK",defaultMessage:"Create a new shortcut"}),u=n.intl.formatMessage({id:"S8dvWz",defaultMessage:"Create"}),p=n.intl.formatMessage({id:"I5Fo4y",defaultMessage:"Creating..."}),_=n.intl.formatMessage({id:"vPeF94",defaultMessage:"Name"}),m=n.intl.formatMessage({id:"nYdrYR",defaultMessage:"URL"}),f=n.intl.formatMessage({id:"U1i5X8",defaultMessage:"Invalid URL"});class h extends i.default.Component{constructor(e){super(e),this.onChange=e=>{this.setState({pointerData:e})},this.handleCreateOnClick=()=>{this.setState({creationInProgress:!0}),this.props.createOnSubmit({pointerData:{name:this.state.pointerData.name.trim(),url:this.state.pointerData.url.trim()},onError:this.handleSubmitError})},this.handleSubmitError=()=>{this.setState({creationInProgress:!1})},this.closeModal=()=>{o.Modal.close()},this.state={pointerData:{name:"",url:""},creationInProgress:!1}}render(){const e=r.CreatePointerFields.canSubmit(this.state.pointerData)&&!this.state.creationInProgress;return i.default.createElement(l.Modal,{title:d,"aria-label":"Shortcut Creation Modal",open:!0},i.default.createElement(l.Modal.Header,{hasBottomSpacing:"title-standard"},i.default.createElement(l.Modal.Title,null,d)),i.default.createElement(l.Modal.Body,{hasVerticalSpacing:!1},i.default.createElement(r.CreatePointerFields,{name:this.state.pointerData.name,url:this.state.pointerData.url,onChange:this.onChange,onSubmit:this.handleCreateOnClick,nameLabel:_,urlLabel:m,urlValidationMessage:f})),i.default.createElement(l.Modal.Footer,null,i.default.createElement(c.Button,{variant:"opacity",onClick:this.closeModal},n.intl.formatMessage({id:"gZIlfg",defaultMessage:"Cancel"})),i.default.createElement(c.Button,{variant:"primary",disabled:!e,onClick:this.handleCreateOnClick},this.state.creationInProgress?p:u)))}static showInstance(e){return o.Modal.showInstance(i.default.createElement(g,Object.assign({},e)))}}t.CreatePointerModal=h,h.displayName="CreatePointerModal";const g=a.requireCssWithComponent(h,["/static/css/spectrum/index.web-vfliw9181.css","/static/css/cloud_docs/create_pointer_modal-vflATc8Dt.css"])})),define("metaserver/static/js/modules/clean/cloud_docs/event_logging",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/modules/clean/cloud_docs/types","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/clean/logging/hive/schemas/web-user-action","metaserver/static/js/modules/clean/logging/telemetry","metaserver/static/js/modules/constants/python","metaserver/static/js/modules/clean/cloud_docs/constants","metaserver/static/js/modules/clean/perf_tools/web_timing_utils","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/clean/filepath/filepath"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logLoggedOutUXSnackBarAction=t.logInterstitialLoginAction=t.logFileConvertPromptAction=t.logFileOpenPromptAction=t.getActionSourceFromNewFileMenuType=t.getActionSourceFromSourceArgs=t.getActionSourceFromSurface=t.checkAndLogNpu=t.logLoggedOutUserAction=t.logUserAction=t.logClientEvent=t.logViewEvent=t.getStartTime=void 0,o=s.__importStar(o),c=s.__importStar(c);let f=void 0;t.getStartTime=()=>{try{f=f||window.performance.timing.fetchStart}catch(e){_.reportStack("Unable to get fetchStart from browser.",{severity:_.SEVERITY.NONCRITICAL}),f=o.start_time()}return f},t.logViewEvent=function(e,t,s){const r={file_views:[{file_info:{shared_link_details:{url:t}},platform_type:{".tag":s}}]};(new i.UserApiV2Client).ns("seen_state").rpc("log_file_view",r,{subjectUserId:e})},t.logClientEvent=function(e,s,i,n,l){const c=l||[];c.push({key:"time_on_page_with_redirect",value:o.time_since_start().toString()}),c.some(e=>"time_now"===e.key)||c.push({key:"time_now",value:Date.now().toString()}),(new r.NoAuthApiV2Client).ns("cloud_docs").rpc("log_client_event",{client:a.editorTypeToClient[s],doc_id:e,event_name:i,auth_token:n,time_on_page:p.WebTimingUtil.getNow()-t.getStartTime(),extras:c},{})},t.logUserAction=function(e){const t=(new i.UserApiV2Client).ns("cloud_docs");let s;e.hasOwnProperty("docPathOrId")&&e.docPathOrId&&(s={".tag":"path_or_id",path_or_id:e.docPathOrId});const r=e.data&&e.data.webOpenId,a=e.data&&e.data.origDest,o=e.data&&e.data.routingDest;t.rpc("log_user_action",{action:e.actionEvent,doc_id:s,source:e.actionSource,open_id:r,orig_dest:a,routing_dest:o,extra_info:e.extra},{subjectUserId:e.userId})},t.logLoggedOutUserAction=function(e){const t=(new r.NoAuthApiV2Client).ns("cloud_docs");let s;e.hasOwnProperty("docPathOrId")&&e.docPathOrId&&(s={".tag":"path_or_id",path_or_id:e.docPathOrId});const i=e.data&&e.data.webOpenId,a=e.data&&e.data.origDest,o=e.data&&e.data.routingDest;t.rpc("logged_out/log_user_action",{action:e.actionEvent,doc_id:s,source:e.actionSource,open_id:i,orig_dest:a,routing_dest:o,extra_info:e.extra},{})},t.checkAndLogNpu=function(e,t,s,r,a){(new i.UserApiV2Client).ns("cloud_docs").rpc("log_new_partner_users",{partner:t,cloud_doc_type:m.file_extension(s),cloud_editor:r,platform:a},{subjectUserId:e})},t.getActionSourceFromSurface=e=>"search"===e?a.UserActionSourceType.WEB_SEARCH:"previews"===e?a.UserActionSourceType.WEB_PREVIEW:"home_recent"===e||"home_starred"===e?a.UserActionSourceType.WEB_HOME:"browse"===e||"sidebar"===e?a.UserActionSourceType.WEB_BROWSE:a.UserActionSourceType.WEB,t.getActionSourceFromSourceArgs=e=>e.fileViewAction===d.FileViewActionType.SEARCH||e.fileViewOrigin===d.FileViewOriginType.SEARCH?a.UserActionSourceType.WEB_SEARCH:e.fileViewOrigin===d.FileViewOriginType.BROWSE?a.UserActionSourceType.WEB_BROWSE:e.fileViewOrigin===d.FileViewOriginType.HOME?a.UserActionSourceType.WEB_HOME:a.UserActionSourceType.WEB,t.getActionSourceFromNewFileMenuType=e=>{switch(e){case u.NewFileMenuFromType.BROWSE:return a.UserActionSourceType.WEB_BROWSE;case u.NewFileMenuFromType.HOME:return a.UserActionSourceType.WEB_HOME;default:return a.UserActionSourceType.WEB}},t.logFileOpenPromptAction=function(e,t,s,i,r){(new c.HiveLogger).log(new l.WebUserActionRow({user_id:e,event_name:n.WebUserActionLogEvent.FILE_OPEN_PROMPT_ACTION,extra:{file_type:t,integration_name:s,prompt_action:i,ask_again:r}}))},t.logFileConvertPromptAction=function(e,t,s,i){(new c.HiveLogger).log(new l.WebUserActionRow({user_id:e,event_name:n.WebUserActionLogEvent.FILE_CONVERT_PROMPT_ACTION,extra:{prompt_action:t,integration_name:s,file_extension:i}}))},t.logInterstitialLoginAction=function(e,t,s){(new c.HiveLogger).log(new l.WebUserActionRow({event_name:n.WebUserActionLogEvent.INTERSTITIAL_LOGIN_ACTION,extra:{prompt_action:e,logged_out_ux_google_variant:t,file_extension:s}}))},t.logLoggedOutUXSnackBarAction=function(e,t,s){(new c.HiveLogger).log(new l.WebUserActionRow({event_name:n.WebUserActionLogEvent.LOGGED_OUT_UX_SNACKBAR_ACTION,extra:{prompt_action:e,file_extension:t,logged_out_ux_google_variant:s||""}}))}})),define("metaserver/static/js/modules/clean/cloud_docs/open_with_utils",["require","exports","tslib","apex-metrics/index","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/clean/cloud_docs/constants","metaserver/static/js/modules/clean/cloud_docs/event_logging","metaserver/static/js/modules/clean/cloud_docs/types","metaserver/static/js/modules/clean/referrer_cleansing_redirect","metaserver/static/js/modules/clean/cloud_docs/constants","metaserver/static/js/modules/core/uri","metaserver/static/js/modules/clean/cloud_docs/utils","metaserver/static/js/modules/clean/open_with","spectrum/util/uuid_generator","metaserver/static/js/modules/core/browser_detection","metaserver/static/js/modules/clean/cloud_docs/create_api","metaserver/static/js/modules/clean/metrics/index"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h){"use strict";let g;function S(e){if(void 0!==e&&void 0!==e.error&&void 0!==e.error[".tag"])return e.error[".tag"]}function E(e){switch(S(e)){case"invalid_file_id":case"permission_denied":case"other":default:return}}function v(e,t,s,i,a,l,c){const u=_.generateUUID("web_open_id"),p=d.URI.parse(e.cloud_editor_url).updateQuery({cloud_editor:a,web_open_id:u});l&&p.updateQuery({ignore_lock:"1"});const m=p.toString();m&&(void 0===c&&(c=n.UserActionSourceType.WEB),o.logUserAction({actionEvent:n.UserActionEventType.PRE_OPEN,userId:i,docPathOrId:s,actionSource:c,data:{webOpenId:u}}),null!=t?r.redirect(m,t):r.open_tab(m))}var T;function b(e){return[".gdoc",".gsheet",".gslides"].indexOf(u.getFileExt(e))>=0}function I(e){return".web"===u.getFileExt(e)}function w(e,t){const s=u.getFileExt(e);for(const e of Object.keys(c.DSS_TYPE_TO_SUPPORTED_EXTS)){const t=e;if(c.DSS_TYPE_TO_SUPPORTED_EXTS[t].indexOf(s)>=0)return t}switch(s){case".gdoc":return c.GoogleFileTypes.GOOGLE_DSS_DOC;case".gsheet":return c.GoogleFileTypes.GOOGLE_DSS_SHEET;case".gslides":return c.GoogleFileTypes.GOOGLE_DSS_SLIDES}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.getGoogleEditorType=t.isCloudBasedDoc=t.isShortcut=t.isGoogleDoc=t.getOpenWithWopiEditorInfo=t.getOpenWithGoogleEditorInfo=t.getOpenWithCloudEditorInfo=t.OpenWithCloudDocProvider=t.openCloudDoc=t.openWithCloudEditor=t.fileToOpenWithParams=t.openCloudEditorUrl=t.isInEdgeIframe=t.handleError=t.decodeAPIError=t.getCloudEditorUrl=t.getCloudEditorUrlCached=void 0,l=s.__importStar(l),p=s.__importDefault(p),m=s.__importStar(m),t.getCloudEditorUrlCached=(e,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){return g||(g=t.getCloudEditorUrl(e,i)),g})),t.getCloudEditorUrl=(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){return(yield(function(){return s.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/api_v2/user_client"],t,s)}).then(s.__importStar);return(new t).ns("cloud_docs")}))})()).rpc("get_cloud_editor_url",{file_id:i},{subjectUserId:t})})),t.decodeAPIError=S,t.handleError=E,t.isInEdgeIframe=()=>{let e=!1;if(m.edge||m.msie||m.edgeChromium())try{e=window.self!==window.top}catch(t){e=!0}return e},t.openCloudEditorUrl=v,t.fileToOpenWithParams=e=>({fileId:e.file_id,openToUrl:e.open_to_url}),t.openWithCloudEditor=({fileId:e,openToUrl:r},o,n,l,c)=>s.__awaiter(void 0,void 0,void 0,(function*(){try{const s=performance.now(),d=h.getMetricsReporter(),u={};try{u.editor=n,c&&(u.source=c[".tag"]);const p=t.isInEdgeIframe();if(u.isInEdgeIframe=String(p),r&&r.startsWith("https://www.dropbox.com/scl/fi/")){u.usedOpenToURLFromFile="true",v({cloud_editor_url:r},null,e,o,n,l,c)}else{u.usedOpenToURLFromFile="false";const s=p?null:f.createPlaceholderTabForNewCloudDoc();v(p?yield t.getCloudEditorUrlCached(o,e):yield t.getCloudEditorUrl(o,e),s,e,o,n,l,c)}u.error="false"}catch(e){u.error="true",E(e)}finally{d.createStats({ns:a.CLOUD_DOCS_AMP_NAMESPACE,name:"web/openWithCloudEditor"},u).recordDuration(performance.now()-s,i.TimeUnit.MILLISECONDS)}}catch(e){E(e)}})),t.openCloudDoc=(t,i,c)=>{if(c||(c=n.UserActionSourceType.WEB),t.href)if(a.isPointerByExtension(t.ns_path))l.safe_open_tab_and_redirect(t.href),o.logUserAction({actionEvent:n.UserActionEventType.PRE_OPEN,userId:i.id,docPathOrId:t.file_id,actionSource:c});else{const e=_.generateUUID("web_open_id"),s=d.URI.parse(t.href).updateQuery("web_open_id",e).toString();r.open_tab(s),o.logUserAction({actionEvent:n.UserActionEventType.PRE_OPEN,userId:i.id,docPathOrId:t.file_id,actionSource:c,data:{webOpenId:e}})}else{const r=f.createPlaceholderTabForNewCloudDoc();new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/previews/data/actions"],t,s)}).then(s.__importStar).then(e=>e.fetchPreviewUrl(t,i)).then(e=>{e&&null!==r&&l.redirect(e,r,!0)})}},(function(e){e.OfficeOnline="OfficeOnline",e.GoogleDSS="GoogleDSS"})(T=t.OpenWithCloudDocProvider||(t.OpenWithCloudDocProvider={})),t.getOpenWithCloudEditorInfo=(e,s,i,r)=>{const a=[],o=t.getOpenWithWopiEditorInfo(e,s,r);o&&i.wopi&&a.push(o);const n=t.getOpenWithGoogleEditorInfo(e,s,r);return n&&i.gdd&&a.push(n),a},t.getOpenWithGoogleEditorInfo=(e,s,i)=>{const r=w(e,s);return r?{text:c.DSS_TYPE_TO_TEXT[r],iconUrl:c.DSS_TYPE_TO_OPEN_WITH_ICONS[r],handler:()=>t.openWithCloudEditor(t.fileToOpenWithParams(e),s.id,r,!1,i),provider:T.GoogleDSS}:null},t.getOpenWithWopiEditorInfo=(e,s,i)=>{const r=p.default.getWopiOpenWithButtonInfo(e);return r?{text:r.name,spriteName:r.icon,handler:()=>t.openWithCloudEditor(t.fileToOpenWithParams(e),s.id,r.editor,!1,i),provider:T.OfficeOnline}:null},t.isGoogleDoc=b,t.isShortcut=I,t.isCloudBasedDoc=function(e){return!!b(e)||!!I(e)},t.getGoogleEditorType=w})),define("metaserver/static/js/modules/clean/cloud_docs/pointers_common",["require","exports","tslib","ts-key-enum","react","dig-components/text_fields"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CreatePointerFields=void 0,r=s.__importStar(r);class o extends r.Component{constructor(){super(...arguments),this.handleKeyPress=e=>{e.key===i.Key.Enter&&o.canSubmit({name:this.props.name,url:this.props.url})&&this.props.onSubmit()},this.handleNameChange=e=>{const t=e.target.value;this.props.onChange({name:t,url:this.props.url})},this.handleUrlChange=e=>{const t=e.target.value;this.props.onChange({name:this.props.name,url:t})},this.setNameFieldRef=e=>{this.nameRef=e}}render(){const e=""===this.props.url||o.isUrlValid(this.props.url);let t="";return e||(t=this.props.urlValidationMessage),r.createElement("div",{className:"create-pointer--fields"},r.createElement("div",{className:"create-pointer--fieldset"},r.createElement("label",{htmlFor:"create-pointer--link_input"},this.props.urlLabel),r.createElement("div",{className:"create-pointer--fieldset-with-icon"},this.props.urlIcon,r.createElement(a.TextInput,{id:"create-pointer--link_input",className:"create-pointer--link_input",isInvalid:!e,onChange:this.handleUrlChange,onKeyPress:this.handleKeyPress,value:this.props.url,autoFocus:!0}))),r.createElement("div",{className:"create-pointer--url-validation-warning"},t),r.createElement("div",{className:"create-pointer--fieldset"},r.createElement("label",{htmlFor:"create-pointer--name_input"},this.props.nameLabel),r.createElement(a.TextInput,{id:"create-pointer--name_input",onChange:this.handleNameChange,onKeyPress:this.handleKeyPress,ref:this.setNameFieldRef})))}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.props.urlPrepopulateFunction){const e=yield this.props.urlPrepopulateFunction();e&&(this.props.onChange({name:this.props.name,url:e}),this.nameRef.focus())}}))}}t.CreatePointerFields=o,o.isUrlValid=e=>/^((http|https):\/\/)?([^.:/\\?#@!]+?\.)+[^.:/\\?#@!]+/i.test(e.trim()),o.canSubmit=e=>""!==e.name&&""!==e.url&&o.isUrlValid(e.url),o.displayName="CreatePointerFields"})),define("metaserver/static/js/modules/clean/cloud_docs/preferred_editor_utils",["require","exports","tslib","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/clean/cloud_docs/event_logging","metaserver/static/js/modules/clean/cloud_docs/utils","metaserver/static/js/modules/clean/cloud_docs/types","react","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/cloud_docs/open_with_utils","metaserver/static/js/modules/core/uri","metaserver/static/js/modules/clean/cloud_docs/cloud_doc_api_client","spectrum/util/uuid_generator","metaserver/static/js/modules/clean/cloud_docs/preferred_editor_constants","metaserver/static/js/modules/clean/cloud_docs/create_api"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPreferredEditorPrompt=t.openInPreferredEditor=t.hasPreferredEditorSupport=void 0,c=s.__importDefault(c),t.hasPreferredEditorSupport=function(e){const t=n.getFileExt(e);return f.PREFERRED_EDITOR_SUPPORTED_EXTS.indexOf(t)>=0},t.openInPreferredEditor=function(e,t,s,i,c){const d=n.getFileExt(t),g=s[e.id];let S="";if(g)try{const s=g[f.EXTENSION_TO_DOC_TYPE[d]],n=s===f.PreferredEditorTypes.GoogleDSS||s===f.PreferredEditorTypes.OfficeOnline,E=m.generateUUID("web_open_id");if(t.is_in_vault_folder)return n&&o.logUserAction({actionEvent:l.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:t.file_id,actionSource:o.getActionSourceFromSourceArgs(c),data:{webOpenId:E},extra:{block_vault_content:"true"}}),void i();if(n){const s=h.createPlaceholderTabForNewCloudDoc();u.getCloudEditorUrl(e.id,t.file_id).then(r=>{S=p.URI.parse(r.cloud_editor_url).updateQuery("web_open_id",E).toString(),s?s.location.replace(S):i(),o.logUserAction({actionEvent:l.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:t.file_id,actionSource:o.getActionSourceFromSourceArgs(c),data:{webOpenId:E}})}).catch(e=>{a.reportStack("Error getting cloud editor url from preferred editor open.",{severity:a.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:S,file_ext:d,preferred_editor_configs:g,error:e.message}}),s&&s.close(),i()})}else _.getPreferredUrl(e.id,t.file_id,d).then(s=>{s.preferred_editor_url&&(S=p.URI.parse(s.preferred_editor_url).updateQuery("web_open_id",E).toString(),o.logUserAction({actionEvent:l.UserActionEventType.PRE_OPEN,userId:e.id,docPathOrId:t.file_id,actionSource:o.getActionSourceFromSourceArgs(c),data:{webOpenId:E}}),r.redirect(S))}).catch(e=>{a.reportStack("Error getting preferred editor url from preferred editor open.",{severity:a.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:S,file_ext:d,preferred_editor_configs:g,error:e.message}})}),i()}catch(e){a.reportStack("Error opening docs in preferred editor.",{severity:a.SEVERITY.CRITICAL,exc_extra:{preferred_editor_url:S,file_ext:d,preferred_editor_configs:g,error:e.message}}),i()}else i()},t.getPreferredEditorPrompt=function(e,t){const s="."+d.file_extension(e),r=f.EXTENSION_TO_DOC_TYPE[s],a=f.INTEGRATION_NAME_TO_PROMPT[t][r];return a?{title:i.intl.formatMessage({id:"jXF9I9",defaultMessage:"Would you like to open <b>{file_extension}</b> files with {web_editor_name} by default?"},{file_extension:s,web_editor_name:a,b:e=>c.default.createElement("b",null,e)}),body:i.intl.formatMessage({id:"f37GH8",defaultMessage:"{web_editor_name} will automatically be used to open your <b>{file_extension}</b> files in Dropbox. You can always update this later in your Dropbox settings."},{file_extension:s,web_editor_name:a,b:e=>c.default.createElement("b",null,e)})}:null}})),define("metaserver/static/js/modules/clean/cloud_docs/preferred_editor_constants",["require","exports","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/cloud_docs/types"],(function(e,t,s,i){"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.IntegrationNameToPreferredEditorEnums=t.INTEGRATION_NAME_TO_PROMPT=t.PREFERRED_EDITOR_SUPPORTED_EXTS=t.EXTENSION_TO_DOC_TYPE=t.PreferredEditorOptionsMap=t.PreferredEditorDocTypes=t.PreferredEditorTypes=void 0,(function(e){e[e.Unknown=0]="Unknown",e[e.FileViewer=1]="FileViewer",e[e.OfficeOnline=2]="OfficeOnline",e[e.GoogleDSS=3]="GoogleDSS"})(r=t.PreferredEditorTypes||(t.PreferredEditorTypes={})),(function(e){e.WORD="ms_word",e.EXCEL="ms_excel",e.POWERPOINT="ms_powerpoint"})(a=t.PreferredEditorDocTypes||(t.PreferredEditorDocTypes={})),t.PreferredEditorOptionsMap={[a.WORD]:{1:s.intl.formatMessage({id:"5+Wabe",defaultMessage:"View in dropbox.com"}),2:s.intl.formatMessage({id:"Y9FcUQ",defaultMessage:"Word for the web"}),3:s.intl.formatMessage({id:"+HsOFj",defaultMessage:"Google Docs"})},[a.EXCEL]:{1:s.intl.formatMessage({id:"5+Wabe",defaultMessage:"View in dropbox.com"}),2:s.intl.formatMessage({id:"o3mRdr",defaultMessage:"Excel for the web"}),3:s.intl.formatMessage({id:"cpuRML",defaultMessage:"Google Sheets"})},[a.POWERPOINT]:{1:s.intl.formatMessage({id:"5+Wabe",defaultMessage:"View in dropbox.com"}),2:s.intl.formatMessage({id:"RTj2SO",defaultMessage:"PowerPoint for the web"}),3:s.intl.formatMessage({id:"PcJCVL",defaultMessage:"Google Slides"})}},t.EXTENSION_TO_DOC_TYPE={".docx":a.WORD,".doc":a.WORD,".xlsx":a.EXCEL,".xls":a.EXCEL,".pptx":a.POWERPOINT,".ppt":a.POWERPOINT},t.PREFERRED_EDITOR_SUPPORTED_EXTS=Object.keys(t.EXTENSION_TO_DOC_TYPE),t.INTEGRATION_NAME_TO_PROMPT={[i.IntegrationName.GOOGLE_DSS]:{[a.WORD]:s.intl.formatMessage({id:"+HsOFj",defaultMessage:"Google Docs"}),[a.EXCEL]:s.intl.formatMessage({id:"cpuRML",defaultMessage:"Google Sheets"}),[a.POWERPOINT]:s.intl.formatMessage({id:"PcJCVL",defaultMessage:"Google Slides"})},[i.IntegrationName.OFFICE_ONLINE]:{[a.WORD]:s.intl.formatMessage({id:"Y9FcUQ",defaultMessage:"Word for the web"}),[a.EXCEL]:s.intl.formatMessage({id:"o3mRdr",defaultMessage:"Excel for the web"}),[a.POWERPOINT]:s.intl.formatMessage({id:"RTj2SO",defaultMessage:"PowerPoint for the web"})},[i.IntegrationName.PAPER_INTEGRATION]:{}},t.IntegrationNameToPreferredEditorEnums={[i.IntegrationName.GOOGLE_DSS]:r.GoogleDSS,[i.IntegrationName.OFFICE_ONLINE]:r.OfficeOnline,[i.IntegrationName.PAPER_INTEGRATION]:r.Unknown}})),define("metaserver/static/js/modules/clean/cloud_docs/utils",["require","exports","metaserver/static/js/modules/clean/filepath/filepath","spectrum-sharing/utils/sharing_constants","metaserver/static/js/modules/clean/cloud_docs/types"],(function(e,t,s,i,r){"use strict";function a(e){return e.replace(/[/?<>:*\\]/g,"_")}Object.defineProperty(t,"__esModule",{value:!0}),t.replaceInvalidURLFilenameChars=t.replaceInvalidFilenameChars=t.integrationNameToShareActionOrigin=t.getFileExt=void 0,t.getFileExt=function(e){let t="";return e.hasOwnProperty("ext")?t=e.ext:e.hasOwnProperty("filename")?(t=s.file_extension(e.filename),t&&(t="."+t)):(t=s.file_extension(e),t&&(t="."+t)),t},t.integrationNameToShareActionOrigin=function(e){switch(e){case r.IntegrationName.GOOGLE_DSS:return i.SHARE_ACTION_ORIGIN_TYPE.GOOGLE_DSS;case r.IntegrationName.PAPER_INTEGRATION:return i.SHARE_ACTION_ORIGIN_TYPE.PAPER_INTEGRATION;case r.IntegrationName.OFFICE_ONLINE:return i.SHARE_ACTION_ORIGIN_TYPE.OFFICE_INTEGRATION;default:throw"No mapping for integration to share action origin: "+e}},t.replaceInvalidFilenameChars=a,t.replaceInvalidURLFilenameChars=function(e){return a(e).replace(/\ /g,"-")}})),define("metaserver/static/js/modules/clean/file_actions/create-folder",["require","exports","tslib","metaserver/static/js/modules/clean/file_actions/metrics","metaserver/static/js/modules/clean/file_actions/strings","metaserver/static/js/modules/clean/metrics/index","metaserver/static/js/modules/clean/react/async_file_modal_controller","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/files_view/file_actions/api_v2","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/user_survey/user_survey","metaserver/static/js/modules/clean/react/growth/rich_snackbar_actions/create_folder_actions","metaserver/static/js/modules/clean/react/browse/data/store","metaserver/static/js/modules/clean/react/browse/data/selectors"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f){"use strict";function h(e,t,s){n.logWebUserAction({event_name:d.WebUserActionLogEvent.CREATE_FOLDER_ERROR,extra:{error_summary:e||null,error:t||null,origin:s||null}})}function g(e){n.logWebUserAction({event_name:d.WebUserActionLogEvent.CREATE_FOLDER_CANCEL,extra:{origin:e||null}})}function S(e){n.logWebUserAction({event_name:d.WebUserActionLogEvent.CREATE_FOLDER_PENDING,extra:{origin:e||null}})}function E(e){n.logWebUserAction({event_name:d.WebUserActionLogEvent.CREATE_FOLDER_SUCCESS,extra:{origin:e||null}}),p.UserSurvey.trackEvent("create_item","browse")}Object.defineProperty(t,"__esModule",{value:!0}),t.logCreateFolderSuccess=t.logCreateFolderPending=t.logCreateFolderCancel=t.logCreateFolderError=t.logCreateFolder=t.createFolder=void 0,o=s.__importStar(o),l=s.__importStar(l),f=s.__importStar(f),t.createFolder=({user:e,name:n,destination:d,checkFsw:p,origin:v,surface:T})=>s.__awaiter(void 0,void 0,void 0,(function*(){const b=a.getMetricsReporter(),I={surface:T},w={latency:b.createTimer({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"create-folder/latency_ms"},I),completed:b.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"create-folder/completed"},I)};S(v),c.Snackbar.sync(u.intl.formatMessage(r.createFolderSnackbarProgress),!1,"browse-action");const C=yield l.createFolder(d,n,e,p);if(C.isError&&"path"===C.error[".tag"]&&"file_system_warnings"===C.error.path[".tag"]){return c.Snackbar.close("browse-action"),(yield(function(e){return s.__awaiter(this,void 0,void 0,(function*(){return new Promise(t=>{o.showFileSystemWarningsModal({fsws:e,onFinalAccept:()=>{t(!0)},onAbortAction:()=>{t(!1)},confirmText:u.intl.formatMessage(r.createFolderFswConfirmText)})})}))})(C.error.path.details))?yield t.createFolder({user:e,name:n,destination:d,checkFsw:!1,origin:v,surface:T}):(g(v),{type:"cancel"})}if(w.latency.record(),C.isError)return"path"===C.error[".tag"]&&"malformed_path"===C.error.path[".tag"]?(c.Snackbar.fail(u.intl.formatMessage(r.createFolderErrorMalformedPath),"browse-action"),w.completed.record(1)):(c.Snackbar.fail(u.intl.formatMessage(r.createFolderErrorGeneric),"browse-action"),w.completed.record(0)),h(C.error_summary,C.error[".tag"],v),{type:"error",summary:C.error_summary,error:C.error[".tag"]};const O=m.getStoreForBrowse().getState(),F=f.getUsersJtbdInterestInfo(O),R=void 0!==C.result.metadata.path_lower?C.result.metadata.path_lower:"",A={richSnackbarProps:_.getRichSnackbarPropsForCreateFolder(e.home_ns_id,R,{expFullFunnelSnackbar:F})},y=void 0!==A.richSnackbarProps;return c.Snackbar.complete(u.intl.formatMessage(r.createFolderSnackbarSuccess),"browse-action",void 0,A,y),E(v),w.completed.record(1),{type:"success",folder:C.result.metadata}})),t.logCreateFolder=function({uid:e,view_type:t,origin:s,source:i}){n.logWebUserAction({user_id:e,event_name:d.WebUserActionLogEvent.CREATE_FOLDER,view_type:t||null,extra:Object.assign({origin:s},i&&{source:i})})},t.logCreateFolderError=h,t.logCreateFolderCancel=g,t.logCreateFolderPending=S,t.logCreateFolderSuccess=E})),define("metaserver/static/js/modules/clean/file_actions/metrics",["require","exports","metaserver/static/js/modules/clean/metrics/index"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recordPathLookupErrors=t.batchContentType=t.bucketForBatchSize=t.FILE_ACTIONS_AMP_NAMESPACE=void 0,t.FILE_ACTIONS_AMP_NAMESPACE="web_file_actions",t.bucketForBatchSize=function(e){return 1===e?"single":e<=10?"small":e<=100?"medium":e<=1e3?"large":"massive"},t.batchContentType=function(e){return e.every(e=>e.is_dir)?"folders":e.every(e=>!e.is_dir)?"files":"mixed"};t.recordPathLookupErrors=function(e,i,r){const a={};e.forEach(e=>{if("path_lookup"===e.failure[".tag"]){const t=e.failure.path_lookup[".tag"];a[t]=(a[t]||0)+1}});for(const e in a)a.hasOwnProperty(e)&&s.getMetricsReporter().createStats({ns:t.FILE_ACTIONS_AMP_NAMESPACE,name:"common/failure/path_lookup"},Object.assign(Object.assign({},r),{lookupFailureType:e,operation:i})).record(a[e])}})),define("metaserver/static/js/modules/clean/file_actions/strings",["require","exports","react-intl"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unstarSnackbarError=t.starSnackbarError=t.unstarSnackbarSuccess=t.starSnackbarSuccess=t.createFolderSnackbarSuccess=t.createFolderFswConfirmText=t.createFolderErrorGeneric=t.createFolderErrorMalformedPath=t.createFolderSnackbarProgress=t.renameSnackbarSuccessMessage=t.renameUndoSnackbarSuccessMessage=t.renameUndoSnackbarErrorMessage=t.renameUndoSnackbarProgressMessage=t.renameFswConfirmText=t.renameSnackbarProgressMessage=t.renameErrorInvalidName=t.deleteUndoSnackbarMessage=t.deleteFswConfirmText=t.deleteSnackbarProgressMessage=void 0,t.deleteSnackbarProgressMessage=s.defineMessage({id:"z7/sbf",defaultMessage:"{count, plural, one{Deleting {count} item...} other{Deleting {count} items...}}"}),t.deleteFswConfirmText=s.defineMessage({id:"da2lvf",defaultMessage:"Delete"}),t.deleteUndoSnackbarMessage=s.defineMessage({id:"hCpZct",defaultMessage:"Delete undone."}),t.renameErrorInvalidName=s.defineMessage({id:"KYHY0Z",defaultMessage:"Name was invalid."}),t.renameSnackbarProgressMessage=s.defineMessage({id:"8j6sBp",defaultMessage:"Renaming"}),t.renameFswConfirmText=s.defineMessage({id:"NYv8Vp",defaultMessage:"Rename"}),t.renameUndoSnackbarProgressMessage=s.defineMessage({id:"deJ8cD",defaultMessage:"Undoing rename..."}),t.renameUndoSnackbarErrorMessage=s.defineMessage({id:"n4o67d",defaultMessage:"Undo failed."}),t.renameUndoSnackbarSuccessMessage=s.defineMessage({id:"6RXx/7",defaultMessage:"Rename undone."}),t.renameSnackbarSuccessMessage=s.defineMessage({id:"NqCfwG",defaultMessage:"Renamed 1 item."}),t.createFolderSnackbarProgress=s.defineMessage({id:"U3y3i9",defaultMessage:"Creating folder..."}),t.createFolderErrorMalformedPath=s.defineMessage({id:"HOb8Zp",defaultMessage:'The following characters are not allowed: angle brackets \\ / : ? * " |'}),t.createFolderErrorGeneric=s.defineMessage({id:"qZTFM0",defaultMessage:"Can’t create folder."}),t.createFolderFswConfirmText=s.defineMessage({id:"VDjS9+",defaultMessage:"Create folder"}),t.createFolderSnackbarSuccess=s.defineMessage({id:"1zC4ih",defaultMessage:"Folder created."}),t.starSnackbarSuccess=s.defineMessage({id:"m96IvY",defaultMessage:"Starred {itemName}."}),t.unstarSnackbarSuccess=s.defineMessage({id:"Yn2gx1",defaultMessage:"Unstarred {itemName}."}),t.starSnackbarError=s.defineMessage({id:"LdcLnn",defaultMessage:"There was a problem starring {itemName}"}),t.unstarSnackbarError=s.defineMessage({id:"t8Eqso",defaultMessage:"There was a problem unstarring {itemName}"})})),define("metaserver/static/js/modules/clean/file_operations/notifications",["require","exports","tslib","lodash","metaserver/static/js/modules/clean/browse_interface","metaserver/static/js/modules/clean/em_string","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/clean/undo","metaserver/static/js/modules/core/html","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify"],(function(e,t,s,i,r,a,o,n,l,c,d,u){"use strict";function p(e,t,s,i){l.notifyWithUndo(e,s,()=>n.rollbackChangeSets({changesets:s,userId:t.id,progressText:d.intl.formatMessage({id:"wKzr7W",defaultMessage:"Undoing…"}),onSuccess:()=>{u.Notify.success(d.intl.formatMessage({id:"t6mPeQ",defaultMessage:"Undo complete."})),i&&i()}}))}function _(e,t){const s=r.browse_uri_for_fq_path(t,e),n=a.Emstring.em_snippet(o.filename(e),40);return{href:s,text:i.escape(n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.notifyRestoreSuccess=t.notifyPurgeSuccess=t.notifyFolderCreationSuccess=t.notifyRenameSuccess=t.notifyDeleteSuccess=t.notifyMoveSuccess=t.notifyCopySuccess=void 0,i=s.__importStar(i),r=s.__importStar(r),o=s.__importStar(o),n=s.__importStar(n),l=s.__importStar(l),t.notifyCopySuccess=function(e,t,s,i,r){let a;if(i){const s=_(i,t);a=d.intl.formatMessage({id:"UZ+XVI",defaultMessage:"{count, plural, one{Copied {count} item to {dest}.} other{Copied {count} items to {dest}.}}"},{count:e,dest:`<a href="${s.href.toString()}">${s.text}</a>`}),a=new c.HTML(a)}else a=d.intl.formatMessage({id:"BDtFp+",defaultMessage:"{count, plural, one{Copied {count} item.} other{Copied {count} items.}}"},{count:e});p(a,t,s,r)},t.notifyMoveSuccess=function(e,t,s,i,r){let a;if(i){const s=_(i,t);a=d.intl.formatMessage({id:"GBu2Ic",defaultMessage:"{count, plural, one{Moved {count} item to {dest}.} other{Moved {count} items to {dest}.}}"},{count:e,dest:`<a href="${s.href.toString()}">${s.text}</a>`}),a=new c.HTML(a)}else a=d.intl.formatMessage({id:"tFGyx0",defaultMessage:"{count, plural, one{Moved {count} item.} other{Moved {count} items.}}"},{count:e});p(a,t,s,r)},t.notifyDeleteSuccess=function(e,t,s,i){p(d.intl.formatMessage({id:"THAbub",defaultMessage:"{count, plural, one{Deleted {count} item.} other{Deleted {count} items.}}"},{count:e}),t,s,i)},t.notifyRenameSuccess=function(e,t,s){p(d.intl.formatMessage({id:"sAZa2U",defaultMessage:"Rename complete."}),e,t,s)},t.notifyFolderCreationSuccess=function(e,t,s){p(d.intl.formatMessage({id:"ndMNx/",defaultMessage:"Created folder {folder_name}."},{folder_name:e}),t,s)},t.notifyPurgeSuccess=function(e){const t=d.intl.formatMessage({id:"jh+GyF",defaultMessage:"{count, plural, one{Permanently deleted {count} item.} other{Permanently deleted {count} items.}}"},{count:e});u.Notify.success(t)},t.notifyRestoreSuccess=function(e){let t;const s=e.length;if(1===s){const s=i.escape(o.filename(e[0].fq_path));t=d.intl.formatMessage({id:"TAukDw",defaultMessage:"Restored <strong>{filename}</strong>."},{strong:e=>`<strong>${e}</strong>`,filename:s}),t=new c.HTML(t)}else t=d.intl.formatMessage({id:"8N7KT8",defaultMessage:"{count, plural, one{Restored {count} file.} other{Restored {count} files.}}"},{count:s});u.Notify.success(t,30)}})),define("metaserver/static/js/modules/clean/growth/smb_funnel/smb_funnel_logger",["require","exports","metaserver/static/js/modules/clean/metrics/index","metaserver/static/js/modules/core/exception","apex-metrics/index"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SMBFunnelLogger=t.SMBFunnelLoggerSingleton=t.Platform=void 0,(function(e){e.WEB="web",e.DESKTOP_SSCV="desktop_sscv",e.MOBILE_WEB="mobile_web"})(t.Platform||(t.Platform={}));const a=["platform","variant","isJoiner"],o=e=>{const t={};return Object.keys(e).forEach(s=>{a.indexOf(s)>=0&&(t[s]=e[s])}),t};class n{constructor(e={}){this.setCommonTags=e=>{const t=o(e);Object.keys(t).forEach(t=>{this.commonTags[t]&&this.commonTags[t]!==e[t]&&i.reportStack(`Attempting to change ${t} after it was already set`,{severity:i.SEVERITY.NONCRITICAL,tags:["activation-targeted","smb-funnel"]})}),this.commonTags=t},this.log=(e,t={})=>{const s=Object.assign(Object.assign({},this.commonTags),t),i=this.metricsReporter.createCounter({ns:"smb_funnel",name:e},s);i.increment(),i.record()},this.logDuration=(e,t,s={})=>{const i=Object.assign(Object.assign({},this.commonTags),s);this.metricsReporter.createStats({ns:"smb_funnel",name:e},i).recordDuration(t,r.TimeUnit.MILLISECONDS)},this.commonTags=o(e),this.metricsReporter=s.getMetricsReporter()}}t.SMBFunnelLoggerSingleton=n,t.SMBFunnelLogger=new n})),define("metaserver/static/js/modules/clean/react/admin/teams/onboarding/web/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContUrl=t.FlowId=t.AMPMetrics=t.Platform=t.BackgroundColors=t.StepStatus=t.Steps=t.MODULE_NAME=t.FRAMEWORK=void 0,t.FRAMEWORK="team_setup_essential",t.MODULE_NAME="smooth_transitions",(function(e){e.VERIFICATION="verification",e.RIGHTSIZING="rightsizing",e.TEAM_INFO="team_info",e.MOVE_FOLDERS="move_folders",e.CONFIRM_FOLDERS="confirm_folders",e.RESULTS_FOLDERS="results_folders",e.INVITE_MEMBERS="invite_members",e.SUGGESTED_INVITE_MEMBERS="suggested_invite_members",e.INVITE_MOBILE="invite_mobile",e.INSTALL="install",e.INSTALL_MOBILE="install_mobile",e.ROLE="role",e.COLLABORATION="collaboration",e.LOADING_SCREEN="loading_screen",e.PAIR="team_install_page_pair",e.OPEN="team_install_page_open",e.DOWNLOAD="team_install_page_download",e.DOWNLOAD_COMPLETE="download_complete",e.MOBILE_INSTALL="mobile_install",e.DOCSEND_ONBOARD="docsend_onboard",e.JOIN_ACCEPT="join_accept",e.JOIN_LOGIN="join_login",e.JOIN_MOVE_FILES="join_move_files",e.JOIN_PRIVACY_QUESTION="privacy_question",e.JOIN_TWO_ACCOUNT_SUGGESTION="two_account_suggestion",e.JOIN_ONE_ACCOUNT_SUGGESTION="one_account_suggestion",e.JOIN_CREATE_NEW_PERSONAL="create_new_personal",e.JOIN_PERSONAL_VERIFICATION="personal_verification",e.HELP_US_HELP_YOU="help_us_help_you"})(t.Steps||(t.Steps={})),(function(e){e.Inactive="inactive",e.Active="active",e.Completed="completed"})(t.StepStatus||(t.StepStatus={})),(function(e){e.CELADON="celadon",e.CLOUD="cloud",e.NAVY="navy",e.ORCHID="orchid",e.SAPPHIRE="sapphire",e.SAND="sand",e.VANILLA="vanilla",e.WHITE="white"})(t.BackgroundColors||(t.BackgroundColors={})),(function(e){e.DESKTOP_WEB="desktop_web",e.DESKTOP_SSCV="desktop_sscv",e.MOBILE_WEB="mobile_web"})(t.Platform||(t.Platform={})),(function(e){e.SETUP_START="setup/start",e.SETUP_FINISH="setup/finish",e.SETUP_STEP_START="setup/step/start",e.SETUP_STEP_FINISH="setup/step/finish",e.SETUP_STEP_ERROR="setup/step/error",e.SETUP_STEP_INTERRUPT="setup/step/interrupt",e.SETUP_STEP_CTA="setup/step/cta",e.SETUP_STEP_FETCH="setup/step/fetch",e.ACTIVATION_IMM_VIEW="activation/imm/view",e.ACTIVATION_IMM_ADD_MEMBERS="activation/imm/add_members",e.ACTIVATION_DESKTOP_ICON_OPEN="activation/desktop_icon/open",e.ACTIVATION_EMPTY_STATE_VIEW="activation/empty_state/view",e.ACTIVATION_EMPTY_STATE_CLICK_UPLOAD_CTA="activation/empty_state/click_browse_upload_cta",e.ACTIVATION_SUGGESTED_FOLDER_CREATE="activation/suggested_folder/create",e.ACTIVATION_SUGGESTED_FOLDER_DISMISS="activation/suggested_folder/dismiss",e.ACTIVATION_SUGGESTED_FOLDER_TOGGLE="activation/suggested_folder/toggle",e.ACTIVATION_QUICK_ACTIONS_PANEL_VIEW="activation/quick_actions_panel/view",e.ACTIVATION_QUICK_ACTION_CREATE_CF="activation/quick_action/create_cf",e.ACTIVATION_QUICK_ACTION_REDIRECT="activation/quick_action/redirect",e.ACTIVATION_QUICK_ACTION_SEE_SF="activation/quick_action/see_sf",e.ACTIVATION_QUICK_ACTION_DISMISS="activation/quick_action/dismiss",e.ACTIVATION_COLLECTION_FOLDER_VIEW="activation/collection_folder/view",e.ACTIVATION_COLLECTIONS_ACTION_REDIRECT="activation/collections_action/redirect",e.ACTIVATION_COLLECTIONS_ACTION_UPLOAD="activation/collections_action/upload",e.ACTIVATION_COLLECTIONS_ACTION_CREATE="activation/collections_action/create",e.ACTIVATION_COLLECTIONS_ACTION_PAPER="activation/collections_action/paper",e.ACTIVATION_COLLECTIONS_ACTION_OPEN_DESKTOP="activation/collections_action/open_desktop",e.ACTIVATION_COLLECTIONS_ACTION_OPEN_SETTINGS="activation/collections_action/open_settings",e.ACTIVATION_INVITE_LINK_CREATE="activation/invite_link/create",e.ACTIVATION_MOBILE_LINK_SEND="activation/mobile_link/send",e.ACTIVATION_DESKTOP_LINK_DISMISS="activation/desktop_link/dismiss",e.ACTIVATION_DESKTOP_LINK_INIT="activation/desktop_link/init",e.ACTIVATION_DESKTOP_LINK_SEND="activation/desktop_link/send",e.ACTIVATION_SUGGESTED_ITEMS_TO_MOVE_START_MOVE="activation/suggested_items_to_move/start_move",e.ACTIVATION_SUGGESTED_ITEMS_TO_MOVE_END_MOVE="activation/suggested_items_to_move/end_move"})(t.AMPMetrics||(t.AMPMetrics={})),(function(e){e[e.ESSENTIAL_SETUP=1]="ESSENTIAL_SETUP",e[e.TEAM_JOINER_FLOW=9]="TEAM_JOINER_FLOW",e[e.HELP_US_HELP_YOU=11]="HELP_US_HELP_YOU"})(t.FlowId||(t.FlowId={})),(function(e){e.DEFAULT="",e.WORK="/work",e.ESSENTIAL_SETUP="/team/setup/essential",e.ESSENTIAL_JOIN="/team/join/essential"})(t.ContUrl||(t.ContUrl={}))})),define("metaserver/static/js/modules/clean/react/growth/rich_snackbar_actions/create_folder_actions",["require","exports","dig-components/icons/src","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/clean/react/onboarding/logging/logging","metaserver/static/js/modules/clean/react/onboarding/logging/events","metaserver/static/js/modules/clean/react/growth/personalization/util"],(function(e,t,s,i,r,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRichSnackbarPropsForCreateFolder=void 0;const l={REQUEST_FILES:{name:"request_files",icon:s.FileRequestLine,onClick:e=>{const{ns_id:t,ns_path:s}=e;a.OALogger.logToTeamsWeb(o.FullFunnelOptimizationForVideoEvents.CLICK_REQUEST_FILES),r.redirect(`/requests?ns_id=${t}&path=${s}`)},text:i.intl.formatMessage({id:"JsXSfu",defaultMessage:"Request files"})}};t.getRichSnackbarPropsForCreateFolder=function(e,t,s){var r;let c;const d={userId:0,filePath:"",ns_id:e,ns_path:t};return n.shouldEnableFullFunnelVideoSnackbar(null==s?void 0:s.expFullFunnelSnackbar)&&(c={actions:[l.REQUEST_FILES],helperText:i.intl.formatMessage({id:"EU51uM",defaultMessage:"Share and send a request for video or other files."}),clickHandlerArgs:d,onCloseClick:()=>{a.OALogger.logToTeamsWeb(o.FullFunnelOptimizationForVideoEvents.DISMISS_SNACKBAR,{action:"request_files"})}}),n.shouldLogFullFunnelVideoSnackbarExposure(null==s?void 0:s.expFullFunnelSnackbar)&&a.OALogger.logToTeamsWeb(o.FullFunnelOptimizationForVideoEvents.EXPOSURE,{variant:null===(r=null==s?void 0:s.expFullFunnelSnackbar)||void 0===r?void 0:r.full_funnel_video_optimization_variant,exposure:"new_folder"}),c}})),define("metaserver/static/js/modules/clean/react/folder_overview/api",["require","exports","metaserver/static/js/api_v2/types","metaserver/static/js/api_v2/user_client"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAccount=t.isFormatVersionError=t.isConflictError=t.getLoggingFileId=t.getSharedFolderPath=t.getFolderAccess=t.addContentReferencesToPath=t.addContentReferences=t.removeContentReferences=t.getContentReferences=t.setDescription=t.getDescription=void 0;const r=new i.UserApiV2Client;class a extends i.UserApiV2Client{constructor(e,t){super(t),this.user=e}_headers(e){return this.user.is_cdm_member&&this.user.is_team_admin&&this.user.team_member_id?Object.assign({[s.ApiV2HeaderNames.DropboxApiSelectAdmin]:this.user.team_member_id},super._headers(e)):super._headers(e)}}t.getDescription=(e,t)=>r.ns("files").rpc("get_description_batch",{file_ids:[t]},{subjectUserId:e}).then(e=>{if(!e||!e.items||1!==e.items.length)throw new Error("Unexpected response from get_description_batch");return e.items[0]}),t.setDescription=(e,t,s,i,r)=>new a(e).ns("files").rpc("set_description",{file_id:t,current_revision_id:s,text:i,format_version:r},{subjectUserId:e.id}),t.getContentReferences=(e,t)=>r.ns("files").rpc("get_content_references_info",{file_id:t},{subjectUserId:e}),t.removeContentReferences=(e,t,s)=>r.ns("files").rpc("remove_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:s},{subjectUserId:e}),t.addContentReferences=(e,t,s)=>r.ns("files").rpc("add_content_references",{anchor_file_id:t,return_roots_as_ns_ids:!0,file_ids:s},{subjectUserId:e}),t.addContentReferencesToPath=(e,t,s)=>r.ns("files").rpc("add_content_references_to_path",{path:t,return_roots_as_ns_ids:!0,file_ids:s},{subjectUserId:e}),t.getFolderAccess=({userId:e,sharedFolderId:t,accountId:s,accountEmail:i})=>r.ns("files").rpc("has_folder_access",{shared_folder_id:t,account_id:s,account_email:i},{subjectUserId:e}),t.getSharedFolderPath=({userId:e,sharedFolderId:t})=>r.ns("files").rpc("get_metadata",{path:`ns:${t}`},{subjectUserId:e}).then(e=>e.is_shareable?e.path_display:void 0),t.getLoggingFileId=({userId:e,path:t})=>r.ns("files").rpc("get_metadata",{path:t},{subjectUserId:e}).then(e=>e.id),t.isConflictError=e=>e.error&&e.error.status&&"conflict"===e.error.status[".tag"],t.isFormatVersionError=e=>e.error&&e.error.status&&"bad_format_version"===e.error.status[".tag"],t.getUserAccount=({userId:e,accountId:t})=>r.ns("users").rpc("get_account",{account_id:t},{subjectUserId:e})})),define("metaserver/static/js/modules/clean/react/folder_overview/constants",["require","exports","metaserver/static/js/modules/core/i18n","react-intl"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONFLICT_POPUP_BUTTON=t.CONFLICT_POPUP_CONTENT_YOU=t.CONFLICT_POPUP_CONTENT=t.CONFLICT_POPUP_TITLE_YOU=t.CONFLICT_POPUP_TITLE=t.DESCRIPTION_LAST_EDIT=t.DESCRIPTION_LAST_EDIT_YOU=t.DESCRIPTION_LAST_EDIT_EMPTY=t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=t.PIN_TO_READ_ONLY_FOLDER=t.PIN_TO_FAILURE_PERMISSION_DENIED=t.PIN_TO_MODAL_TITLE_MULTIPLE=t.PIN_TO_MODAL_TITLE_SINGLE=t.DESCRIPTION_VERSION=t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=t.SHARING_MODAL_MESSAGE_SAME_FOLDER=t.FOLDER_OVERVIEW_EDITOR_EDITING=t.CMD_KEY=t.CTRL_KEY=t.ALT_KEY=t.OPT_KEY=t.DESCRIPTION_SAVE_ERROR_DELAY_MS=t.DESCRIPTION_SAVE_DELAY_MS=t.SNACKBAR_SHOW_BUTTON_TEXT=t.SNACKBAR_CLOSE_BUTTON_TEXT=t.UNPIN_FROM_SNACKBAR_MESSAGE=t.PIN_TO_SNACKBAR_MESSAGE=t.ERROR_SHARE_NO_PERMISSION=t.ERROR_SHARE_MEMBER_FOLDER=t.ERROR_SHARE_PERSONAL_FOLDER=t.ERROR_DESCRIPTION_SAVE=t.ERROR_DESCRIPTION_FORMAT_VERSION=t.ERROR_DESCRIPTION_CONFLICT=t.FOLDER_EXAMPLES_LINK_URI=t.FOLDER_EXAMPLES_LINK_LABEL=t.DESCRIPTION_PLACEHOLDER_READ_ONLY=t.DESCRIPTION_PLACEHOLDER_EXAMPLES_BUTTON=t.DESCRIPTION_PLACEHOLDER_FOR_SPACE=t.DESCRIPTION_PLACEHOLDER=t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=t.DATA_CACHE_TTL_MS=void 0,t.DATA_CACHE_TTL_MS=3e4,t.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL=s.intl.formatMessage({id:"A5Lqjf",defaultMessage:"Add a few details about this folder here."}),t.DESCRIPTION_PLACEHOLDER=s.intl.formatMessage({id:"5wJAeB",defaultMessage:"Click here to describe this folder and turn it into a Space"}),t.DESCRIPTION_PLACEHOLDER_FOR_SPACE=s.intl.formatMessage({id:"uBopyb",defaultMessage:"Click here to describe this Space"}),t.DESCRIPTION_PLACEHOLDER_EXAMPLES_BUTTON=s.intl.formatMessage({id:"PR6SPH",defaultMessage:"Show examples"}),t.DESCRIPTION_PLACEHOLDER_READ_ONLY=s.intl.formatMessage({id:"PYQBlc",defaultMessage:"To edit this overview, ask the folder admin for access"}),t.FOLDER_EXAMPLES_LINK_LABEL=s.intl.formatMessage({id:"PR6SPH",defaultMessage:"Show examples"}),t.FOLDER_EXAMPLES_LINK_URI="https://www.dropbox.com/help/desktop-web/folder-overviews",t.ERROR_DESCRIPTION_CONFLICT=s.intl.formatMessage({id:"ssdefa",defaultMessage:"Can’t save changes. Paste text elsewhere to save, then click Refresh."}),t.ERROR_DESCRIPTION_FORMAT_VERSION=s.intl.formatMessage({id:"5dt0hu",defaultMessage:"Can’t save changes. Reload the page and try again."}),t.ERROR_DESCRIPTION_SAVE=s.intl.formatMessage({id:"PM6K+P",defaultMessage:"Can’t save changes."}),t.ERROR_SHARE_PERSONAL_FOLDER=s.intl.formatMessage({id:"9C/lc5",defaultMessage:"Can’t @mention someone in your Personal Dropbox."}),t.ERROR_SHARE_MEMBER_FOLDER=s.intl.formatMessage({id:"+dhj1b",defaultMessage:"Can’t @mention someone in your member folder."}),t.ERROR_SHARE_NO_PERMISSION=s.intl.formatMessage({id:"b7//2e",defaultMessage:"You don’t have permission to share this folder."}),t.PIN_TO_SNACKBAR_MESSAGE=i.defineMessage({id:"mjXnuX",defaultMessage:"Pinned to {folderName}"}),t.UNPIN_FROM_SNACKBAR_MESSAGE=i.defineMessage({id:"A1Fokf",defaultMessage:"Unpinned from {folderName}"}),t.SNACKBAR_CLOSE_BUTTON_TEXT=i.defineMessage({id:"Ww9LPX",defaultMessage:"Close"}),t.SNACKBAR_SHOW_BUTTON_TEXT=i.defineMessage({id:"8msMyU",defaultMessage:"Show"}),t.DESCRIPTION_SAVE_DELAY_MS=3e3,t.DESCRIPTION_SAVE_ERROR_DELAY_MS=10*t.DESCRIPTION_SAVE_DELAY_MS,t.OPT_KEY=s.intl.formatMessage({id:"HRXOjw",defaultMessage:"opt"}),t.ALT_KEY=s.intl.formatMessage({id:"RIxWSs",defaultMessage:"alt"}),t.CTRL_KEY=s.intl.formatMessage({id:"FL9yea",defaultMessage:"ctrl"}),t.CMD_KEY=s.intl.formatMessage({id:"NWv/3R",defaultMessage:"⌘"}),t.FOLDER_OVERVIEW_EDITOR_EDITING=s.intl.formatMessage({id:"Kud10T",defaultMessage:"Everyone in this folder can see notes, tasks, and pinned items"}),t.SHARING_MODAL_MESSAGE_SAME_FOLDER=i.defineMessage({id:"xkXFjI",defaultMessage:"Hi {user_name}, I @mentioned you in this folder. Take a look."}),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER=i.defineMessage({id:"YzaJIx",defaultMessage:"Hi {user_name}, I @mentioned you in the {folder_name} folder. Take a look."}),t.SHARING_MODAL_MESSAGE_SAME_FOLDER_NO_NAME=s.intl.formatMessage({id:"sl5Fj7",defaultMessage:"I @mentioned you in this folder. Take a look."}),t.SHARING_MODAL_MESSAGE_PARENT_FOLDER_NO_NAME=i.defineMessage({id:"erm7J0",defaultMessage:"I @mentioned you in the {folder_name} folder. Take a look."}),t.DESCRIPTION_VERSION=[1,0,1],t.PIN_TO_MODAL_TITLE_SINGLE=i.defineMessage({id:"kh62rs",defaultMessage:"Pin “{name}” to..."}),t.PIN_TO_MODAL_TITLE_MULTIPLE=i.defineMessage({id:"oU0z79",defaultMessage:"Pin {num} items to..."}),t.PIN_TO_FAILURE_PERMISSION_DENIED=i.defineMessage({id:"BGyZpk",defaultMessage:"You do not have permission to pin to {path}"}),t.PIN_TO_READ_ONLY_FOLDER=i.defineMessage({id:"UD2+LM",defaultMessage:"Can't pin files or folders to a read-only folder"}),t.DESCRIPTION_LAST_EDIT_EMPTY_YOU=i.defineMessage({id:"PX5Hq1",defaultMessage:"Deleted {time_ago} by you"}),t.DESCRIPTION_LAST_EDIT_EMPTY=i.defineMessage({id:"7V5b6j",defaultMessage:"Deleted {time_ago} by {name}"}),t.DESCRIPTION_LAST_EDIT_YOU=i.defineMessage({id:"oA46AW",defaultMessage:"Updated {time_ago} by you"}),t.DESCRIPTION_LAST_EDIT=i.defineMessage({id:"MP7zas",defaultMessage:"Updated {time_ago} by {name}"}),t.CONFLICT_POPUP_TITLE=i.defineMessage({id:"PHRYz8",defaultMessage:"Your changes weren’t saved because you and {user} are editing at the same time."}),t.CONFLICT_POPUP_TITLE_YOU=s.intl.formatMessage({id:"tc/4YZ",defaultMessage:"Your changes weren’t saved because you are editing this description elsewhere."}),t.CONFLICT_POPUP_CONTENT=s.intl.formatMessage({id:"4aEgv5",defaultMessage:"Please wait until they’re done before making changes."}),t.CONFLICT_POPUP_CONTENT_YOU=s.intl.formatMessage({id:"oYSO1Z",defaultMessage:"Please save your other changes before making them here."}),t.CONFLICT_POPUP_BUTTON=s.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"})})),define("metaserver/static/js/modules/clean/react/folder_overview/data/action_creators",["require","exports","tslib","react","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/folder_overview/api","metaserver/static/js/modules/clean/react/folder_overview/constants","metaserver/static/js/modules/clean/react/folder_overview/data/selectors","metaserver/static/js/modules/clean/react/folder_overview/data/types","metaserver/static/js/modules/clean/react/folder_overview/errors","metaserver/static/js/modules/clean/react/folder_overview/live_update","metaserver/static/js/modules/clean/react/folder_overview/logging","metaserver/static/js/modules/clean/react/folder_overview/utils","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/core/persistence/storage","metaserver/static/js/modules/clean/viewer","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/right_rail/user_education/right_rail_user_education_tracker"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v){"use strict";function T(e){m.Snackbar.complete(E.intl.formatMessage({id:"sz+AhS",defaultMessage:"{count, plural, one{Pinned {count} item.} other{Pinned {count} items.}}"},{count:e}),"folder-overview-pin-current-folder")}Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeToBolt=t.initializeUserInteractionState=t.dismissEducationTooltip=t.interactedPinnedItems=t.interactedFolderOverview=t.fetchLoggingFileId=t.fetchAccountForUserId=t.fetchSharedFolderName=t.setDescriptionHasFocus=t.setRequiredComponents=t.updateFolderDataCache=t.removeContentReferences=t.addContentReferencesForPath=t.addContentReferences=t.reloadContentReferences=t.setContentReferencesData=t.saveDescriptionDraft=t.reloadDescription=t.setDescriptionData=t.setFailedToLoad=t.removeLoadedComponent=t.addLoadedComponent=t.saveFolderPreferences=t.loadFolderPreferences=t.handlePrefetch=t.fetchDataForFolder=void 0,i=s.__importStar(i),r=s.__importStar(r),a=s.__importStar(a),o=s.__importStar(o),l=s.__importStar(l),_=s.__importStar(_),S=s.__importStar(S),t.fetchDataForFolder=({path:e,nsId:i,componentNamespace:r,fetchContentReferences:a})=>(d,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){let s,p=!1;const m=_.normalizePath(e),f=Date.now(),h=l.componentDataCache(u())[r];if(!h||0===h.requiredComponents.length){const e=a?["content_references","description","draftjs"]:["description","draftjs"];d(t.setRequiredComponents({componentNamespace:r,requiredComponents:e}))}const g=[];try{const h=l.user(u()).id;s=l.fileIdCache(u())[m];const S=s||l.nsIdCache(u())[m]||i;if(!S)throw new Error("Unable to get file ID or NS ID for current folder");d(t.setFailedToLoad({componentNamespace:r,hasFailedToLoad:!1}));let E=s?l.folderDataCache(u())[s]:void 0;E&&E.descriptionLastUpdated&&f-E.descriptionLastUpdated<n.DATA_CACHE_TTL_MS?(p=!!E.descriptionBaseRevision,d(t.addLoadedComponent({componentNamespace:r,component:"description"})),g.push(Promise.resolve(null))):(d(t.removeLoadedComponent({componentNamespace:r,component:"description"})),g.push(o.getDescription(h,S))),E&&E.contentReferencesLastUpdated&&f-E.contentReferencesLastUpdated<n.DATA_CACHE_TTL_MS?(d(t.addLoadedComponent({componentNamespace:r,component:"content_references"})),g.push(Promise.resolve(null))):a&&(d(t.removeLoadedComponent({componentNamespace:r,component:"content_references"})),g.push(o.getContentReferences(h,S)));const[v,T]=yield Promise.all(g);if(v&&(s=v.file_obj_id),!s)throw new Error("Did not get a file ID from the Sprinkle description payload");d({type:c.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[_.normalizePath(e)]:s}}}),p=!!v&&R(d,s,v,r,f),T&&A(d,s,T,p,r,f),E=l.folderDataCache(u())[s],E&&E.sharedFolderPath||d(t.fetchSharedFolderName({path:e})),E&&E.loggingFileId||d(t.fetchLoggingFileId({path:e})),d(t.loadFolderPreferences({folderFileId:s}))}catch(s){S.reportException({err:s,severity:"non-critical",exc_extra:{path:e}}),d(t.setFailedToLoad({componentNamespace:r,hasFailedToLoad:!0}))}})),t.handlePrefetch=({path:e,content_references:i,description:r,componentNamespace:a,ts:o=Date.now()})=>n=>s.__awaiter(void 0,void 0,void 0,(function*(){try{const t=r||{},s=i||{},l=t.file_obj_id;if(!l)throw new Error("Did not get a file ID from the Odyssey prefetch payload");n({type:c.ActionTypes.UPDATE_FILE_ID_CACHE,payload:{fileIdCache:{[_.normalizePath(e)]:l}}});const d=t&&R(n,l,t,a,o);s&&A(n,l,s,d,a,o)}catch(s){S.reportException({err:s,severity:"non-critical",exc_extra:{path:e}}),n(t.setFailedToLoad({componentNamespace:a,hasFailedToLoad:!0}))}})),t.loadFolderPreferences=({folderFileId:e})=>(i,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(r()).id;f.UserLocalStorage.clearOtherUsers([s]);const a=f.UserLocalStorage.get(s,`folder-overview-${e}`);a&&i(t.updateFolderDataCache({fileId:e,folderData:a}))})),t.saveFolderPreferences=({folderFileId:e})=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const t=l.user(i()).id;f.UserLocalStorage.clearOtherUsers([t]);const s=l.folderDataCache(i())[e];s&&f.UserLocalStorage.set(t,`folder-overview-${e}`,{isCollapsed:s.isCollapsed})})),t.addLoadedComponent=({componentNamespace:e,component:t})=>({type:c.ActionTypes.ADD_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}}),t.removeLoadedComponent=({componentNamespace:e,component:t})=>({type:c.ActionTypes.REMOVE_LOADED_COMPONENT,payload:{componentNamespace:e,component:t}}),t.setFailedToLoad=({componentNamespace:e,hasFailedToLoad:t})=>({type:c.ActionTypes.SET_FAILED_TO_LOAD,payload:{componentNamespace:e,hasFailedToLoad:t}}),t.setDescriptionData=(e,s,i)=>{const{text:r,latest_revision_id:a,file_obj_id:o,bolt_channel_state:n,format_version:l,last_modified_time:d,last_modified_user:u}=e;if(!o)throw new Error("Unexpected response from Sprinkle");const p=a||"";s(t.updateFolderDataCache({fileId:o,folderData:{description:r,descriptionBaseRevision:p,descriptionDraft:void 0,descriptionSaveState:c.DescriptionSaveState.IDLE,descriptionFormatVersion:l,descriptionBoltChannelState:n,descriptionLastUpdated:Date.now()}})),s(t.addLoadedComponent({componentNamespace:i,component:"description"})),s(O({folderFileId:o,modifiedInfo:{timestamp:d,userId:u},field:"description"})),t.subscribeToBolt("description",n)},t.reloadDescription=({folderFileId:e,componentNamespace:i})=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(a());try{const a=yield o.getDescription(s.id,e);r(t.updateFolderDataCache({fileId:e,folderData:{descriptionBaseRevision:""}})),t.setDescriptionData(a,r,i)}catch(t){S.reportException({err:t,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}})),t.saveDescriptionDraft=({folderFileId:e,componentNamespace:i,isInRightRail:r})=>(a,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(u());try{const d=l.folderDataCache(u())[e];if(!d||!w(d))return;_({descriptionSaveState:c.DescriptionSaveState.SAVING});const m=yield o.setDescription(s,e,d.descriptionLatestRevision,d.descriptionDraft,n.DESCRIPTION_VERSION.join(".")),f=l.componentDataCache(u())[i];(null==f?void 0:f.descriptionHasFocus)||void 0===d.descriptionOpenedAtRevision||I(d);const{text:h,latest_revision_id:S,last_modified_time:E,last_modified_user:v}=m;r&&a(t.interactedFolderOverview()),_({description:h,descriptionSaveState:c.DescriptionSaveState.IDLE,descriptionLastModified:{timestamp:E,userId:v},descriptionBaseRevision:S,descriptionLatestRevision:S});const T="BROWSE"===i?g.ActionSurfaceLogValue.CENTER_PANE:g.ActionSurfaceLogValue.RIGHT_SIDEBAR,b="search-sidebar"===i?g.RetrievalSourceValue.SEARCH:g.RetrievalSourceValue.BROWSE;p.logOverviewEdited({folderFileId:e,action_surface:T,retrievalSource:b,loggingFileId:d.loggingFileId})}catch(t){o.isConflictError(t)?(_({descriptionSaveState:c.DescriptionSaveState.CONFLICT,descriptionLastModified:{userId:void 0}}),a(F({folderFileId:e}))):o.isFormatVersionError(t)?(d.showDescriptionFormatError(),_({descriptionSaveState:c.DescriptionSaveState.ERROR})):(d.showDescriptionSaveError(),_({descriptionSaveState:c.DescriptionSaveState.ERROR}))}function _(s){a(t.updateFolderDataCache({fileId:e,folderData:s}))}})),t.setContentReferencesData=(e,s,i,r)=>{const a=s.content_references||[],o=s.latest_revision_id,n=s.last_modified_time,l=s.last_modified_user;i(t.updateFolderDataCache({fileId:e,folderData:{contentReferences:a,contentReferencesRevision:o,contentReferencesBoltChannelState:s.bolt_channel_state,contentReferencesLastUpdated:Date.now()}})),i(O({folderFileId:e,modifiedInfo:{timestamp:n,userId:l},field:"contentReferences"})),i(t.addLoadedComponent({componentNamespace:r,component:"content_references"})),t.subscribeToBolt("content_references",s.bolt_channel_state)},t.reloadContentReferences=({folderFileId:e,componentNamespace:i})=>(r,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(a());try{const a=yield o.getContentReferences(s.id,e);t.setContentReferencesData(e,a,r,i)}catch(t){S.reportException({err:t,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"],exc_extra:{fileId:e,isReload:!0}})}}));const b=({folderName:e,onShow:t})=>{m.Snackbar.show(i.createElement(m.Snackbar,{title:E.intl.formatMessage(n.PIN_TO_SNACKBAR_MESSAGE,{folderName:e}),timeoutDelayMs:5e3,actionButtonText:t?E.intl.formatMessage(n.SNACKBAR_SHOW_BUTTON_TEXT):void 0,closeButtonText:E.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:t?()=>{m.Snackbar.close("folder-overview-pin"),t()}:void 0,id:"folder-overview-pin"}))};function I(e){const t=e.description?E.intl.formatMessage({id:"BV1uZg",defaultMessage:"Folder overview changed."}):E.intl.formatMessage({id:"MLktc7",defaultMessage:"Folder overview added."});m.Snackbar.generic(t,"folder-overview-change")}t.addContentReferences=({folderFileId:e,fileIds:i,componentNamespace:r,snackbarConfig:a})=>(n,c)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(null===i||0===i.length)return;const s=l.user(c()).id;try{yield o.addContentReferences(s,e,i),a?b(a):T(i.length),n(t.reloadContentReferences({folderFileId:e,componentNamespace:r}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),t.addContentReferencesForPath=({path:e,files:i,currentPath:a,snackbarConfig:c})=>(d,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(u());try{yield o.addContentReferencesToPath(s.id,e,i.map(_.fileToContentReferenceId)),c?b(c):a!==e?m.Snackbar.complete(E.intl.formatMessage({id:"Mflc9Z",defaultMessage:"{count, plural, one{Pinned {count} item to {folder}.} other{Pinned {count} items to {folder}.}}"},{count:i.length,folder:r.filename(e,h.Viewer.get_root_name(s))}),"folder-overview-pin"):T(i.length);const n=l.fileIdCache(u())[_.normalizePath(e)];n&&d(t.reloadContentReferences({folderFileId:n,componentNamespace:"BROWSE"}))}catch(t){S.reportException({err:t,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]});try{if("permission_denied"===t.error.status[".tag"]){const t=c?E.intl.formatMessage(n.PIN_TO_READ_ONLY_FOLDER):E.intl.formatMessage(n.PIN_TO_FAILURE_PERMISSION_DENIED,{path:r.filename(e,h.Viewer.get_root_name(s))});return void m.Snackbar.fail(t,"folder-overview-pin")}}catch(e){}m.Snackbar.fail(E.intl.formatMessage({id:"LYVKP8",defaultMessage:"{count, plural, one{Failed to pin {count} item to {folder}.} other{Failed to pin {count} items to {folder}.}}"},{count:i.length,folder:r.filename(e,h.Viewer.get_root_name(s))}),"folder-overview-pin")}})),t.removeContentReferences=({folderFileId:e,fileIds:r,componentNamespace:a,snackbarConfig:c})=>(d,u)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(u()).id;try{yield o.removeContentReferences(s,e,r),c?m.Snackbar.show(i.createElement(m.Snackbar,{title:E.intl.formatMessage(n.UNPIN_FROM_SNACKBAR_MESSAGE,{folderName:c.folderName}),variant:"complete",actionButtonText:E.intl.formatMessage({id:"GUtve/",defaultMessage:"Undo"}),closeButtonText:E.intl.formatMessage({id:"HBT96k",defaultMessage:"Close"}),onActionClick:()=>{m.Snackbar.close("folder-overview-unpin"),d(t.addContentReferences({folderFileId:e,fileIds:r,componentNamespace:a,snackbarConfig:c}))},timeoutDelayMs:5e3,id:"folder-overview-unpin"})):m.Snackbar.generic(E.intl.formatMessage({id:"0bkx9E",defaultMessage:"{count, plural, one{Unpinned {count} item.} other{Unpinned {count} items.}}"},{count:r.length}),"folder-overview-unpin"),d(t.reloadContentReferences({folderFileId:e,componentNamespace:a}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),t.updateFolderDataCache=({fileId:e,folderData:t})=>({type:c.ActionTypes.UPDATE_FOLDER_DATA_CACHE,payload:{fileId:e,folderData:t}}),t.setRequiredComponents=({componentNamespace:e,requiredComponents:t})=>({type:c.ActionTypes.SET_REQUIRED_COMPONENTS,payload:{componentNamespace:e,requiredComponents:t}}),t.setDescriptionHasFocus=({componentNamespace:e,descriptionHasFocus:s,folderFileId:i})=>(r,a)=>{const o=l.componentDataCache(a())[e];if(s&&o&&!o.descriptionHasFocus){const e=l.folderDataCache(a())[i].descriptionBaseRevision;r(t.updateFolderDataCache({fileId:i,folderData:{descriptionLatestRevision:e,descriptionOpenedAtRevision:e}}))}else if(!s&&(null==o?void 0:o.descriptionHasFocus)){const e=l.folderDataCache(a())[i];e&&(null==e?void 0:e.descriptionOpenedAtRevision)!==(null==e?void 0:e.descriptionLatestRevision)&&(I(e),r(t.updateFolderDataCache({fileId:i,folderData:{descriptionOpenedAtRevision:void 0}})))}r({type:c.ActionTypes.SET_DESCRIPTION_HAS_FOCUS,payload:{componentNamespace:e,descriptionHasFocus:s}})};const w=e=>!!e&&(e.descriptionSaveState!==c.DescriptionSaveState.CONFLICT&&(e.descriptionSaveState!==c.DescriptionSaveState.SAVING&&_.hasUnsavedDescriptionDraft(e)));t.fetchSharedFolderName=({path:e})=>(i,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(r.paths_are_equal(e,"/"))return;const s=_.normalizePath(e),n=l.nsIdCache(a())[s];if(!n)return;const c=l.fileIdCache(a())[s],d=l.user(a()).id,u=_.extractSharedFolderId(n);if(u)try{const e=yield o.getSharedFolderPath({userId:d,sharedFolderId:u});i(t.updateFolderDataCache({fileId:c,folderData:{sharedFolderPath:e}}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),t.fetchAccountForUserId=({accountId:e})=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(i());if(!e)return;if(e in l.accountCache(i()))return;if(e===s.account_id)return;const r=yield o.getUserAccount({userId:s.id,accountId:e});t({type:c.ActionTypes.UPDATE_ACCOUNT_CACHE,payload:{accountCache:{[e]:r}}})})),t.fetchLoggingFileId=({path:e})=>(i,n)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(r.paths_are_equal(e,"/"))return;if(r.paths_are_equal(a.context(n()).currentFQPath,e)&&!a.context(n()).currentNSPath)return;const s=_.normalizePath(e),c=l.fileIdCache(n())[s],d=l.user(n()).id;try{const e=yield o.getLoggingFileId({userId:d,path:s});i(t.updateFolderDataCache({fileId:c,folderData:{loggingFileId:e}}))}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}})),t.interactedFolderOverview=()=>(e,t)=>{const s=l.getRightRailUserEducationTracker(t()),i=l.getUserEducationTooltips(t());i.tooltipsEnabled&&!i.hasInteractedWithOverview&&(e({type:c.ActionTypes.UPDATE_EDUCATION_TOOLTIPS_STATE,payload:{hasInteractedWithOverview:!0}}),s.track(v.RightRailUserEducationActions.FOLDER_OVERVIEW_INTERACTION))},t.interactedPinnedItems=()=>(e,t)=>{const s=l.getRightRailUserEducationTracker(t()),i=l.getUserEducationTooltips(t());i.tooltipsEnabled&&!i.hasInteractedWithPinnedItems&&(e({type:c.ActionTypes.UPDATE_EDUCATION_TOOLTIPS_STATE,payload:{hasInteractedWithPinnedItems:!0}}),s.track(v.RightRailUserEducationActions.PINNED_BLADE_INTERACTION))},t.dismissEducationTooltip=()=>(e,t)=>{const s=l.getRightRailUserEducationTracker(t());e({type:c.ActionTypes.UPDATE_EDUCATION_TOOLTIPS_STATE,payload:{hasSeenTooltip:!0}}),s.track(v.RightRailUserEducationActions.TOOLTIP_SEEN)};const C=(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){try{return yield t.hasPerfomed(e)}catch(e){return S.reportException({err:e,force:!0,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview","browse_right_rail"]}),!0}}));t.initializeUserInteractionState=e=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(!e)return;const s=l.getRightRailUserEducationTracker(i()),[r,a,o]=yield Promise.all([C(v.RightRailUserEducationActions.PINNED_BLADE_INTERACTION,s),C(v.RightRailUserEducationActions.FOLDER_OVERVIEW_INTERACTION,s),C(v.RightRailUserEducationActions.TOOLTIP_SEEN,s)]);t({type:c.ActionTypes.UPDATE_EDUCATION_TOOLTIPS_STATE,payload:{hasSeenTooltip:o,hasInteractedWithOverview:a,hasInteractedWithPinnedItems:r,tooltipsEnabled:!0}})}));const O=({folderFileId:e,modifiedInfo:s,field:i})=>(r,a)=>{if(!s.timestamp||!s.userId)return;const o=l.folderDataCache(a())[e];if(!o)return;const n="contentReferences"===i?"contentReferencesLastModified":"descriptionLastModified",c=o[n];(null==c?void 0:c.timestamp)&&s.timestamp<c.timestamp||(r(t.updateFolderDataCache({fileId:e,folderData:{[n]:s}})),r(t.fetchAccountForUserId({accountId:s.userId})))};t.subscribeToBolt=(e,t)=>{if(void 0!==t)try{const{channel_id:s,revision:i,token:r}=t;if(void 0===s||void 0===i||void 0===r)return;const{unique_id:a,app_id:o}=s;if(void 0===a||void 0===o)return;u.folderOverviewLiveUpdateManager.setUpdateChannelForType(e,{uniqueId:a,appId:o,token:r,revision:`${i}`})}catch(e){S.reportException({err:e,severity:S.SEVERITY.NONCRITICAL,tags:["browse","folder_overview"]})}};const F=({folderFileId:e})=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=l.user(i()),{last_modified_time:r,last_modified_user:a}=yield o.getDescription(s.id,e);t(O({folderFileId:e,modifiedInfo:{timestamp:r,userId:a},field:"description"}))})),R=(e,s,i,r,a)=>i.latest_revision_id?(t.setDescriptionData(i,e,r),!0):(e(t.addLoadedComponent({componentNamespace:r,component:"description"})),e(t.updateFolderDataCache({fileId:s,folderData:{descriptionBoltChannelState:i.bolt_channel_state,descriptionLastUpdated:a}})),t.subscribeToBolt("description",i.bolt_channel_state),!1),A=(e,s,i,r,a,o)=>i.latest_revision_id?(t.setContentReferencesData(s,i,e,a),!0):(e(t.updateFolderDataCache({fileId:s,folderData:{contentReferences:[],contentReferencesBoltChannelState:i.bolt_channel_state,contentReferencesLastUpdated:o}})),e(t.addLoadedComponent({componentNamespace:a,component:"content_references"})),!1)})),define("metaserver/static/js/modules/clean/react/folder_overview/data/reducer",["require","exports","metaserver/static/js/modules/clean/react/browse/data/types","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/folder_overview/data/types","metaserver/static/js/modules/clean/react/folder_overview/utils","metaserver/static/js/modules/clean/search/single_page/data/types"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderOverviewReducer=t.defaultFolderOverviewState=void 0,t.defaultFolderOverviewState={folderDataCache:{},fileIdCache:{},accountCache:{},nsIdCache:{},componentDataCache:{},educationTooltips:{hasSeenTooltip:!0}};const n=(e,t)=>{const s=e.componentDataCache[t];return s||{requiredComponents:[],loadedComponents:[],hasFailedToLoad:!1,descriptionHasFocus:!1}},l=e=>{const t={};return e.forEach(e=>{t[a.normalizePath(e.fq_path)]=e.target_ns?`ns:${e.target_ns}/`:`ns:${e.ns_id}/${e.ns_path}`}),t};t.folderOverviewReducer=function(e=t.defaultFolderOverviewState,c){switch(c.type){case r.ActionTypes.UPDATE_FOLDER_DATA_CACHE:return((e,{fileId:t,folderData:s})=>Object.assign(Object.assign({},e),{folderDataCache:Object.assign(Object.assign({},e.folderDataCache),{[t]:Object.assign(Object.assign({},e.folderDataCache[t]),s)})}))(e,c.payload);case r.ActionTypes.UPDATE_FILE_ID_CACHE:return((e,{fileIdCache:t})=>Object.assign(Object.assign({},e),{fileIdCache:Object.assign(Object.assign({},e.fileIdCache),t)}))(e,c.payload);case r.ActionTypes.UPDATE_ACCOUNT_CACHE:return((e,{accountCache:t})=>Object.assign(Object.assign({},e),{accountCache:Object.assign(Object.assign({},e.accountCache),t)}))(e,c.payload);case r.ActionTypes.SET_REQUIRED_COMPONENTS:return((e,{componentNamespace:t,requiredComponents:s})=>{const i=n(e,t);return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},i),{requiredComponents:s})})})})(e,c.payload);case s.ActionTypes.SET_CONTEXT:return((e,{context:t})=>Object.assign(Object.assign({},e),{nsIdCache:Object.assign(Object.assign({},e.nsIdCache),{[a.normalizePath(t.currentFQPath)]:`ns:${t.currentNSID}/${t.currentNSPath}`})}))(e,c.payload);case r.ActionTypes.REMOVE_LOADED_COMPONENT:return((e,{componentNamespace:t,component:s})=>{const i=n(e,t),r=i.loadedComponents;return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},i),{loadedComponents:r.filter(e=>e!==s)})})})})(e,c.payload);case r.ActionTypes.ADD_LOADED_COMPONENT:return((e,{componentNamespace:t,component:s})=>{const i=n(e,t),r=i.loadedComponents;return r.includes(s)?e:Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},i),{loadedComponents:[...r,s]})})})})(e,c.payload);case r.ActionTypes.SET_FAILED_TO_LOAD:return((e,{componentNamespace:t,hasFailedToLoad:s})=>{const i=n(e,t);return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},i),{hasFailedToLoad:s})})})})(e,c.payload);case r.ActionTypes.SET_DESCRIPTION_HAS_FOCUS:return((e,{componentNamespace:t,descriptionHasFocus:s})=>{const i=n(e,t);return Object.assign(Object.assign({},e),{componentDataCache:Object.assign(Object.assign({},e.componentDataCache),{[t]:Object.assign(Object.assign({},i),{descriptionHasFocus:s})})})})(e,c.payload);case s.ActionTypes.SET_UNSORTED_FILES:return((e,{unsortedFiles:t})=>{const s=t.filter(e=>e.is_dir).toArray();return Object.assign(Object.assign({},e),{nsIdCache:Object.assign(Object.assign({},e.nsIdCache),l(s))})})(e,c.payload);case o.ActionTypes.SET_RESULTS:case o.ActionTypes.APPEND_RESULTS:return((e,{searchResults:t})=>{const s=t.results.filter(e=>e instanceof i.File&&e.is_dir);return Object.assign(Object.assign({},e),{nsIdCache:Object.assign(Object.assign({},e.nsIdCache),l(s))})})(e,c.payload);case r.ActionTypes.UPDATE_EDUCATION_TOOLTIPS_STATE:return((e,t)=>Object.assign(Object.assign({},e),{educationTooltips:Object.assign(Object.assign({},e.educationTooltips),t)}))(e,c.payload)}return e}})),define("metaserver/static/js/modules/clean/react/folder_overview/data/selectors",["require","exports","tslib","reselect","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/folder_overview/constants","metaserver/static/js/modules/clean/react/folder_overview/data/reducer","metaserver/static/js/modules/clean/react/folder_overview/utils","typescript/libraries/comments2/src/components/folder_overview_utils/index","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/redux/selectors","metaserver/static/js/modules/clean/user","metaserver/static/js/modules/clean/react/right_rail/user_education/right_rail_user_education_tracker"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canShowToolFolderOverviewTooltip=t.getUserEducationTooltips=t.getRightRailUserEducationTracker=t.makeDoesFolderOverviewExistSelector=t.makeIsSpaceSelector=t.makeIsFolderOverviewEmptySelector=t.makePinnedItemsSelector=t.makeDescriptionContentSelector=t.makeLoggingFileIdSelector=t.makeSharedFolderNameSelector=t.makeSharedFolderPathSelector=t.makeHasUnsavedDescriptionDraftSelector=t.makeDescriptionFormatValidSelector=t.makeDescriptionSaveStateSelector=t.makeLastModifiedUserSelector=t.makeLastModifiedUserIdSelector=t.makeLastModifiedTimeSelector=t.makeDescriptionBaseRevisionSelector=t.makeIsCollapsedSelector=t.descriptionAuthorSelector=t.makeSharedFolderIdSelector=t.makeFolderNsIdSelector=t.makeFolderFileIdSelector=t.makeDescriptionHasFocusSelector=t.makeHasFailedToLoadSelector=t.makeHaveAllComponentsLoadedSelector=t.makeLoadedComponentsSelector=t.user=t.componentDataCache=t.accountCache=t.nsIdCache=t.fileIdCache=t.folderDataCache=void 0,r=s.__importStar(r),n=s.__importStar(n);const _=[],m=e=>d.getStateAtNamespace(e,c.FOLDER_OVERVIEW_NAMESPACE_KEY)||o.defaultFolderOverviewState;t.folderDataCache=e=>m(e).folderDataCache,t.fileIdCache=e=>m(e).fileIdCache;const f=(e,s)=>t.fileIdCache(e)[n.normalizePath(s.path)];t.nsIdCache=e=>m(e).nsIdCache;const h=(e,s)=>t.nsIdCache(e)[n.normalizePath(s.path)];t.accountCache=e=>m(e).accountCache,t.componentDataCache=e=>m(e).componentDataCache,t.user=e=>e.BROWSE&&e.BROWSE.user||u.mkUser(e.SEARCH.user);const g=(e,s)=>t.componentDataCache(e)[s.componentNamespace],S=(e,s)=>{const i=f(e,s);return t.folderDataCache(e)[i]},E=(e,t)=>{const s=S(e,t);return s?s.sharedFolderPath||t.path:void 0},v=(e,t)=>{var s;const i=T(e,t);return null!==(s=null==i?void 0:i.userId)&&void 0!==s?s:void 0},T=(e,t)=>{const{descriptionLastModified:s,contentReferencesLastModified:i}=S(e,t)||{};return t.isInRightRail?s:(null==s?void 0:s.timestamp)&&(null==i?void 0:i.timestamp)?s.timestamp<i.timestamp?i:s:s||i},b=i.createSelector(S,e=>e?e.descriptionFormatVersion:void 0),I=i.createSelector(S,e=>{if(e&&e.description)try{return JSON.parse(e.description)}catch(e){return}}),w=i.createSelector(S,e=>{if(void 0!==e&&void 0!==e.contentReferences)return 0===e.contentReferences.length?_:n.convertContentReferencesToSortedFiles(e.contentReferences)}),C=i.createSelector(I,l.isEmptyDescription);t.makeLoadedComponentsSelector=()=>i.createSelector(g,e=>e?e.loadedComponents:void 0),t.makeHaveAllComponentsLoadedSelector=()=>i.createSelector(g,e=>{if(!e||0===e.requiredComponents.length)return!1;return 0===e.requiredComponents.filter(t=>!e.loadedComponents.includes(t)).length}),t.makeHasFailedToLoadSelector=()=>i.createSelector(g,e=>!!e&&e.hasFailedToLoad),t.makeDescriptionHasFocusSelector=()=>i.createSelector(g,e=>!!e&&e.descriptionHasFocus),t.makeFolderFileIdSelector=()=>i.createSelector(f,e=>e),t.makeFolderNsIdSelector=()=>i.createSelector(h,e=>e),t.makeSharedFolderIdSelector=()=>i.createSelector(h,e=>{if(e)return n.extractSharedFolderId(e)}),t.descriptionAuthorSelector=i.createSelector(t.user,n.convertDbxUserToIUser),t.makeIsCollapsedSelector=()=>i.createSelector(S,e=>!!e&&!!e.isCollapsed),t.makeDescriptionBaseRevisionSelector=()=>i.createSelector(S,e=>e?e.descriptionBaseRevision:void 0),t.makeLastModifiedTimeSelector=()=>i.createSelector(T,e=>{var t;return null!==(t=null==e?void 0:e.timestamp)&&void 0!==t?t:void 0}),t.makeLastModifiedUserIdSelector=()=>i.createSelector(v,e=>e),t.makeLastModifiedUserSelector=()=>i.createSelector(v,t.accountCache,(e,t)=>e?t[e]:void 0),t.makeDescriptionSaveStateSelector=()=>i.createSelector(S,e=>e?e.descriptionSaveState:void 0),t.makeDescriptionFormatValidSelector=()=>i.createSelector(b,e=>{if(!e)return!0;const t=e.split(".").map(e=>parseInt(e,10));return!(t[0]>a.DESCRIPTION_VERSION[0])&&!(t[0]===a.DESCRIPTION_VERSION[0]&&t[1]>a.DESCRIPTION_VERSION[1])}),t.makeHasUnsavedDescriptionDraftSelector=()=>i.createSelector(S,n.hasUnsavedDescriptionDraft),t.makeSharedFolderPathSelector=()=>i.createSelector(E,e=>e),t.makeSharedFolderNameSelector=()=>i.createSelector(E,e=>e?r.filename(e):void 0),t.makeLoggingFileIdSelector=()=>i.createSelector(S,e=>e?e.loggingFileId:void 0),t.makeDescriptionContentSelector=()=>i.createSelector(I,e=>e),t.makePinnedItemsSelector=()=>i.createSelector(w,e=>e),t.makeIsFolderOverviewEmptySelector=()=>i.createSelector(C,w,(e,t)=>t.isInRightRail,(e,t,s)=>e&&(s||!(t&&t.length))),t.makeIsSpaceSelector=()=>i.createSelector(C,w,(e,t)=>!e||!(!t||!t.length)),t.makeDoesFolderOverviewExistSelector=()=>i.createSelector(S,e=>!!e&&(!!e.descriptionBaseRevision||!!e.contentReferencesRevision)),t.getRightRailUserEducationTracker=i.createSelector(t.user,e=>new p.RightRailUserEducationTracker(e.id)),t.getUserEducationTooltips=e=>m(e).educationTooltips,t.canShowToolFolderOverviewTooltip=i.createSelector(C,w,t.getUserEducationTooltips,(e,t,s)=>{const{tooltipsEnabled:i,hasInteractedWithOverview:r,hasInteractedWithPinnedItems:a,hasSeenTooltip:o}=s,n=!(!t||!t.length);return Boolean(i&&!o&&(!r&&!e||!a&&n))})})),define("metaserver/static/js/modules/clean/react/folder_overview/data/store",["require","exports","metaserver/static/js/modules/clean/react/folder_overview/data/reducer","metaserver/static/js/modules/clean/redux/store","metaserver/static/js/modules/clean/redux/namespaces"],(function(e,t,s,i,r){"use strict";let a;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForFolderOverview=void 0,t.getStoreForFolderOverview=()=>(a||(a=i.getStoreAndRegisterReducers({[r.FOLDER_OVERVIEW_NAMESPACE_KEY]:s.folderOverviewReducer})),a)})),define("metaserver/static/js/modules/clean/react/folder_overview/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DescriptionSaveState=t.ActionTypes=void 0,(function(e){e.UPDATE_FOLDER_DATA_CACHE="FOLDER_OVERVIEW/UPDATE_FOLDER_DATA_CACHE",e.UPDATE_FILE_ID_CACHE="FOLDER_OVERVIEW/UPDATE_FILE_ID_CACHE",e.REMOVE_LOADED_COMPONENT="FOLDER_OVERVIEW/REMOVE_LOADED_COMPONENT",e.ADD_LOADED_COMPONENT="FOLDER_OVERVIEW/ADD_LOADED_COMPONENT",e.SET_FAILED_TO_LOAD="FOLDER_OVERVIEW/SET_FAILED_TO_LOAD",e.SET_DESCRIPTION_HAS_FOCUS="FOLDER_OVERVIEW/SET_DESCRIPTION_HAS_FOCUS",e.UPDATE_ACCOUNT_CACHE="FOLDER_OVERVIEW/UPDATE_ACCOUNT_CACHE",e.SET_REQUIRED_COMPONENTS="FOLDER_OVERVIEW/SET_REQUIRED_COMPONENTS",e.UPDATE_EDUCATION_TOOLTIPS_STATE="FOLDER_OVERVIEW/UPDATE_EDUCATION_TOOLTIPS_STATE"})(t.ActionTypes||(t.ActionTypes={})),(function(e){e.IDLE="IDLE",e.SAVING="SAVING",e.CONFLICT="CONFLICT",e.ERROR="ERROR"})(t.DescriptionSaveState||(t.DescriptionSaveState={}))})),define("metaserver/static/js/modules/clean/react/folder_overview/errors",["require","exports","metaserver/static/js/modules/clean/react/folder_overview/constants","metaserver/static/js/modules/clean/react/snackbar"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showDescriptionSaveError=t.showDescriptionFormatError=void 0,t.showDescriptionFormatError=()=>{i.Snackbar.fail(s.ERROR_DESCRIPTION_FORMAT_VERSION,"folder-overview")},t.showDescriptionSaveError=()=>{i.Snackbar.fail(s.ERROR_DESCRIPTION_SAVE,"folder-overview")}})),define("metaserver/static/js/modules/clean/react/folder_overview/live_update",["require","exports","tslib","lodash","eventemitter3","metaserver/static/js/modules/clean/bolt/bolt"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderOverviewLiveUpdateManager=t.FolderOverviewLiveUpdateManager=void 0,i=s.__importStar(i),r=s.__importDefault(r);class o extends r.default{constructor(){super(),this.setUpdateChannelForType=(e,t)=>{this.signedChannelStates[e]=new a.SignedChannelState(t.appId,t.uniqueId,t.revision,t.token),this.boltClient.update_states(i.values(this.signedChannelStates)),this.boltClient.start()},this.handleUpdate=e=>{const t=[];e.forEach(e=>{const s=i.findKey(this.signedChannelStates,{app_id:e.app_id,unique_id:e.unique_id});s&&!t.includes(s)&&(this.emit("update",{type:s}),t.push(s))})},this.handleRefresh=()=>{this.boltClient.update_states(i.values(this.signedChannelStates))},this.boltClient=new a.BoltClient([],this.handleUpdate,this.handleRefresh),this.signedChannelStates={}}stop(){this.boltClient.unsubscribe()}}t.FolderOverviewLiveUpdateManager=o,t.folderOverviewLiveUpdateManager=new o})),define("metaserver/static/js/modules/clean/react/folder_overview/logging",["require","exports","tslib","sjcl","immutable","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/logging/hive/schemas/web-user-action","metaserver/static/js/modules/clean/logging/telemetry","metaserver/static/js/modules/clean/react/folder_overview/data/selectors","metaserver/static/js/modules/clean/react/folder_overview/data/store","metaserver/static/js/modules/clean/react/folder_overview/utils","metaserver/static/js/modules/clean/web_user_action_events"],(function(e,t,s,i,r,a,o,n,l,c,d,u){"use strict";function p(e){return e.blocks.map(e=>e.text.length).reduce((e,t)=>e+t,0)}function _(e){let t=r.OrderedSet();return t=t.merge(e.blocks.map(e=>e.type).filter(e=>"unstyled"!==e)),e.blocks.forEach(e=>e.inlineStyleRanges.forEach(e=>{t=t.add(e.style)})),e.blocks.forEach(s=>s.entityRanges.forEach(s=>{t=t.add(e.entityMap[s.key].type)})),t.toArray().sort()}Object.defineProperty(t,"__esModule",{value:!0}),t.logFolderOverviewAction=t.logOverviewEdited=t.makeOverviewResourceExtras=t.makeEditedData=t.extractNsIdAndPath=t.hashPath=t.hiveLogger=void 0,i=s.__importStar(i),a=s.__importStar(a),n=s.__importStar(n),l=s.__importStar(l),t.hiveLogger=new n.HiveLogger;const m=(e,t)=>{const s=l.folderDataCache(t)[e];return s&&s.contentReferences||[]},f=e=>{if(!e)return"";const t=i.hash.sha256.hash(e.toLowerCase());return i.codec.hex.fromBits(t)};t.hashPath=e=>(e||"/").split("/").map(f).join("/");const h=e=>{const t=a.normalize(e).split("/");return f(t.pop())};t.extractNsIdAndPath=e=>e?{nsId:d.extractSharedFolderId(e),nsPath:d.extractSharedFolderPath(e)}:{},t.makeEditedData=({folderFileId:e,loggingFileId:s,action_surface:i,retrievalSource:r})=>{const a=c.getStoreForFolderOverview().getState(),o=(function(e){const t=(function(e){const t={all:0,checked:0};if(!e)return t;return e.blocks.forEach(e=>{"task-block"===e.type&&(t.all+=1,e.data&&e.data.checked&&(t.checked+=1))}),t})(e);return{length:e?p(e):0,features:e?_(e):[],tasks:t.all,checkedTasks:t.checked}})(((e,t)=>{const s=l.folderDataCache(t)[e];if(s&&s.descriptionDraft)try{return JSON.parse(s.descriptionDraft)}catch(e){return}})(e,a)),n=t.makeOverviewResourceExtras({folderFileId:e,loggingFileId:s,action_surface:i,retrievalSource:r});if(n)return Object.assign(Object.assign({},n),{length:o.length.toString(),formatting:JSON.stringify(o.features),tasks:o.tasks.toString(),checkedTasks:o.checkedTasks.toString(),pins:JSON.stringify(m(e,a).map(e=>({file_id:e.ns_path?e.file_id:e.ns_id,file_obj_id:e.file_id,resource:{resource_title:h(e.fq_path),resource_type:e.is_dir?"SFJ_FOLDER":"SFJ_FILE",ns_id:`${e.ns_id}`,resource_path:t.hashPath(e.fq_path),resource_namespace_path:t.hashPath(e.ns_path)}})))})},t.makeOverviewResourceExtras=({folderFileId:e,loggingFileId:s,action_surface:i,retrievalSource:r})=>{const a=c.getStoreForFolderOverview().getState(),o=((e,t)=>{const s=l.fileIdCache(t);for(const t in s)if(s[t]===e)return t})(e,a);if(void 0===o)return;const{nsId:n,nsPath:d}=t.extractNsIdAndPath(l.nsIdCache(a)[o]);return n?{resource_type:"SFJ_FOLDER",resource_title:h(o),ns_id:n,resource_path:t.hashPath(o),resource_namespace_path:t.hashPath(d),file_id:(d?s:n)||null,file_obj_id:e,is_offline:"false",action_surface:i,retrieval_source:r}:void 0},t.logOverviewEdited=({folderFileId:e,loggingFileId:s,action_surface:i,retrievalSource:r})=>{const a=c.getStoreForFolderOverview().getState();t.logFolderOverviewAction(u.WebUserActionLogEvent.FOLDER_OVERVIEW_EDITED,l.user(a).id,null,t.makeEditedData({folderFileId:e,loggingFileId:s,action_surface:i,retrievalSource:r}))},t.logFolderOverviewAction=(e,s,i,r={})=>{let n={user_id:s,event_name:e};i&&(n=Object.assign(Object.assign({},n),{file_nsid:i.ns_id,file_sjid:i.sjid,file_id:i.file_id,file_name:a.filename(i.fq_path),file_path:i.fq_path,file_extension:i.ext})),t.hiveLogger.log(new o.WebUserActionRow(Object.assign(Object.assign({},n),{extra:Object.assign({},r)})))}})),define("metaserver/static/js/modules/clean/react/folder_overview/utils",["require","exports","tslib","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/core/i18n","typescript/libraries/comments2/src/components/folder_overview_utils/index"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canEditOverviewForFile=t.userInitials=t.fileToContentReferenceId=t.pathFromSharingFolder=t.extractSharedFolderPath=t.extractSharedFolderId=t.getFileExtension=t.convertContentReferencesToSortedFiles=t.hasUnsavedDescriptionDraft=t.normalizePath=t.convertDbxUserToIUser=void 0,i=s.__importStar(i),t.convertDbxUserToIUser=e=>({id:e.id.toString(),name:{display:e.display_name,initials:[e.fname.substr(0,1),e.lname.substr(0,1)].join(""),public:e.familiar_name},photoUrl:e.initials_url}),t.normalizePath=e=>i.normalize(e).toLowerCase(),t.hasUnsavedDescriptionDraft=e=>{if(!e)return!1;try{const t=void 0===e.description||""===e.description||o.isEmptyDescription(JSON.parse(e.description)),s=void 0===e.descriptionDraft||""===e.descriptionDraft||o.isEmptyDescription(JSON.parse(e.descriptionDraft));if(t&&s)return!1}catch(e){}return e.description!==e.descriptionDraft&&void 0!==e.descriptionDraft},t.convertContentReferencesToSortedFiles=e=>{const s=[];e.forEach(e=>{const i={file_id:e.file_id,fq_path:e.fq_path,href:e.href,icon:e.icon,is_cloud_doc:e.is_cloud_doc,is_dir:e.is_dir,thumbnail_url_tmpl:e.thumbnail_url_tmpl,ns_id:e.ns_id,ns_path:e.ns_path,sjid:e.sjid,isDeleted:e.is_deleted,ext:t.getFileExtension(e.fq_path)},a=new r.File(i);s.push(a)});const i=a.case_insensitive_comparator(!0);return s.sort((e,t)=>i(r.File.getFilename(e),r.File.getFilename(t)))},t.getFileExtension=e=>{if(!e)return"";const t=i.file_extension(e);return t?`.${t}`:""},t.extractSharedFolderId=e=>{const t=/^ns:([0-9]+)\/?/.exec(e);return t?t[1]:void 0},t.extractSharedFolderPath=e=>{const t=/^ns:[0-9]+\/?(.*)/.exec(e);return t?t[1]:void 0},t.pathFromSharingFolder=(e,t)=>e.length>=t.length?i.filename(t):[i.filename(e),...t.substr(e.length).split("/").filter(e=>!!e)].join(" › "),t.fileToContentReferenceId=e=>e.is_dir&&e.target_ns?`ns:${e.target_ns}`:e.file_id;t.userInitials=e=>(e=>"fname"in e)(e)?e.fname.substr(0,1)+e.lname.substr(0,1):e.name.given_name.substr(0,1)+e.name.surname.substr(0,1),t.canEditOverviewForFile=e=>(!e.is_dir||!e.isDeleted)&&(e.target_ns?!e._mount_access_perms||!(!e._mount_access_perms||!e._mount_access_perms.includes("can_edit")):!e.read_only)})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/customization/query_param_filter",["require","exports","tslib","react","metaserver/static/js/modules/clean/history","metaserver/static/js/modules/clean/react/folder_subscriptions/data/types"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryParamFilter=void 0,i=s.__importStar(i),r=s.__importDefault(r),t.QueryParamFilter=({children:e})=>{const[t,s]=i.useState(r.default.deconstruct_url().qargs[a.FOLLOW_MODAL_QUERY_PARAM]);return i.useEffect(()=>{function e(e,t){s(t[a.FOLLOW_MODAL_QUERY_PARAM])}const t="/"+r.default.get_url().split(/[/?]/)[1];return r.default.add_callback(t,e),()=>{r.default.remove_callback(t,e)}},[t]),void 0===t||Array.isArray(t)?null:i.default.cloneElement(e,{param:t})},t.QueryParamFilter.displayName="QueryParamFilter"})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes=t.FolderSubscriptionState=t.RequestFlightStatus=t.Frequencies=t.FOLLOW_MODAL_QUERY_PARAM=void 0,t.FOLLOW_MODAL_QUERY_PARAM="manage_folder_subscription",t.Frequencies={INSTANT:{".tag":"instant"},DAILY:{".tag":"daily"}},(function(e){e.IDLE="idle",e.READY="ready",e.INFLIGHT="inflight",e.ERROR="error"})(t.RequestFlightStatus||(t.RequestFlightStatus={})),(function(e){e.FOLLOWING="FOLLOWING",e.FOLLOWING_PARENT="FOLLOWING_PARENT",e.NOT_FOLLOWING="NOT_FOLLOWING"})(t.FolderSubscriptionState||(t.FolderSubscriptionState={})),(function(e){e.FETCHING_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/FETCHING_FOLDER_SUBSCRIPTION",e.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/OPTIMISTIC_SET_FOLDER_SUBSCRIPTION",e.CONFIRM_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/CONFIRM_FOLDER_SUBSCRIPTION",e.ERROR_FOLDER_SUBSCRIPTION="FOLDER_SUBSCRIPTION/ERROR_FOLDER_SUBSCRIPTION"})(t.ActionTypes||(t.ActionTypes={}))})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/data/action_creators",["require","exports","tslib","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/logger_util","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/folder_subscriptions/data/api","metaserver/static/js/modules/clean/react/folder_subscriptions/data/selectors","metaserver/static/js/modules/clean/react/folder_subscriptions/data/types","metaserver/static/js/modules/clean/react/folder_subscriptions/follow/snackbar","metaserver/static/js/modules/clean/web_user_action_events"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editFolderSubscription=t.deleteFolderSubscriptionFromEmail=t.deleteFolderSubscription=t.createFolderSubscription=t.logAction=t.FolderSubscriptionOrigin=t.fetchFolderSubscription=void 0,a=s.__importStar(a),o=s.__importStar(o),n=s.__importStar(n),l=s.__importStar(l),c=s.__importStar(c);const _=(e,t,s)=>{e({type:d.ActionTypes.CONFIRM_FOLDER_SUBSCRIPTION,payload:{folderSubscription:s,path:t,timestamp:new Date}})},m=(e,t,s)=>{e({type:d.ActionTypes.ERROR_FOLDER_SUBSCRIPTION,payload:{folderSubscription:s,path:t}})};var f;t.fetchFolderSubscription=e=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=i(),r=a.user(s).id;c.getRequestState(s,e).status!==d.RequestFlightStatus.INFLIGHT&&(((e,t)=>{e({type:d.ActionTypes.FETCHING_FOLDER_SUBSCRIPTION,payload:{path:t}})})(t,e),l.getFolderSubscription(e,r).then(s=>_(t,e,s),()=>m(t,e)))})),(function(e){e.Email="email",e.SideMenu="side_menu",e.Thumbnail="thumbnail"})(f=t.FolderSubscriptionOrigin||(t.FolderSubscriptionOrigin={})),t.logAction=(e,t,s,l)=>{var d,u;const p=a.user(t).id,_=a.selectedFiles(t),{num_files_selected:m,num_folders_selected:f}=o.countFilesAndFolders(_),h=c.folderSubscription(t,s),g=null===(d=null==h?void 0:h.settings)||void 0===d?void 0:d.activity_types;i.logBrowseAction({action:e,uid:p,num_files_selected:m,num_folders_selected:f,view_type:n.selectViewType(t,{instanceId:r.BROWSE_FILES_VIEW_ID}),extra:{ns_id:l.ns_id.toString(),origin:l.origin||null,frequency:(null===(u=null==h?void 0:h.settings)||void 0===u?void 0:u.frequency[".tag"])||null,file_add:g?g.file_added.toString():null,file_delete:g?g.file_deleted.toString():null}})};const h=({dispatch:e,getState:s,path:i,newValue:r,apiUpdate:a,onSuccess:o,onError:n})=>{const l=s(),u=c.folderSubscription(l,i);return((e,t,s)=>{e({type:d.ActionTypes.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION,payload:{folderSubscription:s,path:t}})})(e,i,r),a().then(t=>{_(e,i,r),o(t)},()=>{m(e,i,u),e(t.fetchFolderSubscription(i)),n()})};t.createFolderSubscription=(e,s,i)=>(r,o)=>{const n=o(),_=a.user(n).id;if(c.folderSubscriptionState(n,e)===d.FolderSubscriptionState.NOT_FOLLOWING)return h({dispatch:r,getState:o,path:e,newValue:{subscriptionState:d.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:s},apiUpdate:()=>l.createFolderSubscription(e,s,_),onSuccess:()=>{u.showSetOptionsConfirmationSnackbar(e),t.logAction(p.WebUserActionLogEvent.FOLLOW_FOLDER,o(),e,i)},onError:()=>u.showSetOptionsErrorSnackbar(e)})},t.deleteFolderSubscription=(e,s)=>(i,r)=>{const o=r(),n=a.user(o).id;if(c.folderSubscriptionState(o,e)===d.FolderSubscriptionState.FOLLOWING)return h({dispatch:i,getState:r,path:e,newValue:{subscriptionState:d.FolderSubscriptionState.NOT_FOLLOWING},apiUpdate:()=>l.deleteFolderSubscription(e,n),onSuccess:()=>{u.showUnfollowConfirmationSnackbar(e),t.logAction(p.WebUserActionLogEvent.UNFOLLOW_FOLDER,r(),e,s)},onError:()=>u.showUnfollowErrorSnackbar(e)})},t.deleteFolderSubscriptionFromEmail=(e,s)=>(i,r)=>{const o=r(),n=a.user(o).id;return l.deleteFolderSubscription(e,n).then(()=>{u.showUnfollowConfirmationSnackbar(e),t.logAction(p.WebUserActionLogEvent.UNFOLLOW_FOLDER,o,e,{ns_id:s,origin:f.Email})},()=>u.showUnfollowErrorSnackbar(e))},t.editFolderSubscription=(e,s,i)=>(r,o)=>{const n=o(),_=a.user(n).id;if(c.folderSubscriptionState(n,e)===d.FolderSubscriptionState.FOLLOWING)return h({dispatch:r,getState:o,path:e,newValue:{subscriptionState:d.FolderSubscriptionState.FOLLOWING,followingPath:e,settings:s},apiUpdate:()=>l.editFolderSubscription(e,s,_),onSuccess:()=>{u.showSetOptionsConfirmationSnackbar(e),t.logAction(p.WebUserActionLogEvent.EDIT_FOLDER_FOLLOW_SETTINGS,o(),e,i)},onError:()=>u.showSetOptionsErrorSnackbar(e)})}})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/data/api",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/modules/clean/react/folder_subscriptions/data/types"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.editFolderSubscription=t.deleteFolderSubscription=t.createFolderSubscription=t.getFolderSubscription=void 0;t.getFolderSubscription=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/get",{identifier:e},{subjectUserId:t}).then((s=e,({subscription:e})=>{if(!e)return{subscriptionState:r.FolderSubscriptionState.NOT_FOLLOWING};const t=e.fq_path;return t!==s?{subscriptionState:r.FolderSubscriptionState.FOLLOWING_PARENT,followingPath:t}:{subscriptionState:r.FolderSubscriptionState.FOLLOWING,followingPath:t,settings:e.settings}}));var s}))},t.createFolderSubscription=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/create",{identifier:e,settings:t},{subjectUserId:r})}))},t.deleteFolderSubscription=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/delete",{identifier:e},{subjectUserId:t})}))},t.editFolderSubscription=function(e,t,r){return s.__awaiter(this,void 0,void 0,(function*(){return(new i.UserApiV2Client).ns("awareness_subscriptions").rpc("folder_subscriptions/edit",{identifier:e,settings:t},{subjectUserId:r})}))}})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/data/reducer",["require","exports","tslib","immutable","metaserver/static/js/modules/clean/react/folder_subscriptions/data/types"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderSubscriptionsReducer=t.defaultFolderSubscriptionsState=void 0,i=s.__importStar(i),t.defaultFolderSubscriptionsState={requests:i.Map(),folderSubscriptions:i.Map()},t.folderSubscriptionsReducer=function(e=t.defaultFolderSubscriptionsState,s){switch(s.type){case r.ActionTypes.OPTIMISTIC_SET_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:s,folderSubscription:i}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(s,{status:r.RequestFlightStatus.INFLIGHT}),folderSubscriptions:e.folderSubscriptions.set(s,i)})})(e,s);case r.ActionTypes.FETCHING_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:s}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(s,{status:r.RequestFlightStatus.INFLIGHT})})})(e,s);case r.ActionTypes.CONFIRM_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:s,folderSubscription:i,timestamp:a}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(s,{status:r.RequestFlightStatus.READY,lastUpdated:a}),folderSubscriptions:e.folderSubscriptions.set(s,i)})})(e,s);case r.ActionTypes.ERROR_FOLDER_SUBSCRIPTION:return(function(e,t){const{path:s,folderSubscription:i}=t.payload;return Object.assign(Object.assign({},e),{requests:e.requests.set(s,{status:r.RequestFlightStatus.ERROR}),folderSubscriptions:i?e.folderSubscriptions.set(s,i):e.folderSubscriptions})})(e,s)}return e}})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/data/selectors",["require","exports","metaserver/static/js/modules/clean/redux/selectors","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/react/folder_subscriptions/data/types","metaserver/static/js/modules/clean/react/folder_subscriptions/data/reducer"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderSubscriptions=t.folderSubscription=t.folderSubscriptionState=t.getRequestState=t.getFolderSubscriptionsState=void 0,t.getFolderSubscriptionsState=e=>s.getStateAtNamespace(e,i.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY)||a.defaultFolderSubscriptionsState,t.getRequestState=(e,s)=>t.getFolderSubscriptionsState(e).requests.get(s,{status:r.RequestFlightStatus.IDLE}),t.folderSubscriptionState=(e,s)=>{var i;return null===(i=t.folderSubscription(e,s))||void 0===i?void 0:i.subscriptionState},t.folderSubscription=(e,s)=>t.folderSubscriptions(e).get(s),t.folderSubscriptions=e=>t.getFolderSubscriptionsState(e).folderSubscriptions})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/data/store",["require","exports","metaserver/static/js/modules/clean/react/folder_subscriptions/data/reducer","metaserver/static/js/modules/clean/redux/store","metaserver/static/js/modules/clean/redux/namespaces"],(function(e,t,s,i,r){"use strict";let a;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForFolderSubscriptions=void 0,t.getStoreForFolderSubscriptions=()=>(a||(a=i.getStoreAndRegisterReducers({[r.FOLDER_SUBSCRIPTIONS_NAMESPACE_KEY]:s.folderSubscriptionsReducer})),a)})),define("metaserver/static/js/modules/clean/react/folder_subscriptions/follow/snackbar",["require","exports","tslib","react","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showFollowFailedSnackbar=t.showUnfollowErrorSnackbar=t.showUnfollowConfirmationSnackbar=t.showSetOptionsErrorSnackbar=t.showSetOptionsConfirmationSnackbar=t.showFolderSubscriptionSnackbar=void 0,i=s.__importDefault(i);const n=o.intl.formatMessage({id:"JBINyn",defaultMessage:"Close"}),l=o.intl.formatMessage({id:"Wzr+Eu",defaultMessage:"Unfollow"});function c({callToActionFn:e,isSuccess:t,message:s}){const r=t?"complete":"fail",o=t&&e?l:void 0,c=t?e:void 0,d=t&&e?void 0:n,u=i.default.createElement(a.Snackbar,{title:s,variant:r,actionButtonText:o,onActionClick:c,closeButtonText:d,timeoutDelayMs:5e3,id:"browse-action"});a.Snackbar.show(u)}t.showFolderSubscriptionSnackbar=c,t.showSetOptionsConfirmationSnackbar=function(e){c({isSuccess:!0,message:o.intl.formatMessage({id:"74emIA",defaultMessage:'Notification options for "{folderName}" have been set'},{folderName:r.filename(e)})})},t.showSetOptionsErrorSnackbar=function(e){c({isSuccess:!1,message:o.intl.formatMessage({id:"fwZe/f",defaultMessage:'Couldn\'t set options for "{folderName}"'},{folderName:r.filename(e)})})},t.showUnfollowConfirmationSnackbar=function(e){c({isSuccess:!0,message:o.intl.formatMessage({id:"nQncys",defaultMessage:'You’ll no longer get notifications about "{folderName}"'},{folderName:r.filename(e)})})},t.showUnfollowErrorSnackbar=function(e){c({isSuccess:!1,message:o.intl.formatMessage({id:"/QEApB",defaultMessage:'Unable to unfollow "{folderName}"'},{folderName:r.filename(e)})})},t.showFollowFailedSnackbar=function(e){c({isSuccess:!1,message:o.intl.formatMessage({id:"0G1Llb",defaultMessage:'Unable to follow "{folderName}"'},{folderName:e})})}})),define("metaserver/static/js/modules/clean/react/browse/actions",["require","exports","tslib","immutable","metaserver/static/js/modules/clean/file_actions/create-folder","metaserver/static/js/modules/clean/file_operations/notifications","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/flux/dispatcher","metaserver/static/js/modules/clean/history","metaserver/static/js/modules/clean/react/async_file_modal_controller","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/browse/data/action_creators/index","metaserver/static/js/modules/clean/react/browse/data/action_creators/file_actions","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/data/store","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/clean/sharing/browse_exports","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/browse/fss_experiment_carousel_util","metaserver/static/js/modules/clean/react/browse/model_types","metaserver/static/js/modules/clean/sync_everything/constants","metaserver/static/js/modules/constants/global_file_upload"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browseActions=void 0,i=s.__importStar(i),a=s.__importStar(a),o=s.__importStar(o),l=s.__importDefault(l),c=s.__importStar(c),d=s.__importStar(d),p=s.__importStar(p),_=s.__importStar(_),m=s.__importStar(m);t.browseActions=new class{constructor(){this.initializeEverything=({path:t,files:r,paginatedTotalNumFiles:a,context:l,mountPoints:c,fqPathsToSelect:d,loadingState:_,teamFolders:m,currentFolderInfo:f})=>s.__awaiter(this,void 0,void 0,(function*(){this.reduxStore.dispatch(p.setPath({path:t})),this.reduxStore.dispatch(p.appendFiles({path:t,files:[...r,...m],currentFolderInfo:f})),this.reduxStore.dispatch(p.setPaginatedTotalNumFiles({paginatedTotalNumFiles:a})),this.reduxStore.dispatch(p.setMountPoints({mountPoints:c})),this.reduxStore.dispatch(p.setLoadingState({loadingState:_,path:t})),_===g.LoadingState.LOADED?this.reduxStore.dispatch(p.selectFilesByFqPath({fqPathsToSelect:d})):this.reduxStore.dispatch(p.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:i.Set(d)})),this.reduxStore.dispatch(p.setContext({context:l})),this.reduxStore.dispatch(p.setCurrentFolderInfo({currentFolderInfo:f}));const S={path:t,hasPermissionToUploadToFolder:l.isCurrentPathWriteable(),isMovingIntoVault:l.isInsideVaultFolder};w.FILE_UPLOAD_USE_REDUX?new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/file_uploader/clean/data/slice"],t,s)}).then(s.__importStar).then(({uploadActionCreators:e})=>{this.reduxStore.dispatch(e.setPath(S))}):n.Dispatcher.dispatch({type:h.UploaderActionType.SET_PATH,data:S}),n.Dispatcher.dispatch({type:u.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:t,files:r}});const{ActionsAdapter:E}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/file_uploader/actions_adapter"],t,s)}).then(s.__importStar);E.on("uploadComplete",({filesAdded:e})=>{if(!e||0===e.length)return;const t=e.map(e=>o.normalize(e.path)+o.normalize(e.name));this.selectFilesAfterUpload({fqPathsToSelect:t})})})),this.addFilesAndSetLoadingState=({path:e,loadingState:t,files:s,paginatedTotalNumFiles:i})=>{this.reduxStore.dispatch(p.appendFiles({path:e,files:s})),this.reduxStore.dispatch(p.setPaginatedTotalNumFiles({paginatedTotalNumFiles:i})),this.reduxStore.dispatch(p.setLoadingState({loadingState:t,path:e})),n.Dispatcher.dispatch({type:u.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:e,files:s}})},this.setUrl=({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:i})=>{this.reduxStore.dispatch(p.setUrl({path:e,qargs:t,expandedBlade:s,forceExpandRightRail:i}))},this.nameNewFolder=()=>{this.reduxStore.dispatch(p.setNewFolderCreationState({newFolderCreationState:g.NewFolderCreationState.PENDING_INPUT}))},this.createFolderPending=()=>{r.logCreateFolderPending(),this.reduxStore.dispatch(p.setNewFolderCreationState({newFolderCreationState:g.NewFolderCreationState.SAVING_INPUT}))},this.cancelCreateFolder=e=>{r.logCreateFolderCancel(e),this.reduxStore.dispatch(p.setNewFolderCreationState({newFolderCreationState:g.NewFolderCreationState.CREATE_FOLDER_INACTIVE}))},this.createFolderComplete=()=>{r.logCreateFolderSuccess(),this.reduxStore.dispatch(p.setNewFolderCreationState({newFolderCreationState:g.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),S.Snackbar.complete(v.intl.formatMessage({id:"a26imc",defaultMessage:"Folder created."}),"browse-action")},this.createFolder=e=>{this.reduxStore.dispatch(p.createFolder(e))},this.createFolderInNewFolderModal=({folderName:e,isConfidential:s,user:i,context:r,redirectOnSuccess:a,redirectOnCancel:o,fqPath:n,selectCreatedFolder:l,origin:c,shouldSuppressRedirectToBrowse:d,handleSuccessSharing:u,handleCancelSharing:p})=>{const _=r?r.currentFQPath:n,m=r?r.rootNSID:i.root_ns_id;if(s&&r&&!r.isInsideTeamFolderTree)E.asyncShowNewFolderShareModal({defaultBasePath:_,initialContentName:e,onCancel:p,onSuccessSharing:u,setUrl:this.setUrl,shouldSuppressRedirectToBrowse:d,user:i});else{const n=(i.is_cdm_member||s)&&!!r&&r.isInsideTeamFolderTree;t.browseActions.createFolder({pathName:_,folderName:e,nsId:m,checkFSWs:!1,showShareModalOnSuccess:n?this.handleShowShareModal:null,redirectOnSuccess:a,redirectOnCancel:o,selectCreatedFolder:l,origin:c,user:i})}},this.handleNewFolderRedirectOnSuccess=e=>{this.setUrl({path:e})},this.doDeleteFilesWithModal=({files:e})=>{const t=m.user(this.reduxStore.getState()),i=m.context(this.reduxStore.getState());c.showDelete(t,e,i,o.filename(i.currentFQPath),()=>s.__awaiter(this,void 0,void 0,(function*(){this.reduxStore.dispatch(_.deleteFiles({files:[...e],checkFSWs:!0}))})))},this.purgeSuccessCallback=e=>{t.browseActions.reloadCurrentPath()},this.onPurgeBatch=(t,i)=>{new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/trash/actions"],t,s)}).then(s.__importStar).then(({purgeByPathBatch:e})=>{var s;const r=I.isBackupBrowse()?null===(s=m.context(this.reduxStore.getState()))||void 0===s?void 0:s.rootNSID:void 0;e(t,i,this.purgeSuccessCallback,void 0,null!=r?r:void 0)})},this.doPermanentDeleteWithModal=e=>{const t=m.user(this.reduxStore.getState()),s=m.context(this.reduxStore.getState());c.showPurgeModal({userId:t.id,context:s,files:e,onPurge:this.onPurgeBatch})},this.onRestore=(e,t,s,i)=>{d.restoreFiles({files:t,userId:e,onSuccess:()=>{a.notifyRestoreSuccess(t)},isSearchMode:s,rootNsId:i})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=m.user(this.reduxStore.getState()),s=m.context(this.reduxStore.getState());c.showUnifiedTrashModal({userId:t.id,context:s,files:e,onRestore:(e,t)=>{var i;this.onRestore(e,t,!1,null!==(i=s.rootNSID)&&void 0!==i?i:void 0)}})},this.handleShowRewindPanel=()=>{l.default.update_query_param(u.BrowseQueryArg.rewind,"true"),this.reduxStore.dispatch(p.showRewind())},this.fetchFolderSizes=({file:e})=>s.__awaiter(this,void 0,void 0,(function*(){const t=m.user(this.reduxStore.getState());let s=u.MAX_FOLDER_SIZE_ITERATIONS;try{this.reduxStore.dispatch(p.requestFolderSizes({fqPath:e.fq_path}));const i=yield d.fetchSharedFolderSizes(t.id,{fq_path:e.fq_path});this.reduxStore.dispatch(p.setFolderSizesPending({fetchFolderSizesResp:i}));let r=[],a=yield this.fetchAndSetSameNamespaceFolderSize(t.id,{fq_path:e.fq_path,folder_limit:u.MAX_FOLDERS_PER_CALL});for(a.queue&&(r=[...r,...a.queue]);r.length>0&&s>0;){s--;const i=Math.min(u.MAX_FOLDER_SIZE_QUEUE_SIZE,r.length),o=r.splice(0,i);a=yield this.fetchAndSetSameNamespaceFolderSize(t.id,{fq_path:e.fq_path,folder_limit:u.MAX_FOLDERS_PER_CALL,queue:o}),a.queue&&r&&(r=[...r,...a.queue])}const o=0!==s&&a.queue&&0===a.queue.length?b.FetchFolderSizeState.COMPLETE:b.FetchFolderSizeState.ERROR;this.reduxStore.dispatch(p.completeFolderSizes({fetchFolderSizeState:o}))}catch(t){this.reduxStore.dispatch(p.setFolderSizesPending({fetchFolderSizesResp:{sizes_dict:[{fq_path:e.fq_path,size:0}],queue:[]}})),this.reduxStore.dispatch(p.completeFolderSizes({fetchFolderSizeState:b.FetchFolderSizeState.ERROR}))}})),this.fetchMultipleFolderSizes=({files:e})=>s.__awaiter(this,void 0,void 0,(function*(){for(const t of e.toArray())yield this.fetchFolderSizes({file:t})})),this.handleShowShareModal=(e,t)=>{const s=m.user(this.reduxStore.getState()),i=m.context(this.reduxStore.getState());E.asyncShowShareModal(s,e,{browseContext:i,origin:t,onCancel:()=>{T.asyncShowFssExpr(s,e.ns_id,e.ns_path,e.is_dir)},onSuccessSharing:()=>{T.asyncShowFssExpr(s,e.ns_id,e.ns_path,e.is_dir)}},this.setUrl)},this.showOnboardingChecklistShareButtonTooltip=e=>{this.reduxStore.dispatch(p.showOnboardingChecklistShareButtonTooltip(e))},this.setFullFunnelM2Overrides=e=>{this.reduxStore.dispatch(p.setFullFunnelM2Overrides(e))},this.reduxStore=f.getStoreForBrowse()}reloadCurrentPath(){this.setUrl({path:m.path(this.reduxStore.getState()),qargs:{reload:!0}})}selectRowsFromBoltClient(e=[]){this.reduxStore.dispatch(p.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:i.Set(e.map(e=>e.fq_path))}))}selectFilesAfterUpload({fqPathsToSelect:e}){const t=m.unsortedFilesWithFolderSizes(this.reduxStore.getState());e.every(e=>t.has(e))?this.reduxStore.dispatch(p.selectFilesByFqPath({fqPathsToSelect:e})):this.reduxStore.dispatch(p.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:i.Set(e)}))}selectFilesByFqPath({fqPathsToSelect:e}){this.reduxStore.dispatch(p.selectFilesByFqPath({fqPathsToSelect:e}))}setShouldShowDeletedFiles({shouldShowDeletedFiles:e}){e?l.default.update_query_param(u.BrowseQueryArg.d,"1"):l.default.remove_query_param(u.BrowseQueryArg.d)}fetchAndSetSameNamespaceFolderSize(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=yield d.fetchSameNamespaceFolderSizes(e,t);return this.reduxStore.dispatch(p.setFolderSizesPending({fetchFolderSizesResp:s})),s}))}}})),define("metaserver/static/js/modules/clean/react/browse/api",["require","exports","tslib","lodash","metaserver/static/js/modules/clean/deprecated_ajax/ajax","metaserver/static/js/api_v2/user_client","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/core/html","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify","metaserver/static/js/modules/core/uri","metaserver/static/js/modules/clean/sharing/api/client","metaserver/static/js/modules/clean/sync_everything/constants"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m){"use strict";function f(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function h(e){if(void 0===e)return{};const t={};for(const s of e)void 0!==s.ns_id&&void 0!==s.mount_point&&(t[s.ns_id]=s.mount_point);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getFolderMemberCounts=t.fetchSameNamespaceFolderSizes=t.fetchSharedFolderSizes=t.getChangesForDirectory=t.createCloudDoc=t.rollbackChangeSets=t.restoreFiles=t.moveFiles=t.isRewindButtonEnabled=t.copyFiles=t.loadPath2Continue=t.loadPath2=void 0,i=s.__importStar(i),r=s.__importStar(r),o=s.__importStar(o),t.loadPath2=function(e){var t,i,r,o;return s.__awaiter(this,void 0,void 0,(function*(){const{userId:s,rootNsId:c,path:d,sortType:u,sortIsAscending:p,includeDeleted:_}=e,m=new a.UserApiV2Client,f=yield m.ns("files").rpc("browse",{root_ns_id:c,fq_path:d,include_deleted:_,sort_type:u,sort_is_ascending:p,sort_folders_first:!0,include_xattrs:!0,include_folder_overview:!0},{subjectUserId:s});return l.assert(void 0!==f.context,"context is undefined"),l.assert(void 0!==f.paginated_file_info,"paginated_file_info is undefined"),l.assert(void 0!==f.total_count,"total_count is undefined"),{folderOverview:null!==(t=f.folder_overview)&&void 0!==t?t:null,mountPoints:h(f.context.ns_id_infos),context:n.BrowseContext.fromApiV2Object(f.context),items:f.paginated_file_info.map(e=>e.file_info),hasMore:null!==(i=f.has_more)&&void 0!==i&&i,nextRequestVoucher:null!==(r=f.next_request_voucher)&&void 0!==r?r:null,paginatedTotalNumFiles:f.total_count,currentFolderInfo:null===(o=f.folder_info)||void 0===o?void 0:o.file_info}}))},t.loadPath2Continue=function(e,t){return(new a.UserApiV2Client).ns("files").rpc("browse_continue",{cursor:e},{subjectUserId:t})},t.copyFiles=function(e){const{files:t,newPath:s,userId:i,onSuccess:a,checkFSWs:o}=e,l=t.map(e=>e.fq_path);return l.includes(s)?(u.Notify.error(d.intl.formatMessage({id:"wWiDtY",defaultMessage:"You can’t copy a folder into itself."})),!1):(r.WebProgressRequest({url:"/cmd/copy",data:{files:l,to_path:s,fsw_request:o?"check":void 0},dataType:"text",subject_user:i,progress_text:d.intl.formatMessage({id:"AZPIG5",defaultMessage:"Copying files..."}),success(e,t){try{const e=JSON.parse(t),i=e.new_browse_files?e.new_browse_files.map(n.File.fromServerObject):[];a({newFiles:i,destinationPath:s,changesets:e.changesets,failureDetails:e.failure_details})}catch(e){}}}),!0)},t.isRewindButtonEnabled=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{return"/"===e&&(e=""),(new a.UserApiV2Client).ns("chronicle").rpc("can_rewind",{path:e,version:2},{subjectUserId:t})}catch(e){return{can_rewind:!1}}}))},t.moveFiles=function(e){const{path:t,files:s,newPath:i,userId:a,onSuccess:l,allowOwnershipTransfer:p,checkFSWs:_}=e;if(void 0!==t&&o.paths_are_equal(t,i))return u.Notify.error(d.intl.formatMessage({id:"V6/bVk",defaultMessage:"Those files already exist in that folder."})),!1;const m=s.map(e=>e.fq_path);return m.includes(i)?(u.Notify.error(d.intl.formatMessage({id:"blAaiJ",defaultMessage:"You can’t move a folder into itself."})),!1):(r.WebProgressRequest({url:"/cmd/move",data:{files:m,to_path:i,allow_ownership_transfer:p,fsw_request:_?"check":void 0},dataType:"text",subject_user:a,progress_text:d.intl.formatMessage({id:"FdTkAn",defaultMessage:"Moving files..."}),skipNotifyError:!p,success(e,s){try{const e=JSON.parse(s),r=e.new_browse_files?e.new_browse_files.map(n.File.fromServerObject):[];l({path:t,destinationPath:i,newFiles:r,changesets:e.changesets,failureDetails:e.failure_details})}catch(e){}},error:(t,s,i)=>{u.Notify.error(new c.HTML(i.message)),e.onError&&e.onError(i.message)}}),!0)},t.restoreFiles=function(e){const{files:t,userId:s,onSuccess:i,isSearchMode:a,rootNsId:o}=e;r.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(e=>e.fq_path),source:a?"search":"browse",backup_ns_id:m.isBackupBrowse()&&o?o:void 0},dataType:"text",subject_user:s,progress_text:d.intl.formatMessage({id:"kBkLSN",defaultMessage:"Restoring…"}),success(){i()}})},t.rollbackChangeSets=function(e){const{userId:t,changesets:s=null,progressText:i,onSuccess:a}=e;r.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(s)},dataType:"text",subject_user:t,progress_text:i,success(){a()}})},t.createCloudDoc=function(e){const{pathName:t,title:s,documentType:i,userId:a,onSuccess:o,onError:l,checkFSWs:c,actionSource:d}=e,u=`${t}/${s}.${i}`.replace("//","/");r.WebRequest({url:new p.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:a,data:{to_path:u,title:s,fsw_request:c?"check":void 0,action_source:d},dataType:"text",success(e,t){const s=f(t);if(s){const e=s.new_browse_files?n.File.fromServerObject(s.new_browse_files[0]):null;o({changesets:null,createdFile:e,failureDetails:s.failure_details})}},error(e,t,s){l(s.message)},skipNotifyError:!0})},t.getChangesForDirectory=function(e){const{path:t,userId:s,namespaceToJournalIdMap:a,onSuccess:o,includeDeletedFiles:n}=e,l={fq_dir:"/"===t?"":t,ns_map:i.map(a,(e,t)=>`${t}_${e}`).join(","),show_deleted:!!n},c=new AbortController;return r.WebRequest({url:"/update/list_dir",subject_user:s,data:l,dataType:"text",signal:c.signal,success(e,t){const s=f(t);s&&o(s)}}),c},t.fetchSharedFolderSizes=function(e,t){return(new a.UserApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})},t.fetchSameNamespaceFolderSizes=function(e,t){return(new a.UserApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})},t.getFolderMemberCounts=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=new _.FolderShareApiClient({userId:t,client:new a.UserApiV2Client}),i=yield s.getMemberCounts({contentId:e});return i?i.total_unique_users:0}catch(e){return 0}}))}})),define("metaserver/static/js/modules/clean/react/browse/async_extensions",["require","exports","tslib","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/clean/redux/store"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncExtensions=void 0;t.asyncExtensions=new class{constructor(){this.initOnce=!1,this.emptyState={},this.sharingServiceInfo=()=>this.emptyState,this.getFeatureFlags=()=>this.emptyState,this.initializeStore=(e,t)=>(this.files=t,this.user=e,r.getStoreAndRegisterReducers({}))}init(){this.initOnce||(i.waitForTTI().then(()=>this.loadExtensionsStore()),this.initOnce=!0)}loadExtensionsStore(){return s.__awaiter(this,void 0,void 0,(function*(){const[{getStore:t,initializeStore:i},{sharingServiceInfo:r,getFeatureFlags:a}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/extensions/data/store"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/extensions/data/selectors"],t,s)}).then(s.__importStar)]);t(),this.sharingServiceInfo=r,this.getFeatureFlags=a,this.initializeStore=i,this.user&&this.initializeStore(this.user,this.files)}))}}})),define("metaserver/static/js/modules/clean/react/browse/crypto_subtle_digest",["require","exports","tslib"],(function(e,t,s){"use strict";function i(e){if(t.windowHasCryptoSubtleDigest())return new Promise(t=>{window.crypto.subtle.digest("SHA-256",e).then(t)});throw new Error("window.crypto.subtle.digest not available")}Object.defineProperty(t,"__esModule",{value:!0}),t.hashString=t.encryptArrayBuffer=t.windowHasCryptoSubtleDigest=void 0,t.windowHasCryptoSubtleDigest=()=>!!window.crypto.subtle&&!!window.crypto.subtle.digest,t.encryptArrayBuffer=i,t.hashString=function(e){return s.__awaiter(this,void 0,void 0,(function*(){if(!t.windowHasCryptoSubtleDigest()||void 0===window.TextEncoder||void 0===window.TextDecoder)return null;try{const t=yield i((new TextEncoder).encode(e));return new TextDecoder("utf-16").decode(t)}catch(e){return null}}))}})),define("metaserver/static/js/modules/clean/react/browse/data/action_creators/index",["require","exports","tslib","lodash","immutable","metaserver/static/js/dropbox/proto/hql_events/browse/web_browse","spectrum-sharing/utils/sharing_constants","metaserver/static/js/modules/clean/file_actions/create-folder","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/filetypes","metaserver/static/js/modules/clean/flux/dispatcher","metaserver/static/js/modules/clean/history","metaserver/static/js/modules/clean/tagging/experiments","metaserver/static/js/modules/clean/hql/index","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/clean/react/browse/async_extensions","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/browse/crypto_subtle_digest","metaserver/static/js/modules/clean/react/browse/data/folder_overview_selectors","metaserver/static/js/modules/clean/react/browse/data/helpers","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/data/types","metaserver/static/js/modules/clean/react/browse/logger_util","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/browse/uri_helper","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/react/files_view/data/action_creators","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/file_actions/file_from_metadata","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/folder_overview/data/action_creators","metaserver/static/js/modules/clean/react/selection","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/clean/redux/tests/store","metaserver/static/js/modules/clean/tagging/experiments","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/constants/trademark","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/uri","metaserver/static/js/modules/clean/react/browse/right_rail_preferences","metaserver/static/js/modules/clean/tagging/data/action_creators","metaserver/static/js/modules/clean/sync_everything/constants","metaserver/static/js/modules/constants/global_file_upload"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w,C,O,F,R,A,y,D,M,N,L,P,j,U,x,k,V,B,W,H,G,q){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCreateMenuOpenRequest=t.setBackupFolders=t.setOverflowMenuCloseRequest=t.setInlineOverflowMenuOpenRequest=t.setOverflowMenuCoordinates=t.setOverflowMenuOpenRequest=t.expandBlade=t.setFileHasAutomatedRuleMap=t.setRightRailIsCollapsed=t.setHideFilesAndSidebar=t.setViewType=t.showOnboardingChecklistShareButtonTooltip=t.showPersonalizationSuggestedFolders=t.setFullFunnelM2Overrides=t.setArePostTTIModulesLoaded=t.setIsFileViewerShown=t.appendFiles=t.applyBoltUpdates=t.completeFolderSizes=t.setFolderSizesPending=t.requestFolderSizes=t.setUnsortedFiles=t.setAndStoreSortOrder=t.setShouldShowDeletedFiles=t.clearSelection=t.setSelection=t.setPathData=t.setPath=t.setUrl=t.setPaginatedTotalNumFiles=t.setNewFolderCreationState=t.setMountPoints=t.setLoadingState=t.setFolderSizes=t.createFolder=t.refreshPinnedItems=t.toggleSpacesEntryPoint=t.hideFolderHistoryPanel=t.showFolderHistoryPanel=t.hideRewind=t.showRewind=t.setFolderMemberCounts=t.setIsRewindButtonEnabled=t.setFilePathsToSelectOnNextUpdate=t.resetFileJumpFilter=t.addFileJumpKeyCode=t.setBrowsePostTTIData=t.setBrowsePostTTIExperiments=t.setCurrentFolderInfo=t.setContext=t.pasteFilesFromClipboard=t.setFilesToClipboard=t.setCanDisplayFolderSizes=t.selectFilesByFqPath=t.popBoltIgnore=t.pushBoltIgnore=t.handleAppCleanup=t.appInit=void 0,i=s.__importStar(i),r=s.__importStar(r),n=s.__importStar(n),l=s.__importStar(l),u=s.__importDefault(u),f=s.__importStar(f),E=s.__importStar(E),T=s.__importStar(T),I=s.__importStar(I),F=s.__importStar(F),R=s.__importStar(R),W=s.__importStar(W),t.appInit=({props:e,user:t,viewer:s})=>i=>{i({type:b.ActionTypes.APP_INIT,payload:{props:e,user:t,viewer:s}}),i(F.loadScopedSortOrders({user:t,defaultSort:{sortField:D.SortField.FILENAME,sortDirection:D.SortDirection.ASCENDING}})),d.Dispatcher.dispatch({type:O.UploaderActionType.SET_USER,data:{user:t}})},t.handleAppCleanup=()=>({type:b.ActionTypes.HANDLE_APP_CLEANUP}),t.pushBoltIgnore=e=>({type:b.ActionTypes.PUSH_BOLT_IGNORE,payload:e}),t.popBoltIgnore=e=>({type:b.ActionTypes.POP_BOLT_IGNORE,payload:e}),t.selectFilesByFqPath=({fqPathsToSelect:e})=>({type:b.ActionTypes.SELECT_FILES_BY_FQ_PATH,payload:{fqPathsToSelect:e}}),t.setCanDisplayFolderSizes=({canDisplayFolderSizes:e})=>({type:b.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES,payload:{canDisplayFolderSizes:e}});const z=({clipboard:e})=>({type:b.ActionTypes.SET_CLIPBOARD_FILES,payload:{clipboard:e}});t.setFilesToClipboard=({clipboard:e})=>t=>{const{files:s}=e;s.length&&(s.some(e=>e.isDeleted||e.is_unmounted)?L.Snackbar.fail(V.intl.formatMessage({id:"jdnaZR",defaultMessage:"Deleted files cannot be added to the clipboard"}),"browse-clipboard-copy"):s.some(w.File.isTeamSharedFolder)||s.some(w.File.isTeamMemberFolder)?L.Snackbar.fail(V.intl.formatMessage({id:"0Nkg/N",defaultMessage:"Team Folders cannot be added to the clipboard"}),"browse-clipboard-copy"):s.some(w.File.isFamilySharedFolder)?L.Snackbar.fail(V.intl.formatMessage({id:"KMcV0/",defaultMessage:"Family shared folders cannot be added to the clipboard"}),"browse-clipboard-copy"):s.some(e=>e.type===c.FileTypes.VAULT_FOLDER)?L.Snackbar.fail(V.intl.formatMessage({id:"La991r",defaultMessage:"{TRADEMARK_VAULT} cannot be added to the clipboard"},{TRADEMARK_VAULT:x.TRADEMARK_VAULT}),"browse-clipboard-copy"):(L.Snackbar.complete(V.intl.formatMessage({id:"BvUPS9",defaultMessage:"{count, plural, one{Added {count} item to clipboard.} other{Added {count} items to clipboard.}}"},{count:s.length}),"browse-clipboard-copy"),t(z({clipboard:e}))))},t.pasteFilesFromClipboard=({copyFiles:e,moveFiles:t})=>(s,i)=>{const r=i(),a=T.user(r),{files:o,action:n}=T.clipboard(i()),c=T.path(i());o.length<=0||("cut"===n?(l.paths_are_equal(l.parent_dir(o[0].fq_path),c)||t({user:a,files:o,newPath:"/"===c?"":c,checkFSWs:!0}),s(z({clipboard:{files:[]}}))):e({user:a,files:o,newPath:c,checkFSWs:!0,isPasteAction:!0,onSuccess:e=>{}}))},t.setContext=({context:e})=>({type:b.ActionTypes.SET_CONTEXT,payload:{context:e}}),t.setCurrentFolderInfo=({currentFolderInfo:e})=>({type:b.ActionTypes.SET_CURRENT_FOLDER_INFO,payload:{currentFolderInfo:e}}),t.setBrowsePostTTIExperiments=({browsePostTTIExperiments:e})=>({type:b.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS,payload:{browsePostTTIExperiments:e}}),t.setBrowsePostTTIData=({browsePostTTIData:e})=>{const t=Object.assign({},e);return Object.keys(t).forEach(e=>{void 0===t[e]&&delete t[e]}),{type:b.ActionTypes.SET_BROWSE_POST_TTI_DATA,payload:{browsePostTTIData:t}}};const K=({fileJumpFilter:e})=>({type:b.ActionTypes.SET_FILE_JUMP_FILTER,payload:{fileJumpFilter:e}});t.addFileJumpKeyCode=({keyChar:e})=>(s,i)=>{const r=T.fileJumpFilter(i())+e.toLowerCase();s(K({fileJumpFilter:r}));let a=null;const o=T.fileJumpIndex(i());for(const{fqPath:e,filename:t}of o)if(t>=r){a=e;break}null!=a&&s(t.selectFilesByFqPath({fqPathsToSelect:[a]}))},t.resetFileJumpFilter=()=>(e,t)=>{m.logKeyboardShortcutUsage({user_id:T.user(t()).id,keyboard_shortcut_type:"jump",view_type:R.selectViewType(t(),{instanceId:g.BROWSE_FILES_VIEW_ID})}),e(K({fileJumpFilter:""}))},t.setFilePathsToSelectOnNextUpdate=({filePathsToSelectOnNextUpdate:e})=>({type:b.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,payload:{filePathsToSelectOnNextUpdate:e}}),t.setIsRewindButtonEnabled=e=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const{path:s,userId:i,userSkuHasRewind:r}=e;if(!r)return void t({type:b.ActionTypes.SET_IS_REWIND_ENABLED,payload:{value:!0}});const a=yield f.isRewindButtonEnabled(s,i);t({type:b.ActionTypes.SET_IS_REWIND_ENABLED,payload:{value:!!a.can_rewind}})})),t.setFolderMemberCounts=e=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const{contentId:s,userId:r}=e;let a;a=T.isInsideBackupFolder(i())?1:yield f.getFolderMemberCounts(s,r),t({type:b.ActionTypes.SET_FOLDER_MEMBER_COUNTS,payload:{value:a}})})),t.showRewind=()=>({type:b.ActionTypes.SHOW_TIMELINE,payload:{timestamp:(new Date).getTime()}}),t.hideRewind=()=>({type:b.ActionTypes.HIDE_TIMELINE,payload:{}}),t.showFolderHistoryPanel=()=>({type:b.ActionTypes.SHOW_FOLDER_HISTORY_PANEL,payload:{timestamp:(new Date).getTime()}}),t.hideFolderHistoryPanel=()=>({type:b.ActionTypes.HIDE_FOLDER_HISTORY_PANEL,payload:{}}),t.toggleSpacesEntryPoint=({value:e})=>({type:b.ActionTypes.TOGGLE_SPACES_ENTRY_POINT,payload:{value:e}}),t.refreshPinnedItems=()=>(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=E.folderOverviewFolderFileId(t());e(M.reloadContentReferences({folderFileId:s,componentNamespace:g.BrowseFolderOverviewComponentNamespace}))})),t.createFolder=({pathName:e,folderName:i,user:r,checkFSWs:a,showShareModalOnSuccess:l,redirectOnSuccess:c,redirectOnCancel:d,selectCreatedFolder:u=!0,origin:p})=>(_,m)=>s.__awaiter(void 0,void 0,void 0,(function*(){_(t.setNewFolderCreationState({newFolderCreationState:y.NewFolderCreationState.SAVING_INPUT}));const s=yield n.createFolder({destination:e,name:i,user:r,checkFsw:a,origin:p,surface:"browse"});if(_(t.setNewFolderCreationState({newFolderCreationState:y.NewFolderCreationState.CREATE_FOLDER_INACTIVE})),"success"===s.type){const e=A.folderFromFolderMetadata(s.folder);u&&_(t.selectFilesByFqPath({fqPathsToSelect:[e.fq_path]})),c&&c(e.fq_path),l&&l(e,o.SHARE_ACTION_ORIGIN_TYPE.BROWSE_NEW_FOLDER_MODAL)}else d&&d()})),t.setFolderSizes=({folderSizes:e})=>({type:b.ActionTypes.SET_FOLDER_SIZES,payload:{folderSizes:e}}),t.setLoadingState=({loadingState:e,path:t})=>({type:b.ActionTypes.SET_LOADING_STATE,payload:{loadingState:e,path:t}}),t.setMountPoints=({mountPoints:e})=>({type:b.ActionTypes.SET_MOUNT_POINTS,payload:{mountPoints:e}}),t.setNewFolderCreationState=({newFolderCreationState:e})=>({type:b.ActionTypes.SET_NEW_FOLDER_CREATION_STATE,payload:{newFolderCreationState:e}}),t.setPaginatedTotalNumFiles=({paginatedTotalNumFiles:e})=>({type:b.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES,payload:{paginatedTotalNumFiles:e}}),t.setUrl=({path:e="",qargs:s,expandedBlade:r="info",forceExpandRightRail:a=!1})=>(o,n)=>{u.default.push_state(T.urlPrefix(n())+B.URI.encode_parts(e),i.omitBy(Object.assign(Object.assign({},i.pick(C.getQueryArgs(),["d"])),s),i.isUndefined)),o(t.clearSelection({skipLogging:!0})),o(t.expandBlade(r)),a&&o(t.setRightRailIsCollapsed(!1))},t.setPath=({path:e})=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){t({type:b.ActionTypes.SET_PATH,payload:{path:e}});const s=yield S.hashString(e);s||k.reportException({err:new Error("hashString returned null"),tags:["browse"],severity:k.SEVERITY.NONCRITICAL}),t({type:b.ActionTypes.SET_VIEW_SCOPE,payload:{viewScope:s}}),e&&(document.title=G.isBackupBrowse()?V.intl.formatMessage({id:"IePl0Y",defaultMessage:"{folder_name} - Dropbox Backup"},{folder_name:l.filename(e,V.intl.formatMessage({id:"UwzCW9",defaultMessage:"Backups"}))}):V.intl.formatMessage({id:"dbYCaa",defaultMessage:"{folder_name} - Dropbox"},{folder_name:l.filename(e,V.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"}))}))})),t.setPathData=({path:i,files:a,paginatedTotalNumFiles:o,context:n,currentFolderInfo:c})=>(u,p)=>{if(!l.paths_are_equal(i,T.path(p())))return;const _=r.Map(a.map(e=>[e.fq_path,e]));u(t.setContext({context:n})),u(t.setCurrentFolderInfo({currentFolderInfo:c})),t.setUnsortedFiles({unsortedFiles:_})(u,p,P.mockExtraArguments),u(t.setPaginatedTotalNumFiles({paginatedTotalNumFiles:o})),u(t.clearSelection({skipLogging:!0})),Y({unsortedFiles:_})(u,p,P.mockExtraArguments),j.isFetchTagsOnBrowseEnabled(T.manualTaggingVariant(p()))&&u(H.fetchTagsForFiles({user:T.user(p()),files:c?[...a,c]:[...a],override:!0})),setTimeout(()=>{d.Dispatcher.dispatch({type:g.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:i,files:a}});const t={path:i,hasPermissionToUploadToFolder:n.isCurrentPathWriteable(),isMovingIntoVault:n.isInsideVaultFolder};q.FILE_UPLOAD_USE_REDUX?new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/file_uploader/clean/data/slice"],t,s)}).then(s.__importStar).then(({uploadActionCreators:e})=>{u(e.setPath(t))}):d.Dispatcher.dispatch({type:O.UploaderActionType.SET_PATH,data:t})},1)},t.setSelection=({selection:e,actionSource:t,skipLogging:s})=>(i,r)=>{if(!s){const s=r(),{event:i,itemId:o}=I.makeSelectionEvent(T.selection(s),e),n=T.selectFileByFullPath(s,{path:o}),{browseWebHqlPilot:l}=T.experiments(s);if(n){const{num_files_selected:o,num_folders_selected:c}=I.countFilesAndFolders(T.selectFilesForSelection(s,{selection:e}));l&&i===U.WebUserActionLogEvent.SELECT_ROW&&_.logEvent(a.hql_events.WebBrowseSelectRow.create({actionSource:t})),m.logBrowseAction({uid:T.user(s).id,action:i,action_source:t,num_files_selected:o,num_folders_selected:c,view_type:R.selectViewType(r(),{instanceId:g.BROWSE_FILES_VIEW_ID}),result:n,extra:{entity_type:n.is_dir?"folder":"file"}})}}i({type:b.ActionTypes.SET_SELECTION,payload:{selection:e,actionSource:t}}),J(i,r,e)},t.clearSelection=({actionSource:e,skipLogging:s}={})=>t.setSelection({actionSource:e,skipLogging:s,selection:N.createSelection()}),t.setShouldShowDeletedFiles=({shouldShowDeletedFiles:e})=>({type:b.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES,payload:{shouldShowDeletedFiles:e}});t.setAndStoreSortOrder=e=>(t,s)=>{const i=s(),r=T.user(i);m.logSortRecords({uid:r.id,sort_by:e.sortField,sort_direction:e.sortDirection,view_type:R.selectViewType(i,{instanceId:g.BROWSE_FILES_VIEW_ID})}),t(F.setSort({user:r,sort:e,viewScope:R.selectViewTypeScope(i,{instanceId:g.BROWSE_FILES_VIEW_ID}),updateGlobalScope:!0})),t((({sortOrder:e})=>({type:b.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:e}}))({sortOrder:e}))},t.setUnsortedFiles=({unsortedFiles:e})=>(t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=T.user(i());t({type:b.ActionTypes.SET_UNSORTED_FILES,payload:{unsortedFiles:e}}),h.asyncExtensions.initializeStore(s,e.toArray())})),t.requestFolderSizes=({fqPath:e})=>({type:b.ActionTypes.REQUEST_FOLDER_SIZES,payload:{fqPath:e}}),t.setFolderSizesPending=({fetchFolderSizesResp:e})=>({type:b.ActionTypes.SET_FOLDER_SIZES_PENDING,payload:{fetchFolderSizesResp:e}}),t.completeFolderSizes=({fetchFolderSizeState:e})=>({type:b.ActionTypes.COMPLETE_FOLDER_SIZES,payload:{fetchFolderSizeState:e}}),t.applyBoltUpdates=({path:e,updates:s})=>(i,r)=>{const{parent_changes:a}=s,o=T.user(r());if(l.paths_are_equal(e,T.path(r()))){if(a&&a.change_to_fq_path)return v.showUserNotificationForPathChange(o,a),void t.setUrl({path:a.change_to_fq_path})(i,r,P.mockExtraArguments);(function(e,s,i){const{mount_points:r}=i,a=T.path(s()),[o,n]=v.getMountPointUpdateForCurrentPath(r,a,T.mountPoints(s()));o&&!n&&L.Snackbar.complete(V.intl.formatMessage({id:"QB9ZqK",defaultMessage:"The folder was unshared."}),"browse-unshare");const l=v.getPathForNewMountPoint(o,n,a);if(l)return void e(t.setPath({path:l}));e(t.setMountPoints({mountPoints:r}))})(i,r,s),(function(e,s,i){const{added:r,moved:a,removed:o}=i,n=T.path(s());let c=T.unsortedFiles(s()),u=T.folderSizes(s()),p=c.size;const _={added:new Set([]),moved:new Set([]),removed:new Set([])};e(t.popBoltIgnore(_)),c=c.withMutations(e=>{u=u.withMutations(t=>{const s=t=>{(e=>l.paths_are_equal(l.parent_dir(e.fq_path),n))(t)&&(e.set(t.fq_path,w.File.fromServerObject(t)),p+=1)},i=(i,r)=>{const a=e.get(i);if(a&&a.sjid>=r.sjid&&i===r.fq_path)return;e.remove(i),s(r);const o=t.get(i);o&&(t.remove(i),t.set(r.fq_path,o))},c=s=>{e.remove(s),t.remove(s),p-=1};for(const t of r)e.has(t.fq_path)?i(t.fq_path,t):s(t);for(const[t,r]of a)e.has(t)?i(t,r):s(r);for(const t of o){const s=e.find(e=>e.fq_path.toLowerCase()===t.toLowerCase());s&&c(s.fq_path)}})}),c.size!==p&&k.reportException({err:new Error("applyBoltUpdates ended up with unexpected number of items"),tags:["browse_file_collections_mismatch"],severity:k.SEVERITY.CRITICAL,exc_extra:{expected_unsorted_files_size:p,actual_unsorted_files_size:c.size,is_deleted_files_on:T.shouldShowDeletedFiles(s()),filesAdded:r,filesRemoved:o,filesMove:a}});c!==T.unsortedFiles(s())&&(t.setUnsortedFiles({unsortedFiles:c})(e,s,P.mockExtraArguments),d.Dispatcher.dispatch({type:g.SharedWithActionType.BROWSE_FILES_UPDATED,data:{parentPath:n,files:c.toArray()}}));u!==T.folderSizes(s())&&e(t.setFolderSizes({folderSizes:u}));Y({unsortedFiles:c})(e,s,P.mockExtraArguments)})(i,r,s),p.isTaggingEnabled(T.manualTaggingVariant(r()))&&(function(e,t,s,i){if(0===s.moved.length)return;const r=[];for(const e of s.moved){const{fq_path:s}=e[1],i=T.selectFileByFullPath(t(),{path:s});void 0!==i&&r.push(i)}e(H.fetchTagsForFiles({user:i,files:r}))})(i,r,s,o)}};const Y=({unsortedFiles:e})=>(s,i)=>{const a=T.filePathsToSelectOnNextUpdate(i()).toArray(),o=a.filter(t=>e.has(t)),n=a.filter(t=>!e.has(t));0!==o.length&&(s(t.selectFilesByFqPath({fqPathsToSelect:o})),s(t.setFilePathsToSelectOnNextUpdate({filePathsToSelectOnNextUpdate:r.Set(n)})))};t.appendFiles=({path:e,files:s,currentFolderInfo:i})=>(a,o)=>{if(!l.paths_are_equal(e,T.path(o())))return;const n=T.unsortedFiles(o()).size,c=T.unsortedFiles(o()).merge(r.Map(s.map(e=>[e.fq_path,e])));t.setUnsortedFiles({unsortedFiles:c})(a,o,P.mockExtraArguments),Y({unsortedFiles:c})(a,o,P.mockExtraArguments),j.isFetchTagsOnBrowseEnabled(T.manualTaggingVariant(o()))&&(i=null!=i?i:T.getCurrentFolderInfo(o()),a(H.fetchTagsForFiles({user:T.user(o()),files:i?[...s,i]:[...s],override:0===n}))),setTimeout(()=>{d.Dispatcher.dispatch({type:g.SharedWithActionType.BROWSE_FILES_LOADED,data:{parentPath:e,files:s}})},1),c.size!==n+s.length&&k.reportException({err:new Error("appendFiles ended up with unexpected number of files."),tags:["browse_file_collections_mismatch"],severity:k.SEVERITY.CRITICAL,exc_extra:{previous_unsorted_files_size:n,incoming_files_size:s.length,updated_unsorted_files_size:c.size,is_deleted_files_on:T.shouldShowDeletedFiles(o())}})},t.setIsFileViewerShown=({isShown:e})=>({type:b.ActionTypes.SET_IS_FILE_VIEWER_SHOWN,payload:{isShown:e}}),t.setArePostTTIModulesLoaded=({arePostTTIModulesLoaded:e})=>({type:b.ActionTypes.SET_ARE_POST_TTI_MODULES_LOADED,payload:{arePostTTIModulesLoaded:e}});const J=(e,t,s)=>{if(!s||0===s.selected.count())return;const i=T.unsortedFiles(t()),r=null==i?void 0:i.filter(e=>s.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl),a=[];if(null==r||r.forEach(e=>{a.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})}),a.length>0){const s=T.user(t()).id;e(F.loadPreviewThumbnails(a,s,g.BROWSE_FILES_VIEW_ID))}};t.setFullFunnelM2Overrides=e=>({type:b.ActionTypes.SET_FULL_FUNNEL_M2_OVERRIDES,payload:{fullFunnelM2Overrides:e}}),t.showPersonalizationSuggestedFolders=e=>({type:b.ActionTypes.SHOW_PERSONALIZATION_SUGGESTED_FOLDERS,payload:{showSuggestedFolders:e}}),t.showOnboardingChecklistShareButtonTooltip=e=>({type:b.ActionTypes.SHOW_ONBOARDING_CHECKLIST_SHARE_BUTTON_TOOLTIP,payload:{showOnboardingChecklistShareButtonTooltip:e}}),t.setViewType=e=>(t,s)=>{const i=s();t(F.setViewType({user:T.user(i),viewType:e,viewTypeScope:T.selectViewTypeScope(i),updateGlobalScope:!0}))},t.setHideFilesAndSidebar=({shouldHideFilesAndSidebar:e})=>({type:b.ActionTypes.SET_HIDE_FILES_AND_SIDEBAR,payload:{shouldHideFilesAndSidebar:e}}),t.setRightRailIsCollapsed=e=>(t,s)=>{const i=T.user(s());t({type:b.ActionTypes.SET_RIGHTRAIL_IS_COLLAPSED,payload:{collapsed:e}}),W.setIsCollapsed(i.id,e)},t.setFileHasAutomatedRuleMap=({fileHasAutomatedRuleMap:e})=>({type:b.ActionTypes.SET_FILE_HAS_AUTOMATED_RULE_MAP,payload:{fileHasAutomatedRuleMap:e}}),t.expandBlade=e=>({type:b.ActionTypes.SET_EXPANDED_BLADE,payload:{expandedBlade:e}}),t.setOverflowMenuOpenRequest=e=>({type:b.ActionTypes.SET_OVERFLOW_MENU_OPEN_REQUEST,payload:{overflowMenuOpenRequest:e}}),t.setOverflowMenuCoordinates=e=>({type:b.ActionTypes.SET_OVERFLOW_MENU_COORDINATES,payload:{overflowMenuCoordinates:e}}),t.setInlineOverflowMenuOpenRequest=e=>({type:b.ActionTypes.SET_INLINE_OVERFLOW_MENU_OPEN_REQUEST,payload:{inlineOverflowMenuOpenRequest:e}}),t.setOverflowMenuCloseRequest=e=>({type:b.ActionTypes.SET_OVERFLOW_MENU_CLOSE_REQUEST,payload:{overflowMenuCloseRequest:e}}),t.setBackupFolders=t=>(i,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(null!==T.backupFolders(r()))return;const{fetchBackups:a}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/sync_everything/api"],t,s)}).then(s.__importStar),o=yield a(t);i({type:b.ActionTypes.SET_BACKUP_FOLDERS,payload:{backupFolders:o.map(e=>e.browsePath.substring(e.browsePath.indexOf("/",1)))}})})),t.setCreateMenuOpenRequest=e=>({type:b.ActionTypes.SET_CREATE_MENU_OPEN_REQUEST,payload:{createMenuOpenRequest:e}})})),define("metaserver/static/js/modules/clean/react/browse/data/action_creators/file_actions",["require","exports","tslib","metaserver/static/js/modules/clean/file_actions/metrics","metaserver/static/js/modules/clean/file_actions/strings","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/metrics/index","metaserver/static/js/modules/clean/react/async_file_modal_controller","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/browse/data/action_creators/index","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/logger_util","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/data/action_creators","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/file_actions/api_v2","metaserver/static/js/modules/clean/react/files_view/file_actions/file_from_metadata","metaserver/static/js/modules/clean/react/files_view/file_actions/rollback","metaserver/static/js/modules/clean/react/files_view/file_actions/snackbars","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/tagging/data/action_creators","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/clean/undo","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renameFile=t.renameUndo=t.deleteFiles=void 0,a=s.__importStar(a),n=s.__importStar(n),u=s.__importStar(u),p=s.__importStar(p),m=s.__importStar(m),f=s.__importStar(f),h=s.__importStar(h),E=s.__importStar(E);const O=({state:e,eventName:t,num_files_selected:s,num_folders_selected:i,batch_success_count:r,batch_fail_count:a,lookup_error_type:o,error_summary:n})=>{l.logBrowseAction({uid:u.user(e).id,action:t,num_files_selected:s,num_folders_selected:i,view_type:f.selectViewType(e,{instanceId:c.BROWSE_FILES_VIEW_ID}),batch_success_count:r,batch_fail_count:a,lookup_error_type:o,error_summary:n})};t.deleteFiles=({files:e,checkFSWs:l})=>(c,m)=>s.__awaiter(void 0,void 0,void 0,(function*(){const f=u.user(m()),g=u.path(m()),v=u.shouldShowDeletedFiles(m()),T=o.getMetricsReporter(),F={surface:"browse",batchSizeBucket:i.bucketForBatchSize(e.length),contentType:i.batchContentType(e)},R=T.createTimer({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_total_ms"},F),A=Date.now(),y=T.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_average_ms"},F),D=T.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/completed"},F);b.Snackbar.sync(C.intl.formatMessage(r.deleteSnackbarProgressMessage,{count:e.length}),!0,"browse-action"),1!==e.length||v||c(d.pushBoltIgnore({removed:new Set([e[0].fq_path])})),O({state:m(),eventName:w.WebUserActionLogEvent.DELETE_REQUEST_ATTEMPT,num_files_selected:e.length,num_folders_selected:0});const M=yield h.deleteFiles(e,f.id,l);if(M.isError&&"path"===M.error[".tag"]&&"file_system_warnings"===M.error.path[".tag"])return void c((({files:e,details:i})=>(a,o)=>s.__awaiter(void 0,void 0,void 0,(function*(){b.Snackbar.close("browse-action"),n.showFileSystemWarningsModal({fsws:i,onFinalAccept:()=>{a(t.deleteFiles({files:e,checkFSWs:!1}))},confirmText:C.intl.formatMessage(r.deleteFswConfirmText)})})))({files:e,details:M.error.path.details}));if(R.record(),y.record((Date.now()-A)/e.length),M.isError)return c((({files:e,result:t})=>(i,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=u.shouldShowDeletedFiles(r());1!==e.length||s||i(d.popBoltIgnore({removed:new Set([e[0].fq_path])})),b.Snackbar.fail(E.deleteError(e.length,t.error),"browse-action");const a=u.selectedFiles(r()),{num_files_selected:o,num_folders_selected:n}=p.countFilesAndFolders(a);O({state:r(),eventName:w.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:o,num_folders_selected:n,batch_success_count:0,batch_fail_count:e.length,error_summary:t.error_summary})})))({files:e,result:M})),void D.record(0);const N=M.result.entries.filter(e=>"success"===e[".tag"]);c((({pathAtRequestTime:e,successEntries:t})=>(i,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=u.shouldShowDeletedFiles(r());if(!a.paths_are_equal(u.path(r()),e))return;const o=t.map(e=>e.metadata.path_display),n=u.unsortedFiles(r()),l=o.reduce((e,t)=>{if(void 0===t)return e;const i=n.get(t);return s&&void 0!==i?e.set(t,new _.File(Object.assign(Object.assign({},i),{isDeleted:!0}))):e.delete(t)},n);i(d.setUnsortedFiles({unsortedFiles:l}))})))({pathAtRequestTime:g,successEntries:N}));const L=((e,t)=>()=>s.__awaiter(void 0,void 0,void 0,(function*(){b.Snackbar.close("browse-action"),O({state:e,eventName:w.WebUserActionLogEvent.DELETE_UNDO,num_files_selected:t.result.changeset_data.length,num_folders_selected:0}),S.rollback({changeset_data:t.result.changeset_data,userId:u.user(e).id,onSuccess:()=>{b.Snackbar.complete(C.intl.formatMessage(r.deleteUndoSnackbarMessage),"browse-action"),O({state:e,eventName:w.WebUserActionLogEvent.DELETE_UNDO_REQUEST_SUCCESS,num_files_selected:t.result.changeset_data.length,num_folders_selected:0})}})})))(m(),M);I.setHandleUndo(L);const P=M.result.entries.filter(h.isFailure),j=P[0];let U,x;if(void 0!==j){const e=j.failure;U=e[".tag"],h.isPathLookupFailure(e)&&(x=e.path_lookup[".tag"])}const k=M.result.entries.filter(e=>h.isFailure(e)&&!h.isPathLookupFailure(e.failure)).length;D.record(k>0?0:1),i.recordPathLookupErrors(P,"delete",F),P.length===M.result.entries.length?(b.Snackbar.fail(E.deleteCompleteError(P),"browse-action"),O({state:m(),eventName:w.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:M.result.changeset_data.length,num_folders_selected:0,batch_success_count:M.result.entries.length-P.length,batch_fail_count:P.length,error_summary:U,lookup_error_type:x})):(b.Snackbar.completeWithUndo(E.deleteCompleteSuccess(e.length,N.length),L,"browse-action"),O({state:m(),eventName:w.WebUserActionLogEvent.DELETE_REQUEST_SUCCESS,num_files_selected:M.result.changeset_data.length,num_folders_selected:0,batch_success_count:M.result.entries.length,batch_fail_count:0,error_summary:U,lookup_error_type:x}))}));const F=(e,t,s,i)=>{const r=u.selectedFiles(e),{num_files_selected:a,num_folders_selected:o}=p.countFilesAndFolders(r);l.logBrowseAction({uid:u.user(e).id,action:t,num_files_selected:a,num_folders_selected:o,view_type:f.selectViewType(e,{instanceId:c.BROWSE_FILES_VIEW_ID}),result:s,error_summary:i})};t.renameUndo=({file:e,pathAtRequestTime:t,resultEntry:n,changeset:l})=>(c,p)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=u.user(p()),_=g.fileFromMetadata(e,n.success),m=o.getMetricsReporter(),f={surface:"browse",contentType:e.is_dir?"folders":"files",batchSizeBucket:"single"},S={latency:m.createTimer({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/latency_ms"},f),completed:m.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/completed"},f)};b.Snackbar.sync(C.intl.formatMessage(r.renameUndoSnackbarProgressMessage),!1,"browse-action"),c(d.pushBoltIgnore({added:new Set([e.fq_path]),removed:new Set([_.fq_path])})),F(p(),w.WebUserActionLogEvent.RENAME_UNDO,e);const E=yield h.undo(l,s);E.isError?(b.Snackbar.fail(C.intl.formatMessage(r.renameUndoSnackbarErrorMessage),"browse-action"),c(d.popBoltIgnore({added:new Set([e.fq_path]),removed:new Set([_.fq_path])})),F(p(),w.WebUserActionLogEvent.RENAME_UNDO_REQUEST_FAIL,e,E.error_summary),S.completed.record(0)):(b.Snackbar.complete(C.intl.formatMessage(r.renameUndoSnackbarSuccessMessage),"browse-action"),a.paths_are_equal(u.path(p()),t)&&(c(d.setUnsortedFiles({unsortedFiles:u.unsortedFiles(p()).remove(_.fq_path).set(e.fq_path,e)})),c(d.refreshPinnedItems())),c(d.selectFilesByFqPath({fqPathsToSelect:[e.fq_path]})),F(p(),w.WebUserActionLogEvent.RENAME_UNDO_REQUEST_SUCCESS,e),S.completed.record(1)),S.latency.record()})),t.renameFile=({file:e,name:l,checkFSWs:c,onSuccessSnackbarClose:p})=>(_,f)=>s.__awaiter(void 0,void 0,void 0,(function*(){const S=u.user(f()),O=u.path(f()),R=o.getMetricsReporter(),A={surface:"browse",contentType:e.is_dir?"folders":"files"},y={latency:R.createTimer({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/latency_ms"},A),completed:R.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/completed"},A)};if(-1!==l.indexOf("/"))return b.Snackbar.fail(C.intl.formatMessage(r.renameErrorInvalidName),"browse-action"),void _(m.setFileRename({file:e,renameState:null}));_(m.setFileRename({file:e,renameState:v.RenameState.SAVING_INPUT})),b.Snackbar.sync(C.intl.formatMessage(r.renameSnackbarProgressMessage),!1,"browse-action");const D=yield h.renameFile(e.fq_path,l,S.id,{checkFSWs:c});if(D.isError&&"to"===D.error[".tag"]&&"file_system_warnings"===D.error.to[".tag"])return void _((({file:e,name:i,details:a})=>(o,l)=>s.__awaiter(void 0,void 0,void 0,(function*(){b.Snackbar.close("browse-action"),n.showFileSystemWarningsModal({fsws:a,onFinalAccept:()=>{o(t.renameFile({file:e,name:i,checkFSWs:!1}))},onAbortAction:()=>{o(m.setFileRename({file:e,renameState:null})),o(d.pushBoltIgnore({moved:new Set([e.fq_path])}))},confirmText:C.intl.formatMessage(r.renameFswConfirmText)})})))({file:e,name:l,details:D.error.to.details}));if(y.latency.record(),D.isError||"success"!==D.result.entries[0][".tag"]){const t=D.isError?D:h.createUndefinedRpcResult();return _((({file:e,result:t})=>(i,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){i(d.pushBoltIgnore({moved:new Set([e.fq_path])})),i(m.setFileRename({file:e,renameState:null})),b.Snackbar.fail(E.renameError(t.error,e.fq_path),"browse-action"),F(r(),w.WebUserActionLogEvent.RENAME_REQUEST_FAIL,e,t.error_summary)})))({file:e,result:t})),y.completed.record(0),void R.createStats({ns:i.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/error"},Object.assign(Object.assign({},A),{error:t.error[".tag"]})).record(1)}const M=D.result.entries[0],N=g.fileFromMetadata(e,M.success);a.paths_are_equal(u.path(f()),O)&&(_(d.setUnsortedFiles({unsortedFiles:u.unsortedFiles(f()).remove(e.fq_path).set(N.fq_path,N)})),_(T.fileRename({file:e,newFile:N})),_(d.refreshPinnedItems())),_(d.selectFilesByFqPath({fqPathsToSelect:[N.fq_path]})),_(m.setFileRename({file:e,renameState:null})),y.completed.record(1);const L=()=>{_(t.renameUndo({file:e,resultEntry:M,pathAtRequestTime:O,changeset:D.result.changeset_data}))};I.setHandleUndo(L),b.Snackbar.completeWithUndo(C.intl.formatMessage(r.renameSnackbarSuccessMessage),L,"browse-action",{onClosed:()=>{null==p||p(N)}}),F(f(),w.WebUserActionLogEvent.RENAME_REQUEST_SUCCESS,N)}))})),define("metaserver/static/js/modules/clean/react/browse/data/reducer",["require","exports","tslib","immutable","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/data/types","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/clean/react/browse/right_rail_preferences","metaserver/static/js/modules/clean/react/browse/model_types"],(function(e,t,s,i,r,a,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browseReducer=void 0,i=s.__importStar(i),r=s.__importStar(r),l=s.__importStar(l),t.browseReducer=function(e=a.defaultBrowseState,t){switch(t.type){case a.ActionTypes.APP_INIT:return(function(e,t){const{props:i,user:r,viewer:a}=t.payload;n.assert(null===e.user,"Cannot reinitialize Browse store; changing invariants such as `user` is untested");const{browseExperiments:o}=i,c=s.__rest(i,["browseExperiments"]);return Object.assign(Object.assign(Object.assign(Object.assign({},e),{user:r,viewer:a,experiments:o}),c),{isRightRailCollapsed:l.getIsCollapsed(r.id)})})(e,t);case a.ActionTypes.PUSH_BOLT_IGNORE:return(function(e,t){let{added:s,moved:i,removed:r}=e.boltIgnore;return t.payload.added&&(s=new Set(s),t.payload.added.forEach(e=>s.add(e))),t.payload.moved&&(i=new Set(i),t.payload.moved.forEach(e=>i.add(e))),t.payload.removed&&(r=new Set(r),t.payload.removed.forEach(e=>r.add(e))),Object.assign(Object.assign({},e),{boltIgnore:{added:s,moved:i,removed:r}})})(e,t);case a.ActionTypes.POP_BOLT_IGNORE:return(function(e,t){let{added:s,moved:i,removed:r}=e.boltIgnore;return t.payload.added&&(s=new Set(s),t.payload.added.forEach(e=>s.delete(e))),t.payload.moved&&(i=new Set(i),t.payload.moved.forEach(e=>i.delete(e))),t.payload.removed&&(r=new Set(r),t.payload.removed.forEach(e=>r.delete(e))),Object.assign(Object.assign({},e),{boltIgnore:{added:s,moved:i,removed:r}})})(e,t);case a.ActionTypes.SELECT_FILES_BY_FQ_PATH:return(function(e,t){const{fqPathsToSelect:s}=t.payload,r=s.map(e=>e.toLowerCase()),a=e.unsortedFiles.toList().filter(e=>r.includes(e.fq_path.toLowerCase())).map(e=>e.fq_path),o=i.OrderedSet(a),n=a.size?a.get(0):null;return Object.assign(Object.assign({},e),{selection:e.selection.set("selected",o).set("anchor",n)})})(e,t);case a.ActionTypes.SET_CAN_DISPLAY_FOLDER_SIZES:return(function(e,t){const{canDisplayFolderSizes:s}=t.payload;return Object.assign(Object.assign({},e),{canDisplayFolderSizes:s})})(e,t);case a.ActionTypes.SET_CLIPBOARD_FILES:return(function(e,t){const{clipboard:s}=t.payload;return Object.assign(Object.assign({},e),{clipboard:s})})(e,t);case a.ActionTypes.SET_CONTEXT:return(function(e,t){const{context:s}=t.payload;return Object.assign(Object.assign({},e),{context:s})})(e,t);case a.ActionTypes.SET_CURRENT_FOLDER_INFO:return(function(e,t){const{currentFolderInfo:s}=t.payload;return Object.assign(Object.assign({},e),{currentFolderInfo:s})})(e,t);case a.ActionTypes.SET_FILE_HAS_AUTOMATED_RULE_MAP:return(function(e,t){return Object.assign(Object.assign({},e),{fileHasAutomatedRuleMap:e.fileHasAutomatedRuleMap.merge(t.payload.fileHasAutomatedRuleMap)})})(e,t);case a.ActionTypes.SET_FILE_JUMP_FILTER:return(function(e,t){const{fileJumpFilter:s}=t.payload;return Object.assign(Object.assign({},e),{fileJumpFilter:s})})(e,t);case a.ActionTypes.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return(function(e,t){const{filePathsToSelectOnNextUpdate:s}=t.payload;return Object.assign(Object.assign({},e),{filePathsToSelectOnNextUpdate:s})})(e,t);case a.ActionTypes.SET_FOLDER_SIZES:return(function(e,t){const{folderSizes:s}=t.payload;return Object.assign(Object.assign({},e),{folderSizes:s})})(e,t);case a.ActionTypes.SET_LOADING_STATE:return(function(e,t){const{loadingState:s,path:a}=t.payload;return r.paths_are_equal(a,e.path)?s===o.LoadingState.LOADED?Object.assign(Object.assign({},e),{loadingState:s,filePathsToSelectOnNextUpdate:i.Set()}):Object.assign(Object.assign({},e),{loadingState:s}):e})(e,t);case a.ActionTypes.SET_MOUNT_POINTS:return(function(e,t){const{mountPoints:s}=t.payload;return Object.assign(Object.assign({},e),{mountPoints:i.Map(s)})})(e,t);case a.ActionTypes.SET_NEW_FOLDER_CREATION_STATE:return(function(e,t){const{newFolderCreationState:s}=t.payload;return Object.assign(Object.assign({},e),{newFolderCreationState:s})})(e,t);case a.ActionTypes.SET_PAGINATED_TOTAL_NUM_FILES:return(function(e,t){const{paginatedTotalNumFiles:s}=t.payload;return Object.assign(Object.assign({},e),{paginatedTotalNumFiles:s})})(e,t);case a.ActionTypes.SET_PATH:return(function(e,t){const{path:s}=t.payload;return Object.assign(Object.assign({},e),{path:s})})(e,t);case a.ActionTypes.SET_SELECTION:return(function(e,t){const{selection:s}=t.payload;return Object.assign(Object.assign({},e),{selection:s})})(e,t);case a.ActionTypes.SET_SHOULD_SHOW_DELETED_FILES:return(function(e,t){const{shouldShowDeletedFiles:s}=t.payload;return Object.assign(Object.assign({},e),{shouldShowDeletedFiles:s})})(e,t);case a.ActionTypes.SET_UNSORTED_FILES:return(function(e,t){const{unsortedFiles:s}=t.payload;return Object.assign(Object.assign({},e),{unsortedFiles:s})})(e,t);case a.ActionTypes.SHOW_TIMELINE:return(function(e,t){return Object.assign(Object.assign({},e),{isRewindVisible:!0,clickRewindTimestamp:t.payload.timestamp})})(e,t);case a.ActionTypes.HIDE_TIMELINE:return(function(e,t){return Object.assign(Object.assign({},e),{isRewindVisible:!1})})(e);case a.ActionTypes.SHOW_FOLDER_HISTORY_PANEL:return(function(e,t){return Object.assign(Object.assign({},e),{isFolderHistoryVisible:!0,clickFolderHistoryTimestamp:t.payload.timestamp})})(e,t);case a.ActionTypes.HIDE_FOLDER_HISTORY_PANEL:return(function(e,t){return Object.assign(Object.assign({},e),{isFolderHistoryVisible:!1})})(e);case a.ActionTypes.SET_IS_FILE_VIEWER_SHOWN:return(function(e,t){return Object.assign(Object.assign({},e),{isFileViewerShown:t.payload.isShown})})(e,t);case a.ActionTypes.SET_IS_REWIND_ENABLED:return(function(e,t){return Object.assign(Object.assign({},e),{isRewindButtonEnabled:t.payload.value})})(e,t);case a.ActionTypes.SET_FOLDER_MEMBER_COUNTS:return(function(e,t){return Object.assign(Object.assign({},e),{folderMemberCounts:t.payload.value})})(e,t);case a.ActionTypes.TOGGLE_SPACES_ENTRY_POINT:return(function(e,t){return Object.assign(Object.assign({},e),{isSpacesEntryPointEnabled:t.payload.value})})(e,t);case a.ActionTypes.REQUEST_FOLDER_SIZES:return(function(e,t){const{fqPath:s}=t.payload;if(e.isQueryingFolderSizes)return e;const i=e.folderSizes.withMutations(e=>{e.set(s,{size:0,state:c.FetchFolderSizeState.LOADING})});return Object.assign(Object.assign({},e),{folderSizes:i,isQueryingFolderSizes:!0})})(e,t);case a.ActionTypes.SET_FOLDER_SIZES_PENDING:return(function(e,t){const{fetchFolderSizesResp:s}=t.payload;let i=e.currentFolderSizesQuery;const r=e.folderSizes.withMutations(e=>{for(const t of s.sizes_dict)e.update(t.fq_path,{size:0,state:c.FetchFolderSizeState.LOADING},()=>({size:t.size,state:c.FetchFolderSizeState.LOADING})),i=i.withMutations(e=>e.add(t.fq_path))});return Object.assign(Object.assign({},e),{currentFolderSizesQuery:i,folderSizes:r})})(e,t);case a.ActionTypes.COMPLETE_FOLDER_SIZES:return(function(e,t){const{fetchFolderSizeState:s}=t.payload,r=e.folderSizes.withMutations(t=>{e.currentFolderSizesQuery.forEach(i=>{const r=e.folderSizes.get(i);r&&t.update(i,()=>({size:r.size,state:s}))})});return Object.assign(Object.assign({},e),{currentFolderSizesQuery:i.Set(),folderSizes:r,isQueryingFolderSizes:!1})})(e,t);case a.ActionTypes.SET_ARE_POST_TTI_MODULES_LOADED:return(function(e,t){return Object.assign(Object.assign({},e),{arePostTTIModulesLoaded:t.payload.arePostTTIModulesLoaded})})(e,t);case a.ActionTypes.SET_VIEW_SCOPE:return(function(e,t){return Object.assign(Object.assign({},e),{viewScope:t.payload.viewScope})})(e,t);case a.ActionTypes.SET_HIDE_FILES_AND_SIDEBAR:return(function(e,t){return Object.assign(Object.assign({},e),{shouldHideFilesAndSidebar:t.payload.shouldHideFilesAndSidebar})})(e,t);case a.ActionTypes.SET_IS_CREATING_SHARED_LINK:return(function(e,t){return Object.assign(Object.assign({},e),{isCreatingSharedLinkMap:e.isCreatingSharedLinkMap.set(t.payload.fileIdOrPath,t.payload.isCreatingSharedLink)})})(e,t);case a.ActionTypes.SET_RIGHTRAIL_IS_COLLAPSED:return(function(e,t){return Object.assign(Object.assign({},e),{isRightRailCollapsed:t.payload.collapsed})})(e,t);case a.ActionTypes.SET_EXPANDED_BLADE:return(function(e,t){return Object.assign(Object.assign({},e),{expandedBlade:t.payload.expandedBlade})})(e,t);case a.ActionTypes.SET_OVERFLOW_MENU_OPEN_REQUEST:return(function(e,t){return Object.assign(Object.assign({},e),{overflowMenuOpenRequest:t.payload.overflowMenuOpenRequest})})(e,t);case a.ActionTypes.SET_OVERFLOW_MENU_CLOSE_REQUEST:return(function(e,t){return e.overflowMenuCloseRequest===t.payload.overflowMenuCloseRequest?e:Object.assign(Object.assign({},e),{overflowMenuCloseRequest:t.payload.overflowMenuCloseRequest})})(e,t);case a.ActionTypes.SET_INLINE_OVERFLOW_MENU_OPEN_REQUEST:return(function(e,t){return Object.assign(Object.assign({},e),{inlineOverflowMenuOpenRequest:t.payload.inlineOverflowMenuOpenRequest})})(e,t);case a.ActionTypes.SET_OVERFLOW_MENU_COORDINATES:return(function(e,t){return Object.assign(Object.assign({},e),{overflowMenuCoordinates:t.payload.overflowMenuCoordinates})})(e,t);case a.ActionTypes.SET_BROWSE_POST_TTI_EXPERIMENTS:return(function(e,t){const{browsePostTTIExperiments:s}=t.payload;return Object.assign(Object.assign({},e),{browsePostTTIExperiments:s})})(e,t);case a.ActionTypes.SET_BROWSE_POST_TTI_DATA:return(function(e,t){const{browsePostTTIData:s}=t.payload;return Object.assign(Object.assign({},e),{browsePostTTIData:Object.assign(Object.assign({},e.browsePostTTIData),s)})})(e,t);case a.ActionTypes.SET_BACKUP_FOLDERS:return(function(e,t){return Object.assign(Object.assign({},e),{backupFolders:t.payload.backupFolders})})(e,t);case a.ActionTypes.SET_CREATE_MENU_OPEN_REQUEST:return(function(e,t){return Object.assign(Object.assign({},e),{createMenuOpenRequest:t.payload.createMenuOpenRequest})})(e,t);case a.ActionTypes.SET_FULL_FUNNEL_M2_OVERRIDES:return(function(e,t){const{browsePostTTIExperimentsOverrides:s}=e,{fullFunnelM2Overrides:i}=t.payload;return Object.assign(Object.assign({},e),{browsePostTTIExperimentsOverrides:Object.assign(Object.assign({},s),{fullFunnelM2Overrides:i})})})(e,t);case a.ActionTypes.SHOW_PERSONALIZATION_SUGGESTED_FOLDERS:return(function(e,t){const{browsePostTTIExperimentsOverrides:s}=e,{showSuggestedFolders:i}=t.payload;return Object.assign(Object.assign({},e),{browsePostTTIExperimentsOverrides:Object.assign(Object.assign({},s),{showPersonalizationSuggestedFolders:i})})})(e,t);case a.ActionTypes.SHOW_ONBOARDING_CHECKLIST_SHARE_BUTTON_TOOLTIP:return(function(e,t){const{browsePostTTIExperimentsOverrides:s}=e,{showOnboardingChecklistShareButtonTooltip:i}=t.payload;return Object.assign(Object.assign({},e),{browsePostTTIExperimentsOverrides:Object.assign(Object.assign({},s),{showOnboardingChecklistShareButtonTooltip:i})})})(e,t);case a.ActionTypes.HANDLE_APP_CLEANUP:return a.defaultBrowseState}return e}})),define("metaserver/static/js/modules/clean/react/browse/data/selectors",["require","exports","tslib","immutable","reselect","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/browse/data/types","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/browse/uri_helper","metaserver/static/js/modules/clean/react/browse/util","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/growth/personalization/util","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/redux/selectors","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/clean/tagging/data/selectors/index","metaserver/static/js/modules/clean/tagging/experiments","metaserver/static/js/modules/clean/tagging/utils","metaserver/static/js/modules/clean/filetypes","metaserver/static/js/modules/clean/react/browse/data/helpers","metaserver/static/js/modules/clean/sync_everything/constants","metaserver/static/js/modules/clean/growth/user_action/trackers/personalization_tracker"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGgToCdmMigrationExperimentActive=t.ggToCdmMigrationVariant=t.backupNewLocationHintEnabled=t.getIndexOfFile=t.createMenuOpenRequest=t.selectCurrentFolderInfoWithTags=t.selectedFilesWithTags=t.sortedFilesWithFolderSizesAndTags=t.selectIsTagsColumnEnabled=t.selectIsTaggingEnabled=t.autoTagAwarenessVariant=t.flowsAutoTagUiVariant=t.flowsAutomatedFolderUiVariant=t.manualTaggingVariant=t.isInsideBackupFolder=t.isInsideBackupFolderByFile=t.backupFolderPath=t.backupFolderPathByFile=t.isSelectedBackupFolder=t.backupFolders=t.isContinuousOnboardingBackgroundActive=t.browseBoostSharing=t.showBrowseViewToggleInToolbar=t.showShareViewInToolbar=t.expandedBlade=t.fileHasAutomatedRuleMap=t.isInsideFlowsEligibleFolder=t.flowsFolderRule=t.isRightRailCollapsed=t.showSelectionIndicatorInToolbar=t.expActionBarRedesignVariant=t.browseCommentsEnabled=t.getCurrentFolderInfo=t.selectionMode=t.selectViewTypeScope=t.isEligibleForActivationCards=t.getUserHasSharedFileOrFolderInfo=t.shouldLogFullFunnelM2CreateTooltipExposure=t.shouldLogFullFunnelM2TooltipExposure=t.shouldLogFullFunnelM2NextStepsExposure=t.shouldShowJtbdNextStepsOverlay=t.fullFunnelM2Overrides=t.shouldShowJtbdCreateButtonTooltip=t.shouldShowJtbdUploadButtonTooltip=t.getCreateSuggestedFolderTooltipVariant=t.shouldLogCreateSuggestedFolderTooltipExposure=t.shouldDisplayCreateSuggestedFolderTooltip=t.getUsersJtbdInterestInfo=t.shouldDisplaySpecificMoveButtonMessage=t.shouldDisplaySuggestedItemsToMoveSubheaderInfo=t.shouldDisplaySuggestedFoldersToMoveSubheaderInfo=t.getMfm2Variant=t.isEligibleForOnboardingChecklist=t.isEligibleForSuggestedItemsToMove=t.shouldShowTeamSpaceEmptyZone=t.selectFileByFullPath=t.canEditFolderOverview=t.shouldShowSidebarFolderOverview=t.unsortedFilesWithFolderSizes=t.sortedFilesWithFolderSizes=t.urlPrefix=t.selectFilesForSelection=t.allFilesSelected=t.selectedFilesForSidebar=t.selectedFiles=t.sortedFiles=t.fileJumpIndex=t.isCurrentPathRoot=t.arePostTTIModulesLoaded=t.unsortedFiles=t.uploaderPostTTIExperiments=t.browsePostTTIExperimentsOverrides=t.browsePostTTIExperiments=t.isSpacesEntryPointEnabled=t.folderMemberCounts=t.isRewindButtonEnabled=t.isFileViewerShown=t.clickFolderHistoryTimestamp=t.clickRewindTimestamp=t.isFolderHistoryVisible=t.isRewindVisible=t.viewer=t.user=t.isCreatingSharedLinkForFile=t.shouldHideFilesAndSidebar=t.autoTeamGroupId=t.hasLinkedDesktop=t.hasLinkedMobile=t.browsePostTTIData=t.boltIgnore=t.sortOrder=t.shouldShowDeletedFiles=t.selection=t.path=t.newFolderCreationState=t.mountPoints=t.browseLoadingState=t.isQueryingFolderSizes=t.isFileJumping=t.folderSizes=t.filePathsToSelectOnNextUpdate=t.fileJumpFilter=t.selectPostTTIExperimentsOptional=t.postTTIExperiments=t.selectBrowseExperimentsOptional=t.experiments=t.inlineOverflowMenuOpenRequest=t.overflowMenuCoordinates=t.overflowMenuCloseRequest=t.overflowMenuOpenRequest=t.context=t.clipboard=t.canDisplayFolderSizes=t.getBrowseState=void 0,i=s.__importStar(i),a=s.__importStar(a),t.getBrowseState=e=>h.getStateAtNamespace(e,f.BROWSE_NAMESPACE_KEY)||n.defaultBrowseState,t.canDisplayFolderSizes=e=>t.getBrowseState(e).canDisplayFolderSizes,t.clipboard=e=>t.getBrowseState(e).clipboard,t.context=e=>t.getBrowseState(e).context,t.overflowMenuOpenRequest=e=>t.getBrowseState(e).overflowMenuOpenRequest,t.overflowMenuCloseRequest=e=>t.getBrowseState(e).overflowMenuCloseRequest,t.overflowMenuCoordinates=e=>t.getBrowseState(e).overflowMenuCoordinates,t.inlineOverflowMenuOpenRequest=e=>t.getBrowseState(e).inlineOverflowMenuOpenRequest,t.experiments=e=>t.getBrowseState(e).experiments,t.selectBrowseExperimentsOptional=e=>{var t;return null===(t=e[f.BROWSE_NAMESPACE_KEY])||void 0===t?void 0:t.experiments},t.postTTIExperiments=e=>t.getBrowseState(e).browsePostTTIExperiments,t.selectPostTTIExperimentsOptional=e=>{var t;return null===(t=e[f.BROWSE_NAMESPACE_KEY])||void 0===t?void 0:t.browsePostTTIExperiments},t.fileJumpFilter=e=>t.getBrowseState(e).fileJumpFilter,t.filePathsToSelectOnNextUpdate=e=>t.getBrowseState(e).filePathsToSelectOnNextUpdate,t.folderSizes=e=>t.getBrowseState(e).folderSizes,t.isFileJumping=e=>t.getBrowseState(e).fileJumpFilter.length>0,t.isQueryingFolderSizes=e=>t.getBrowseState(e).isQueryingFolderSizes,t.browseLoadingState=e=>t.getBrowseState(e).loadingState,t.mountPoints=e=>t.getBrowseState(e).mountPoints,t.newFolderCreationState=e=>t.getBrowseState(e).newFolderCreationState,t.path=e=>t.getBrowseState(e).path,t.selection=e=>t.getBrowseState(e).selection,t.shouldShowDeletedFiles=e=>t.getBrowseState(e).shouldShowDeletedFiles,t.sortOrder=e=>{const t=p.selectScopedSort(e,{instanceId:o.BROWSE_FILES_VIEW_ID});return t||o.BROWSE_DEFAULT_SORT_ORDER},t.boltIgnore=e=>t.getBrowseState(e).boltIgnore,t.browsePostTTIData=e=>t.getBrowseState(e).browsePostTTIData,t.hasLinkedMobile=e=>t.getBrowseState(e).hasLinkedMobile,t.hasLinkedDesktop=e=>t.getBrowseState(e).hasLinkedDesktop,t.autoTeamGroupId=e=>t.getBrowseState(e).autoTeamGroupId,t.shouldHideFilesAndSidebar=e=>t.getBrowseState(e).shouldHideFilesAndSidebar,t.isCreatingSharedLinkForFile=(e,s)=>Boolean(t.getBrowseState(e).isCreatingSharedLinkMap.get(s)),t.user=e=>{const s=t.getBrowseState(e).user;return g.assert(null!=s,"Browse store `user` accessed before APP_INIT action"),s},t.viewer=e=>{const s=t.getBrowseState(e).viewer;return g.assert(null!=s,"Browse store `viewer` accessed before APP_INIT action"),s},t.isRewindVisible=e=>t.getBrowseState(e).isRewindVisible,t.isFolderHistoryVisible=e=>t.getBrowseState(e).isFolderHistoryVisible,t.clickRewindTimestamp=e=>t.getBrowseState(e).clickRewindTimestamp,t.clickFolderHistoryTimestamp=e=>t.getBrowseState(e).clickFolderHistoryTimestamp,t.isFileViewerShown=e=>t.getBrowseState(e).isFileViewerShown,t.isRewindButtonEnabled=e=>t.getBrowseState(e).isRewindButtonEnabled,t.folderMemberCounts=e=>t.getBrowseState(e).folderMemberCounts,t.isSpacesEntryPointEnabled=e=>t.getBrowseState(e).isSpacesEntryPointEnabled,t.browsePostTTIExperiments=e=>t.getBrowseState(e).browsePostTTIExperiments||{},t.browsePostTTIExperimentsOverrides=e=>t.getBrowseState(e).browsePostTTIExperimentsOverrides||{},t.uploaderPostTTIExperiments=r.createSelector(t.browsePostTTIData,t.browsePostTTIExperimentsOverrides,(e,t)=>{var s,i,r,a,o;const n=null===(s=null==e?void 0:e.uploaderPostTTIExperiments)||void 0===s?void 0:s.usersJtbdInterestInfo;return Object.assign(Object.assign({},e.uploaderPostTTIExperiments),{usersJtbdInterestInfo:Object.assign(Object.assign({},n),{onboarding_signup_cta:null!==(r=null===(i=null==t?void 0:t.fullFunnelM2Overrides)||void 0===i?void 0:i.onboardingSignupCtaOverride)&&void 0!==r?r:null==n?void 0:n.onboarding_signup_cta,onboarding_interest:null!==(o=null===(a=null==t?void 0:t.fullFunnelM2Overrides)||void 0===a?void 0:a.onboardingInterestOverride)&&void 0!==o?o:null==n?void 0:n.onboarding_interest})})}),t.unsortedFiles=e=>t.getBrowseState(e).unsortedFiles,t.arePostTTIModulesLoaded=e=>t.getBrowseState(e).arePostTTIModulesLoaded,t.isCurrentPathRoot=e=>a.paths_are_equal(t.path(e),"/"),t.fileJumpIndex=r.createSelector(t.unsortedFiles,e=>e.keySeq().toArray().map(e=>({filename:a.filename(e).toLowerCase(),fqPath:e})).sort((e,t)=>e.filename<t.filename?-1:e.filename>t.filename?1:0)),t.sortedFiles=r.createSelector(t.unsortedFiles,t.sortOrder,t.folderSizes,t.context,t.experiments,(e,t,s,i,r)=>d.sortFiles(e.toList(),t,s)),t.selectedFiles=r.createSelector(t.unsortedFiles,t.selection,(e,t)=>C(e,t)),t.selectedFilesForSidebar=r.createSelector(t.selectedFiles,u.previewThumbnails,(e,t)=>e.count()>0?e.withMutations(e=>{e.forEach((s,i)=>{var r;if(!s.thumbnail_url_tmpl&&(null===(r=t[s.file_id])||void 0===r?void 0:r.preview_url)){const r=t[s.file_id].preview_url;e.set(i,new l.File(Object.assign(Object.assign({},s),{thumbnail_url_tmpl:r})))}})}):e),t.allFilesSelected=r.createSelector(t.selectedFiles,t.unsortedFiles,(e,t)=>e.size===t.size),t.selectFilesForSelection=(e,s)=>C(t.unsortedFiles(e),s.selection);const C=(e,t)=>t.selected.isEmpty()||e.isEmpty()?i.OrderedMap():i.OrderedMap(t.selected.map(t=>{const s=e.find(e=>e.fq_path===t);return s?[s.fq_path,s]:void 0}));t.urlPrefix=r.createSelector(t.user,t.viewer,(e,t)=>c.browse_root(t,e)),t.sortedFilesWithFolderSizes=r.createSelector(t.sortedFiles,t.folderSizes,(e,t)=>e.map(e=>{const s=t.get(e.fq_path);return s?e.updateSize(s.size,s.state):e})),t.unsortedFilesWithFolderSizes=r.createSelector(t.unsortedFiles,t.folderSizes,(e,t)=>e.withMutations(s=>{t.forEach((t,i)=>{const r=e.get(i);if(r&&t){const e=r.updateSize(t.size,t.state);s.set(i,e)}})})),t.shouldShowSidebarFolderOverview=r.createSelector(t.selectedFiles,e=>e&&1===e.size&&e.first().is_dir&&!l.File.isNoAccessSharedFolder(e.first())),t.canEditFolderOverview=r.createSelector(t.user,t.context,(e,t)=>e.is_cdm_member&&e.is_team_admin&&t.isCurrentlyInRoot||!!t.isCurrentPathWriteable()),t.selectFileByFullPath=(e,s)=>t.sortedFilesWithFolderSizes(e).find(e=>e.fq_path===s.path),t.shouldShowTeamSpaceEmptyZone=r.createSelector(t.context,t.experiments,t.browsePostTTIData,t.browsePostTTIExperiments,t.browseLoadingState,(e,t,s,i,r)=>!(s.mobileWebInvites||!i.expPersonalizedFirstPaths&&!s.firstTaskProps.is_eligible_team||!e.isInsideMyTeamFolderTree||!e.isCurrentlyInRoot||r===_.LoadingState.LOADING_FIRST_PAGE)),t.isEligibleForSuggestedItemsToMove=r.createSelector(t.context,t.experiments,t.browsePostTTIData,t.browseLoadingState,t.user,(e,t,s,i,r)=>{var a;const o=null===(a=s.suggestedItemsToMoveInfo)||void 0===a?void 0:a.is_dismissed,n=t.splitTmfTsd&&"/Team Files"===e.currentFQPath;return Boolean(r.is_team&&!o&&!s.mobileWebInvites&&e.isInsideMyTeamFolderTree&&(e.isCurrentlyInRoot&&!t.splitTmfTsd||n)&&i!==_.LoadingState.LOADING_FIRST_PAGE)}),t.isEligibleForOnboardingChecklist=r.createSelector(t.context,t.experiments,t.browsePostTTIData,t.browseLoadingState,(e,t,s,i)=>Boolean(!s.mobileWebInvites&&!t.splitTmfTsd&&e.isCurrentlyInRoot&&e.isInsideMyTeamFolderTree&&i===_.LoadingState.LOADED));const O=r.createSelector(t.browsePostTTIData,e=>e.suggestedItemsToMoveInfo);t.getMfm2Variant=r.createSelector(O,e=>{var t;return null!==(t=null==e?void 0:e.mfm2_variant)&&void 0!==t?t:"OFF"}),t.shouldDisplaySuggestedFoldersToMoveSubheaderInfo=r.createSelector(O,e=>"V1"===(null==e?void 0:e.mfm2_variant)),t.shouldDisplaySuggestedItemsToMoveSubheaderInfo=r.createSelector(O,e=>"V3"===(null==e?void 0:e.mfm2_variant)),t.shouldDisplaySpecificMoveButtonMessage=r.createSelector(O,e=>{var t;return["V1","V2","V3"].includes(null!==(t=null==e?void 0:e.mfm2_variant)&&void 0!==t?t:"OFF")}),t.getUsersJtbdInterestInfo=r.createSelector(t.browsePostTTIData,e=>e.usersJtbdInterestInfo),t.shouldDisplayCreateSuggestedFolderTooltip=r.createSelector(t.getUsersJtbdInterestInfo,e=>"V1"===(null==e?void 0:e.full_funnel_video_optimization_variant)&&(null==e?void 0:e.onboarding_interest)===m.OnboardingInterest.VIDEO_SHARE&&(null==e?void 0:e.onboarding_signup_cta)===m.OnboardingSignupCTA.UNSET&&!m.hasDismissedCreateSuggestedFoldersTooltip(e)),t.shouldLogCreateSuggestedFolderTooltipExposure=r.createSelector(t.getUsersJtbdInterestInfo,e=>void 0!==(null==e?void 0:e.full_funnel_video_optimization_variant)&&["CONTROL","V1"].includes(e.full_funnel_video_optimization_variant)&&(null==e?void 0:e.onboarding_interest)===m.OnboardingInterest.VIDEO_SHARE&&(null==e?void 0:e.onboarding_signup_cta)===m.OnboardingSignupCTA.UNSET&&!m.hasDismissedCreateSuggestedFoldersTooltip(e)),t.getCreateSuggestedFolderTooltipVariant=r.createSelector(t.getUsersJtbdInterestInfo,e=>e&&m.getCreateSuggestedFolderTooltipVariant(e)),t.shouldShowJtbdUploadButtonTooltip=r.createSelector(t.getUsersJtbdInterestInfo,e=>"V1"===(null==e?void 0:e.full_funnel_activation_m2_variant)&&m.hasApplicableJtbdForUploadButtonTooltip(e)&&!m.hasPerformedJtbdPersonalizationAction(w.PersonalizationActions.DISMISS_JTBD_UPLOAD_BUTTON_TOOLTIP,e)),t.shouldShowJtbdCreateButtonTooltip=r.createSelector(t.getUsersJtbdInterestInfo,e=>"V1"===(null==e?void 0:e.full_funnel_activation_m2_variant)&&m.hasApplicableJtbdForCreateButtonTooltip(e)&&!m.hasPerformedJtbdPersonalizationAction(w.PersonalizationActions.DISMISS_JTBD_CREATE_BUTTON_TOOLTIP,e)),t.fullFunnelM2Overrides=r.createSelector(t.browsePostTTIExperimentsOverrides,e=>null==e?void 0:e.fullFunnelM2Overrides),t.shouldShowJtbdNextStepsOverlay=r.createSelector(t.getUsersJtbdInterestInfo,e=>"V1"===(null==e?void 0:e.full_funnel_activation_m2_variant)&&m.hasApplicableJtbdForNextStepsOverlay(e)&&!m.hasPerformedJtbdPersonalizationAction(w.PersonalizationActions.DISMISS_JTBD_NEXT_STEPS_OVERLAY,e)),t.shouldLogFullFunnelM2NextStepsExposure=r.createSelector(t.getUsersJtbdInterestInfo,e=>["CONTROL","V1"].includes((null==e?void 0:e.full_funnel_activation_m2_variant)||"")&&m.hasApplicableJtbdForNextStepsOverlay(e)&&!m.hasPerformedJtbdPersonalizationAction(w.PersonalizationActions.DISMISS_JTBD_NEXT_STEPS_OVERLAY,e)),t.shouldLogFullFunnelM2TooltipExposure=r.createSelector(t.getUsersJtbdInterestInfo,t.fullFunnelM2Overrides,(e,t)=>["CONTROL","V1"].includes((null==e?void 0:e.full_funnel_activation_m2_variant)||"")&&(!!(null==t?void 0:t.shouldShowJtbdUploadButtonTooltip)||m.hasApplicableJtbdForUploadButtonTooltip(e)&&!m.hasPerformedJtbdPersonalizationAction(w.PersonalizationActions.DISMISS_JTBD_UPLOAD_BUTTON_TOOLTIP,e))),t.shouldLogFullFunnelM2CreateTooltipExposure=r.createSelector(t.getUsersJtbdInterestInfo,e=>["CONTROL","V1"].includes((null==e?void 0:e.full_funnel_activation_m2_variant)||"")&&m.hasApplicableJtbdForCreateButtonTooltip(e)&&!m.hasPerformedJtbdPersonalizationAction(w.PersonalizationActions.DISMISS_JTBD_CREATE_BUTTON_TOOLTIP,e)),t.getUserHasSharedFileOrFolderInfo=r.createSelector(t.browsePostTTIData,e=>e.userHasSharedFileOrFolderInfo),t.isEligibleForActivationCards=r.createSelector(t.user,t.context,t.browseLoadingState,t.getUserHasSharedFileOrFolderInfo,(e,t,s,i)=>Boolean(!e.is_team&&t.isCurrentlyInRoot&&s===_.LoadingState.LOADED&&["V1","CONTROL"].includes((null==i?void 0:i.sharing_made_easy_variant)||"OFF")&&(null==i?void 0:i.has_shared_file_or_folder))),t.selectViewTypeScope=e=>t.getBrowseState(e).viewScope||void 0,t.selectionMode=r.createSelector(t.selectedFiles,e=>e.count()>0?"selected":"unselected"),t.getCurrentFolderInfo=e=>t.getBrowseState(e).currentFolderInfo,t.browseCommentsEnabled=r.createSelector(t.postTTIExperiments,e=>"ON"===e.expBrowseWebComments),t.expActionBarRedesignVariant=r.createSelector(t.postTTIExperiments,e=>e.expActionBarRedesign?e.expActionBarRedesign:"OFF"),t.showSelectionIndicatorInToolbar=e=>t.getBrowseState(e).context.isInsideFamilySharedFolder,t.isRightRailCollapsed=e=>t.getBrowseState(e).isRightRailCollapsed||!1,t.flowsFolderRule=(e,s)=>t.getBrowseState(e).fileHasAutomatedRuleMap.get(s),t.isInsideFlowsEligibleFolder=e=>{const s=t.getCurrentFolderInfo(e),i=t.getBrowseState(e).context;return s&&i.isInFolderMode&&!i.isCurrentlyInRoot&&!i.isInsideTeamFolderRoot&&!i.isInsideVaultFolder&&s.type!==T.FileTypes.TEAM_MEMBER_FOLDER&&!l.File.isReadOnlySharedFolder(s)},t.fileHasAutomatedRuleMap=e=>t.getBrowseState(e).fileHasAutomatedRuleMap,t.expandedBlade=e=>t.getBrowseState(e).expandedBlade,t.showShareViewInToolbar=(e,s)=>{const i=!s.isResponsive||s.isMatchedLarge,r=!i&&s.isMatchedMedium,a=t.getBrowseState(e).context.isInsideFamilySharedFolder;return(t.isRightRailCollapsed(e)&&i||r)&&!a},t.showBrowseViewToggleInToolbar=e=>t.getBrowseState(e).context.isInsideFamilySharedFolder,t.browseBoostSharing=r.createSelector(t.selectBrowseExperimentsOptional,e=>e?e.browseBoostSharing:"OFF"),t.isContinuousOnboardingBackgroundActive=r.createSelector(t.context,t.experiments,t.unsortedFiles,t.selectedFiles,(e,t,s,i)=>{const r=i.size>0,a="V1"===t.coreO21nInFolderActivationM2&&!e.isCurrentlyInRoot&&s.size<=0;return r||a}),t.backupFolders=e=>t.getBrowseState(e).backupFolders,t.isSelectedBackupFolder=r.createSelector(t.selectedFiles,t.browsePostTTIExperiments,(e,t)=>!!t.expEnableBackupWeb&&b.isBackupFolder(e.first())),t.backupFolderPathByFile=(e,s)=>{var i;const r=null!==(i=null==s?void 0:s.fq_path)&&void 0!==i?i:t.path(e),o=r.split("/").filter(Boolean);if(o.length>=2&&o[1]===`${o[0]}${I.EDB_EXTENSION}`)return`/${o[0]}/${o[1]}`;const n=t.backupFolders(e),l=o.findIndex(e=>e.endsWith(I.EDB_EXTENSION));if(-1!==l)return["",...o.slice(0,l+1)].join("/");if(null===n)return null;const c=[r,...a.parent_dirs(r)],d=n.filter(e=>c.includes(e));return 0===d.length?null:d[0]},t.backupFolderPath=e=>t.backupFolderPathByFile(e),t.isInsideBackupFolderByFile=(e,s)=>!(!I.isBackupBrowse()||s)||!!t.browsePostTTIExperiments(e).expEnableBackupWeb&&(!!b.isBackupFolder(null!=s?s:t.getCurrentFolderInfo(e))||null!==t.backupFolderPathByFile(e,s)),t.isInsideBackupFolder=e=>t.isInsideBackupFolderByFile(e),t.manualTaggingVariant=r.createSelector(t.selectBrowseExperimentsOptional,e=>{var t;return null!==(t=null==e?void 0:e.manualTagging)&&void 0!==t?t:"OFF"}),t.flowsAutomatedFolderUiVariant=r.createSelector(t.selectBrowseExperimentsOptional,e=>{var t;return null!==(t=null==e?void 0:e.flowsAutomatedFolderUi)&&void 0!==t&&t}),t.flowsAutoTagUiVariant=r.createSelector(t.selectBrowseExperimentsOptional,e=>{var t;return null!==(t=null==e?void 0:e.flowsAutoTagUi)&&void 0!==t&&t}),t.autoTagAwarenessVariant=r.createSelector(t.selectBrowseExperimentsOptional,e=>{var t;return null!==(t=null==e?void 0:e.autoTagAwareness)&&void 0!==t&&t}),t.selectIsTaggingEnabled=r.createSelector(t.manualTaggingVariant,E.isTaggingEnabled),t.selectIsTagsColumnEnabled=r.createSelector(t.manualTaggingVariant,E.isTagsColumnOnBrowseEnabled);const F=(e,t)=>{const s=t[v.getFileMapKey(e)];let i=e;return void 0!==s&&(i=new l.File(Object.assign(Object.assign({},e),{tags:s.map(e=>({value:e,highlighted:!1}))}))),i};t.sortedFilesWithFolderSizesAndTags=r.createSelector(t.sortedFilesWithFolderSizes,S.selectTagsByFile,(e,t)=>e.map(e=>F(e,t)));const R=r.createSelector(t.unsortedFiles,S.selectTagsByFile,(e,t)=>e.withMutations(e=>{e.forEach((s,i)=>{e.set(i,F(s,t))})}));t.selectedFilesWithTags=r.createSelector(R,t.selection,(e,t)=>C(e,t)),t.selectCurrentFolderInfoWithTags=r.createSelector(t.getCurrentFolderInfo,S.selectTagsByFile,(e,t)=>{if(void 0!==e)return F(e,t)}),t.createMenuOpenRequest=e=>t.getBrowseState(e).createMenuOpenRequest,t.getIndexOfFile=(e,s)=>t.sortedFiles(s).findIndex(t=>t.sjid===e.sjid&&t.ns_id===e.ns_id),t.backupNewLocationHintEnabled=r.createSelector(t.selectPostTTIExperimentsOptional,e=>"ON"===(null==e?void 0:e.expBackupNewLocationHint)),t.ggToCdmMigrationVariant=r.createSelector(t.selectPostTTIExperimentsOptional,e=>{var t;return null!==(t=null==e?void 0:e.expGgToCdmMigrationVariant)&&void 0!==t?t:"OFF"}),t.isGgToCdmMigrationExperimentActive=r.createSelector(t.ggToCdmMigrationVariant,e=>["CONTROL","V1"].includes(e))})),define("metaserver/static/js/modules/clean/react/browse/data/folder_overview_selectors",["require","exports","tslib","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/folder_overview/data/selectors","metaserver/static/js/modules/clean/react/browse/data/selectors","reselect","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/filepath/filepath"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowFamilyEmptyState=t.shouldShowVaultEmptyState=t.paginatedTotalNumFiles=t.folderOverviewPinnedItems=t.folderOverviewLoggingFileId=t.folderOverviewFolderFileId=t.hasFailedToLoad=t.haveAllComponentsLoaded=void 0,r=s.__importStar(r),l=s.__importStar(l);const c=r.makeHaveAllComponentsLoadedSelector(),d=r.makeHasFailedToLoadSelector(),u=r.makeFolderFileIdSelector(),p=r.makeLoggingFileIdSelector(),_=r.makePinnedItemsSelector();t.haveAllComponentsLoaded=e=>c(e,{componentNamespace:i.BrowseFolderOverviewComponentNamespace}),t.hasFailedToLoad=e=>d(e,{componentNamespace:i.BrowseFolderOverviewComponentNamespace}),t.folderOverviewFolderFileId=e=>u(e,{path:a.path(e)}),t.folderOverviewLoggingFileId=e=>p(e,{path:a.path(e)}),t.folderOverviewPinnedItems=e=>_(e,{path:a.path(e)}),t.paginatedTotalNumFiles=e=>a.browseLoadingState(e)===n.LoadingState.LOADED?a.sortedFiles(e).count():a.getBrowseState(e).paginatedTotalNumFiles,t.shouldShowVaultEmptyState=o.createSelector(a.context,t.paginatedTotalNumFiles,(e,t)=>e.isInsideVaultFolder&&null!=e.currentNSPath&&l.paths_are_equal(e.currentNSPath,"")&&0===t),t.shouldShowFamilyEmptyState=o.createSelector(a.context,t.paginatedTotalNumFiles,a.experiments,(e,t,s)=>e.isInFamilySharedFolder&&null!=e.currentNSPath&&l.paths_are_equal(e.currentNSPath,"")&&0===t)})),define("metaserver/static/js/modules/clean/react/browse/data/store",["require","exports","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/react/browse/data/reducer","metaserver/static/js/modules/clean/redux/store","metaserver/static/js/modules/clean/tagging/data/store","metaserver/static/js/modules/clean/business_space/browse/data/store"],(function(e,t,s,i,r,a,o){"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForBrowse=void 0,t.getStoreForBrowse=()=>(n||(n=r.getStoreAndRegisterReducers({[s.BROWSE_NAMESPACE_KEY]:i.browseReducer})),a.getStoreForTagging(),o.getStoreForClientPortal(),n)})),define("metaserver/static/js/modules/clean/react/browse/right_rail_preferences",["require","exports","metaserver/static/js/modules/core/persistence/storage","metaserver/static/js/modules/core/exception"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setIsCollapsed=t.getIsCollapsed=t.RIGHTRAIL_COLLAPSED_STORAGE_KEY=void 0,t.RIGHTRAIL_COLLAPSED_STORAGE_KEY="browse_right_rail_collapsed_preferences",t.getIsCollapsed=function(e){try{return s.UserLocalStorage.get(e,t.RIGHTRAIL_COLLAPSED_STORAGE_KEY)||!1}catch(e){return i.reportException({err:e,severity:"non-critical"}),!1}},t.setIsCollapsed=function(e,r){try{s.UserLocalStorage.set(e,t.RIGHTRAIL_COLLAPSED_STORAGE_KEY,r)}catch(e){i.reportException({err:e,severity:"non-critical"})}}})),define("metaserver/static/js/modules/clean/react/right_rail/user_education/right_rail_user_education_tracker",["require","exports","tslib","metaserver/static/js/modules/clean/growth/user_action/tracker"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RightRailUserEducationTracker=t.RightRailUserEducationActions=void 0,(function(e){e.FOLDER_OVERVIEW_INTERACTION="folder_overview_interaction",e.PINNED_BLADE_INTERACTION="pinned_blade_interaction",e.TOOLTIP_SEEN="tooltip_seen"})(t.RightRailUserEducationActions||(t.RightRailUserEducationActions={}));class r extends i.GrowthUserActionTracker{constructor(){super(...arguments),this.project="right_rail_user_education"}hasPerfomed(e){return s.__awaiter(this,void 0,void 0,(function*(){return(yield this.client.rpc("performed_user_action",{project:this.project,action:e},{subjectUserId:this.userId})).has_performed}))}}t.RightRailUserEducationTracker=r})),define("metaserver/static/js/modules/clean/react/file_uploader/action_logger",["require","exports","tslib","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/react/file_uploader/web_upload_action_logger","metaserver/static/js/modules/clean/web_user_action_logger","metaserver/static/js/modules/clean/react/file_uploader/web_upload_action_events","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/clean/react/file_uploader/utils","metaserver/static/js/modules/core/exception"],(function(e,t,s,i,r,a,o,n,l,c,d,u){"use strict";function p(){const e=c.get_pathname();return"/h"===e?"HOME":"/recents"===e?"RECENTS":"/starred"===e?"STARRED":e.startsWith("/share")?"SHARED":"/requests"===e?"FILE_REQUESTS":"/deleted_files"===e?"DELETED_FILES":"BROWSE"}Object.defineProperty(t,"__esModule",{value:!0}),t.logUploadAction=void 0,i=s.__importStar(i),c=s.__importStar(c),t.logUploadAction=function({action:e,upload:t,chooser_type:s,upload_method:_,num_files:m,num_dirs:f,errorType:h,extra:g,batchId:S,user:E,uploadPath:v,useUploadKit:T,source:b}){let I={num_files:m,num_dirs:f,chooser_type:s,upload_method:_,extra:Object.assign({origin:p(),use_upload_kit:T?"true":"false"},b&&{source:b})};if((function(e){return e&&!!e.uploadId})(t)){const s=t,a=e===n.WebUploadActionEvent.UPLOAD_FAILURE?s.errorType===r.UploadErrorType.GENERIC&&h?h:s.errorType:void 0;I=Object.assign(Object.assign({},I),{upload_id:s.uploadId,file_size:s.size,file_extension:i.file_extension(s.name),failure_reason:a,batch_id:s.batchId,upload_destination:s.dest,current_path:c.get_pathname(),file_name:s.name})}else if((function(e){return e&&!!e.batchId})(t)){const e=t;I=Object.assign(Object.assign({},I),{file_size:e.size,file_extension:i.file_extension(e.name),batch_id:e.batchId})}return!I.chooser_type&&t&&"chooserType"in t&&t.chooserType&&(I.chooser_type=t.chooserType),S&&(I.batch_id=S),v&&(I.batch_dest_folder_level=d.getFolderLevel(v),E&&(I.member_folder=d.isInMemberFolder(E,v))),g&&(I.extra=Object.assign(Object.assign({},I.extra),g)),E?(function(e){return e===l.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===l.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===l.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===l.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===l.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===l.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===l.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK})(e)?o.WebUserActionLog.log(E.id,e,I):(e=e,I.client_timestamp=Math.round(Date.now()/1e3),a.WebUploadActionLog.log(E.id,e,I)):void u.reportStack("Trying to log web upload event but user is null",{severity:u.SEVERITY.NONCRITICAL})}})),define("metaserver/static/js/modules/clean/react/file_uploader/constants",["require","exports","tslib","immutable"],(function(e,t,s,i){"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ValidChunkSizeStrings=t.FileUpload=t.OverQuotaStatusType=t.UploadErrorType=t.TeamAccessLevel=t.FileStatusType=t.UploaderActionType=t.MAX_FILE_SIZE=t.ChooserType=void 0,i=s.__importStar(i),(function(e){e.FILE="file",e.FOLDER="folder",e.FILE_FOLDER="file_folder",e.UNKNOWN="unknown"})(t.ChooserType||(t.ChooserType={})),t.MAX_FILE_SIZE=524288e5,(function(e){e.ALL_UPLOADS_COMPLETE="ALL_UPLOADS_COMPLETE",e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.READY_UPLOADS="READY_UPLOADS",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES",e.SET_HAS_OVERQUOTA_ERROR="SET_HAS_OVERQUOTA_ERROR",e.SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN="SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN",e.ADD_TEAM_ACCESS_LEVEL="ADD_TEAM_ACCESS_LEVEL",e.RESET_TEAM_ACCESS_LEVELS="RESET_TEAM_ACCESS_LEVELS",e.SET_UPLOAD_PROGRESS="SET_UPLOAD_PROGRESS",e.SET_FILE_UPLOAD_TIME_LEFT="SET_FILE_UPLOAD_TIME_LEFT"})(t.UploaderActionType||(t.UploaderActionType={})),(function(e){e.SET_PERMISSIONS="SET_PERMISSIONS",e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(r=t.FileStatusType||(t.FileStatusType={})),(function(e){e.WRITER="WRITER",e.READER="READER",e.NO_ACCESS="NO_ACCESS",e.INHERIT="INHERIT"})(t.TeamAccessLevel||(t.TeamAccessLevel={})),(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.INVALID_EXTENSION="INVALID_EXTENSION",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.COMMIT_INVALID_ARGS="COMMIT_INVALID_ARGS",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_RESPONSE_ERROR="SERVER_RESPONSE_ERROR",e.SERVER_TOKEN_EMPTY_ERROR="SERVER_TOKEN_EMPTY_ERROR",e.SERVER_TOKENS_MISSING_ERROR="SERVER_TOKENS_MISSING_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.BLOB_MISSING_ERROR="BLOB_MISSING_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR",e.UPLOAD_PRECHECK_ERROR="UPLOAD_PRECHECK_ERROR",e.UPLOAD_PRECHECK_INVALID_CHAR_ERROR="UPLOAD_PRECHECK_INVALID_CHAR_ERROR",e.PERMISSIONS_AT_UPLOAD_ERROR="PERMISSIONS_AT_UPLOAD_ERROR"})(a=t.UploadErrorType||(t.UploadErrorType={})),(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));class o extends(i.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:r.SET_PERMISSIONS,errorType:a.GENERIC,errorMessage:"",batchId:void 0,chooserType:void 0,numSecondsLeft:0},"FileUpload")){}t.FileUpload=o,(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={}))})),define("metaserver/static/js/modules/clean/react/file_uploader/utils",["require","exports","tslib","react","dig-components/tooltips","metaserver/static/js/modules/clean/base64","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/async_file_modal_controller","metaserver/static/js/modules/clean/react/file_uploader/constants","metaserver/static/js/modules/clean/react/upload_kit/lib/types","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/snackbar","metaserver/static/js/modules/clean/viewer","metaserver/static/js/modules/clean/em_string"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m){"use strict";function f(){let e="";for(let t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));let t=a.encode(e);return t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t=t.replace(/\=*$/,""),t}function h(e,t){return!e.is_team||!e.is_cdm_member||""!==o.normalize(t)&&(o.paths_are_equal(e.cdm_tmf_path,t)||o.inSubDirectory(e.cdm_tmf_path,t))}function g(e,t){let s=e.dest;const i=E(t);for(;E(s)-1>i;)s=o.parent_dir(s);return s}function S(e,t){const s=e.toArray().map(e=>g(e,t));return Array.from(new Set(s))}function E(e){return(o.normalize(e).match(/\//g)||[]).length+1}function v(e){switch(e){case c.UploadErrorType.EmptyFile:return u.intl.formatMessage({id:"KZETkM",defaultMessage:"Empty files cannot be uploaded."});case c.UploadErrorType.OverMaxFileSize:return u.intl.formatMessage({id:"Hg3ZgC",defaultMessage:"File is too large to be uploaded."});default:return u.intl.formatMessage({id:"WQDOGQ",defaultMessage:"This file is not supported by Dropbox and cannot be uploaded."})}}Object.defineProperty(t,"__esModule",{value:!0}),t.makeUploadSnippet=t.showCannotUploadLinksSnackbar=t.showCannotUploadEmptyFolderSnackbar=t.promiseWithRetries=t.folderModalTitle=t.getDestinationDir=t.showInvalidFileWarning=t.getFolderLevel=t.getFileUploadsWithStatus=t.isUploadInTmf=t.uploadContainsFolder=t.isMultifolderUpload=t.getRootDests=t.getRootDest=t.getFSWMetadataToLog=t.PERMISSION_FSW_IDS=t.getUploadLocationMetadataToLog=t.isInMemberFolder=t.getOQmodalOQALocationCode=t.getNsId=t.calculateSizeOfUploads=t.generateBatchId=t.generateUploadId=void 0,i=s.__importDefault(i),a=s.__importStar(a),o=s.__importStar(o),n=s.__importStar(n),d=s.__importStar(d),t.generateUploadId=function(){return f()},t.generateBatchId=function(){return"batch-"+f()},t.calculateSizeOfUploads=function(e,t){let s=0;return e.forEach(e=>{-1!==t.indexOf(e.status)&&(s+=e.size)}),s},t.getNsId=function(e,t,s){let i=t,r=0;return e.forEach((e,t)=>{let a=0;const o=e.split("/"),n=s.split("/");for(;a<o.length&&a<n.length&&o[a]===n[a];)a++;a===o.length&&a>1&&a>r&&(r=a,i=Number(t))}),i},t.getOQmodalOQALocationCode=e=>"/h"===(e||d.get_uri().path)?"ho":"fb",t.isInMemberFolder=h,t.getUploadLocationMetadataToLog=function(e,t){return{root_folder:""===o.normalize(t),member_folder:h(e,t),folder_level:o.normalize(t).split("/").length}},t.PERMISSION_FSW_IDS=["action_commit_to_tsd_root","action_missing_parent"],t.getFSWMetadataToLog=function(e){return{has_permissions:e.includes("action_commit_to_tsd_root"),has_permissions_nonroot:e.includes("action_missing_parent"),has_other:e.some(e=>!t.PERMISSION_FSW_IDS.includes(e))}},t.getRootDest=g,t.getRootDests=S,t.isMultifolderUpload=function(e,t){const s=S(e.filter(e=>l.FileStatusType.SET_PERMISSIONS===e.status),t);return!s.every(e=>e===s[0])},t.uploadContainsFolder=function(e,t){const s=e.filter(e=>l.FileStatusType.SET_PERMISSIONS===e.status),i=E(t);return S(s,t).some(e=>E(e)>i)},t.isUploadInTmf=function(e,t){if(!t.cdm_tmf_path)return!1;const s=e.filter(e=>l.FileStatusType.SET_PERMISSIONS===e.status),i=o.normalize(t.cdm_tmf_path);return s.some(e=>e.dest===i||o.inSubDirectory(i,e.dest))},t.getFileUploadsWithStatus=function(e,t){return e.valueSeq().toArray().filter(e=>t.includes(e.status))},t.getFolderLevel=E,t.showInvalidFileWarning=function(e,t,s){return new Promise((i,r)=>{if(e.length){const{title:a,text:o}=(function(e){if(1===e.length){const{name:t,validationError:s}=e[0];return{title:u.intl.formatMessage({id:"uQF0D4",defaultMessage:"Unable to upload {file}"},{file:t}),text:v(s)}}{const t=u.intl.formatMessage({id:"Chf30m",defaultMessage:"Unable to upload one or more files"}),s=e.map(({name:e})=>e);if(e.length<=3)return{title:t,text:u.intl.formatMessage({id:"fKAsp7",defaultMessage:"The following files are not supported by Dropbox and cannot be uploaded: {files}"},{files:s.join(", ")})};const i=s.length-3;return{title:t,text:u.intl.formatMessage({id:"z9swUK",defaultMessage:"{count, plural, one{The following files are not supported by Dropbox and cannot be uploaded: {files} and {count} more} other{The following files are not supported by Dropbox and cannot be uploaded: {files} and {count} more}}"},{files:s.slice(0,3).join(", "),count:i})}}})(e),l=e.some(({validationError:e})=>e===c.UploadErrorType.CloudDoc)?"https://www.dropbox.com/help/syncing-uploads/web-based-files":"https://help.dropbox.com/installs-integrations/sync-uploads/files-not-syncing";n.showFileSystemWarningsModal({confirmText:u.intl.formatMessage({id:"Bmo28B",defaultMessage:"{count, plural, one{Skip this file} other{Skip these files}}"},{count:e.length}),fsws:[{id:"action_upload_invalid_extension",blocking:t,title:a,text:o,learn_more:l}],onFinalAccept:i,onAbortAction:s?r:void 0})}else i()})},t.getDestinationDir=function(e,t){const s=o.normalize(e),i=o.parent_dir(t);return""===s?"/"===i?"/":"/"+i:"/"===i?s:s+"/"+i},t.folderModalTitle=i.default.createElement(i.default.Fragment,null,u.intl.formatMessage({id:"2sJoAc",defaultMessage:"Upload file in..."}),i.default.createElement(r.Toggletip,{"aria-label":"More information",iconButtonSize:"standard",title:u.intl.formatMessage({id:"Grmp0v",defaultMessage:"Choose a folder you have access to"})})),t.promiseWithRetries=(e,t)=>s.__awaiter(void 0,void 0,void 0,(function*(){let s=0,i=yield e();for(;i.isError&&s<t;)s++,i=yield e();return{response:i,retryCount:s}})),t.showCannotUploadEmptyFolderSnackbar=()=>{p.Snackbar.fail(u.intl.formatMessage({id:"N5+K9w",defaultMessage:"Can’t upload empty folder."}),"upload-error-empty-dir",!0)},t.showCannotUploadLinksSnackbar=()=>{p.Snackbar.fail(u.intl.formatMessage({id:"VRES4Y",defaultMessage:"Can’t upload links. To save a link, go to Create > More > Shortcut."}),"upload-error-no-links",!0)},t.makeUploadSnippet=(e,t,s)=>{const i=_.Viewer.get_viewer();let r;return i.is_paired&&t.is_team&&(r=i.team_name),i.is_paired?t.is_team?T(s,e,r):b(s,e):I(s,e)};const T=(e,t,s)=>{const i=m.Emstring.em_snippet(o.filename(e),t);return"/"===e?u.intl.formatMessage({id:"hem9Id",defaultMessage:"upload to your {team_name} Dropbox"},{team_name:s}):u.intl.formatMessage({id:"dFFTlY",defaultMessage:"upload to the folder ‘{folder}’ in your {team_name} Dropbox"},{folder:i,team_name:s})},b=(e,t)=>{const s=m.Emstring.em_snippet(o.filename(e),t);return"/"===e?u.intl.formatMessage({id:"2iuZ56",defaultMessage:"upload to your personal Dropbox"}):u.intl.formatMessage({id:"ezK+EU",defaultMessage:"upload to the folder ‘{folder}’ in your personal Dropbox"},{folder:s})},I=(e,t)=>{const s=m.Emstring.em_snippet(o.filename(e),t);return"/"===e?u.intl.formatMessage({id:"te1cSD",defaultMessage:"upload to your Dropbox"}):u.intl.formatMessage({id:"bgpbuT",defaultMessage:"upload to the folder ‘{folder}’"},{folder:s})}})),define("metaserver/static/js/modules/clean/react/files_view/column_helpers",["require","exports","metaserver/static/js/modules/clean/immutability_helper"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.swapColumns=void 0,t.swapColumns=function(e,t,i){const r=e.map(e=>e.sortField).indexOf(t),a=e.map(e=>e.sortField).indexOf(i);if(r===a||-1===r||-1===a)return e;const o=e[r],n=e[a];return s.splice(s.splice(e,r,1,n),a,1,o)}})),define("metaserver/static/js/modules/clean/react/files_view/column_manager",["require","exports","tslib","lodash","react","metaserver/static/js/modules/clean/react/hooks/usePrevious","spectrum/dimensions/index","metaserver/static/js/modules/clean/immutability_helper","metaserver/static/js/modules/clean/react/files_view/column_helpers","metaserver/static/js/modules/clean/react/files_view/resizing/column_size_context","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/view_type"],(function(e,t,s,i,r,a,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnManagerComponent=t.ColumnManager=void 0,i=s.__importStar(i),r=s.__importDefault(r),t.ColumnManager=e=>{var{responsiveContainer:i}=e,a=s.__rest(e,["responsiveContainer"]);return(a.isMatchedLarge||a.isMatchedMedium)&&i?r.default.createElement(o.Dimensions,null,({width:e})=>{const s=Object.assign({},a);return e&&(s.isMatchedLarge=e>824,s.isMatchedMedium=!s.isMatchedLarge&&e>588),r.default.createElement(t.ColumnManagerComponent,Object.assign({},s,{containerWidth:e}))}):r.default.createElement(t.ColumnManagerComponent,Object.assign({},a))},t.ColumnManager.displayName="ColumnManager",t.ColumnManagerComponent=e=>{const[t,s]=r.default.useState(()=>e.preferredColumns?h(e):(function(e){return e.columns.slice(0,v(e))})(e)),[o,p]=r.default.useState(()=>T(t)),_=r.default.useRef(),m=r.default.useRef(),f=a.usePrevious(e);function h(e){const{currentSort:t,viewType:s,preferredColumns:i,isBusinessSpaceFound:r}=e;let a=i;if(r||(a=a.filter(e=>e.sortField!==d.SortField.CLIENT_ACCESS)),s===u.ViewType.Grid||s===u.ViewType.LargeGrid){const e=a.find(e=>e.sortField===t.sortField);a=[e||a[0]]}else a=a.slice(0,v(e));return a}function g(t,i=!1){const r=T(t);s(t),p(r),i?_.current=setTimeout(()=>{S(),e.onCanDisplayFolderSizesChanged(r)}):e.onCanDisplayFolderSizesChanged(r)}r.default.useEffect(()=>{if(!f)return void e.onCanDisplayFolderSizesChanged(o);if(e.preferredColumns){const s=h(e);return void(i.isEqual(s,t)||g(s,!0))}const{columns:r,currentSort:a}=e,n=v(f),c=v(e);if(i.isEqual(e.columns,f.columns)&&e.viewType===f.viewType){if(c<n)g(t.slice(0,c),!0);else if(c>n){const e=c-t.length,s=i.filter(r,e=>!i.find(t,t=>t.sortField===e.sortField)).slice(0,e);g([...t,...s],!0)}}else if(1===c&&r.length&&a){const{viewType:t,viewTypeColumns:i}=e,o=i?i[u.ViewType.Grid]:void 0;switch(t){case u.ViewType.List:case u.ViewType.CondensedList:g([r[0]],!0);break;case u.ViewType.Grid:case u.ViewType.LargeGrid:if(o){const i=r.find(e=>e.sortField===a.sortField)||r[0];(function(t,i,r){E();const a=T(t);s(t),p(a),m.current=setTimeout(()=>{E(),e.onColumnsChanged({columns:i,viewType:r,canDisplayFolderSizes:a})})})([i],l.swapColumns(o,o[0].sortField,i.sortField),t)}}}else g(r.slice(0,c),!0)},[e.columns,e.viewType,e.isMatchedLarge,e.isMatchedMedium,e.numVisibleColumns,e.preferredColumns,e.isBusinessSpaceFound]);const S=()=>{_.current&&(clearTimeout(_.current),_.current=void 0)};function E(){m.current&&(clearTimeout(m.current),m.current=void 0)}function v(e){const{isMatchedLarge:t,isMatchedMedium:s,viewType:i,numVisibleColumns:r,isMoreColumnsEnabled:a,isSearchMode:o}=e;switch(i){case u.ViewType.Grid:case u.ViewType.LargeGrid:return 1;case u.ViewType.List:case u.ViewType.CondensedList:default:return a?o?3:r||3:t?3:s?2:1}}function T(e){return e.some(e=>e.sortField===d.SortField.SIZE)}const{children:b,containerWidth:I}=e;if(!b)return null;let w=b;return"function"==typeof b&&(w=b({visibleColumns:t,canDisplayFolderSizes:o,handleSelection:function(s,i){const{isMoreColumnsEnabled:r,preferredColumns:a,viewType:o}=e;r&&a&&(o===u.ViewType.List||o===u.ViewType.CondensedList)?(function(s,i,r){const{onColumnsChanged:a,viewType:o}=e,l=t.indexOf(s),c=t.includes(i)?t.indexOf(i):t.length-1,d=l>=0?n.splice(t,l,1):n.splice(t,c+1,0,s);g(d),a({columns:[...d,...r.filter(e=>!d.includes(e))],viewType:o,canDisplayFolderSizes:T(d),numVisibleColumns:d.length})})(s,i,a):(function(s,i){const{viewType:r,onColumnsChanged:a,viewTypeColumns:o,preferredColumns:c}=e,p=c||(o?o[u.ViewType.List]:void 0),_=o?o[u.ViewType.Grid]:void 0;if(p&&_){const e=t.indexOf(i);if(-1===e||t.includes(s))g(t);else{const o=n.splice(t,e,1,s);g(o);const m=T(o);r===u.ViewType.List||r===u.ViewType.CondensedList?a({columns:l.swapColumns(p,i.sortField,s.sortField),viewType:u.ViewType.List,canDisplayFolderSizes:m}):(c||a({columns:l.swapColumns(_,i.sortField,s.sortField),viewType:r,canDisplayFolderSizes:m}),s.sortField!==d.SortField.FILENAME&&a({columns:l.swapColumns(p,p[1].sortField,s.sortField),viewType:u.ViewType.List,canDisplayFolderSizes:m}))}}})(s,i)},handleReorder:function(s,i){const{preferredColumns:r,onColumnsChanged:a,viewType:o}=e;if(!r||!t[s]||!t[i])return;const l=n.splice(n.splice(t,i,1),s,0,t[i]);g(l),a({columns:[...l,...r.filter(e=>!l.includes(e))],viewType:o,canDisplayFolderSizes:T(l),numVisibleColumns:l.length})},containerWidth:I})),r.default.createElement(c.ColumnResizingProvider,{storageSetting:e.columnResizeStorageSetting||c.noStorage,columnResizingEnabled:!!e.isMoreColumnsEnabled,scrollContainerWidth:e.scrollContainerWidth,visibleColumns:t},w)}})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/column_header_cell",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/typography","spectrum/table/index","metaserver/static/js/modules/clean/react/files_view/column_headers/draggable_reorder","metaserver/static/js/modules/clean/react/files_view/resizing/column_size_context","metaserver/static/js/modules/clean/react/files_view/sort_types","focus-visible"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p){"use strict";function _(e){return e===p.SortDirection.ASCENDING?"ascending":e===p.SortDirection.DESCENDING?"descending":"none"}Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnHeaderCell=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importStar(n);const m=(e,t)=>s=>{s.getModifierState("Alt")&&"ArrowLeft"===s.key&&e(),s.getModifierState("Alt")&&"ArrowRight"===s.key&&t()},f=({column:e,sortDirection:t,setSort:s,onDecreaseSize:c,onIncreaseSize:d})=>{const{columnResizingEnabled:_}=r.default.useContext(u.ColumnResizingContext);return e.isSortDisabled||e.isSortOrderOptionDisabled?r.default.createElement(l.Text,{variant:"label",isBold:void 0!==t,className:i.default("files-view-column-header-unclickable","files-view-column-header-text",{"column-resizing-enabled":_}),tabIndex:_?0:void 0,onKeyDown:m(c,d)},e.label):r.default.createElement(a.Button,{variant:"transparent",hasNoUnderline:!0,onClick:()=>s(e.sortField,(function(e){switch(e){case p.SortDirection.ASCENDING:return p.SortDirection.DESCENDING;default:return p.SortDirection.ASCENDING}})(t)),className:i.default("files-view-column-header-text",{"column-resizing-enabled":_}),onKeyDown:m(c,d)},r.default.createElement(l.Text,{variant:"label",isBold:void 0!==t},e.label),t&&r.default.createElement(o.UIIcon,{src:t===p.SortDirection.ASCENDING?n.ArrowUpLine:n.ArrowDownLine,size:"small",className:"files-view-column-header-sort-button"}))};f.displayName="ColumnHeaderCellContent",f.displayName="ColumnHeaderCellContent";const h=e=>{var{index:t,className:a}=e,o=s.__rest(e,["index","className"]);const n=d.useDraggableReorder(t),{className:l}=n,u=s.__rest(n,["className"]);return r.default.createElement(c.TableHeadCell,Object.assign({className:i.default(a,l)},o,u))};h.displayName="DraggableTableHeadCell",t.ColumnHeaderCell=({children:e,column:t,index:s,role:i,setSort:a,sortDirection:o,canMove:n,onDecreaseSize:l,onIncreaseSize:d})=>{const p=r.default.useContext(u.ColumnResizingContext);let m;p.columnResizingEnabled&&(m=p.columnSizes[t.sortField]);const g=void 0===m?{}:{width:m,minWidth:m,maxWidth:m},S={key:s,role:i,scope:"col","aria-sort":_(o),className:"files-view-column-header-table-cell",style:g,children:r.default.createElement(r.default.Fragment,null,r.default.createElement(f,{column:t,sortDirection:o,setSort:a,onDecreaseSize:l,onIncreaseSize:d}),e)};return n?r.default.createElement(h,Object.assign({index:s},S)):r.default.createElement(c.TableHeadCell,Object.assign({},S))},t.ColumnHeaderCell.displayName="ColumnHeaderCell",t.ColumnHeaderCell.displayName="ColumnHeaderCell"})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/column_header_menu",["require","exports","tslib","classnames","react","react-redux","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/menu","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/tagging/experiments","metaserver/static/js/modules/clean/react/files_view/column_headers/tags_column_tooltip/index"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnHeaderMenu=t.AvailableMoves=void 0,i=s.__importDefault(i),r=s.__importDefault(r);var m;(function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.BOTH=3]="BOTH"})(m=t.AvailableMoves||(t.AvailableMoves={})),t.ColumnHeaderMenu=({columns:e,index:t,onSelection:s,onMenuOpen:f,selectedColumns:h,title:g,allowUnchecking:S,availableMoves:E,isSearchMode:v})=>{const T=[m.BOTH,m.LEFT].includes(E),b=[m.BOTH,m.RIGHT].includes(E),I=T||b,[w,C]=r.default.useState(!1),O=a.useSelector(u.manualTaggingVariant),F=0===t&&!v&&p.isTagsColumnOnBrowseEnabled(O);return r.default.createElement(c.Menu.Wrapper,{onSelection:e=>s(t,e),onToggle:({isOpen:e})=>e&&f(t,h[t].popoverTriggerLabel)},({getContentProps:t,getTriggerProps:s,triggerRef:a})=>r.default.createElement(r.default.Fragment,null,r.default.createElement(o.IconButton,Object.assign({},s(),{variant:"transparent",size:"small","aria-label":d.intl.formatMessage({id:"+D26UW",defaultMessage:"Change column"}),className:i.default("files-view-column-header-menu-button",{"files-view-column-header-menu-open":t().open||w}),"data-testid":"files-view-column-header-menu-trigger"}),r.default.createElement(n.UIIcon,{src:l.ChevronDownLine,size:"small"})),r.default.createElement(c.Menu.Content,Object.assign({},t(),{placement:"bottom-end"}),r.default.createElement(c.Menu.Segment,{withLabel:g},e.map(e=>r.default.createElement(c.Menu.SelectItem,{"aria-label":e.popoverTriggerLabel,key:e.popoverTriggerLabel,value:{type:"ColumnSelection",payload:e},selected:h.includes(e),disabled:e.isLocked||!S&&h.includes(e)},e.label))),I&&r.default.createElement(c.Menu.Segment,{withLabel:d.intl.formatMessage({id:"Yzabjr",defaultMessage:"Adjust"})},r.default.createElement(c.Menu.Submenu,{withTriggerContent:d.intl.formatMessage({id:"qKy/7I",defaultMessage:"Column order"})},r.default.createElement(c.Menu.Segment,null,r.default.createElement(c.Menu.ActionItem,{value:{type:"ColumnOrderSelection",payload:"left"},disabled:!T},d.intl.formatMessage({id:"obFNpg",defaultMessage:"Move left"})),r.default.createElement(c.Menu.ActionItem,{value:{type:"ColumnOrderSelection",payload:"right"},disabled:!b},d.intl.formatMessage({id:"7QBrxY",defaultMessage:"Move right"})))))),F&&r.default.createElement(_.TagsColumnTooltip,{showTooltip:w,setShowTooltip:C,triggerRef:a})))},t.ColumnHeaderMenu.displayName="ColumnHeaderMenu"})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/dig_column_header",["require","exports","tslib","classnames","react","dig-components/controls","spectrum/table/index","metaserver/static/js/modules/clean/react/files_view/column_headers/column_header_cell","metaserver/static/js/modules/clean/react/files_view/column_headers/column_header_menu","metaserver/static/js/modules/clean/react/files_view/column_headers/draggable_reorder","metaserver/static/js/modules/clean/react/files_view/column_headers/resize_handle","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/fixed_table_head","metaserver/static/js/modules/clean/react/files_view/resizing/column_size_context","metaserver/static/js/modules/clean/react/files_view/sticky_table_head","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnHeader=void 0,i=s.__importDefault(i),r=s.__importDefault(r);const S=(e,t)=>{switch(e){case h.ViewType.Grid:case h.ViewType.LargeGrid:return g.intl.formatMessage({id:"iWzO4p",defaultMessage:"Group by"});case h.ViewType.List:default:return t?g.intl.formatMessage({id:"t3Jo9w",defaultMessage:"Sort by"}):g.intl.formatMessage({id:"IUsgJf",defaultMessage:"Show"})}};t.ColumnHeader=({columnFlex:e,items:t,isCompactMode:s,isSelectMode:h,currentSort:E,selectAllCheckboxState:v="unchecked",showSelectAllCheckbox:T=!0,stickyOffsetHeight:b,stickyOffsetTop:I,columns:w,visibleColumns:C,viewType:O,isSearchMode:F,presentationOnly:R,variant:A="fixed",onMenuOpen:y,onSelectAll:D,onDeselectAll:M,onReorder:N,onSort:L,onSelection:P,isMoreColumnsEnabled:j,disableResizing:U})=>{const{resizeColumn:x,resizeColumnToDefault:k,columnSizes:V,columnResizingEnabled:B}=r.default.useContext(_.ColumnResizingContext),W=B&&!U,[H,G]=r.default.useState(!1),[q,z]=r.default.useState(!1),K={onMouseEnter:()=>z(!0),onMouseLeave:()=>z(!1)},Y=F?u.SEARCH_LIST_VIEW_SORT_ENABLED_COLUMNS:w,J=Y.filter(e=>!e.isLocked),Q=!h&&!q&&!s,X=(e,t)=>{if("ColumnSelection"===t.type&&(function(e){return"string"==typeof(null==e?void 0:e.popoverTriggerLabel)})(t.payload)){const s=C[e],i=t.payload;P(i,s,e),F?L(i.sortField,f.SortDirection.DESCENDING):j?C.includes(i)&&(null==E?void 0:E.sortField)===i.sortField&&L(C[0].sortField,f.SortDirection.ASCENDING):(null==E?void 0:E.sortField)===s.sortField&&(i.isSortOrderOptionDisabled?L(C[0].sortField,f.SortDirection.ASCENDING):L(i.sortField,E.sortDirection||f.SortDirection.ASCENDING))}else"ColumnOrderSelection"===t.type&&("right"===t.payload&&e<C.length-1?N(e+1,e):"left"===t.payload&&e>1&&N(e-1,e))},Z=C.map((e,s)=>{const i=(e=>{if(!j)return l.AvailableMoves.NONE;const t=C[e];if(!t||t.isLocked)return l.AvailableMoves.NONE;const s=0!==e&&!C[e-1].isLocked,i=e!==C.length-1&&!C[e+1].isLocked;return s&&i?l.AvailableMoves.BOTH:s?l.AvailableMoves.LEFT:i?l.AvailableMoves.RIGHT:l.AvailableMoves.NONE})(s),a=j||!(e.isLocked||e.isSortDisabled);return r.default.createElement(n.ColumnHeaderCell,{key:e.popoverTriggerLabel,column:e,index:s,setSort:L,role:R?"presentation":"columnheader",sortDirection:(null==E?void 0:E.sortField)===e.sortField?E.sortDirection:void 0,canMove:i!==l.AvailableMoves.NONE,onIncreaseSize:()=>x(e.sortField,V[e.sortField]+4),onDecreaseSize:()=>x(e.sortField,V[e.sortField]-4)},a&&r.default.createElement(l.ColumnHeaderMenu,{columns:j?Y:J,index:s,onMenuOpen:y,onSelection:X,selectedColumns:C,title:S(O,!!F),allowUnchecking:j,availableMoves:i,isSearchMode:F}),W&&void 0!==x&&void 0!==k&&void 0!==E&&r.default.createElement(d.ResizeHandle,{onResize:t=>{G(!0),x(e.sortField,t)},onResizeToDefault:()=>k(e.sortField),onColumnResizeEnd:()=>G(!1),sortField:e.sortField,items:t}))}),$=r.default.createElement(c.DraggableReorderProvider,{onReorder:N},r.default.createElement(o.TableHeadCell,{className:"files-view-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:R?"presentation":"columnheader",scope:"col"},r.default.createElement("div",{className:"brws-vertically-center"},T&&!Q?r.default.createElement(a.Checkbox,{className:i.default("brws-checkbox",{"brws-checkbox-checked":"checked"===v}),checked:"checked"===v,isIndeterminate:"mixed"===v,onChange:e=>{"unchecked"===v?D():M()},"aria-label":g.intl.formatMessage({id:"YzMs/g",defaultMessage:"Select all"})}):null)),Z);return"default"===A?r.default.createElement(o.TableHead,Object.assign({className:i.default("brws-column-header",{"header-column-resize":W,"column-header-is-resizing":H})},K,{"data-testid":"table-head"}),$):"fixed"===A?r.default.createElement(p.FixedTableHead,Object.assign({offsetHeight:b},K,{"data-testid":"fixed-table-head"}),$):"sticky-native"===A?r.default.createElement(o.TableHead,Object.assign({className:i.default("brws-column-header brws-column-header--sticky",{"header-column-resize":W,"column-header-is-resizing":H}),style:{top:I}},K,{"data-testid":"sticky-native-table-head"}),$):r.default.createElement(m.StickyTableHead,Object.assign({columnFlex:e,offsetHeight:b,offsetTop:I,className:i.default("brws-column-header",{"header-column-resize":W,"column-header-is-resizing":H})},K,{"data-testid":"sticky-table-head"}),$)},t.ColumnHeader.displayName="ColumnHeader",t.ColumnHeader.displayName="ColumnHeader"})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/resize_handle",["require","exports","tslib","react","metaserver/static/js/modules/clean/em_string","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/rows/cells/async_folder_size"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeHandle=t.SCROLLBAR_WIDTH=void 0,i=s.__importDefault(i);t.SCROLLBAR_WIDTH=16;const c=e=>14*new r.Emstring(e).length;t.ResizeHandle=({items:e,onResize:s,onResizeToDefault:r,onColumnResizeEnd:d,sortField:u})=>{const p=i.default.useRef({type:"not_resizing"}),[_,m]=i.default.useState();i.default.useRef(s).current=s;const f=i.default.useCallback(e=>{if("resizing"===p.current.type){const{startingPageX:t,startingWidth:i}=p.current,r=i-(t-e.pageX);r!==i&&s(r)}},[]),h=i.default.useCallback(e=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",h),p.current={type:"not_resizing"},m(void 0),d()},[]),g=e=>{e.preventDefault(),window.document.removeEventListener("click",g,!0)},S=()=>{let t=0;null==e||e.forEach(e=>{if(e instanceof a.File)switch(u){case n.SortField.CATEGORY:t=Math.max(c(a.File.getCategoryDescription(e)),t);break;case n.SortField.EXTENSION:t=Math.max(c(a.File.getExtension(e)),t);break;case n.SortField.FILENAME:t=Math.max(c(o.getFilename(e)),t);break;case n.SortField.MODIFIED:case n.SortField.RELEVANCE:t=Math.max(c(e.is_dir?"--":e.ago),t);break;case n.SortField.SIZE:t=Math.max(c(e.is_dir?"--":e.size),t)}else if(e instanceof a.FileSharedWithMe)switch(u){case n.SortField.FILENAME:t=Math.max(c(o.getFilename(e)),t);break;case n.SortField.MODIFIED:case n.SortField.RELEVANCE:t=Math.max(c(e.agoFromLastActionByUserTs||e.ago),t);break;case n.SortField.SIZE:t=Math.max(c(e.is_cloud_doc&&l.isCloudDocProviderStored(e)?"--":e.size),t)}});let s=30;return u===n.SortField.FILENAME&&(s=110),t>0?t+s:0};return i.default.createElement("div",{className:"resize-drag-handle",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),window.addEventListener("mousemove",f),window.addEventListener("mouseup",h);const s=window.innerHeight-e.currentTarget.getBoundingClientRect().top-4-t.SCROLLBAR_WIDTH;p.current={type:"resizing",startingWidth:e.currentTarget.parentElement.getBoundingClientRect().width,startingPageX:e.pageX},m(s),window.document.addEventListener("click",g,!0)},onDoubleClick:()=>{if(u===n.SortField.SHARED_WITH)r();else{const e=S();e>0?s(e):r()}},"data-testid":"resize-handle"},void 0!==_&&i.default.createElement("div",{className:"resize-vertical-focus-line",style:{height:`${_}px`}}))},t.ResizeHandle.displayName="ResizeHandle",t.ResizeHandle.displayName="ResizeHandle"})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/draggable_reorder",["require","exports","tslib","classnames","react"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useDraggableReorder=t.DraggableReorderProvider=void 0,i=s.__importDefault(i);const a=(r=s.__importStar(r)).default.createContext({draggedIndex:null,setDraggedIndex:()=>{},onReorder:()=>{}});t.DraggableReorderProvider=({onReorder:e,children:t})=>{const[s,i]=r.useState(null);return r.default.createElement(a.Provider,{value:{draggedIndex:s,setDraggedIndex:i,onReorder:e}},t)},t.DraggableReorderProvider.displayName="DraggableReorderProvider",t.DraggableReorderProvider.displayName="DraggableReorderProvider",t.useDraggableReorder=e=>{const{draggedIndex:t,setDraggedIndex:s,onReorder:o}=r.useContext(a),[n,l]=r.useState(!1),c=r.useRef(null),d=t===e,u=null!==t&&!d;return{draggable:!0,onDragStart:r.useCallback(t=>{t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.dropEffect="move"),s(e)},[e]),onDragEnd:r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),s(null)},[]),onDragEnter:r.useCallback(e=>{u&&(e.preventDefault(),e.stopPropagation(),l(!0),c.current=e.target)},[u]),onDragLeave:r.useCallback(e=>{e.target===c.current&&(e.preventDefault(),e.stopPropagation(),l(!1))},[]),onDrop:r.useCallback(i=>{u&&null!==t&&(i.preventDefault(),i.stopPropagation(),s(null),l(!1),o(e,t))},[e,u,t,o]),className:i.default("draggable-reorder",{"draggable-reorder--dragging":d,"draggable-reorder--dragged-over-from-right":n&&null!==t&&t-e>0,"draggable-reorder--dragged-over-from-left":n&&null!==t&&t-e<0})}}})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/tags_column_tooltip/component",["require","exports","tslib","react","react-intl","dig-components/buttons","dig-components/click_outside","dig-components/typography","dig-components/tooltips","metaserver/static/js/modules/clean/react/files_view/resizing/column_size_context","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/column_headers/tags_column_tooltip/tracker"],(function(e,t,s,i,r,a,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsColumnTooltip=void 0,i=s.__importDefault(i),t.TagsColumnTooltip=i.default.memo(({showTooltip:e,setShowTooltip:t,triggerRef:s})=>{const[p,_]=i.default.useState("bottom"),m=r.useIntl(),{columnSizes:f}=i.default.useContext(c.ColumnResizingContext),h=i.default.useRef(null),g=f[d.SortField.FILENAME];i.default.useEffect(()=>{var e;null===(e=null==h?void 0:h.current)||void 0===e||e.update()},[g]),i.default.useEffect(()=>{u.fetchTagsColumnTooltipSeen().then(e=>t(!e))},[t]);const S=()=>{t(!1),_("bottom")};return i.default.createElement(o.ClickOutside,{isActive:e,onClickOutside:S},i.default.createElement(l.Tooltip.Control,{variant:"rich",open:e,ref:h,triggerRef:s,auto:!0,placement:p,onChangePlacement:e=>_(e),onDisplayed:()=>{u.setTagsColumnTooltipSeen()}},i.default.createElement(n.Title,{size:"standard",inverse:!0},m.formatMessage({id:"+NJwpB",defaultMessage:"Show tags here"})),i.default.createElement(n.Text,{tagName:"p",color:"standard",inverse:!0},m.formatMessage({id:"7uh+Vn",defaultMessage:"To see all these files’ tags at a glance, just click the arrow and choose “tags” from the list."})),i.default.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",marginTop:"var(--spacing__unit--2)"}},i.default.createElement(a.Button,{variant:"outline",inverse:!0,onClick:S,autoFocus:!0},m.formatMessage({id:"5LJHki",defaultMessage:"Got it"})))))}),t.TagsColumnTooltip.displayName="TagsColumnTooltip"})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/tags_column_tooltip/index",["require","exports","metaserver/static/js/modules/clean/react/files_view/column_headers/tags_column_tooltip/component"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsColumnTooltip=void 0,Object.defineProperty(t,"TagsColumnTooltip",{enumerable:!0,get:function(){return s.TagsColumnTooltip}})})),define("metaserver/static/js/modules/clean/react/files_view/column_headers/tags_column_tooltip/tracker",["require","exports","tslib","metaserver/static/js/modules/clean/growth/user_action/tracker","metaserver/static/js/api_v2/default_user_client","metaserver/static/js/modules/clean/viewer"],(function(e,t,s,i,r,a){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.setTagsColumnTooltipSeen=t.fetchTagsColumnTooltipSeen=void 0,(function(e){e.TAGS_COLUMN_TOOLTIP_SEEN="tags_column_tooltip_seen"})(o||(o={}));class n extends i.GrowthUserActionTracker{constructor(){super(...arguments),this.project="manual_tagging"}}t.fetchTagsColumnTooltipSeen=function(){var e;return s.__awaiter(this,void 0,void 0,(function*(){const t=a.Viewer.get_viewer(),s=null!==(e=t.work_user)&&void 0!==e?e:t.personal_user;if(!s)return!0;const i=new r.DefaultUserApiV2Client(s),l=new n(s.id);return(yield i.ns("growth").rpc("performed_user_action",{project:l.project,action:o.TAGS_COLUMN_TOOLTIP_SEEN},{})).has_performed}))},t.setTagsColumnTooltipSeen=function(){var e;return s.__awaiter(this,void 0,void 0,(function*(){const t=a.Viewer.get_viewer(),s=null!==(e=t.work_user)&&void 0!==e?e:t.personal_user;if(s)return new n(s.id).track(o.TAGS_COLUMN_TOOLTIP_SEEN)}))}})),define("metaserver/static/js/modules/clean/react/files_view/resizing/column_size_context",["require","exports","tslib","react","lodash","metaserver/static/js/modules/core/browser_detection","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/sort_types","lodash"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnResizingProvider=t.localStorage=t.noStorage=t.ColumnResizingContext=void 0,i=s.__importDefault(i),l=s.__importStar(l);const c={columnResizingEnabled:!1,columnSizes:o.COLUMN_DEFAULT_WIDTHS,resizeColumn:function(e,t){},resizeColumnToDefault:function(e){}};function d(e,t){const s=o.COLUMN_MIN_WIDTHS[t],i=o.COLUMN_MAX_WIDTHS[t];return Math.min(Math.max(e,s),i)}function u(e){return l.mapValues(e,(e,t)=>d(e,t))}t.ColumnResizingContext=i.default.createContext(c);const p=r.debounce((function(e,t){window.localStorage.setItem(e,JSON.stringify(t))}));t.noStorage={type:"no_storage"},t.localStorage={type:"local_storage",localStorageKey:"dbx_files_view_column_sizes"};const _=e=>{const t=i.default.useRef(e);return t.current=e,t};t.ColumnResizingProvider=({children:e,storageSetting:s,columnResizingEnabled:r,scrollContainerWidth:c,visibleColumns:m})=>{const[f,h]=i.default.useState(()=>{switch(s.type){case"no_storage":return o.COLUMN_DEFAULT_WIDTHS;case"local_storage":return(function(e){try{const t=window.localStorage.getItem(e),s=JSON.parse(t);return l.mapValues(o.COLUMN_DEFAULT_WIDTHS,(e,t)=>{const i=s[t];return"number"==typeof i?i:e})}catch(e){return o.COLUMN_DEFAULT_WIDTHS}})(s.localStorageKey)}}),g=_(f),S=_(c),E=i.default.useRef("UNFROZEN"),v=i.default.useRef(a.safari);i.default.useEffect(()=>{if(r&&c&&c>0){if(v.current)return void(v.current=!1);const e=T(f),t="UNFROZEN"===E.current||"OVERFLOW"===E.current&&c>e||"UNDERFLOW"===E.current&&c<e;e>0&&c!==e&&t&&b(n.SortField.FILENAME,c-(e-f[n.SortField.FILENAME]),"DYNAMIC")}},[c]);const T=e=>{let t=0;return m.map(e=>e.sortField).forEach(s=>{t+=e[s]}),t},b=i.default.useCallback((e,t,i="MANUAL")=>{if(g.current[e]!==t){const r=Object.assign(Object.assign({},g.current),{[e]:d(t,e)});h(r),"local_storage"===s.type&&p(s.localStorageKey,r),"MANUAL"===i&&S.current?E.current=T(r)>S.current?"OVERFLOW":"UNDERFLOW":"DYNAMIC"===i&&(E.current="UNFROZEN")}},[s,g,S]),I=i.default.useCallback(e=>{const t=o.COLUMN_DEFAULT_WIDTHS[e];b(e,t)},[b]),w=i.default.useMemo(()=>({columnSizes:u(f),resizeColumn:b,resizeColumnToDefault:I,columnResizingEnabled:r}),[f,b,I,r]);return i.default.createElement(t.ColumnResizingContext.Provider,{value:w},e)},t.ColumnResizingProvider.displayName="ColumnResizingProvider",t.ColumnResizingProvider.displayName="ColumnResizingProvider"})),define("metaserver/static/js/modules/clean/react/files_view/contexts/files_view_context",["require","exports","tslib","react","react-redux","metaserver/static/js/modules/clean/react/files_view/contexts/callback_context","metaserver/static/js/modules/clean/react/files_view/contexts/file_thumb_store","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewContextProvider=void 0,i=s.__importStar(i);t.FilesViewContextProvider=({children:e,props:t,instanceId:s})=>{const{items:c,path:d}=t,u=r.useSelector((e=>t=>l.selectViewType(t,{instanceId:e}))(s));return i.createElement(a.FilesViewCallbackContextProvider,{props:t},i.createElement(o.ThumbStoreProvider,{shouldPrewarm:u!==n.ViewType.Grid,items:c,path:d},e))},t.FilesViewContextProvider.displayName="FilesViewContextProvider"})),define("metaserver/static/js/modules/clean/react/files_view/controller",["require","exports","tslib","react-redux","react","metaserver/static/js/modules/clean/react/files_view/data/store","metaserver/static/js/modules/clean/react/files_view/files_view","metaserver/static/js/modules/clean/react/files_view/data/action_creators","metaserver/static/js/modules/clean/react/files_view/contexts/files_view_context","metaserver/static/js/modules/clean/react/flows/types","metaserver/static/js/modules/clean/react/files_view/legacy_types"],(function(e,t,s,i,r,a,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewController=t.FilesViewWithUpserter=t.splitProps=void 0,r=s.__importDefault(r),s.__exportStar(d,t);const u={arePostTTIModulesLoaded:!0,context:!0,createNewFolderState:!0,items:!0,selection:!0,user:!0,responsive:!0,clipboard:!0,currentSort:!0,disabledMultiselect:!0,dropTargetHighlightMode:!0,enableUnity:!0,expBizFoldersEmptyStateAdmin:!0,expBizFoldersEmptyStateUser:!0,fileRename:!0,filteredContactName:!0,renderFilenameSubtitleAsLink:!0,hideViewFileButton:!0,highDensity:!0,isOverFreeQuota:!0,isSearchMode:!0,loadingState:!0,sharingServiceInfo:!0,starredState:!0,teamFolders:!0,viewTypeScope:!0,viewTypes:!0,eligibleForFirstTaskSubtitle:!0,expVaultEnableViewOnlySharing:!0,isActionBarEnabled:!0,inlineActionBar:!0,expFlowsAutomatedFolderUI:!0,fileHasAutomatedRuleMap:c.FlowsMap({}),expManualTagging:"OFF",currentFolderInfo:!0,mediaFiltersVariant:"OFF",isRightClickEnabled:!0},p=(e,t,s)=>{t[s]=e[s]};t.splitProps=e=>{const t={},s={};for(const i of Object.keys(e))if(u.hasOwnProperty(i)){const t=i;void 0!==e[t]&&p(e,s,t)}else p(e,t,i);return{ownProps:t,upsertedProps:s}};let _=0;const m=e=>{const{id:s,isActive:a=!0}=e,c=i.useDispatch(),{ownProps:d,upsertedProps:u}=t.splitProps(e),p=r.default.useMemo(()=>s||`files-view:${_++}`,[s]),m=p!==s;return c(n.upsertInstance(p,u)),r.default.useEffect(()=>()=>{m&&c(n.deleteInstance(p))},[m,c,p]),r.default.useEffect(()=>{a&&s&&c(n.markActiveInstance(s))},[a,s,c]),r.default.createElement(l.FilesViewContextProvider,{props:e,instanceId:p},r.default.createElement(o.FilesView,Object.assign({},d,{id:p})))};m.displayName="UpsertWrapper",t.FilesViewWithUpserter=i.connect()(m);const f=a.getStoreForFilesView();t.FilesViewController=e=>r.default.createElement(i.Provider,{store:f},r.default.createElement(t.FilesViewWithUpserter,Object.assign({},e))),t.FilesViewController.displayName="FilesViewController"})),define("metaserver/static/js/modules/clean/react/files_view/culled_table_body",["require","exports","tslib","spectrum/table/index","metaserver/static/js/modules/clean/react/files_view/util","react"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeOffsetCache=t.scrollTo=t.CulledTableBodyWithScrollToRow=t.CulledTableBodyWithScrollContainer=void 0,a=s.__importDefault(a),t.CulledTableBodyWithScrollContainer=e=>{var{scrollContainer:t}=e,i=s.__rest(e,["scrollContainer"]);const n=a.default.useMemo(()=>(null==t?void 0:t.current)?r.createFakeWindow(t.current):null,[null==t?void 0:t.current]);return t?t.current&&n?a.default.createElement(o,Object.assign({},i,{shouldUseWindowAsScrollContainer:!0,window:n})):null:a.default.createElement(o,Object.assign({},i))},t.CulledTableBodyWithScrollContainer.displayName="CulledTableBodyWithScrollContainer",t.CulledTableBodyWithScrollContainer.displayName="CulledTableBodyWithScrollContainer";class o extends a.default.PureComponent{constructor(e){super(e),this.updateOffsetCache()}componentDidMount(){this.updateScroll(!0)}componentDidUpdate(e){e.listItemHeight!==this.props.listItemHeight&&this.updateOffsetCache(),e.scrollToRow!==this.props.scrollToRow&&this.updateScroll(void 0===e.scrollToRow||e.scrollToRow<0)}updateOffsetCache({listItemHeight:e}=this.props){this.offsetCache=Array.isArray(e)?t.computeOffsetCache(e):void 0}updateScroll(e){const{scrollToRow:s,listItemHeight:i,viewportTopOffset:r=0,scrollPositionOffset:a=0,window:o}=this.props;if(void 0!==s&&s>=0){const n=(Array.isArray(i)?this.offsetCache[s]:(s+1)*i)+a,l=n-(Array.isArray(i)?i[s]:i);t.scrollTo([l,n],r,o,e)}}render(){const e=this.props,{viewportTopOffset:t,scrollToRow:r}=e,o=s.__rest(e,["viewportTopOffset","scrollToRow"]);return a.default.createElement(i.CulledTableBody,Object.assign({viewportHeight:window.innerHeight-t},o))}}t.CulledTableBodyWithScrollToRow=o,o.defaultProps={viewportTopOffset:0},o.displayName="CulledTableBodyWithScrollToRow";t.scrollTo=([e,t],s=0,i=window,r)=>{const a=i.innerHeight-s,o=((e=window)=>"scrollingElement"in e.document&&e.document.scrollingElement?e.document.scrollingElement.scrollTop:e.document.documentElement.scrollTop)(i),n=o+a;e<o?i.scrollTo(0,e):t>n&&(r&&t-e<a/2?i.scrollTo(0,t-a/2):i.scrollTo(0,t-a))},t.computeOffsetCache=e=>e.reduce((e,t)=>(e.push(t+(e[e.length-1]||0)),e),[])})),define("metaserver/static/js/modules/clean/react/files_view/data/action_creators",["require","exports","tslib","lodash","immutable","metaserver/static/js/api_v2/user_client","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/data/types","lodash","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/clean/react/files_view/view_preferences"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadScopedSortOrders=t.setSort=t.loadPreviewThumbnails=t.batchLoadPreviewThumbnails=t.openKeyboardShortcutsModal=t.filterOutColumns=t.markActiveInstance=t.deleteInstance=t.upsertInstance=t.resetScroll=t.updateRenamingBarDisabledStatus=t.updateNamingConventionsApplyStatus=t.updateFileRenameInput=t.setFileRename=t.loadViewTypeColumns=t.setColumns=t.loadViewTypes=t.setViewType=void 0,n=s.__importStar(n),l=s.__importStar(l),d=s.__importStar(d),_=s.__importStar(_),t.setViewType=({user:e,viewType:t,viewTypeScope:s=o.VIEW_TYPE_GLOBAL_SCOPE,updateGlobalScope:i=!1})=>r=>{const a=[s];i&&s!==o.VIEW_TYPE_GLOBAL_SCOPE&&a.push(o.VIEW_TYPE_GLOBAL_SCOPE),r({type:c.ActionTypes.SET_VIEW_TYPE,payload:{viewType:t,viewScopes:a}}),_.setViewType(e.id,a,t)};t.loadViewTypes=({user:e,defaultViewType:t})=>s=>{const i=((e,t)=>{const s=_.getViewTypes(e);return s||(t?{[o.VIEW_TYPE_GLOBAL_SCOPE]:t}:null)})(e.id,t);i&&s({type:c.ActionTypes.SET_VIEW_TYPES,payload:{viewTypes:i}})},t.setColumns=({columns:e,user:t,viewTypeScope:s=o.VIEW_TYPE_GLOBAL_SCOPE,updateGlobalScope:i=!1,numVisibleColumns:r})=>a=>{const n={};e.forEach((e,t)=>{n[t]=e.sortField});const l=[s];i&&s!==o.VIEW_TYPE_GLOBAL_SCOPE&&l.push(o.VIEW_TYPE_GLOBAL_SCOPE),a({type:c.ActionTypes.SET_COLUMNS_INDEX,payload:{viewScopes:l,columnsIndex:n,numVisibleColumns:r}}),_.setColumnsIndex(t.id,l,n),void 0!==r&&_.setNumVisibleColumns(t.id,l,r)},t.loadViewTypeColumns=({user:e})=>{const t=_.getScopedColumnsIndex(e.id),s=_.getScopedNumVisibleColumns(e.id);return{type:c.ActionTypes.SET_SCOPED_COLUMNS_INDEX,payload:{scopedColumnsIndex:t,scopedNumVisibleColumns:s}}},t.setFileRename=({file:e,renameState:t})=>({type:c.ActionTypes.SET_FILE_RENAME,payload:{file:e,renameState:t}}),t.updateFileRenameInput=({renameInput:e})=>({type:c.ActionTypes.UPDATE_FILE_RENAME_INPUT,payload:{renameInput:e}}),t.updateNamingConventionsApplyStatus=({isApplyClicked:e})=>({type:c.ActionTypes.UPDATE_NAMING_CONVENTION_APPLY_STATUS,payload:{isApplyClicked:e}}),t.updateRenamingBarDisabledStatus=({})=>({type:c.ActionTypes.UPDATE_RENAMING_BAR_DISABLED_STATUS,payload:{}}),t.resetScroll=()=>({type:c.ActionTypes.SET_SCROLL,payload:{scrollTop:0}});t.upsertInstance=(e,t)=>(s,a)=>{var o,l;o=t,(!(l=n.selectInstances(a()).get(e))||Object.keys(o).some(e=>{const t=o[e],s=l[e];return!(!s&&!t||(r.Map.isMap(s)&&r.Map.isMap(t)?s.equals(t):r.List.isList(s)&&r.List.isList(t)?s.equals(t):"selection"===e?r.is(s,t):i.isEqual(t,s)))}))&&s({type:c.ActionTypes.UPSERT_INSTANCE,payload:{id:e,instance:t}})},t.deleteInstance=e=>({type:c.ActionTypes.DELETE_INSTANCE,payload:{id:e}}),t.markActiveInstance=e=>({type:c.ActionTypes.MARK_ACTIVE_INSTANCE,payload:{id:e}}),t.filterOutColumns=e=>({type:c.ActionTypes.FILTER_OUT_COLUMNS,payload:e}),t.openKeyboardShortcutsModal=t=>(i,r)=>{(function(t){s.__awaiter(this,void 0,void 0,(function*(){const{showKeyboardShortcutsModal:i}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/files_view/keyboard_shortcuts_modal"],t,s)}).then(s.__importStar);i(t)}))})(l.selectIsListView(r(),t))};t.batchLoadPreviewThumbnails=(e,t,i,r,o)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=n.previewThumbnailsToLoad(t()),d=l.selectViewType(t(),{instanceId:o});try{if(s.length>0){const t=new a.UserApiV2Client,o=yield t.ns("previews").rpc("get_preview_data_batch",{files:s},{subjectUserId:i}),n=[];o.results.forEach(e=>{var t;const s=null===(t=e.preview)||void 0===t?void 0:t.content,i=e.file.file_id;i&&s&&(s.hasOwnProperty("thumbnail_url_tmpl")?n.push({file_id:i,preview_url:s.thumbnail_url_tmpl}):s.hasOwnProperty("placeholder_image_url")&&n.push({file_id:i,preview_url:s.placeholder_image_url}))}),n.length>0&&(e((({preview_thumbnails:e})=>({type:c.ActionTypes.PREVIEW_THUMBNAILS_LOADED,payload:{preview_thumbnails:e}}))({preview_thumbnails:n})),_={view_type:d,userId:i,num_files_requested:s.length,num_files_retrieved:n.length,elapsed_ms:Date.now()-r},u.logWebUserAction({user_id:_.userId,event_name:p.WebUserActionLogEvent.PREVIEW_THUMBNAIL_SUCCESS,extra:{view_type:_.view_type,num_files_requested:_.num_files_requested.toString(),num_files_retrieved:_.num_files_retrieved.toString(),elapsed_ms:_.elapsed_ms.toString()}}))}}catch(t){e((({files:e})=>({type:c.ActionTypes.PREVIEW_THUMBNAILS_REMOVED,payload:{files:e}}))({files:s})),(e=>{u.logWebUserAction({user_id:e.userId,event_name:p.WebUserActionLogEvent.PREVIEW_THUMBNAIL_ERROR,extra:{view_type:e.view_type,error_summary:e.error_summary||"unknown"}})})({view_type:d,userId:i,error_summary:null==t?void 0:t.toString()})}var _}));const m=d.debounce((e,s,i,r,a)=>{t.batchLoadPreviewThumbnails(e,s,i,r,a)},300);t.loadPreviewThumbnails=(e,t,s)=>(i,r)=>{const a=n.previewThumbnails(r()),o=e.filter(e=>e.file_id&&!a.hasOwnProperty(e.file_id));o.length>0&&(i((({files:e})=>({type:c.ActionTypes.PREVIEW_THUMBNAILS_LOADING,payload:{files:e}}))({files:o})),m(i,r,t,Date.now(),s))},t.setSort=({user:e,sort:t,viewScope:s=o.VIEW_TYPE_GLOBAL_SCOPE,updateGlobalScope:i=!1})=>r=>{const a=[s];i&&s!==o.VIEW_TYPE_GLOBAL_SCOPE&&a.push(o.VIEW_TYPE_GLOBAL_SCOPE),r({type:c.ActionTypes.SET_SORT,payload:{sort:t,viewScopes:a}}),_.setSort(e.id,a,t)},t.loadScopedSortOrders=({user:e,defaultSort:t})=>({type:c.ActionTypes.SET_SCOPED_SORTS,payload:{scopedSorts:Object.assign({[o.VIEW_TYPE_GLOBAL_SCOPE]:t},_.getScopedSorts(e.id))}})})),define("metaserver/static/js/modules/clean/react/files_view/data/reducer",["require","exports","tslib","immutable","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/data/types","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/flows/types"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filesViewReducer=t.defaultFilesViewInstance=t.defaultFilesViewState=void 0,i=s.__importStar(i),t.defaultFilesViewState={viewTypes:{[r.VIEW_TYPE_GLOBAL_SCOPE]:n.ViewType.List},scopedColumnsIndex:void 0,scopedSorts:void 0,viewTypeColumns:{[n.ViewType.List]:r.LIST_VIEW_COLUMNS,[n.ViewType.CondensedList]:r.LIST_VIEW_COLUMNS,[n.ViewType.Grid]:r.GRID_VIEW_COLUMNS,[n.ViewType.LargeGrid]:r.GRID_VIEW_COLUMNS},fileRename:null,instances:i.Map(),previewThumbnails:{},activeInstance:void 0};t.defaultFilesViewInstance={dropTargetHighlightMode:o.DropTargetHighlightMode.NONE,enableUnity:!0,loadingState:o.LoadingState.LOADING_FIRST_PAGE,fileRename:null,renderFilenameSubtitleAsLink:!0,eligibleForFirstTaskSubtitle:!1,viewTypeScope:r.VIEW_TYPE_GLOBAL_SCOPE,hideViewFileButton:!1,fileHasAutomatedRuleMap:l.FlowsMap({})};t.filesViewReducer=function(e=t.defaultFilesViewState,s){switch(s.type){case a.ActionTypes.SET_VIEW_TYPE:return((e,{viewType:t,viewScopes:s})=>{const i=Object.assign({},e.viewTypes);for(const e of s)i[e]=t;return Object.assign(Object.assign({},e),{viewTypes:i})})(e,s.payload);case a.ActionTypes.SET_VIEW_TYPES:return((e,{viewTypes:t})=>Object.assign(Object.assign({},e),{viewTypes:Object.assign(Object.assign({},e.viewTypes),t)}))(e,s.payload);case a.ActionTypes.SET_FILE_RENAME:return(function(e,t){var s,i;const{file:r,renameState:a}=t.payload;return a===o.RenameState.PENDING_INPUT||a===o.RenameState.SAVING_INPUT&&!1===(null===(s=e.fileRename)||void 0===s?void 0:s.isNamingConventionsApplied)?Object.assign(Object.assign({},e),{fileRename:{file:r,state:a,input:r.fq_path.substring(r.fq_path.lastIndexOf("/")+1),isNamingConventionsApplied:!1,isRenamingBarDisabled:!!(null===(i=e.fileRename)||void 0===i?void 0:i.isRenamingBarDisabled)}}):Object.assign(Object.assign({},e),{fileRename:null})})(e,s);case a.ActionTypes.SET_COLUMNS_INDEX:return((e,{payload:{columnsIndex:t,viewScopes:s,numVisibleColumns:i}})=>{const r=Object.assign({},e.scopedColumnsIndex),a=Object.assign({},e.scopedNumVisibleColumns);for(const e of s)r[e]=t,void 0!==i&&(a[e]=i);return Object.assign(Object.assign({},e),{scopedColumnsIndex:r,scopedNumVisibleColumns:a})})(e,s);case a.ActionTypes.SET_SCOPED_COLUMNS_INDEX:return((e,{payload:{scopedColumnsIndex:t,scopedNumVisibleColumns:s}})=>Object.assign(Object.assign({},e),{scopedColumnsIndex:t,scopedNumVisibleColumns:s}))(e,s);case a.ActionTypes.SET_SCOPED_SORTS:return((e,{payload:{scopedSorts:t}})=>Object.assign(Object.assign({},e),{scopedSorts:t}))(e,s);case a.ActionTypes.SET_SORT:return((e,{payload:{sort:t,viewScopes:s}})=>{const i=Object.assign({},e.scopedSorts);for(const e of s)i[e]=t;return Object.assign(Object.assign({},e),{scopedSorts:i})})(e,s);case a.ActionTypes.SET_SCROLL:return((e,t)=>Object.assign(Object.assign({},e),{currentScroll:{scrollTop:t.scrollTop}}))(e,s.payload);case a.ActionTypes.UPSERT_INSTANCE:return((e,{payload:{instance:s,id:i}})=>{const r=e.instances.get(i);return Object.assign(Object.assign({},e),{activeInstance:i,instances:e.instances.set(i,Object.assign(Object.assign({},r||t.defaultFilesViewInstance),s))})})(e,s);case a.ActionTypes.DELETE_INSTANCE:return((e,{payload:{id:t}})=>Object.assign(Object.assign({},e),{instances:e.instances.delete(t)}))(e,s);case a.ActionTypes.PREVIEW_THUMBNAILS_LOADING:return((e,{payload:{files:t}})=>{const s=Object.assign({},e.previewThumbnails);return t.forEach(e=>{var t;e.file_id&&!(null===(t=s[e.file_id])||void 0===t?void 0:t.isLoading)&&(s[e.file_id]={isLoading:!0,file_info:e})}),Object.assign(Object.assign({},e),{previewThumbnails:s})})(e,s);case a.ActionTypes.PREVIEW_THUMBNAILS_LOADED:return((e,{payload:{preview_thumbnails:t}})=>{const s=Object.assign({},e.previewThumbnails);return t.forEach(e=>{e.file_id&&(s[e.file_id]={isLoading:!1,preview_url:e.preview_url})}),Object.assign(Object.assign({},e),{previewThumbnails:s})})(e,s);case a.ActionTypes.PREVIEW_THUMBNAILS_REMOVED:return((e,{payload:{files:t}})=>{const s=Object.assign({},e.previewThumbnails);return t.forEach(e=>{e.file_id&&delete s[e.file_id]}),Object.assign(Object.assign({},e),{previewThumbnails:s})})(e,s);case a.ActionTypes.MARK_ACTIVE_INSTANCE:return((e,{payload:{id:t}})=>e.activeInstance!==t?Object.assign(Object.assign({},e),{activeInstance:t}):e)(e,s);case a.ActionTypes.FILTER_OUT_COLUMNS:return((e,t)=>{const s=r.LIST_VIEW_COLUMNS.filter(e=>-1===t.payload.indexOf(e.sortField));return Object.assign(Object.assign({},e),{viewTypeColumns:Object.assign(Object.assign({},e.viewTypeColumns),{[n.ViewType.List]:s,[n.ViewType.CondensedList]:s})})})(e,s);case a.ActionTypes.UPDATE_FILE_RENAME_INPUT:return(function(e,t){var s,i,r,a,n;const{renameInput:l}=t.payload;return(null===(s=e.fileRename)||void 0===s?void 0:s.state)===o.RenameState.PENDING_INPUT?Object.assign(Object.assign({},e),{fileRename:{file:null===(i=e.fileRename)||void 0===i?void 0:i.file,state:null===(r=e.fileRename)||void 0===r?void 0:r.state,input:l,isNamingConventionsApplied:null===(a=e.fileRename)||void 0===a?void 0:a.isNamingConventionsApplied,isRenamingBarDisabled:null===(n=e.fileRename)||void 0===n?void 0:n.isRenamingBarDisabled}}):Object.assign({},e)})(e,s);case a.ActionTypes.UPDATE_NAMING_CONVENTION_APPLY_STATUS:return(function(e,t){var s,i,r,a,o;return!1===(null===(s=e.fileRename)||void 0===s?void 0:s.isNamingConventionsApplied)?Object.assign(Object.assign({},e),{fileRename:{file:null===(i=e.fileRename)||void 0===i?void 0:i.file,state:null===(r=e.fileRename)||void 0===r?void 0:r.state,input:null===(a=e.fileRename)||void 0===a?void 0:a.input,isNamingConventionsApplied:t.payload.isApplyClicked,isRenamingBarDisabled:null===(o=e.fileRename)||void 0===o?void 0:o.isRenamingBarDisabled}}):Object.assign({},e)})(e,s);case a.ActionTypes.UPDATE_RENAMING_BAR_DISABLED_STATUS:return(function(e,t){var s,i,r,a,o;return!1===(null===(s=e.fileRename)||void 0===s?void 0:s.isRenamingBarDisabled)?Object.assign(Object.assign({},e),{fileRename:{file:null===(i=e.fileRename)||void 0===i?void 0:i.file,state:null===(r=e.fileRename)||void 0===r?void 0:r.state,input:null===(a=e.fileRename)||void 0===a?void 0:a.input,isNamingConventionsApplied:null===(o=e.fileRename)||void 0===o?void 0:o.isNamingConventionsApplied,isRenamingBarDisabled:!0}}):Object.assign({},e)})(e)}return e}})),define("metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors",["require","exports","metaserver/static/js/modules/clean/react/files_view/data/reducer","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/redux/selectors"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.previewThumbnailsToLoad=t.previewThumbnails=t.selectInstances=t.isActiveFilesView=t.currentScroll=t.fileRename=t.scopedNumVisibleColumns=t.scopedSorts=t.viewTypeColumns=t.scopedColumnsIndex=t.viewTypes=void 0;const a=e=>r.getStateAtNamespace(e,i.FILES_VIEW_NAMESPACE_KEY)||s.defaultFilesViewState;t.viewTypes=e=>a(e).viewTypes,t.scopedColumnsIndex=e=>a(e).scopedColumnsIndex,t.viewTypeColumns=e=>a(e).viewTypeColumns,t.scopedSorts=e=>a(e).scopedSorts,t.scopedNumVisibleColumns=e=>a(e).scopedNumVisibleColumns,t.fileRename=e=>a(e).fileRename,t.currentScroll=e=>a(e).currentScroll,t.isActiveFilesView=(e,t)=>a(e).activeInstance===t,t.selectInstances=e=>a(e).instances,t.previewThumbnails=e=>a(e).previewThumbnails,t.previewThumbnailsToLoad=e=>{const s=[],i=t.previewThumbnails(e);for(const e in i)!0===i[e].isLoading&&i[e].file_info&&s.push(i[e].file_info);return s}})),define("metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors",["require","exports","reselect","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors","metaserver/static/js/modules/clean/react/files_view/data/store","metaserver/static/js/modules/clean/react/files_view/file_grouper","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/core/assert"],(function(e,t,s,i,r,a,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.selectExpManualTagging=t.selectExpFlowsAutomatedFolderUI=t.selectNumVisibleColumns=t.selectScopedSort=t.selectPreferredColumns=t.selectColumnsIndex=t.selectViewType=t.selectViewTypes=t.selectViewTypeScope=t.selectItemsForUnityListener=t.selectItemIds=t.selectSections=t.selectHasItemsSelected=t.selectNumItemsSelected=t.selectShouldShowFileNameLocation=t.selectShouldShowFileNameHighlights=t.selectCutItems=t.selectClipboard=t.selectIsMobileMode=t.selectIsCompactMode=t.selectInlineActionBar=t.selectIsActionBarEnabled=t.selectEligibleForFirstTaskSubtitle=t.selectRenderFilenameSubtitleAsLink=t.selectHighDensity=t.selectFileRename=t.selectResponsive=t.selectSelection=t.selectDisabledMultiselect=t.selectIsSearchMode=t.selectCurrentSort=t.selectIsListView=t.selectIsGridView=t.selectArePostTTIModulesLoaded=t.selectUser=t.selectContext=t.selectFileHasAutomatedRuleMap=t.selectCurrentFolderInfo=t.selectMainItems=t.selectDropTargetHighlightMode=t.selectInstance=void 0;const u=(e,t)=>a.selectInstances(e).get(t.instanceId);t.selectInstance=(e,t)=>{const s=u(e,t);return d.assert(!!s,`[FilesView] Instance '${t.instanceId}' must be defined in redux store before mounting`),s};const p=e=>(s,i)=>e(t.selectInstance(s,i)),_=e=>(t,s)=>e(u(t,s));t.selectDropTargetHighlightMode=p(e=>e.dropTargetHighlightMode),t.selectMainItems=p(e=>e.items),t.selectCurrentFolderInfo=p(e=>e.currentFolderInfo),t.selectFileHasAutomatedRuleMap=p(e=>e.fileHasAutomatedRuleMap),t.selectContext=p(e=>e.context),t.selectUser=p(e=>e.user),t.selectArePostTTIModulesLoaded=p(e=>e.arePostTTIModulesLoaded),t.selectIsGridView=(e,s)=>[l.ViewType.Grid,l.ViewType.LargeGrid].includes(t.selectViewType(e,s)),t.selectIsListView=(e,s)=>[l.ViewType.List,l.ViewType.CondensedList].includes(t.selectViewType(e,s)),t.selectCurrentSort=p(e=>e.currentSort),t.selectIsSearchMode=p(e=>e.isSearchMode),t.selectDisabledMultiselect=p(e=>!!e.disabledMultiselect),t.selectSelection=p(e=>e.selection),t.selectResponsive=p(e=>e.responsive),t.selectFileRename=p(e=>e.fileRename),t.selectHighDensity=p(e=>e.highDensity),t.selectRenderFilenameSubtitleAsLink=p(e=>e.renderFilenameSubtitleAsLink),t.selectEligibleForFirstTaskSubtitle=p(e=>e.eligibleForFirstTaskSubtitle),t.selectIsActionBarEnabled=p(e=>e.isActionBarEnabled),t.selectInlineActionBar=p(e=>e.inlineActionBar),t.selectIsCompactMode=(e,s)=>!t.selectResponsive(e,s).isMatchedLarge,t.selectIsMobileMode=(e,s)=>{const i=t.selectResponsive(e,s);return c.isMobileMode(i)},t.selectClipboard=p(e=>e.clipboard),t.selectCutItems=(e,s)=>{const i=t.selectClipboard(e,s);return i&&"cut"===i.action?new Map(i.files.map(e=>[e.fq_path,e])):new Map},t.selectShouldShowFileNameHighlights=(e,s)=>t.selectIsSearchMode(e,s),t.selectShouldShowFileNameLocation=(e,s)=>t.selectIsSearchMode(e,s),t.selectNumItemsSelected=(e,s)=>t.selectSelection(e,s).selected.size,t.selectHasItemsSelected=(e,s)=>t.selectNumItemsSelected(e,s)>0,t.selectSections=s.createSelector(t.selectIsGridView,t.selectCurrentSort,t.selectMainItems,t.selectIsSearchMode,(e,t,s,i)=>e&&t?n.getSections(s,t.sortField,t.sortDirection,i):n.EMPTY_SECTIONS),t.selectItemIds=s.createSelector(t.selectMainItems,e=>e.toArray().map(e=>e instanceof i.File?e.fq_path:e instanceof i.FileSharedWithMe?e.file_id:"")),t.selectItemsForUnityListener=s.createSelector(t.selectMainItems,t.selectCurrentFolderInfo,(e,t)=>t?e.concat(t):e),t.selectViewTypeScope=_(e=>(null==e?void 0:e.viewTypeScope)||r.VIEW_TYPE_GLOBAL_SCOPE),t.selectViewTypes=_(e=>(null==e?void 0:e.viewTypes)||[]),t.selectViewType=s.createSelector(a.viewTypes,t.selectViewTypes,t.selectViewTypeScope,(e,t,s)=>{let i;return i=s in e?e[s]:s in r.defaultViewTypes?r.defaultViewTypes[s]:e[r.VIEW_TYPE_GLOBAL_SCOPE],t.includes(i)?i:l.ViewType.List}),t.selectColumnsIndex=s.createSelector(a.scopedColumnsIndex,t.selectViewTypeScope,t.selectIsSearchMode,(e,t,s)=>{if(e&&!s)return t in e?e[t]:e[r.VIEW_TYPE_GLOBAL_SCOPE]||{}}),t.selectPreferredColumns=s.createSelector(t.selectColumnsIndex,t.selectViewType,a.viewTypeColumns,(e,t,s)=>{if(!e)return;const[i,...r]=s[t],a=Object.keys(e).reduce((t,s)=>{const i=parseInt(s,10);return t[e[i]]=i,t},{}),o=[],n={};for(const e of r){const t=a[e.sortField];void 0===t||0===t?o.push(e):n[t]=e}const l=[i];for(let e=1;e<=r.length;e++){const t=n[e]||o.shift();t&&l.push(t)}return l}),t.selectScopedSort=s.createSelector(a.scopedSorts,t.selectViewTypeScope,(e,t)=>{if(e)return t in e?e[t]:e[r.VIEW_TYPE_GLOBAL_SCOPE]}),t.selectNumVisibleColumns=s.createSelector(a.scopedNumVisibleColumns,t.selectViewTypeScope,(e,t)=>{if(e)return t in e?e[t]:e[r.VIEW_TYPE_GLOBAL_SCOPE]}),t.selectExpFlowsAutomatedFolderUI=_(e=>(null==e?void 0:e.expFlowsAutomatedFolderUI)||!1),t.selectExpManualTagging=_(e=>(null==e?void 0:e.expManualTagging)||"OFF"),o.getStoreForFilesView()})),define("metaserver/static/js/modules/clean/react/files_view/data/selectors/item_selectors",["require","exports","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/clean/tagging/experiments"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.selectFlowsBadge=t.selectIsCutToClipboard=t.selectIconSize=t.selectShouldShowFirstTaskSubtitle=t.selectSnippetRows=t.selectRowHeight=t.selectShouldShowTags=t.selectShouldShowSnippets=t.selectFirstValidSnippet=t.selectSnippets=t.selectIsTooltipEnabled=t.selectShowCDMUserEducationEffects=t.selectShouldShowStar=t.selectIsNoAccessSharedFolder=t.selectShouldShowSubtitle=t.selectIsRenameBarDisabled=t.selectRenameInput=t.selectRenameState=t.selectUserEducationEffectName=t.selectShouldShowUserEducationEffects=t.selectIsCheckboxVisible=t.selectIsItemSelected=t.selectItemSelectionId=t.selectItemAssertFileOrFileSharedWithMe=t.selectItem=void 0,t.selectItem=(e,t)=>{const s=r.selectMainItems(e,t),i=s&&s.get(t.itemIndex);return n.assert(!!i,`Item undefined at index: ${t.itemIndex}`),i},t.selectItemAssertFileOrFileSharedWithMe=(e,i)=>{const r=t.selectItem(e,i);return n.assert(r instanceof s.File||r instanceof s.FileSharedWithMe,`item must be File or FileSharedWithMe at index: ${i.itemIndex}`),r},t.selectItemSelectionId=(e,i)=>{const r=t.selectItemAssertFileOrFileSharedWithMe(e,i);return r instanceof s.File?i.fileToId(r):r.file_id},t.selectIsItemSelected=(e,s)=>r.selectSelection(e,s).selected.has(t.selectItemSelectionId(e,s)),t.selectIsCheckboxVisible=(e,t)=>t.isHovered||r.selectHasItemsSelected(e,t)||r.selectIsCompactMode(e,t),t.selectShouldShowUserEducationEffects=(e,t)=>{const{rowIndex:s}=t;return 0===s||r.selectUser(e,t).is_cdm_member&&(2===t.rowIndex||1===t.rowIndex)},t.selectUserEducationEffectName=(e,s)=>t.selectShouldShowUserEducationEffects(e,s)?"FileNameLabel-"+s.rowIndex:void 0,t.selectRenameState=(e,i)=>{const a=r.selectFileRename(e,i),o=t.selectItem(e,i);if(a&&o instanceof s.File)return a.file.fq_path===o.fq_path?a.state:void 0},t.selectRenameInput=(e,t)=>{const s=r.selectFileRename(e,t);return null==s?void 0:s.input},t.selectIsRenameBarDisabled=(e,t)=>{const s=r.selectFileRename(e,t);return null==s?void 0:s.isRenamingBarDisabled},t.selectShouldShowSubtitle=(e,s)=>!t.selectRenameState(e,s)&&r.selectViewType(e,s)!==a.ViewType.CondensedList,t.selectIsNoAccessSharedFolder=(e,i)=>{const r=t.selectItem(e,i);return r instanceof s.File&&s.File.isNoAccessSharedFolder(r)},t.selectShouldShowStar=(e,s)=>r.selectArePostTTIModulesLoaded(e,s)&&!t.selectIsNoAccessSharedFolder(e,s)&&!r.selectContext(e,s).isInsideVaultFolder&&!r.selectIsMobileMode(e,s),t.selectShowCDMUserEducationEffects=(e,i)=>{const r=t.selectItem(e,i);return r instanceof s.File&&s.File.isTeamMemberFolder(r)},t.selectIsTooltipEnabled=(e,t)=>r.selectArePostTTIModulesLoaded(e,t),t.selectSnippets=(e,i)=>{const r=t.selectItem(e,i);if(r instanceof s.Paper||r instanceof s.File||r instanceof s.FileSharedWithMe)return r.snippets},t.selectFirstValidSnippet=(e,s)=>{const i=t.selectSnippets(e,s);return i&&i.find(({highlight_spans:e})=>!!e&&e.length>0)},t.selectShouldShowSnippets=(e,s)=>Boolean(!r.selectIsMobileMode(e,s)&&t.selectFirstValidSnippet(e,s)),t.selectShouldShowTags=(e,i)=>{const a=t.selectItem(e,i),o=r.selectExpManualTagging(e,i);return l.isTaggingEnabled(o)&&a instanceof s.File&&a.tags&&a.tags.length>0},t.selectRowHeight=(e,s)=>{const o=t.selectShouldShowSnippets(e,s),n=r.selectHighDensity(e,s),l=r.selectViewType(e,s),c=t.selectShouldShowTags(e,s);if(o){const r=t.selectSnippetRows(e,s);if(!r)return c?i.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS;const a=i.ROW_VERTICAL_PADDING+i.ROW_TITLE_HEIGHT+i.ROW_SUBTITLE_HEIGHT+i.ROW_SNIPPET_VERTICAL_MARGIN+i.SNIPPET_HEIGHT_PER_ROW*r;return c?a+i.TAGS_HEIGHT:a}return l===a.ViewType.CondensedList?i.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:n?c?i.DEFAULT_ROW_HEIGHT_DENSE+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT_DENSE:c?i.DEFAULT_ROW_HEIGHT+i.TAGS_HEIGHT:i.DEFAULT_ROW_HEIGHT};t.selectSnippetRows=(e,s)=>{const r=t.selectFirstValidSnippet(e,s);if(!r||!r.highlight_spans)return 0;const{containerWidth:a,numVisibleColumns:o}=s,n=a?a*i.FILE_NAME_CELL_SEARCH_FLEX_BASIS[o]/100:void 0;if(!n)return 3;const l=r.highlight_spans.map(e=>e.highlight_str).join().length,c=Math.max(n-i.MEDIA_CELL_ICON_WIDTH-i.SNIPPET_HORIZONTAL_PADDING,1),d=6*l;return Math.min(Math.ceil(d/c),3)},t.selectShouldShowFirstTaskSubtitle=(e,t)=>Boolean(r.selectEligibleForFirstTaskSubtitle(e,t)&&c(e,t));const c=(e,i)=>{const a=r.selectContext(e,i),o=t.selectItem(e,i),n=r.selectUser(e,i);return o instanceof s.File&&(a.isInsideMyTeamFolderTree&&a.isCurrentlyInRoot&&o.fq_path===n.cdm_tmf_path)};t.selectIconSize=(e,t)=>r.selectViewType(e,t)===a.ViewType.CondensedList?32:void 0,t.selectIsCutToClipboard=(e,s)=>{const i=r.selectCutItems(e,s),a=t.selectItem(e,s);return o.isCutToClipboard(a,i)},t.selectFlowsBadge=(e,i)=>{const a=t.selectItemAssertFileOrFileSharedWithMe(e,i);if(a instanceof s.FileSharedWithMe)return;const o=r.selectFileHasAutomatedRuleMap(e,i),n=r.selectExpFlowsAutomatedFolderUI(e,i),l=o.get(a.fq_path);return null!=l&&n?l:void 0}})),define("metaserver/static/js/modules/clean/react/files_view/data/selectors/list_selectors",["require","exports","tslib","reselect","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/file_list_utils","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/tagging/experiments","metaserver/static/js/modules/clean/media_filters/gating"],(function(e,t,s,i,r,a,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.estimateSnippetRowsNeeded=t.getFileRowHeight=t.shouldShowSnippets=t.getFirstValidSnippet=t.getFilesViewListRowItems=t.selectListItemBuffer=t.selectListItemHeights=t.selectListItems=void 0,t.selectListItems=(e,s)=>{const i=o.selectMainItems(e,s),r=!!o.selectDisabledMultiselect(e,s),a=o.selectViewType(e,s)===l.ViewType.CondensedList,n=o.selectIsActionBarEnabled(e,s);return t.getFilesViewListRowItems(Object.assign(Object.assign({},s),{isCheckboxDisabled:r,isCondensedListView:a,items:i,isActionBarEnabled:n}))},t.selectListItemHeights=i.createSelector(t.selectListItems,e=>e.map(({height:e})=>e)),t.selectListItemBuffer=(e,t)=>o.selectViewType(e,t)===l.ViewType.CondensedList?20:void 0;const p=i.createSelectorCreator(i.defaultMemoize,(e,t)=>Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(s=>t.hasOwnProperty(s)&&e[s]===t[s]));t.getFilesViewListRowItems=p(({activeDropTarget:e,arePostTTIModulesLoaded:t,canDisplayFolderSizes:s,context:i,createNewFolderState:r,dropTargetHighlightMode:a,fileRename:o,focusedFileIndex:n,isCheckboxDisabled:l,isCompactMode:c,isSearchMode:d,isSelectMode:u,items:p,selection:_,sharingServiceInfo:m,starredState:f,user:h,visibleColumns:g,responsive:S,containerWidth:E,highDensity:v,isCondensedListView:T,fileToId:b,renderSharedWithController:I,expVaultEnableViewOnlySharing:w,isActionBarEnabled:C,expManualTagging:O,mediaFiltersVariant:F})=>({activeDropTarget:e,arePostTTIModulesLoaded:t,canDisplayFolderSizes:s,context:i,createNewFolderState:r,dropTargetHighlightMode:a,fileRename:o,focusedFileIndex:n,isCheckboxDisabled:l,isCompactMode:c,isSearchMode:d,isSelectMode:u,items:p,selection:_,sharingServiceInfo:m,starredState:f,user:h,visibleColumns:g,responsive:S,containerWidth:E,highDensity:v,isCondensedListView:T,fileToId:b,renderSharedWithController:I,expVaultEnableViewOnlySharing:w,isActionBarEnabled:C,expManualTagging:O,mediaFiltersVariant:F}),e=>{const{activeDropTarget:i,context:o,createNewFolderState:l,dropTargetHighlightMode:u,items:p,fileRename:_,focusedFileIndex:m,selection:f,user:h,visibleColumns:g,responsive:S,containerWidth:E,highDensity:v,fileToId:T,isCondensedListView:b,isActionBarEnabled:I,mediaFiltersVariant:w}=e,C=s.__rest(e,["activeDropTarget","context","createNewFolderState","dropTargetHighlightMode","items","fileRename","focusedFileIndex","selection","user","visibleColumns","responsive","containerWidth","highDensity","fileToId","isCondensedListView","isActionBarEnabled","mediaFiltersVariant"]),O=!!e.expVaultEnableViewOnlySharing,F=d.isTaggingEnabled(e.expManualTagging),R=b?a.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:v?a.DEFAULT_ROW_HEIGHT_DENSE:a.DEFAULT_ROW_HEIGHT,A=b?32:void 0,y=p.toArray().map((e,s)=>{if(e instanceof r.UserDefinedItem)return{type:"UserDefinedItemRow",props:{userDefinedItem:e},height:R};const l=E?E*a.FILE_NAME_CELL_SEARCH_FLEX_BASIS[g.length]/100:void 0,d=t.shouldShowSnippets({file:e,responsive:S}),p=t.estimateSnippetRowsNeeded({snippets:e.snippets,fileNameCellWidth:l}),y=t.getFileRowHeight({file:e,showSnippets:d,snippetRows:p,highDensity:v,isCondensedListView:b,showTags:F,mediaFiltersVariant:w,fileNameCellWidth:l});if(e instanceof r.Paper)return{type:"PaperRow",props:{isSearchMode:C.isSearchMode,paper:e,visibleColumns:g,arePostTTIModulesLoaded:C.arePostTTIModulesLoaded,showSnippets:d,snippetRows:p,height:y,showStar:C.arePostTTIModulesLoaded&&!c.isMobileMode(S)},height:y};const D="fq_path"in e?T(e):e.file_id,M=f.selected.has(D);if(e instanceof r.FileSharedWithMe)return{type:"FileSharedWithMeRow",props:{file:e,visibleColumns:g,showSnippets:d,snippetRows:p,height:y,isSelected:M,arePostTTIModulesLoaded:C.arePostTTIModulesLoaded,isSelectMode:C.isSelectMode,isFocused:s===m,iconSize:A},height:y};const N=n.canFileBeHighlightedDropTarget({file:e,dropTargetHighlightMode:u});return{type:"FileRow",key:`file:${encodeURIComponent(e.file_id)}:${encodeURIComponent(e.fq_path)}`,itemIndex:s,props:Object.assign(Object.assign({},C),{file:e,isActionBarEnabled:I,isActiveDropTarget:N&&i===e,isAvailableDropTarget:N,isFocused:s===m,isSelected:M,isExtensionsMenuDisabled:!0,isSharingDisabled:n.isSharingDisabledForFile({context:o,file:e,user:h,expVaultEnableViewOnlySharing:O}),renameState:_&&_.file.fq_path===e.fq_path?_.state:void 0,visibleColumns:g,height:y,containerWidth:E,isCondensedListView:b,responsive:S}),height:y}});return l&&"CREATE_FOLDER_INACTIVE"!==l&&y.unshift({type:"NewFolderRow",props:{createNewFolderState:l,isInsideMyTeamFolderTree:o.isInsideTeamFolderTree,iconSize:A},height:R}),y}),t.getFirstValidSnippet=e=>e.find(({highlight_spans:e})=>!!e&&e.length>0),t.shouldShowSnippets=({file:{snippets:e},responsive:s})=>!!e&&!!t.getFirstValidSnippet(e)&&(s.isMatchedLarge||s.isMatchedMedium),t.getFileRowHeight=({file:e,showSnippets:t,snippetRows:s,highDensity:i,isCondensedListView:r,showTags:o,mediaFiltersVariant:n,fileNameCellWidth:l})=>{const d=o&&c.isFile(e)&&e.tags&&e.tags.length>0?a.TAGS_HEIGHT:0,u=_({file:e,mediaFiltersVariant:n,fileNameCellWidth:l});if(e.snippets&&t){if(!s)return a.DEFAULT_ROW_HEIGHT_WITH_SNIPPETS+d+u;return a.ROW_VERTICAL_PADDING+a.ROW_TITLE_HEIGHT+a.ROW_SUBTITLE_HEIGHT+a.ROW_SNIPPET_VERTICAL_MARGIN+a.SNIPPET_HEIGHT_PER_ROW*s+d+u}return r?a.DEFAULT_ROW_HEIGHT_CONDENSED_LIST:i?a.DEFAULT_ROW_HEIGHT_DENSE+d+u:a.DEFAULT_ROW_HEIGHT+d+u};const _=({file:e,mediaFiltersVariant:s,fileNameCellWidth:i})=>{var r,o,n,l;const d=c.isFile(e)&&!!(null===(o=null===(r=e.media_data)||void 0===r?void 0:r.data)||void 0===o?void 0:o.date_taken);if(u.isMediaMetadataSearchEnabled(s)){if(c.isFile(e)){const s=(null!==(l=null===(n=e.media_data)||void 0===n?void 0:n.display_info)&&void 0!==l?l:[]).map(e=>t.estimateSnippetRowsNeeded({snippets:[{highlight_spans:e.highlights}],fileNameCellWidth:i})).reduce((e,t)=>e+t,0),r=d?s+1:s;return Math.min(r,3)*a.MEDIA_INFO_ITEM_HEIGHT}return 0}return u.isMediaFiltersEnabled(s)&&d?a.MEDIA_INFO_ITEM_HEIGHT:0};t.estimateSnippetRowsNeeded=({snippets:e,fileNameCellWidth:s})=>{if(!e)return 0;const i=t.getFirstValidSnippet(e);if(!i||!i.highlight_spans)return 0;if(!s)return 3;const r=i.highlight_spans.map(e=>e.highlight_str).join().length,o=Math.max(s-a.MEDIA_CELL_ICON_WIDTH-a.SNIPPET_HORIZONTAL_PADDING,1),n=6*r;return Math.min(Math.ceil(n/o),3)}})),define("metaserver/static/js/modules/clean/react/files_view/data/store",["require","exports","metaserver/static/js/modules/clean/react/files_view/data/reducer","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/redux/store"],(function(e,t,s,i,r){"use strict";let a;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForFilesView=void 0,t.getStoreForFilesView=()=>(a||(a=r.getStoreAndRegisterReducers({[i.FILES_VIEW_NAMESPACE_KEY]:s.filesViewReducer})),a)})),define("metaserver/static/js/modules/clean/react/files_view/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes=void 0,(function(e){e.SET_VIEW_TYPE="FILES_VIEW/SET_VIEW_TYPE",e.SET_VIEW_TYPES="FILES_VIEW/SET_VIEW_TYPES",e.SET_VIEW_TYPE_SCOPE="FILES_VIEW/SET_VIEW_TYPE_SCOPE",e.SET_FILE_RENAME="FILES_VIEW/SET_FILE_RENAME",e.SET_COLUMNS_INDEX="FILES_VIEW/SET_COLUMNS_INDEX",e.SET_SCOPED_COLUMNS_INDEX="FILES_VIEW/SET_SCOPED_COLUMNS_INDEX",e.SET_SORT="FILES_VIEW/SET_SORT",e.SET_SCOPED_SORTS="FILES_VIEW/SET_SCOPED_SORTS",e.SET_SCROLL="FILES_VIEW/SET_SCROLL",e.UPDATE_INSTANCE="FILES_VIEW/UPDATE_INSTANCE",e.UPSERT_INSTANCE="FILES_VIEW/UPSERT_INSTANCE",e.DELETE_INSTANCE="FILES_VIEW/DELETE_INSTANCE",e.PREVIEW_THUMBNAILS_LOADING="FILES_VIEW/PREVIEW_THUMBNAILS_LOADING",e.PREVIEW_THUMBNAILS_LOADED="FILES_VIEW/PREVIEW_THUMBNAILS_LOADED",e.PREVIEW_THUMBNAILS_REMOVED="FILES_VIEW/PREVIEW_THUMBNAILS_REMOVED",e.MARK_ACTIVE_INSTANCE="FILES_VIEW/MARK_ACTIVE_INSTANCE",e.FILTER_OUT_COLUMNS="FILES_VIEW/FILTER_OUT_COLUMNS",e.UPDATE_FILE_RENAME_INPUT="UPDATE_FILE_RENAME_INPUT",e.UPDATE_NAMING_CONVENTION_APPLY_STATUS="UPDATE_NAMING_CONVENTION_APPLY_STATUS",e.UPDATE_RENAMING_BAR_DISABLED_STATUS="UPDATE_RENAMING_BAR_DISABLED_STATUS"})(t.ActionTypes||(t.ActionTypes={}))})),define("metaserver/static/js/modules/clean/react/files_view/file_actions/api_v2",["require","exports","tslib","metaserver/static/js/api_v2/user_client","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/core/exception"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPathLookupFailure=t.isFailure=t.createFolder=t.deleteFiles=t.copyFiles=t.moveFiles=t.renameFile=t.undo=t.getFilenameFromActionInfo=t.fileInfoIsFqPathBased=t.createUndefinedRpcResult=t.EXCLOG_TAG=void 0,r=s.__importStar(r);t.EXCLOG_TAG="file_actions_client_error",t.createUndefinedRpcResult=e=>({isError:!0,error:{".tag":"undefined_error"},error_summary:"undefined_error",jobId:e});const o=(e,s)=>{a.reportStack(JSON.stringify("error"in s?s.error:s),{severity:a.SEVERITY.NON_CRITICAL,silent:!0,tags:[t.EXCLOG_TAG,`${t.EXCLOG_TAG}_${e}`]})};function n(e){return Boolean("fq_path"in e?e:null)}function l(e){return n(e)?r.filename(e.fq_path):e.name}function c(e,i){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield e();if("complete"===s[".tag"])return p("relocation_batch",s),{isError:!1,result:s};{let e=void 0;do{yield new Promise(e=>setTimeout(e,1e3)),e=yield i(s.async_job_id)}while(e&&"in_progress"===e[".tag"]);if("complete"===e[".tag"]){const t=e;for(const e of t.entries){const t=d(e,s.async_job_id);if(t)return t}return p("relocation_batch",t),{isError:!1,result:t,jobId:s.async_job_id}}return o("relocation_batch_poll",e),t.createUndefinedRpcResult(s.async_job_id)}}catch(e){return o("relocation_batch_poll",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.error[".tag"]}:t.createUndefinedRpcResult()}}))}function d(e,t){if("failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"to"===e.failure.relocation_error[".tag"]&&"file_system_warnings"===e.failure.relocation_error.to[".tag"])return{isError:!0,error:e.failure.relocation_error,error_summary:"file_system_warnings",jobId:t}}function u(e){var s;if(null===(s=null==e?void 0:e.error)||void 0===s?void 0:s[".tag"]){const t={".tag":"failure",failure:{".tag":"relocation_error",relocation_error:e.error}},s=d(t,void 0);return void 0!==s?s:{isError:!1,result:{changeset_data:[],entries:[t]}}}return t.createUndefinedRpcResult()}t.fileInfoIsFqPathBased=n,t.getFilenameFromActionInfo=l,t.undo=function(e,r){return s.__awaiter(this,void 0,void 0,(function*(){const s=new i.UserApiV2Client;try{return{isError:!1,result:yield s.ns("files").rpc("undo_batch",{entries:e},{subjectUserId:r.id})}}catch(e){return o("undo_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:t.createUndefinedRpcResult()}}))},t.renameFile=function(e,t,a,o){return s.__awaiter(this,void 0,void 0,(function*(){const s=r.parent_dir(e),n=r.normalize(s)+"/"+t,l=new i.UserApiV2Client,{checkFSWs:c}=o;try{const t=yield l.ns("files").rpc("move_v2",{from_path:e,to_path:n,autorename:!0,allow_ownership_transfer:!1,fsw_request:c?{".tag":"check"}:void 0},{subjectUserId:a});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return u(e)}}))},t.moveFiles=function(e,t,r,a={}){return s.__awaiter(this,void 0,void 0,(function*(){const s=new i.UserApiV2Client,{allowOwnershipTransfer:o,checkFSWs:d}=a,p=e=>{const s=`${t}/${l(e)}`;return n(e)?{from_path:e.fq_path,to_path:s}:{from_path:e.id,to_path:s}};if(1===e.length&&n(e[0])&&!e[0].is_dir)try{const t=yield s.ns("files").rpc("move_v2",Object.assign(Object.assign({},p(e[0])),{allow_ownership_transfer:!!o,fsw_request:d?{".tag":"check"}:void 0}),{subjectUserId:r});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",success:t.metadata}]}}}catch(e){return u(e)}return yield c(()=>s.ns("files").rpc("move_batch_v2",{entries:e.map(p),autorename:!0,allow_ownership_transfer:!!o,fsw_request:d?{".tag":"check"}:void 0},{subjectUserId:r}),e=>s.ns("files").rpc("move_batch/check_v2",{async_job_id:e},{subjectUserId:r}))}))},t.copyFiles=function(e,t,a,o={}){return s.__awaiter(this,void 0,void 0,(function*(){const s=new i.UserApiV2Client,{checkFSWs:n}=o;if(1===e.length&&!e[0].is_dir)try{const i=yield s.ns("files").rpc("copy_v2",{from_path:e[0].fq_path,to_path:`${t}/${r.filename(e[0].fq_path)}`,autorename:!0,fsw_request:n?{".tag":"check"}:void 0},{subjectUserId:a});return{isError:!1,result:{changeset_data:i.changeset_data,entries:[{".tag":"success",success:i.metadata}]}}}catch(e){return u(e)}return yield c(()=>s.ns("files").rpc("copy_batch_v2",{entries:e.map(e=>({from_path:e.fq_path,to_path:`${t}/${r.filename(e.fq_path)}`})),autorename:!0,fsw_request:n?{".tag":"check"}:void 0},{subjectUserId:a}),e=>s.ns("files").rpc("copy_batch/check_v2",{async_job_id:e},{subjectUserId:a}))}))},t.deleteFiles=function(e,r,a){var n;return s.__awaiter(this,void 0,void 0,(function*(){const l=new i.UserApiV2Client,c=e=>"file_id"in e?e.file_id:e.fq_path;if(1===e.length&&!e[0].is_dir)try{const t=yield l.ns("files").rpc("delete_v2",{path:c(e[0]),fsw_request:a?{".tag":"check"}:void 0},{subjectUserId:r});return{isError:!1,result:{changeset_data:t.changeset_data,entries:[{".tag":"success",metadata:t.metadata}]}}}catch(e){return t.isPathLookupFailure(e)||o("delete_v2",e),(null===(n=null==e?void 0:e.error)||void 0===n?void 0:n[".tag"])?{isError:!1,result:{changeset_data:[],entries:[{".tag":"failure",failure:e.error}]}}:t.createUndefinedRpcResult()}return yield(function(e,i){return s.__awaiter(this,void 0,void 0,(function*(){try{const s=yield e();if("complete"===s[".tag"])return p("delete_batch",s),{isError:!1,result:s};if("other"===s[".tag"])return o("delete_batch",s),t.createUndefinedRpcResult();{let e=void 0;do{yield new Promise(e=>setTimeout(e,1e3)),e=yield i(s.async_job_id)}while(e&&"in_progress"===e[".tag"]);return"complete"===e[".tag"]?(p("delete_batch",e),{isError:!1,result:e,jobId:s.async_job_id}):(o("delete_batch_poll",e),t.createUndefinedRpcResult(s.async_job_id))}}catch(e){return o("delete_batch",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:t.createUndefinedRpcResult()}}))})(()=>l.ns("files").rpc("delete_batch",{entries:e.map(e=>({path:c(e)})),fsw_request:a?{".tag":"check"}:void 0},{subjectUserId:r}),e=>l.ns("files").rpc("delete_batch/check",{async_job_id:e},{subjectUserId:r}))}))};const p=(e,t)=>{t.entries.forEach(t=>{".tag"in t&&"failure"===t[".tag"]&&o(e,t.failure)})};t.createFolder=function(e,a,n,l){return s.__awaiter(this,void 0,void 0,(function*(){const s=new i.UserApiV2Client;try{return{isError:!1,result:yield s.ns("files").rpc("create_folder_v2",{path:r.normalize(e)+"/"+a,autorename:!0,fsw_request:l?{".tag":"check"}:void 0},{subjectUserId:n.id})}}catch(e){return o("create_folder",e),e&&e.error&&e.error[".tag"]?{isError:!0,error:e.error,error_summary:e.summary}:t.createUndefinedRpcResult()}}))},t.isFailure=e=>"failure"===e[".tag"],t.isPathLookupFailure=e=>"path_lookup"===e[".tag"]})),define("metaserver/static/js/modules/clean/react/files_view/file_actions/file_from_metadata",["require","exports","metaserver/static/js/modules/clean/react/browse/models"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.folderFromFolderMetadata=t.fileFromMetadata=void 0,t.fileFromMetadata=(e,t)=>{if("file"===t[".tag"]){const i=t,r=Object.assign(Object.assign({},e),{fq_path:i.path_display||e.fq_path,icon:i.icon+"_32",revision_id:i.rev,file_id:i.id});return new s.File(r)}return"folder"===t[".tag"]?new s.File(Object.assign(Object.assign({},e),{fq_path:t.path_display||e.fq_path})):e},t.folderFromFolderMetadata=e=>new s.File({file_id:e.id,fq_path:e.path_display||"",icon:e.icon,is_dir:!0})})),define("metaserver/static/js/modules/clean/react/files_view/file_actions/rollback",["require","exports","tslib","metaserver/static/js/modules/clean/react/browse/api","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rollback=void 0,i=s.__importStar(i),t.rollback=({changeset_data:e,userId:t,onSuccess:s})=>{const a={};for(const{ns_id:t,op_id:s}of e){const e=parseInt(s.slice(6),10);a.hasOwnProperty(t)?a[t].push(e):a[t]=[e]}i.rollbackChangeSets({changesets:a,onSuccess:s,userId:t,progressText:r.intl.formatMessage({id:"wKzr7W",defaultMessage:"Undoing…"})})}})),define("metaserver/static/js/modules/clean/react/files_view/file_actions/snackbars",["require","exports","metaserver/static/js/modules/core/i18n"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteCompleteError=t.deleteInProgress=t.deleteCompleteSuccess=t.deleteError=t.renameError=void 0,t.renameError=(e,t)=>{let i;return i="to"===e[".tag"]&&"malformed_path"===e.to[".tag"]?s.intl.formatMessage({id:"rBgywO",defaultMessage:"Name was invalid."}):"from_write"===e[".tag"]&&"team_folder"===e.from_write[".tag"]?s.intl.formatMessage({id:"zqiuDZ",defaultMessage:"Team folders can’t be renamed."}):"from_lookup"===e[".tag"]&&"not_found"===e.from_lookup[".tag"]?s.intl.formatMessage({id:"kdizeA",defaultMessage:"Couldn’t find the file."}):s.intl.formatMessage({id:"pUBm7w",defaultMessage:"Rename failed."}),i},t.deleteError=(e,t)=>s.intl.formatMessage({id:"pjyJun",defaultMessage:"{count, plural, one{Couldn’t delete {count} item.} other{Couldn’t delete {count} items.}}"},{count:e}),t.deleteCompleteSuccess=(e,t)=>t<e?s.intl.formatMessage({id:"QGz6Gm",defaultMessage:"{count, plural, one{Deleted {succesfully_deleted_files} out of {count} item.} other{Deleted {succesfully_deleted_files} out of {count} items.}}"},{count:e,succesfully_deleted_files:t}):s.intl.formatMessage({id:"THAbub",defaultMessage:"{count, plural, one{Deleted {count} item.} other{Deleted {count} items.}}"},{count:t}),t.deleteInProgress=e=>s.intl.formatMessage({id:"z7/sbf",defaultMessage:"{count, plural, one{Deleting {count} item...} other{Deleting {count} items...}}"},{count:e}),t.deleteCompleteError=e=>{if(1===e.length){const t=e[0].failure;if("too_many_files"===t[".tag"]||"too_many_write_operations"===t[".tag"])return s.intl.formatMessage({id:"ane1pD",defaultMessage:"There are too many files in one request. Please retry with fewer files."});if("path_lookup"===t[".tag"]&&"not_found"===t.path_lookup[".tag"])return s.intl.formatMessage({id:"9suezP",defaultMessage:"File does not exist."})}return s.intl.formatMessage({id:"pjyJun",defaultMessage:"{count, plural, one{Couldn’t delete {count} item.} other{Couldn’t delete {count} items.}}"},{count:e.length})}})),define("metaserver/static/js/modules/clean/react/files_view/file_grouper",["require","exports","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/datetime/datetime","metaserver/static/js/modules/clean/react/browse/constants","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/browse/models"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSections=t.EMPTY_SECTIONS=void 0;const n=s.intl.formatMessage({id:"RzhnRl",defaultMessage:"Extensionless"}),l=s.intl.formatMessage({id:"DcKHEo",defaultMessage:"Missing dates"}),c=s.intl.formatMessage({id:"GYhJ5f",defaultMessage:"Deleted content isn’t sorted by last modified"});t.EMPTY_SECTIONS={sectionLabels:[],sectionStartIndices:[]},t.getSections=function(e,t,d,u=!1){const p=[],_=[];let m=null;if(t===a.SortField.CATEGORY)e.forEach((e,t)=>{if(!e)return;const s=(function(e){return e instanceof o.File?o.File.getCategoryDescription(e,!0):r.ExtensionCategories.DOCUMENT})(e);s!==m&&(p.push(s),_.push(t),m=s)});else if(t===a.SortField.EXTENSION)e.forEach((e,t)=>{if(!e)return;const s=(function(e){return e instanceof o.File?e.is_dir?r.FileTypeCapitalizedCategoryTranslations.FOLDER:o.File.getExtension(e).toUpperCase():n})(e);if(s!==m){let e=s;""===s&&(e=n),p.push(e),_.push(t),m=s}});else if(t===a.SortField.MODIFIED)if(d===a.SortDirection.DESCENDING){const t=i.getTimeBands(Date.now());e.forEach((e,i)=>{if(!e)return;let r;if(u&&e instanceof o.File&&e.isDeleted)r=c;else{const i=o.itemTimestampInMs(e);r=i>=t.today?s.intl.formatMessage({id:"JDRaFD",defaultMessage:"Today"}):i>=t.yesterday?s.intl.formatMessage({id:"2iSDDx",defaultMessage:"Yesterday"}):i>=t.thisWeek?s.intl.formatMessage({id:"e3KIPg",defaultMessage:"This week"}):i>=t.lastWeek?s.intl.formatMessage({id:"dsHtkw",defaultMessage:"Last week"}):i>=t.thisMonth?s.intl.formatMessage({id:"G0eFMx",defaultMessage:"This month"}):i>=t.lastMonth?s.intl.formatMessage({id:"nM5Fv4",defaultMessage:"Last month"}):i>=t.lastThreeMonths?s.intl.formatMessage({id:"U7dFRR",defaultMessage:"Three months ago"}):s.intl.formatMessage({id:"Y/NN0h",defaultMessage:"Older"})}r!==m&&(p.push(r),_.push(i),m=r)})}else e.forEach((e,t)=>{if(!e)return;let i;i=u&&e instanceof o.File&&e.isDeleted?c:o.itemTimestampInMs(e)?s.intl.formatDate(o.itemTimestampInMs(e),{year:"numeric",month:"long"}):l,i!==m&&(p.push(i),_.push(t),m=i)});return{sectionLabels:p,sectionStartIndices:_}}})),define("metaserver/static/js/modules/clean/react/files_view/file_actions/file_media_actions",["require","exports","tslib","react","spectrum/media_table/index","metaserver/static/js/modules/clean/react/extensions/split_share_button","metaserver/static/js/modules/clean/react/files_view/overflow_menu","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/vault/lib/browse_utils","metaserver/static/js/modules/clean/user_survey/user_survey"],(function(e,t,s,i,r,a,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileMediaActions=void 0,i=s.__importDefault(i);class d extends i.default.PureComponent{constructor(){super(...arguments),this.state={isActionDropdownOpen:!1},this.onSplitShareDropdownOpen=()=>{this.onActionDropdownOpen()},this.onActionDropdownOpen=()=>{this.setState({isActionDropdownOpen:!0})},this.onActionDropdownClose=()=>{this.setState({isActionDropdownOpen:!1})},this.logSplitShareButton=e=>{c.UserSurvey.trackEvent("share_item","browse"),n.isFile(this.props.file)&&this.props.file.is_in_vault_folder&&l.logShareFromInsideVault(this.props.file.is_dir)}}render(){const{arePostTTIModulesLoaded:e,canDisplayFolderSizes:t,file:s,getOverflowMenuActions:n,isCompactMode:l,isHovered:c,isSelectMode:d,isSharingDisabled:u,onPresentInZoom:p,shareButtonLabel:_,showShareButton:m,showBorders:f,user:h,viewportTopOffset:g}=this.props,S=this.props.onShowShare||(()=>{});return d?null:i.default.createElement(r.MediaActions,null,!u&&!1!==m&&i.default.createElement(a.SplitShareButton,{shareButtonLabel:_,onShowShare:S,logShareButtonClick:this.logSplitShareButton,isVisible:c&&!l||this.state.isActionDropdownOpen,user:h,files:[s],onDropdownOpen:this.onSplitShareDropdownOpen,onDropdownClose:this.onActionDropdownClose,onPresentInZoom:p,variant:"opacity",shouldUsePortalPopover:!0}),e&&i.default.createElement(o.FilesViewOverflowMenu,{canDisplayFolderSizes:t,file:s,getOverflowMenuActions:n,showBorders:c||!!f,viewportTopOffset:g,ariaHidden:!0}))}}t.FileMediaActions=d,d.displayName="FileMediaActions"})),define("metaserver/static/js/modules/clean/react/files_view/file_actions/file_media_actions_v2",["require","exports","tslib","classnames","react","react-redux","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/core/browser_detection"],(function(e,t,s,i,r,a,o,n){"use strict";function l(e){e.stopPropagation()}function c(e){const{FilesViewInlineActionBar:t,file:s,highlighted:a,onHoverLocked:o,isMobile:c}=e,d=i.default("brws-file-row-inline-action-bar",{"brws-file-row-inline-action-bar--safari":n.safari});return t?r.default.createElement("td",{onClick:l,className:"brws-file-row-inline-action-bar--container"},r.default.createElement(t,{className:d,file:s,highlighted:a,onHoverLocked:o,isMobile:c})):null}Object.defineProperty(t,"__esModule",{value:!0}),t.FileMediaActionsV2=t.FileMediaActionsV2Element=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importStar(n),t.FileMediaActionsV2Element=c;t.FileMediaActionsV2=a.connect((e,t)=>({FilesViewInlineActionBar:o.selectInlineActionBar(e,t)}))(c)})),define("metaserver/static/js/modules/clean/react/files_view/file_name/file_name_audio_description",["require","exports","tslib","react","metaserver/static/js/modules/clean/filetypes","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameAudioDescription=void 0,i=s.__importDefault(i),t.FileNameAudioDescription=({file:e,isSelected:t})=>{const s=[];return o.isFile(e)&&e.isDeleted&&s.push(n.intl.formatMessage({id:"RBvabN",defaultMessage:"Deleted"})),t&&s.push(n.intl.formatMessage({id:"mpdvwi",defaultMessage:"Selected"})),o.isFile(e)&&e.is_dir&&(e.type===r.FileTypes.SHARED_FOLDER?a.File.isReadOnlySharedFolder(e)?s.push(n.intl.formatMessage({id:"513aYe",defaultMessage:"Read-only shared folder"})):s.push(n.intl.formatMessage({id:"r6q13e",defaultMessage:"Shared folder"})):e.type===r.FileTypes.TEAM_SHARED_FOLDER?a.File.isReadOnlySharedFolder(e)?s.push(n.intl.formatMessage({id:"dNfvWF",defaultMessage:"Read-only team shared folder"})):s.push(n.intl.formatMessage({id:"8zuxGM",defaultMessage:"Team shared folder"})):s.push(n.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"}))),s.length>0?i.default.createElement("span",{className:"ax-visually-hidden"},`${s.join(" ")}`):null},t.FileNameAudioDescription.displayName="FileNameAudioDescription"})),define("metaserver/static/js/modules/clean/react/files_view/file_name/file_name_cell",["require","exports","tslib","classnames","react","react-redux","spectrum/dimensions/index","metaserver/static/js/modules/clean/react/browse/data/selectors","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/item_selectors","metaserver/static/js/modules/clean/react/files_view/star","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/selectable_list","metaserver/static/js/modules/clean/react/files_view/file_name/file_name_cell_contents","metaserver/static/js/modules/clean/react/flows/components/badge_async","metaserver/static/js/modules/clean/redux/namespaces","metaserver/static/js/modules/clean/react/files_view/file_name/renaming_bar_modal_overlay","metaserver/static/js/modules/clean/react/files_view/file_name/renaming_bar_api_v2","metaserver/static/js/modules/clean/react/browse/data/store","metaserver/static/js/modules/core/browser_detection"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameCell=t.FileNameCellComponent=void 0,i=s.__importDefault(i),r=s.__importDefault(r),t.FileNameCellComponent=({mediaActions:e,fileNameCellWidth:t,draggable:s,shouldTruncateMiddleFilename:a,renameState:o,flowsBadge:c,showStar:d,file:h,user:b,isMobileMode:I,isSelected:w,showLocation:C,showSnippets:O,shouldShowSubtitle:F,snippetRows:R,onNameClick:A,showUserEducationEffects:y,showHighlights:D,hrefForFile:M,userEducationEffectName:N,isTooltipEnabled:L,showFirstTaskSubtitle:P,renderFilenameSubtitleAsLink:j,onRenameCancel:U,onRenameSubmit:x,isHovered:k,onLocationLinkClick:V,onSelect:B,onDragStart:W,expFlowsAutomatedFolderUI:H,showTags:G,preventSelectionOnDrag:q,mediaFiltersVariant:z,backupNewLocationHintEnabled:K,isInsideBackupFolder:Y,ggToCdmMigrationVariant:J,renameInput:Q,isRenameBarDisabled:X})=>{const Z=i.default("brws-file-name-cell-text","brws-vertically-center",{"brws-file-name-cell-text-rename":!!o}),$=i.default("brws-file-name-container",{"brws-file-name-container--action-ui-inline-star":!0}),ee=s=>{let i;return a&&(i=t||s,void 0!==i&&void 0!==e&&(i-=48)),i},te=e=>{W&&(q||w||!B||B(_.SelectOptions.DEFAULT,p.FilesViewActionSource.ROW_SINGLE_CLICK),W(e))},se=a&&void 0===t,[ie,re]=r.default.useState(!1),[ae,oe]=r.default.useState(0),ne=r.default.useRef(null),[le,ce]=r.default.useState(Q);r.default.useEffect(()=>{n.postTTIExperiments(E.getStoreForBrowse().getState()).expRenamingBar&&!v.is_supported_mobile_browser()&&!X&&h instanceof l.File&&!h.is_dir?S.shouldShowRenamingBar(b.id).then(e=>{let t=e.should_show;S.getRules(b.id,h.fq_path.substring(0,h.fq_path.lastIndexOf("/"))).then(e=>{e&&e.rules_struct&&Object.keys(e.rules_struct).length&&!g.isDefaultRules(e.rules_struct)&&(t=!1),re(t)})}):re(!1)},[X,ae,h,b.id]);const de=r.default.useCallback(()=>{oe(e=>e+1)},[]);return r.default.useEffect(()=>{ce(Q)},[Q]),r.default.createElement(r.default.Fragment,null,r.default.createElement(T,{className:$,shouldWrap:se},e=>r.default.createElement("div",{className:$},ie&&o===p.RenameState.PENDING_INPUT&&0===ae&&Q&&h instanceof l.File&&!window.location.pathname.startsWith("/search")&&r.default.createElement(g.RenamingBarModalOverlay,{anchorRef:ne,userId:b.id,fqPath:h.fq_path,namespaceId:h.ns_id,renameInput:le,incNumRenamingBarDismissed:de}),r.default.createElement("div",{className:Z,draggable:s,onDragStart:te,ref:ne},r.default.createElement(m.FileNameCellContents,{file:h,renameState:o,showLocation:C,showSnippets:O,shouldShowSubtitle:F,snippetRows:R,user:b,onNameClick:A,isSelected:w,showUserEducationEffects:y,showHighlights:D,hrefForFile:M,userEducationEffectName:N,isTooltipEnabled:L,showFirstTaskSubtitle:P,renderFilenameSubtitleAsLink:j,onRenameCancel:U,onRenameSubmit:x,isHovered:k,onLocationLinkClick:V,width:ee(e),shouldShowTags:G,mediaFiltersVariant:z,backupNewLocationHintEnabled:K,isInsideBackupFolder:Y,ggToCdmMigrationVariant:J,isRenamingBarEnabled:ie,numRenamingBarDismissed:ae,incNumRenamingBarDismissed:de})),null!=c&&r.default.createElement(f.AsyncBadgeComponent,{isFolderFocused:w,type:c,isInUnifiedModal:!!H}),!o&&d&&r.default.createElement(u.StarContainer,{item:h,user:b,className:"brws-file-name-cell-star",isReadOnly:I,tabIndex:w?0:-1,starButtonClassName:"brws-file-name-star-button",alwaysShowUnstarred:!0}))),e)},t.FileNameCellComponent.displayName="FileNameCellComponent";const T=({children:e,className:t,shouldWrap:s})=>s?r.default.createElement(o.Dimensions,{className:t},({width:t})=>e(t)):e();T.displayName="ConditionalDimensions";t.FileNameCell=a.connect((e,t)=>{const s=d.selectItemAssertFileOrFileSharedWithMe(e,t),i=h.BROWSE_NAMESPACE_KEY in e&&"fq_path"in s?n.isInsideBackupFolderByFile(e,s):void 0;return{file:s,flowsBadge:d.selectFlowsBadge(e,t),isSelectMode:c.selectHasItemsSelected(e,t),isSelected:d.selectIsItemSelected(e,t),expFlowsAutomatedFolderUI:c.selectExpFlowsAutomatedFolderUI(e,t),renameState:d.selectRenameState(e,t),renderFilenameSubtitleAsLink:c.selectRenderFilenameSubtitleAsLink(e,t),isMobileMode:c.selectIsMobileMode(e,t),showHighlights:c.selectShouldShowFileNameHighlights(e,t),showLocation:c.selectShouldShowFileNameLocation(e,t),showStar:d.selectShouldShowStar(e,t),showUserEducationEffects:d.selectShouldShowUserEducationEffects(e,t),userEducationEffectName:d.selectUserEducationEffectName(e,t),isTooltipEnabled:d.selectIsTooltipEnabled(e,t),user:c.selectUser(e,t),shouldTruncateMiddleFilename:c.selectArePostTTIModulesLoaded(e,t),showSnippets:d.selectShouldShowSnippets(e,t),snippetRows:d.selectSnippetRows(e,Object.assign(Object.assign({},t),{numVisibleColumns:t.visibleColumns.length})),showFirstTaskSubtitle:d.selectShouldShowFirstTaskSubtitle(e,t),shouldShowSubtitle:d.selectShouldShowSubtitle(e,t),backupNewLocationHintEnabled:n.backupNewLocationHintEnabled(e),isInsideBackupFolder:i,ggToCdmMigrationVariant:n.ggToCdmMigrationVariant(e),renameInput:d.selectRenameInput(e,t),isRenameBarDisabled:d.selectIsRenameBarDisabled(e,t)}})(t.FileNameCellComponent)})),define("metaserver/static/js/modules/clean/react/files_view/file_name/file_name_cell_contents",["require","exports","tslib","react","spectrum/media_table/index","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/files_view/file_snippets","metaserver/static/js/modules/clean/react/files_view/name_input","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/files_view/file_name/file_name_subtitle","metaserver/static/js/modules/clean/react/files_view/file_name/file_name_title","metaserver/static/js/modules/clean/react/files_view/file_name/file_name_audio_description","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/tagging/logger","metaserver/static/js/modules/clean/tagging/utils","metaserver/static/js/modules/clean/tagging/components/tags_container","metaserver/static/js/modules/clean/media_filters/gating","metaserver/static/js/modules/clean/media_filters/media_search_snippet_loader","metaserver/static/js/modules/clean/react/browse/data/helpers","dig-components/buttons","dig-components/tooltips","dig-components/icons","dig-components/icons/src","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/clean/sync_everything/constants"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w,C,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameCellContents=void 0,i=s.__importDefault(i),a=s.__importStar(a),f=s.__importStar(f),h=s.__importStar(h),C=s.__importStar(C);const F=e=>{null==e||e.stopPropagation()};t.FileNameCellContents=({file:t,renameState:_,showLocation:A,showSnippets:y,shouldShowSubtitle:D,snippetRows:M,user:N,onNameClick:L,isSelected:P,showUserEducationEffects:j,showHighlights:U,hrefForFile:x,userEducationEffectName:k,isTooltipEnabled:V,showFirstTaskSubtitle:B,renderFilenameSubtitleAsLink:W,onRenameCancel:H,onRenameSubmit:G,isHovered:q,onLocationLinkClick:z,width:K,shouldShowTags:Y,mediaFiltersVariant:J,backupNewLocationHintEnabled:Q,isInsideBackupFolder:X,ggToCdmMigrationVariant:Z,isRenamingBarEnabled:$,numRenamingBarDismissed:ee,incNumRenamingBarDismissed:te})=>{const se=R(),ie=((e,t)=>s=>{const i=!c.shouldHandleClick(s);i||(s.preventDefault(),s.stopPropagation()),c.isFile(e)&&(null==t||t(e,i))})(t,z),re=()=>{c.isFile(t)&&(null==H||H(t))},ae=e=>{c.isFile(t)&&(null==G||G(t,e))},oe=Z&&"OFF"!==Z?i.default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{MigrationTooltip:t,MigrationTooltipStep:r}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/gg_to_cdm_migration/migration_tooltip"],t,s)}).then(s.__importStar);return{default:e=>i.default.createElement(t,Object.assign({},e,{step:r.Two}))}}))):void 0,ne=i.default.useRef(null),le=i.default.useMemo(()=>oe?i.default.createElement(oe,{triggerRef:ne,ggToCdmMigrationVariant:Z,user:N}):void 0,[ne,Z]);if(c.isFile(t)&&_===l.RenameState.PENDING_INPUT)return i.default.createElement(n.NameInput,{defaultValue:a.filename(t.fq_path),label:t.is_dir?se.renameDirStr:se.renameFileStr,onClick:F,onSubmit:ae,onCancel:re,ignoreFileExtension:t.is_dir,isRenamingBarEnabled:$,numRenamingBarDismissed:ee,incNumRenamingBarDismissed:te});let ce;ce=_===l.RenameState.SAVING_INPUT?i.default.createElement(i.default.Fragment,null,se.renamingStr):i.default.createElement(u.FileNameTitle,{file:t,user:N,containerWidth:K,isSelected:P,onNameClick:L,hrefForFile:x,showHighlights:U,isTooltipEnabled:V,showUserEducationEffects:j,userEducationEffectName:k}),t instanceof m.File&&m.File.isTeamMemberFolder(t)&&le&&(ce=i.default.createElement("span",{ref:ne},ce,i.default.createElement(i.default.Suspense,{fallback:i.default.createElement(i.default.Fragment,null)},le)));let de=null;B?de=i.default.createElement("span",{className:"first-task-content-subtitle"},se.filesMovedString):A&&(de=i.default.createElement(d.FileSubtitle,{containerWidth:K,file:t,onClick:ie,renderAsLink:W,user:N,focusable:P,isInsideBackupFolder:X}));const ue=K?{width:K}:void 0,pe=S.isMediaFiltersEnabled(J)&&c.isFile(t)&&t.media_data,_e=y||Y&&c.isFile(t)||pe;return i.default.createElement(i.default.Fragment,null,i.default.createElement(r.MediaCellText,{key:"title",highlight:q},i.default.createElement("div",{className:"brws-file-name-cell-title-container"},ce,i.default.createElement(p.FileNameAudioDescription,{file:t,isSelected:P}),Q&&v.isBackupFolder(t)&&!O.isBackupBrowse()&&i.default.createElement(b.Tooltip,{title:se.backupNewLocationTooltipStr,placement:"right"},i.default.createElement(T.Button,{className:"brws-file-name-cell-backup-new-location",variant:"transparent",size:"small",withIconLeft:i.default.createElement(I.UIIcon,{src:w.OpenLine,size:"small"}),onClick:t=>{new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/sync_everything/constants"],t,s)}).then(s.__importStar).then(({getBackupUrl:e})=>C.open_tab(e("browse_row"))),t.stopPropagation()}},se.backupNewLocationButtonStr)))),D&&i.default.createElement(r.MediaCellText,{key:"subtitle",variant:"subtitle"},de),_e&&i.default.createElement(r.MediaCellText,{key:"snippets_tags",variant:"subtitle",style:ue},i.default.createElement("div",{className:"brws-file-snippets-tags-container"},pe&&c.isFile(t)&&i.default.createElement("span",{className:"brws-file-snippets-media-search",style:ue},i.default.createElement(E.AsyncMediaSearchSnippet,{mediaData:t.media_data,mediaFiltersVariant:J})),y&&i.default.createElement(o.FileSnippets,{snippets:t.snippets,lineClamp:M}),Y&&c.isFile(t)&&t.tags&&t.tags.length>0&&i.default.createElement("span",{className:"brws-file-snippets",style:ue},i.default.createElement(g.TagsContainer,{tags:t.tags.map(e=>e.value),highlightedIndexes:t.tags.map((e,t)=>e.highlighted?t:void 0).filter(e=>void 0!==e),onTagClick:(e,s)=>{if(s){!c.shouldHandleClick(s)||(s.preventDefault(),s.stopPropagation())}c.isFile(t)&&(f.logTagClick(N,[t],"center_pane",e),h.redirectToSearchByTag(N,e.tag_text))},containerClassName:"brws-file-tags-container",chipClassName:"brws-file-tag",showMoreClassName:"brws-file-tags-show-more",chipSize:"xsmall",containerMaxRows:1,expandable:!1,showMoreWidth:100})))))},t.FileNameCellContents.displayName="FileNameCellContents";const R=()=>({filesMovedString:_.intl.formatMessage({id:"WYezR2",defaultMessage:"Your existing files moved here."}),renameFileStr:_.intl.formatMessage({id:"44Ky+Q",defaultMessage:"Rename file"}),renameDirStr:_.intl.formatMessage({id:"YApL4x",defaultMessage:"Rename directory"}),renamingStr:_.intl.formatMessage({id:"KvygQC",defaultMessage:"Renaming…"}),backupNewLocationButtonStr:_.intl.formatMessage({id:"wX0e+1",defaultMessage:"New location"}),backupNewLocationTooltipStr:_.intl.formatMessage({id:"Pn0YTw",defaultMessage:"Backups have a new home"})})})),define("metaserver/static/js/modules/clean/react/files_view/file_name/file_name_subtitle",["require","exports","tslib","react","metaserver/static/js/modules/clean/browse_interface","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/files_view/file_name/truncation_helpers"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSubtitle=void 0,i=s.__importDefault(i),a=s.__importStar(a);t.FileSubtitle=({file:e,renderAsLink:t=!0,user:s,containerWidth:c,onClick:d,focusable:u,isInsideBackupFolder:p})=>{const _={notAddedYetString:e=>n.intl.formatMessage({id:"hY0d5Z",defaultMessage:"not added yet, in {location}"},{location:e}),sharedWithYouString:n.intl.formatMessage({id:"FWJkxz",defaultMessage:"Shared with you"}),formattedLocationText:e=>n.intl.formatMessage({id:"yR1l4z",defaultMessage:"in {location}"},{location:e})};if(!o.isFile(e))return i.default.createElement(i.default.Fragment,null,_.sharedWithYouString);const m=a.parent_dir(e.fq_path),f="/"===m?r.get_browse_root_name(s):m.slice(1);if(e.is_unmounted)return i.default.createElement(i.default.Fragment,null,_.notAddedYetString(f));const h=l.truncateTextInFilenameCell(_.formattedLocationText(f),12,6,c);if(!t||e.isDeleted)return i.default.createElement(i.default.Fragment,null,h);const g=r.browse_uri_for_fq_path(s,m,void 0,{isBackup:p});return i.default.createElement("a",{className:"brws-file-name-cell-location",href:g.toString(),onClick:d,tabIndex:u?0:-1},h)},t.FileSubtitle.displayName="FileSubtitle",t.FileSubtitle.displayName="FileSubtitle"})),define("metaserver/static/js/modules/clean/react/files_view/file_name/file_name_title",["require","exports","tslib","react","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/title_bubble","metaserver/static/js/modules/clean/user_education/react/user_education_effect","metaserver/static/js/modules/clean/react/sticky_position","typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/index","metaserver/static/js/modules/clean/react/files_view/file_name/truncation_helpers"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileNameTitle=void 0,i=s.__importDefault(i),r=s.__importStar(r);const _=e=>e instanceof a.FileSharedWithMe;t.FileNameTitle=({file:e,user:t,hrefForFile:s,showHighlights:a,showUserEducationEffects:m,userEducationEffectName:f,isSelected:h,containerWidth:g,onNameClick:S,isTooltipEnabled:E})=>{const v=n.getFilename(e),T=i.default.useRef(null),b=i.default.useMemo(()=>((e,t,s)=>{if(!t||_(e)||!s.current)return!1;const i=s.current,a=r.filename(e.fq_path),o=i.offsetWidth<i.scrollWidth,n=i.textContent!==a;return o||n})(e,E,T),[e,E]);let I,w;if(g)I=i.default.createElement(u.HighlightedTruncatedString,{text:v,className:"brws-file-name-element",fontSize:14,availableWidth:g,highlightSpans:p.getHighlightedSpansForHighlightedTruncatedString(v,e),cellBuffer:3});else{const t=p.truncateTextInFilenameCell(v,14,3,g);I=a&&(e.highlight_spans||n.isFile(e)&&e.filename_highlights)?p.getHighlightedSpan(t,e):i.default.createElement("span",null,t),I=i.default.createElement("div",{className:"brws-file-name-element",ref:T},I)}if(b){const e=v.length<=o.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?v:i.default.createElement("div",{className:"brws-file-name-cell-tooltip"},v);I=i.default.createElement(l.TitleBubble,{content:e,position:d.StickyPosition.BOTTOM,className:"list-label__title-bubble"},I)}return _(e)?w=e.href:e.is_unmounted||e.isDeleted||(w=null==s?void 0:s(t,e)),void 0!==w&&(I=i.default.createElement("a",{className:"brws-file-name-cell-filename",href:w,onClick:S,tabIndex:h?0:-1},I)),m&&(I=i.default.createElement(c.UserEducationEffect,{containerName:"FileNameLabel",name:f||"FileNameLabel",useSpan:!0},I)),I},t.FileNameTitle.displayName="FileNameTitle",t.FileNameTitle.displayName="FileNameTitle"})),define("metaserver/static/js/modules/clean/react/files_view/file_name/truncation_helpers",["require","exports","tslib","react","metaserver/static/js/modules/clean/em_string","metaserver/static/js/modules/clean/filename_highlights","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/util"],(function(e,t,s,i,r,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHighlightedSpansForHighlightedTruncatedString=t.getHighlightedSpan=t.truncateTextInFilenameCell=void 0,i=s.__importDefault(i);t.truncateTextInFilenameCell=function(e,t,s,i){if(i&&i>32){const a=(i-32)/t,o=Math.max(s,a-s);return r.Emstring.em_snippet(e,Math.floor(o),.5)}return e},t.getHighlightedSpan=function(e,t){const s=n.getFilename(t),r=(function(e,t){let s=0;for(;s<e.length&&e.charAt(s)===t.charAt(s);)++s;return s===e.length||"…"!==e.charAt(s)?[e]:[e.substring(0,s),e.substring(s+1)]})(e,s);if(1===r.length)return n.isFile(t)&&!t.highlight_spans?a.highlightMatchReact(e,t.filename_highlights):a.highlightReactFromHighlightSpans(e,t.highlight_spans);let o,l;return n.isFile(t)&&!t.highlight_spans?(o=a.highlightMatchReact(s,t.filename_highlights,0,r[0].length),l=a.highlightMatchReact(s,t.filename_highlights,s.lastIndexOf(r[1]))):(o=a.highlightReactFromHighlightSpans(s,t.highlight_spans,0,r[0].length),l=a.highlightReactFromHighlightSpans(s,t.highlight_spans,s.lastIndexOf(r[1]))),i.default.createElement("span",null,o,"…",l)},t.getHighlightedSpansForHighlightedTruncatedString=function(e,t){if(n.isFile(t)||(e=>e instanceof o.FileSharedWithMe)(t)){if(t.highlight_spans)return t.highlight_spans.map(e=>({string:e.highlight_str,isHighlighted:e.is_highlighted}));if(n.isFile(t)&&t.filename_highlights){return a.highlightMatchSections(e,t.filename_highlights).map(e=>({string:e.text,isHighlighted:e.isHighlighted}))}}}})),define("metaserver/static/js/modules/clean/react/files_view/file_name/renaming_bar_modal_overlay",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/components/css","lodash","dig-components/overlay","dig-components/layer","dig-components/buttons","dig-components/icons/src","dig-components/icons","metaserver/static/js/modules/clean/react/files_view/data/store","metaserver/static/js/modules/clean/react/files_view/data/action_creators","metaserver/static/js/modules/clean/react/files_view/file_name/renaming_bar_api_v2","react-intl","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/clean/web_user_action_logger","metaserver/static/js/modules/clean/react/browse/data/store","metaserver/static/js/modules/clean/react/browse/data/selectors"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDefaultRules=t.RenamingBarModalOverlay=t.RenamingBarModalOverlayComponent=void 0,i=s.__importDefault(i);class v extends i.default.Component{constructor(){var t;super(...arguments),this.state={suggestedRename:(t=this.props,t.fqPath.substring(t.fqPath.lastIndexOf("/")+1)),isFilenameAlreadyConformed:!1},this.onWindowResize=a.throttle(()=>{this.props.anchorRef.current},500),this.updateSuggestedRename=(e,t,s)=>{_.namingConventionsFilePreview(e,t,s).then(e=>{this.setState({suggestedRename:e.filename_suggestion.length>0?e.filename_suggestion[0].suggested_rename:s,isFilenameAlreadyConformed:e.filename_suggestion.length<=0})})},this.handleClick=e=>{e.preventDefault(),e.stopPropagation()},this.handleApplyToFileClick=()=>s.__awaiter(this,void 0,void 0,(function*(){if(u.getStoreForFilesView().dispatch(p.updateNamingConventionsApplyStatus({isApplyClicked:!0})),this.state.isFilenameAlreadyConformed){const[{showNoTargetSnackbar:t}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/actions"],t,s)}).then(s.__importStar)]);return void t()}const t=this.props.fqPath.substring(0,this.props.fqPath.lastIndexOf("/")),[{applyNamingConventions:i},{NamingConventionType:r,DateFormatSelection:a,ConsistentSeparatorSelection:o,NamingConventionOrigin:n}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/actions"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/types"],t,s)}).then(s.__importStar)]);g.WebUserActionLog.log(this.props.userId,h.WebUserActionLogEvent.NAMING_CONVENTIONS_APPLY,{ns_id:this.props.namespaceId,start_with_date:1,start_with_date_options:a.yyyy_mm_dd,change_all_separators:1,change_all_separators_options:o.spaces,capitalize_all_initials:1,include_parent_folder_name:0,end_with_keyword:0,origin:n.from_renaming_bar,file_count:1,automation:"unchanged"});const l={selectedRules:[r.consistent_separators,r.capitalize_all_initials,r.upload_date],dateFormatSelection:a.yyyy_mm_dd,consistentSeparatorSelection:o.spaces,mlFilenameParsing:!1,data:{keyword:""}};i({userId:this.props.userId,fqPath:t,nameUpdates:[{file:this.props.fqPath,suggested_rename:this.state.suggestedRename}],reopenModal:void 0,nsId:0,newRules:l,prevRules:l,automationToggled:!1,updateAutomation:!1,isAutomationEligibleFolder:!1})})),this.handleMoreOptionsClick=()=>s.__awaiter(this,void 0,void 0,(function*(){u.getStoreForFilesView().dispatch(p.updateNamingConventionsApplyStatus({isApplyClicked:!0}));const t=this.props.fqPath.substring(0,this.props.fqPath.lastIndexOf("/")),i=E.postTTIExperiments(S.getStoreForBrowse().getState()).expNamingConventionsPositioning,[{showNamingConventionsModal:r},{NamingConventionOrigin:a}]=yield Promise.all([new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/naming_conventions_modal"],t,s)}).then(s.__importStar),new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/naming_conventions/types"],t,s)}).then(s.__importStar)]);g.WebUserActionLog.log(this.props.userId,h.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:this.props.namespaceId,origin:a.from_renaming_bar,positioning:i?1:0}),r({currentUserId:this.props.userId,targetPath:t,namespaceId:0,origin:a.from_renaming_bar})})),this.onClose=()=>{this.props.incNumRenamingBarDismissed(),u.getStoreForFilesView().dispatch(p.updateRenamingBarDisabledStatus({})),_.dismissRenamingBar(this.props.userId)},this.renamingBarMsg=f.intl.formatMessage(m.defineMessage({id:"vAKE36",defaultMessage:"Do you also want to set naming conventions?"})),this.applyButtonMsg=f.intl.formatMessage(m.defineMessage({id:"m+bcDh",defaultMessage:"Apply to file"})),this.MoreOptionsButtonMsg=f.intl.formatMessage(m.defineMessage({id:"vp4zOG",defaultMessage:"More options"}))}componentDidMount(){window.addEventListener("resize",this.onWindowResize),void 0!==this.props.renameInput&&""!==this.props.renameInput&&this.updateSuggestedRename(this.props.userId,this.props.fqPath,this.state.suggestedRename)}componentDidUpdate(e){e.renameInput!==this.props.renameInput&&void 0!==this.props.renameInput&&""!==this.props.renameInput&&this.updateSuggestedRename(this.props.userId,this.props.fqPath,this.props.renameInput)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}render(){return i.default.createElement(n.LayerContext.Provider,{value:20},i.default.createElement(o.Overlay,{className:"renaming-bar-overlay",anchorRef:this.props.anchorRef,placement:"bottom-start",auto:!0,onClick:this.handleClick},i.default.createElement("div",{className:"renaming-bar-overlay-header"},i.default.createElement("p",{className:"renaming-bar-overlay-header-content"},this.renamingBarMsg),i.default.createElement(l.IconButton,{variant:"transparent"},i.default.createElement(d.UIIcon,{src:c.CloseLine,"aria-label":"Close Renaming Bar",onClick:this.onClose}))),i.default.createElement("div",{className:"renaming-bar-overlay-body"},i.default.createElement("div",{className:"renaming-bar-overlay-body-content"},i.default.createElement(l.IconButton,{className:"renaming-bar-overlay-body-content-icon",variant:"transparent"},i.default.createElement(d.UIIcon,{src:c.FileLine,"aria-label":"suggested filename"})),i.default.createElement("div",{className:"renaming-bar-overlay-body-content-filename"},this.state.suggestedRename)),i.default.createElement(l.Button,{variant:"transparent",onClick:this.handleApplyToFileClick},this.applyButtonMsg),i.default.createElement(l.Button,{variant:"transparent",className:"renaming-bar-overlay-body-button",onClick:this.handleMoreOptionsClick},this.MoreOptionsButtonMsg))))}}t.RenamingBarModalOverlayComponent=v,v.displayName="RenamingBarModalOverlayComponent",t.RenamingBarModalOverlay=r.requireCssWithComponent(v,["/static/css/dig-components/index.web-vfl0pq0Fh.css","/static/css/files_view/renaming_bar-vflLnAiqm.css"]),t.isDefaultRules=function(e){return e.start_with_date&&"yyyy_mm_dd"===e.start_with_date[".tag"]&&e.change_all_separators&&"spaces"===e.change_all_separators[".tag"]&&e.capitalize_all_initials&&"capitalize_initials"===e.capitalize_all_initials[".tag"]&&!e.data&&!e.end_with_keyword&&!e.include_parent_folder_name&&!e.ml_filename}})),define("metaserver/static/js/modules/clean/react/files_view/name_input",["require","exports","tslib","react","ts-key-enum","metaserver/static/js/modules/clean/react/files_view/types","dig-components/text_fields","metaserver/static/js/modules/clean/react/files_view/data/store","metaserver/static/js/modules/clean/react/files_view/data/action_creators","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors"],(function(e,t,s,i,r,a,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NameInput=void 0,i=s.__importDefault(i);const d=()=>{};class u extends i.default.PureComponent{constructor(){super(...arguments),this.inputRef=i.default.createRef(),this.handleDragStart=e=>{e.stopPropagation()},this.handleSubmit=e=>{e.preventDefault(),this.submitIfChanged(a.NameInputActionSource.SUBMIT)},this.handleKeyDown=e=>{e.key===r.Key.Escape?(e.preventDefault(),this.props.onCancel({source:a.NameInputActionSource.ESC})):e.key===r.Key.Enter&&this.handleSubmit(e)},this.handleBlur=e=>{this.props.isRenamingBarEnabled&&void 0!==this.props.numRenamingBarDismissed?setTimeout(()=>{1===this.props.numRenamingBarDismissed?(this.inputRef.current&&this.inputRef.current.focus(),this.props.incNumRenamingBarDismissed()):this.submitIfChanged(a.NameInputActionSource.BLUR)},200):this.submitIfChanged(a.NameInputActionSource.BLUR)},this.handleClick=e=>{e.preventDefault(),this.props.onClick(e)},this.handleChange=e=>{n.getStoreForFilesView().dispatch(l.updateFileRenameInput({renameInput:e.currentTarget.value}))}}componentDidMount(){this.inputRef.current&&this.inputRef.current.focus(),window.requestAnimationFrame(()=>{if(!this.inputRef.current)return;const e=this.inputRef.current.value;let t=this.props.ignoreFileExtension?e.length:e.lastIndexOf(".");t<0&&(t=e.length),this.inputRef.current.setSelectionRange(0,t)})}submitIfChanged(e){var t;if(this.inputRef.current){const s=this.inputRef.current.value.trim();s===this.props.defaultValue||!0===(null===(t=c.fileRename(n.getStoreForFilesView().getState()))||void 0===t?void 0:t.isNamingConventionsApplied)?this.props.onCancel({source:e}):this.props.onSubmit(s)}}render(){return i.default.createElement("form",{className:"u-pad-right-xs",onSubmit:this.handleSubmit},i.default.createElement(o.TextInput,{ref:this.inputRef,defaultValue:this.props.defaultValue,className:this.props.className,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onDragStart:this.handleDragStart,"aria-label":this.props.label,onClick:this.handleClick,onChange:this.handleChange}))}}t.NameInput=u,u.defaultProps={className:"",onCancel:d,onClick:d,onSubmit:d,idDir:null},u.displayName="NameInput"})),define("metaserver/static/js/modules/clean/react/files_view/tile_label_input",["require","exports","tslib","classnames","react","metaserver/static/js/modules/clean/react/files_view/name_input"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TileLabelInput=void 0,i=s.__importDefault(i),r=s.__importDefault(r),t.TileLabelInput=function(e){const t=i.default("tile-label-input",e.className),s=e.defaultValue||"";return r.default.createElement(a.NameInput,{className:t,defaultValue:s,label:e.label,onCancel:e.onCancel,onClick:e=>{e&&(e.stopPropagation(),e.preventDefault())},onSubmit:e.onSubmit})}})),define("metaserver/static/js/modules/clean/react/files_view/tile_grid",["require","exports","tslib","classnames","immutable","react","metaserver/static/js/modules/clean/em_string","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/filetypes","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/drag_drop/drag_and_drop","metaserver/static/js/modules/clean/react/files_view/file_list_utils","metaserver/static/js/modules/clean/react/files_view/keyboard_shortcuts","metaserver/static/js/modules/clean/react/files_view/overflow_menu","metaserver/static/js/modules/clean/react/files_view/star","metaserver/static/js/modules/clean/react/files_view/tile_label_input","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/icon/file_folder_icon","metaserver/static/js/modules/clean/react/files_view/base_tile_grid","metaserver/static/js/modules/clean/react/selectable_list","metaserver/static/js/modules/clean/react/sticky_position","metaserver/static/js/modules/clean/react/title_bubble","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w,C,O,F){"use strict";function R(e){e.stopPropagation()}Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewTileGrid=t.TileLabel=void 0,i=s.__importDefault(i),r=s.__importStar(r),a=s.__importDefault(a),n=s.__importStar(n),O=s.__importStar(O);class A extends a.default.PureComponent{render(){const{fileRename:e,arePostTTIModulesLoaded:t,user:s,item:i,createRenameCancelHandler:r,createRenameSubmitHandler:l}=this.props;let c;if(c=i instanceof d.File?n.filename(i.fq_path):i instanceof d.FileSharedWithMe?i.filename:i instanceof d.Paper?i.title:i.name,i instanceof d.File&&e&&n.paths_are_equal(e.file.fq_path,i.fq_path)){if(e.state===S.RenameState.PENDING_INPUT)return a.default.createElement(g.TileLabelInput,{defaultValue:c,label:c,onCancel:r(i),onSubmit:l(i)});if(e.state===S.RenameState.SAVING_INPUT)return a.default.createElement(T.TileItemLabelText,{className:"tile-label__text--saving",label:F.intl.formatMessage({id:"OefYpa",defaultMessage:"Renaming…"})})}const p=o.Emstring.em_snippet(c,14,.5),_=t&&i instanceof d.File&&!d.File.isNoAccessSharedFolder(i);let m=a.default.createElement(T.TileItemLabelText,{key:"label",label:p});if(c!==p){const e=c.length<=u.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?c:a.default.createElement("div",{className:"tile-label-tooltip"},c);m=a.default.createElement(w.TitleBubble,{content:e,position:I.StickyPosition.BOTTOM,className:"tile-label__title-bubble",key:"tooltip"},m)}const f=a.default.createElement(h.StarContainer,{item:i,user:s,className:"tile-star",key:"tileStar",tabIndex:-1});return a.default.createElement("span",null,[m,_&&!e&&f])}}t.TileLabel=A,A.displayName="TileLabel";class y extends a.default.PureComponent{constructor(){super(...arguments),this.tileGridRef=a.default.createRef(),this.state={inSelectMode:!1,selectedIds:r.Set(),menuOpenId:void 0},this.createRenameCancelHandler=e=>()=>{this.props.onRenameCancel(e)},this.createRenameSubmitHandler=e=>t=>{this.props.onRenameSubmit(e,t)},this.logOverflowMenuOpen=()=>{const{selectedFiles:e,user:t,viewType:s}=this.props,i=e?e.count(e=>e.is_dir):0,r=e?e.count()-i:0;c.logContextMenuClick({uid:t.id,viewType:s,action_surface:C.ActionSurfaceLogValue.CENTER_PANE,numFilesSelected:r,numFoldersSelected:i})},this.hrefForItem=(e,t)=>t instanceof d.File?this.props.hrefForFile(e,t):t instanceof d.FileSharedWithMe?t.href:t.url,this.getTileItem=(e,t)=>{const{activeDropTarget:s,isCreateFolderUIActive:i,isPhotosPage:r,items:a,selection:o,user:c,viewType:p,focusedFileIndex:_,disabledMultiselect:m,cutItems:f}=this.props,{menuOpenId:h}=this.state,{inSelectMode:g}=this.state;if(i){if(0===e)return this.getCreateFolderTile();e-=1}const T=a.get(e);if(!T){const t=`Placeholder ${e}`;return{altText:t,id:t,isViewOnly:!0,isDraggable:!1,isSelectable:!1}}const b=E.isFile(T)||E.isFswm(T),I=T,w=g&&b,C=_===e,O=w&&o.selected.some(e=>I instanceof d.FileSharedWithMe?I.file_id===e:I.fq_path===e),R=this.createToggleSelectHandler(I,O),A=this.createRightClickSelectHandler(I,O),y=this.createClickHandler({item:T,inSelectModeAndIsFile:w,toggleSelectHandler:R}),D=this.createRightClickHandler({item:T,rightClickSelectHandler:A}),M=this.createViewFileHandler(T,S.FilesViewActionSource.ROW_DOUBLE_CLICK),N=this.createViewFileHandler(T,S.FilesViewActionSource.ROW_TITLE),L=E.isFile(T)||E.isFswm(T)?this.renderTileOverflowMenu(T,t,r):void 0,P=this.renderLabelElement(e),j=(function(e){let t=e instanceof d.File?n.filename(e.fq_path):E.isFswm(e)?e.filename:e instanceof d.Paper?e.title:e.name;if(e instanceof d.File)switch(e.type){case l.FileTypes.FOLDER:t=F.intl.formatMessage({id:"C/gp+a",defaultMessage:"Folder, {alt}"},{alt:t});break;case l.FileTypes.PACKAGE:t=F.intl.formatMessage({id:"FhSkpL",defaultMessage:"Package, {alt}"},{alt:t});break;case l.FileTypes.SHARED_FOLDER:t=F.intl.formatMessage({id:"rWEPV0",defaultMessage:"Shared folder, {alt}"},{alt:t});break;case l.FileTypes.SANDBOX:t=F.intl.formatMessage({id:"+vbakm",defaultMessage:"Sandbox, {alt}"},{alt:t});break;case l.FileTypes.TEAM_SHARED_FOLDER:t=F.intl.formatMessage({id:"ZtOyAr",defaultMessage:"Team shared folder, {alt}"},{alt:t});break;case l.FileTypes.TEAM_MEMBER_FOLDER:t=F.intl.formatMessage({id:"1yRjbu",defaultMessage:"Team member folder, {alt}"},{alt:t});break;default:t=F.intl.formatMessage({id:"e8WrLw",defaultMessage:"File, {alt}"},{alt:t})}return t})(T),U=T===s,x=this.hrefForItem(c,T),k=T instanceof d.File||T instanceof d.FileSharedWithMe?v.getThumbnailUrlForItem(T.thumbnail_url_tmpl,u.ViewTypeThumbnailSizes[p]):void 0;return{file:I,paper:T instanceof d.Paper?T:void 0,fileSharedWithMe:T instanceof d.FileSharedWithMe?T:void 0,id:d.itemId(T),labelNode:P,altText:j,thumbnailUrl:k,actionNode:L,onClick:y,onRightClick:D,onDoubleClick:M,onLabelClick:N,isDraggable:!r&&(O||!w),isViewOnly:m,isFocused:C,isSelectable:b,handleToggleSelect:R,checkboxAriaText:F.intl.formatMessage({id:"o3Djy2",defaultMessage:"Select tile"}),href:x,onDragEnter:r?void 0:this.createDragEnterHandler(I,O,U),onDragStart:r?void 0:this.createDragStartHandler(I,O,R),onDragEnd:r?void 0:this.createDragEndHandler(),isCheckboxFocusable:r,isCutToClipboard:f&&E.isCutToClipboard(T,f),className:h===d.itemId(T)?"tile--hover-forced":void 0}},this.shouldFileBeHighlightedDropTarget=(e,t)=>{const{dropTargetHighlightMode:s}=this.props;return _.canFileBeHighlightedDropTarget({file:e,dropTargetHighlightMode:s})},this.scrollIntoView=({top:e,bottom:t},s)=>{const{viewportTopOffset:i=0}=this.props,{height:r,scrollTop:a,scrollTo:o}=this.getScrollPane(),n=r-i,l=a+n;e<a?o(0,e):t>l&&o(0,s&&t-e<n/2?t-n/2:t-n)}}UNSAFE_componentWillMount(){this.setState({inSelectMode:this.props.selectedFiles.count()>0}),this.setSelectedTiles(this.props)}componentDidMount(){this.setupExternalDragHandler(),this.setupKeyboardShortcuts()}componentWillUnmount(){this.props.isPhotosPage||m.resetFileJumpKeyboardShortcuts(b.SELECTABLE_TILE_GRID_KEY_SCOPE),m.resetFilesViewKeyboardShortcuts(b.SELECTABLE_TILE_GRID_KEY_SCOPE),p.cleanupExternalDragHandler(b.SELECTABLE_TILE_GRID_KEY_SCOPE)}UNSAFE_componentWillReceiveProps(e){e.selectedFiles!==this.props.selectedFiles&&(this.setSelectedTiles(e),this.setState({inSelectMode:e.selectedFiles.count()>0}))}componentDidUpdate(e){(e.createNewFolderState===S.NewFolderCreationState.PENDING_INPUT&&this.props.createNewFolderState===S.NewFolderCreationState.SAVING_INPUT||e.fileRename!==this.props.fileRename||e.items!==this.props.items||e.starredState!==this.props.starredState)&&this.tileGridRef.current&&this.tileGridRef.current.forceUpdate(),e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():m.resetFilesViewKeyboardShortcuts(b.SELECTABLE_TILE_GRID_KEY_SCOPE))}getTotalNumItems(){const{items:e,totalNumItems:t,isCreateFolderUIActive:s}=this.props;let i=Math.max(e.size,t);return s&&(i+=1),i}createToggleSelectHandler(e,t){const s=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path;return e=>{const{onDeselectFile:i,onSelectFile:r}=this.props,a=Boolean(!("keyCode"in e)&&e.shiftKey);t?i(s,a):r(s,a?b.SelectOptions.EXTEND:b.SelectOptions.DEFAULT)}}createRightClickSelectHandler(e,t){const s=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path;return e=>{const{onSelectFile:i}=this.props,r=Boolean(!("keyCode"in e)&&(e.shiftKey||e.metaKey||e.ctrlKey));t||i(s,r?b.SelectOptions.EXTEND:b.SelectOptions.DEFAULT)}}renderTileOverflowMenu(e,t,s){const{getOverflowMenuActions:i,arePostTTIModulesLoaded:r,inlineActions:o}=this.props;return o&&e instanceof d.File?a.default.createElement("div",{onClick:R},a.default.createElement(o,{file:e,className:"tile__action-button--overflow-menu",onHoverLocked:({isOpen:t})=>{this.setState({menuOpenId:t?d.itemId(e):void 0})}})):r&&a.default.createElement(f.FilesViewOverflowMenu,{file:e,getOverflowMenuActions:i,size:f.OverflowMenuSize.Small,showBorders:!0,ariaHidden:!s,onMenuOpen:this.logOverflowMenuOpen})}renderLabelElement(e){const{items:t,focusedFileIndex:s,user:i,fileRename:r,arePostTTIModulesLoaded:o,isPhotosPage:n}=this.props;if(n)return;const l=t.get(e);if(!l)return;const{inSelectMode:c}=this.state,d=s===e;return a.default.createElement(A,{item:l,user:i,fileRename:r,arePostTTIModulesLoaded:o,inSelectMode:c,isTileFocused:d,createRenameCancelHandler:this.createRenameCancelHandler,createRenameSubmitHandler:this.createRenameSubmitHandler})}createViewFileHandler(e,t){return s=>{if(s.preventDefault(),s.stopPropagation(),"click"===s.type){const t=s;if(0===t.button){const s=this.hrefForItem(this.props.user,e);if(E.hasModifierKey(t))return void O.open_tab(s)}}e instanceof d.File?this.props.onNavigateToFileOrFolder(e,{actionSource:t}):e instanceof d.FileSharedWithMe?this.props.onOpenFileSharedWithMe(e):e instanceof d.Paper&&this.props.onOpenPaper(e)}}createClickHandler({item:e,inSelectModeAndIsFile:t,toggleSelectHandler:s}){const i=e instanceof d.File||e instanceof d.FileSharedWithMe;return t=>{if(i){const i="keyCode"in t;if(t.preventDefault(),i)s(t);else{const i=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path;this.props.onSelectFile&&(t.shiftKey?this.props.onSelectFile(i,b.SelectOptions.EXTEND):t.ctrlKey||t.metaKey?s(t):this.props.onSelectFile(i,b.SelectOptions.ONLY))}}}}createRightClickHandler({item:e,rightClickSelectHandler:t}){const s=e instanceof d.File||e instanceof d.FileSharedWithMe;return i=>{if(!s)return;const r="keyCode"in i;if(i.preventDefault(),r)t(i);else{if(!this.props.onSelectFile)return;const t=e instanceof d.FileSharedWithMe?e.file_id:e.fq_path,s=i.shiftKey||i.ctrlKey||i.metaKey?b.SelectOptions.EXTEND:b.SelectOptions.ONLY;this.props.onSelectFile(t,s)}}}setSelectedTiles(e){const t=r.Set().withMutations(t=>{e.selectedFiles.forEach(e=>{var s;t.add((s=e)instanceof d.FileSharedWithMe?s.file_id:s.fq_path)})});this.setState({selectedIds:t})}setupExternalDragHandler(){p.setupExternalDragHandler(b.SELECTABLE_TILE_GRID_KEY_SCOPE,()=>!!this.props.isDraggingInternalFiles,()=>!!this.props.isDraggingExternalFiles,this.props.onSetFileUploaderPath,".tile",()=>this.props.activeDropTarget,this.props.onSetDropTarget)}setupKeyboardShortcuts(){const{user:e,viewType:t,onDelete:s,onShowRename:i,deselectAll:r,getIsCurrentPathWriteable:a,getIsFileJumping:o,onAddFileJumpKeyCode:n,onResetFileJump:l,onCopyToClipboard:c,onCutToClipboard:d,onFocusSearchBar:u,onPasteFromClipboard:p,selectAll:_}=this.props,f=m.generateGetIsGlobalEvent(this),h=f;this.props.isPhotosPage||m.setupFileJumpKeyboardShortcuts({scope:b.SELECTABLE_TILE_GRID_KEY_SCOPE,getIsFileJumping:o,onAddFileJumpKeyCode:n,onResetFileJump:l}),m.setupFilesViewKeyboardShortcuts({user:e,viewType:t,getIsGlobalEvent:f,getIsItemEvent:h,getSelectedFiles:()=>this.props.selectedFiles,isCurrentPathWriteable:a,selectAllAction:_,deselectAllAction:r,onCopyToClipboard:c,onCutToClipboard:d,onDelete:s,onFocusSearchBar:u,onPasteFromClipboard:p,onShowRename:i,onNavigateToFileOrFolder:()=>{},onNavigateToParentFolder:()=>{},scope:b.SELECTABLE_TILE_GRID_KEY_SCOPE,onShowHelpMenu:this.props.onOpenKeyboardShortcutModal})}createDragEnterHandler(e,t,s){return i=>{this.props.onDragEnter(i,e,t,s)}}createDragStartHandler(e,t,s){const{preventSelectionOnDrag:i}=this.props;return r=>{t?this.props.onDragStart(r):(i||s(r),this.props.onDragStart(r,[e]))}}createDragEndHandler(){return e=>{this.props.onDragEnd(e)}}getCreateFolderTile(){const{createNewFolderState:e,onNewFolderCancel:t,onNewFolderSubmit:s}=this.props;let i=F.intl.formatMessage({id:"pxGZm3",defaultMessage:"New folder"}),r=a.default.createElement("div",null);return e===S.NewFolderCreationState.PENDING_INPUT?(i=F.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),r=a.default.createElement(g.TileLabelInput,{label:i,onCancel:t,onSubmit:s})):e===S.NewFolderCreationState.SAVING_INPUT&&(i=F.intl.formatMessage({id:"p58M12",defaultMessage:"Creating new folder…"}),r=a.default.createElement(T.TileItemLabelText,{className:"tile-label__text--saving",label:i})),{altText:i,id:"New folder tile",isDraggable:!1,isSelectable:!1,labelNode:r}}getScrollPane(){const{scrollContainer:e}=this.props;if(e&&e.current){const{clientHeight:t,scrollTop:s,scrollTo:i}=e.current;return{height:t,scrollTop:s,scrollTo:i?i.bind(e.current):()=>{}}}return{height:window.innerHeight,scrollTop:"scrollingElement"in window.document&&window.document.scrollingElement?window.document.scrollingElement.scrollTop:window.document.documentElement.scrollTop,scrollTo:window.scrollTo?window.scrollTo.bind(window):()=>{}}}getWindow(){const{scrollContainer:e}=this.props;return e&&e.current?E.createFakeWindow(e.current):window}render(){const{enableMaxHeightGrouping:e,sections:t,viewType:s,viewportTopOffset:r,scrollContainer:o,scrollPositionOffset:n,registerSelectableTile:l,isPhotosPage:c}=this.props,d=i.default({"file-tile-grid-container":!0,"file-tile-grid-container--show-checkboxes":this.state.inSelectMode,"file-tile-grid-container--click-to-select":!0}),p=new Set;return this.state.selectedIds.forEach(e=>p.add(e)),o&&!o.current?null:a.default.createElement("div",{role:"grid","aria-multiselectable":"true"},a.default.createElement(T.InfiniteTileGrid,{key:"tileGrid",ref:this.tileGridRef,totalNumItems:this.getTotalNumItems(),containerClass:d,rowClass:"file-tile-row",enableMaxHeightGrouping:e,delayRenderFullTile:!this.props.isCreateFolderUIActive,logTileLoading:!0,numThresholdRows:u.FilesViewTileGridConstants.NUM_THRESHOLD_ROWS,scrollDeltaThreshold:u.FilesViewTileGridConstants.SCROLL_DELTA_THRESHOLD,sectionStartIndices:t.sectionStartIndices,sectionLabels:t.sectionLabels,showLabels:!c,contentOffset:r,getTileItem:this.getTileItem,selectedIds:p,handleTTI:this.props.onTTI,onRangeInView:this.props.onRangeInView,tilesPerRow:this.props.tilesPerRow,onTilesPerRowChange:this.props.onTilesPerRowChange,activeDropTarget:this.props.activeDropTarget,maxTileWidth:u.ViewTypeGridSizes[s],tileHeight:u.ViewTypeGridSizes[s],shouldFileBeHighlightedDropTarget:this.shouldFileBeHighlightedDropTarget,scrollToIndex:this.props.focusedFileIndex,scrollIntoView:this.scrollIntoView,scrollPositionOffset:n||0,window:this.getWindow(),registerSelectableTile:l}))}}t.FilesViewTileGrid=y,y.defaultProps={enableMaxHeightGrouping:!1},y.displayName="FilesViewTileGrid"})),define("metaserver/static/js/modules/clean/react/files_view/rows/file_row",["require","exports","tslib","classnames","metaserver/static/js/modules/clean/react/files_view/file_actions/file_media_actions_v2","react","spectrum/media_table/index","metaserver/static/js/modules/clean/media_filters/gating","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/file_actions/file_media_actions","metaserver/static/js/modules/clean/react/files_view/file_name/file_name_cell","metaserver/static/js/modules/clean/react/files_view/rows/cells/file_row_checkbox","metaserver/static/js/modules/clean/react/files_view/rows/row","metaserver/static/js/modules/clean/react/files_view/thumbnail_media_cell","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/clean/react/files_view/rows/cells/modified_cell","metaserver/static/js/modules/clean/react/files_view/rows/cells/async_folder_size","metaserver/static/js/modules/clean/react/files_view/rows/cells/tags_cell","metaserver/static/js/modules/clean/tagging/experiments","metaserver/static/js/modules/clean/react/browse/data/helpers"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileRow=void 0,i=s.__importDefault(i),a=s.__importDefault(a),l=s.__importStar(l),S=s.__importStar(S),E=s.__importStar(E);const C=()=>a.default.createElement("span",{"aria-hidden":!0},"--");class O extends a.default.Component{constructor(){super(...arguments),this.state={isHoverLocked:!1,rowIsDragging:!1},this.handleOpenFileClick=e=>this.handleOpenNewTabOrNavigate(e,f.FilesViewActionSource.ROW_PREVIEW_ICON),this.handleTitleClick=e=>this.handleOpenNewTabOrNavigate(e,f.FilesViewActionSource.ROW_TITLE),this.handleOpenNewTabOrNavigate=(e,t)=>{if(0===e.button){const s=g.hasModifierKey(e);if(s&&"A"===e.currentTarget.tagName)return void e.stopPropagation();e.preventDefault(),e.stopPropagation(),this.onNavigateToItem({openInNewTab:s,actionSource:t})}},this.onSelect=(e,t)=>{this.props.onSelect&&this.props.onSelect(this.props.fileToId(this.props.file),e,t)},this.onDeselect=(e,t)=>{this.props.onDeselect&&this.props.onDeselect(this.props.fileToId(this.props.file),e,t)},this.onNavigateToItem=({openInNewTab:e,actionSource:t})=>{if(e){const{file:e,user:t,hrefForFile:s}=this.props;S.open_tab(s(t,e))}else this.props.onNavigateToFileOrFolder(this.props.file,{actionSource:t})},this.onDragEnter=e=>{const{file:t,isSelected:s,isActiveDropTarget:i}=this.props;this.props.onDragEnter(e,t,!!s,!!i)},this.onDragStart=e=>{this.setState({rowIsDragging:!0});const{file:t,isSelected:s,onDragStart:i}=this.props;i&&(s?i(e):i(e,[t]))},this.onDragEnd=e=>{this.setState({rowIsDragging:!1});const{onDragEnd:t}=this.props;t&&t(e)},this.onShowShare=()=>{this.props.onShowShare(this.props.file,"BROWSE_FILE_ROW")},this.onPresentInZoom=()=>{this.props.onPresentInZoom&&this.props.onPresentInZoom(this.props.file)},this.handleHoverLocked=({isOpen:e})=>{this.setState({isHoverLocked:e})},this.getAriaLabelForColumn=(e,t)=>{var s;switch(e.sortField){case h.SortField.FILENAME:return e.label+" "+l.filename(t.fq_path);case h.SortField.MODIFIED:return e.label+" "+t.ago;case h.SortField.CATEGORY:return e.label+" "+c.File.getCategoryDescription(t);case h.SortField.EXTENSION:return e.label+" "+c.File.getExtension(t);case h.SortField.SIZE:return e.label+" "+t.size;case h.SortField.TAGS:return e.label+" "+t.tags?null===(s=t.tags)||void 0===s?void 0:s.map(e=>e.value).join(", "):"";case h.SortField.SHARED_WITH:default:return}},this.renderMediaActions=(e,t)=>{const{instanceId:s,arePostTTIModulesLoaded:i,canDisplayFolderSizes:o,file:n,getOverflowMenuActions:l,isCompactMode:c,responsive:u,isSelectMode:p,isSelected:_,isSharingDisabled:m,renameState:f,shareButtonLabel:h,showShareButton:g,user:S,viewportTopOffset:E,isActionBarEnabled:v}=this.props,T=!u.isMatchedLarge&&!u.isMatchedMedium;return!(T&&(f||p))?v?e||T?a.default.createElement(r.FileMediaActionsV2,{instanceId:s,file:n,highlighted:_,onHoverLocked:this.handleHoverLocked,isMobile:T}):void 0:a.default.createElement(d.FileMediaActions,{arePostTTIModulesLoaded:i,canDisplayFolderSizes:o,file:n,getOverflowMenuActions:l,isCompactMode:!!c,isHovered:e,isSelectMode:!!p,isSharingDisabled:!!m,onOpenFileClick:this.handleOpenFileClick,onPresentInZoom:this.onPresentInZoom,onShowShare:this.onShowShare,shareButtonLabel:h,showShareButton:g,showBorders:t,user:S,viewportTopOffset:E}):void 0},this.handleRenderPrivacyColumnClientAccessCell=e=>this.props.renderPrivacyColumnClientAccessCell?this.props.renderPrivacyColumnClientAccessCell({file:e,user:this.props.user}):a.default.createElement(a.default.Fragment,null)}renderCell({isHovered:e,sortField:t,renderCell:s}){var i,r;const{instanceId:l,itemIndex:d,rowIndex:p,fileToId:_,visibleColumns:f,containerWidth:g,height:S,file:w,hrefForFile:O,isSearchMode:F,isSelectMode:R,onLocationLinkClick:A,onRenameCancel:y,onRenameSubmit:D,filteredContactName:M,showCDMUserEducationEffects:N,iconSize:L,isCondensedListView:P,columnSizes:j,renderSharedWithController:U,isSelected:x,expManualTagging:k,user:V,preventSelectionOnDrag:B,mediaFiltersVariant:W}=this.props;if(s)return s({file:w});const H=null==j?void 0:j[t];switch(t){case h.SortField.FILENAME:return a.default.createElement(m.ThumbnailMediaCell,{key:"fileName",file:w,height:S,width:H,showCDMUserEducationEffects:N,iconSize:L},a.default.createElement(u.FileNameCell,{instanceId:l,itemIndex:d,rowIndex:p,isHovered:e,fileToId:_,visibleColumns:f,containerWidth:g,onLocationLinkClick:A,onRenameCancel:y,onRenameSubmit:D,hrefForFile:O,onNameClick:this.handleTitleClick,onSelect:this.onSelect,onDragStart:this.onDragStart,draggable:!R,showTags:F&&I.isTaggingEnabled(k),mediaFiltersVariant:F?W:"OFF",preventSelectionOnDrag:B}));case h.SortField.RELEVANCE:case h.SortField.MODIFIED:return a.default.createElement(v.ModifiedCell,{key:"modified",file:w,filteredContactName:M,isSearchMode:Boolean(F),shouldBubbleSubtitle:P,width:H});case h.SortField.SHARED_WITH:case h.SortField.CATEGORY:case h.SortField.EXTENSION:case h.SortField.SIZE:case h.SortField.TAGS:case h.SortField.LOCKED_FILES:case h.SortField.CLIENT_ACCESS:{const e=void 0===H?{}:{width:H,minWidth:H,maxWidth:H},s={[h.SortField.SHARED_WITH]:U(w,x?0:void 0),[h.SortField.CATEGORY]:null,[h.SortField.EXTENSION]:null,[h.SortField.SIZE]:null,[h.SortField.LOCKED_FILES]:null,[h.SortField.TAGS]:a.default.createElement(b.TagsCell,{file:w,user:V}),[h.SortField.CLIENT_ACCESS]:this.handleRenderPrivacyColumnClientAccessCell(w)}[t],l={[h.SortField.SHARED_WITH]:void 0,[h.SortField.CATEGORY]:c.File.getCategoryDescription(w),[h.SortField.EXTENSION]:c.File.getExtension(w),[h.SortField.SIZE]:a.default.createElement(T.SizeCellTitle,{file:w}),[h.SortField.LOCKED_FILES]:void 0,[h.SortField.TAGS]:void 0,[h.SortField.CLIENT_ACCESS]:void 0}[t],d={[h.SortField.SHARED_WITH]:"sharedWith",[h.SortField.CATEGORY]:"category",[h.SortField.EXTENSION]:"extension",[h.SortField.SIZE]:"size",[h.SortField.LOCKED_FILES]:"locked_files",[h.SortField.TAGS]:"tags",[h.SortField.CLIENT_ACCESS]:"client_access"}[t],u={[h.SortField.SHARED_WITH]:"brws-file-shared-with-cell",[h.SortField.CATEGORY]:"brws-file-category-cell",[h.SortField.EXTENSION]:"brws-file-extension-cell",[h.SortField.SIZE]:"brws-file-size-cell",[h.SortField.LOCKED_FILES]:"brws-file-size-cell",[h.SortField.TAGS]:"brws-file-tags-cell",[h.SortField.CLIENT_ACCESS]:void 0}[t];let p=void 0;if(t===h.SortField.SIZE&&F&&n.isMediaFiltersEnabled(W)){const e=null===(i=w.media_data)||void 0===i?void 0:i.data.image_width,t=null===(r=w.media_data)||void 0===r?void 0:r.data.image_height;p=e&&t?`${e}x${t} px`:"​"}return a.default.createElement(o.MediaCell,{className:u,subtitle:p,title:l,style:e,key:d},s)}default:return E.reportException({err:new Error("renderCell function for "+t+"is not implemented"),severity:E.SEVERITY.NONCRITICAL,tags:["js:browse"]}),a.default.createElement(C,null)}}render(){const{file:e,fileToId:t,instanceId:s,isActiveDropTarget:r,isSearchMode:n,isSelectMode:l,isSelected:d,itemIndex:u,onDeselect:m,onSelect:f,renameState:h,rowIndex:g,topOffset:S,visibleColumns:E,isCutToClipboard:v,isFocused:T,isRightClickEnabled:b}=this.props,{isHoverLocked:I}=this.state;let C="";E.forEach(t=>{const s=this.getAriaLabelForColumn(t,e);s&&(C+=s+", ")});const O=this.state.rowIsDragging&&!d,F=i.default({"brws-file-row":!0,"brws-file-row-no-access":c.File.isNoAccessSharedFolder(e)||O,"brws-file-row-hover-forced":I,"brws-file-row-cut":v,"brws-file-row-dragging":O}),R=!(h||n||c.File.isTeamMemberFolder(e)||c.File.isReadOnlySharedFolder(e)||c.File.isNoAccessSharedFolder(e)||w.isBackupFolder(e)||!d);return a.default.createElement(_.FilesViewRow,{className:F,isActiveDropTarget:r,isSelected:d,isDeleted:e.isDeleted,isDraggable:R,topOffset:S,rowIndex:g,isSelectMode:l,filename:String(e.fq_path.split("/").slice(-1)),ariaLabel:C,onSelect:this.onSelect,onDeselect:this.onDeselect,onNavigateToItem:this.onNavigateToItem,onDragEnter:this.onDragEnter,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,isRightClickEnabled:b},({isHovered:e,isKeyboardFocused:i})=>(e=e||I,a.default.createElement(a.default.Fragment,null,a.default.createElement(o.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},a.default.createElement(p.FileRowCheckbox,{instanceId:s,itemIndex:u,rowIndex:g,isHovered:e,isFocused:!!T,fileToId:t,onSelect:f,onDeselect:m})),E.map((t,s)=>this.renderCell({isHovered:e&&!O,sortField:t.sortField,renderCell:t.renderCell})),this.renderMediaActions(e,i))))}}t.FileRow=O,O.defaultProps={topOffset:0,controlsFocusable:!1,fileToId:e=>e.fq_path},O.displayName="FileRow"})),define("metaserver/static/js/modules/clean/react/files_view/rows/cells/modified_cell",["require","exports","tslib","react","dig-components/tooltips","spectrum/media_table/index","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModifiedCell=void 0,i=s.__importDefault(i),t.ModifiedCell=({file:e,mediaActions:t,filteredContactName:s,isSearchMode:n,shouldBubbleSubtitle:l,width:c})=>{const d=s&&e.agoFromLastActionByUserTs,u=e.is_dir&&!n?void 0:d?e.agoFromLastActionByUserTs:e.ago,p=d?s:e.last_modified_name||void 0,_=p?o.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:p}):e.is_dir?void 0:o.intl.formatMessage({id:"5794tP",defaultMessage:"by you"}),m=u||i.default.createElement("span",{"aria-hidden":!0},"--"),f=void 0===c?{}:{width:c,minWidth:c,maxWidth:c},h=l&&_?i.default.createElement(r.Tooltip,{title:_},i.default.createElement("span",null,m)):m;return i.default.createElement(a.MediaCell,{className:"brws-file-modified-at-cell",subtitle:l?void 0:_,title:h,style:f},t)},t.ModifiedCell.displayName="ModifiedCell",t.ModifiedCell.displayName="ModifiedCell"})),define("metaserver/static/js/modules/clean/react/files_view/rows/cells/async_folder_size",["require","exports","tslib","react","metaserver/static/js/modules/clean/cloud_docs/constants","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/filepath/filepath"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SizeCellTitle=t.isCloudDocProviderStored=void 0,i=s.__importDefault(i),o=s.__importStar(o);const n=()=>i.default.createElement("span",{"aria-hidden":!0},"--");function l(e){switch(a.isFile(e)?o.split_filename(e.fq_path).ext:e.ext.slice(1)){case r.PaperFileTypes.PAPER:case r.PaperFileTypes.PAPER_TEMPLATE:return!0;default:return!1}}t.isCloudDocProviderStored=l;const c=i.default.lazy(()=>s.__awaiter(void 0,void 0,void 0,(function*(){return{default:(yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/files_view/rows/cells/folder_size"],t,s)}).then(s.__importStar)).FolderSizeCell}})));t.SizeCellTitle=e=>{const{file:t}=e;return t.is_dir?i.default.createElement(i.default.Suspense,{fallback:i.default.createElement(n,null)},i.default.createElement(c,{file:t},i.default.createElement(n,null))):t.is_cloud_doc&&l(t)?i.default.createElement(n,null):i.default.createElement("span",null,t.size)}})),define("metaserver/static/js/modules/clean/react/files_view/rows/cells/tags_cell",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/tagging/logger","metaserver/static/js/modules/clean/tagging/utils","metaserver/static/js/modules/clean/tagging/components/tags_container","metaserver/static/js/modules/clean/tagging/utils"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagsCell=void 0,i=s.__importDefault(i),a=s.__importStar(a),o=s.__importStar(o),t.TagsCell=e=>{const{file:t,user:s}=e,c=t.tags&&t.tags.map(e=>e.value.tag_text)||[];if(0===c.length)return null;return i.default.createElement(n.TagsContainer,{tags:l.textTagsToUserGeneratedTags(c),onTagClick:(e,i)=>{r.isFile(t)&&(i&&(i.preventDefault(),i.stopPropagation()),a.logTagClick(s,[t],"browse_tag_col",e),o.redirectToSearchByTag(s,e.tag_text))},containerClassName:"brws-col-tags-container",chipClassName:"brws-tag-chip",chipSize:"xsmall",showMoreClassName:"brws-tag-chip",expandable:!1})}})),define("metaserver/static/js/modules/clean/react/files_view/rows/cells/file_row_checkbox",["require","exports","tslib","react","classnames","react-redux","dig-components/controls","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/item_selectors","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/selectable_list","metaserver/static/js/modules/clean/user_education/react/user_education_effect","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileRowCheckbox=t.FileRowCheckboxComponent=void 0,i=s.__importDefault(i),r=s.__importDefault(r);t.FileRowCheckboxComponent=({isSelected:e,isDisabled:t,shouldShowUserEducationEffects:s,isCheckboxVisible:a,onSelect:n,onDeselect:l,selectionId:_,isFocused:m})=>{const f={selectItem:p.intl.formatMessage({id:"MkD8+F",defaultMessage:"Select item"})},h=i.default.useRef(null),g=()=>{var e,t;null===(t=null===(e=h.current)||void 0===e?void 0:e.querySelector("input"))||void 0===t||t.focus()};i.default.useEffect(()=>{m&&g()},[m]),i.default.useEffect(()=>{e&&m&&g()},[e,m]);const S=s=>{n&&l&&!t&&(s.stopPropagation(),e?l(_,s.shiftKey,c.FilesViewActionSource.SINGLE_CHECKBOX):n(_,s.shiftKey?d.SelectOptions.EXTEND:d.SelectOptions.DEFAULT,c.FilesViewActionSource.SINGLE_CHECKBOX))};let E=null;return a&&(E=i.default.createElement(o.Checkbox,{disabled:t,checked:e,onClick:S,"aria-label":f.selectItem,tabIndex:e?0:-1,readOnly:!0})),s&&(E=i.default.createElement(u.UserEducationEffect,{containerName:"FileItemRow",name:"FirstFileSelectCheckbox",useSpan:!0},E||i.default.createElement("div",{style:{width:20,height:20}}))),i.default.createElement("div",{className:r.default("brws-vertically-center","brws-file-row-checkbox-target",{"brws-file-row-checkbox-background":a}),onClick:S,ref:h},E)},t.FileRowCheckboxComponent.displayName="FileRowCheckboxComponent",t.FileRowCheckboxComponent.displayName="FileRowCheckboxComponent";t.FileRowCheckbox=a.connect((e,t)=>({isCheckboxDisabled:n.selectDisabledMultiselect(e,t),isCheckboxVisible:l.selectIsCheckboxVisible(e,t),isSelected:l.selectIsItemSelected(e,t),shouldShowUserEducationEffects:l.selectShouldShowUserEducationEffects(e,t),isDisabled:n.selectDisabledMultiselect(e,t),selectionId:l.selectItemSelectionId(e,t)}))(t.FileRowCheckboxComponent)})),define("metaserver/static/js/modules/clean/react/files_view/rows/file_shared_with_me_row",["require","exports","tslib","classnames","react","react-dom","dig-components/controls","spectrum/media_table/index","spectrum/util/raf_throttle","metaserver/static/js/modules/clean/react/files_view/file_name/file_name_cell","metaserver/static/js/modules/clean/react/files_view/rows/cells/async_folder_size","metaserver/static/js/modules/clean/react/files_view/rows/row","metaserver/static/js/modules/clean/react/files_view/thumbnail_media_cell","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/selectable_list","metaserver/static/js/modules/clean/user_education/react/user_education_effect","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSharedWithMeRow=void 0,i=s.__importDefault(i),r=s.__importDefault(r),a=s.__importStar(a),S=s.__importStar(S),E=s.__importStar(E);const T=()=>r.default.createElement("span",{"aria-hidden":!0},"--"),b=e=>void 0===e?{}:{width:e,minWidth:e,maxWidth:e},I=({file:e})=>e.is_cloud_doc&&d.isCloudDocProviderStored(e)?r.default.createElement(T,null):r.default.createElement("span",null,e.size);class w extends r.default.PureComponent{constructor(e){super(e),this.setRef=e=>{this.brwsFilenameContainerDiv=e},this.checkboxRef=null,this.handleWindowResize=()=>{this.throttledWindowResize.request()},this.handleResize=()=>{if(this.brwsFilenameContainerDiv){const{brwsFilenameContainerDivWidth:e}=this.state,t=this.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&this.setState({brwsFilenameContainerDivWidth:t})}},this.handleTitleClick=e=>this.handleOpenNewTabOrNavigate(e,_.FilesViewActionSource.ROW_TITLE),this.handleOpenNewTabOrNavigate=(e,t)=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),this.onNavigateToItem({openInNewTab:f.hasModifierKey(e),actionSource:t}))},this.onSelect=(e,t)=>{this.props.onSelect&&this.props.onSelect(this.props.file.file_id,e,t)},this.onDeselect=(e,t)=>{this.props.onDeselect&&this.props.onDeselect(this.props.file.file_id,e,t)},this.onNavigateToItem=({openInNewTab:e,actionSource:t})=>{e?S.open_tab(this.props.file.href):this.props.onOpenFileSharedWithMe(this.props.file,{actionSource:t})},this.getCheckboxNode=()=>this.checkboxRef&&a.findDOMNode(this.checkboxRef),this.isCheckboxNode=e=>{const t=this.getCheckboxNode();return!!t&&t.contains(e)},this.handleCheckboxChange=e=>{},this.handleCheckboxClick=e=>{e.stopPropagation();const{onSelect:t,onDeselect:s,file:i}=this.props;t&&s&&(e.currentTarget.checked?t(i.file_id,e.shiftKey?h.SelectOptions.EXTEND:h.SelectOptions.DEFAULT,_.FilesViewActionSource.SINGLE_CHECKBOX):s(i.file_id,e.shiftKey,_.FilesViewActionSource.SINGLE_CHECKBOX))},this.setCheckboxRef=e=>{this.checkboxRef=e},this.handleCheckboxTouchTargetClick=e=>{if(this.shouldHandleClick(e)){if(!this.props.isCheckboxDisabled&&this.props.onDeselect&&this.props.onSelect){e.preventDefault();const t=this.props.file.file_id;this.props.isSelected?this.props.onDeselect(t,e.shiftKey,_.FilesViewActionSource.SINGLE_CHECKBOX):this.props.onSelect(t,e.shiftKey?h.SelectOptions.EXTEND:h.SelectOptions.DEFAULT,_.FilesViewActionSource.SINGLE_CHECKBOX)}}else e.preventDefault()},this.renderCheckbox=e=>{const{isCompactMode:t,isSelectMode:s,isSelected:a,showUserEducationEffects:n}=this.props;let l=null;return l=!(e||a||s||t)?null:r.default.createElement(o.Checkbox,{disabled:this.props.isCheckboxDisabled,checked:!!a,className:i.default("brws-checkbox",{"brws-checkbox-checked":a}),onChange:this.handleCheckboxChange,onClick:this.handleCheckboxClick,ref:this.setCheckboxRef,"aria-label":v.intl.formatMessage({id:"sJRsRx",defaultMessage:"Select item"}),tabIndex:a?0:-1}),n&&(l=r.default.createElement(g.UserEducationEffect,{containerName:"FileSharedWithMeRow",name:"FirstFileSelectCheckbox",useSpan:!0},l||r.default.createElement("div",{style:{width:20,height:20}}))),l},this.state={brwsFilenameContainerDivWidth:void 0},this.throttledWindowResize=new l.RafThrottle(()=>this.handleResize())}componentDidMount(){this.handleResize(),window.addEventListener("resize",this.handleWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize)}componentDidUpdate(e){(this.props.isFocused&&!e.isFocused||this.props.isFocused&&this.props.isSelected&&!e.isSelected)&&this.checkboxRef&&Promise.resolve().then(()=>{const e=this.getCheckboxNode();e&&e.focus()})}renderModifiedCell(e,t,s,i){const a=s&&e.agoFromLastActionByUserTs,o=a?e.agoFromLastActionByUserTs:e.ago,l=a?s:e.last_modified_name||void 0,c=l?v.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:l}):v.intl.formatMessage({id:"5794tP",defaultMessage:"by you"});return r.default.createElement(n.MediaCell,{className:"brws-file-modified-at-cell",key:"modifiedAt",subtitle:c,title:o||r.default.createElement(T,null),style:b(i)},t)}renderCell({isHovered:e,isKeyboardFocused:t,sortField:s,isLastCell:a}){const{arePostTTIModulesLoaded:o,file:l,isSelectMode:d,isSelected:u,responsive:_,user:f,showSnippets:h,snippetRows:g,height:S,filteredContactName:v,iconSize:w,columnSizes:C}=this.props,O=null==C?void 0:C[s];switch(s){case m.SortField.FILENAME:const t={file:l,isHovered:e,isSelectMode:!!d,isSelected:!!u,isMobileMode:!_.isMatchedLarge&&!_.isMatchedMedium,user:f,mediaActions:void 0,flowsBadge:void 0,shouldTruncateMiddleFilename:o,showHighlights:!0,showLocation:!0,showStar:!1,showSnippets:!!h,snippetRows:g,onNameClick:this.handleTitleClick,renameState:void 0,renderFilenameSubtitleAsLink:!1,showUserEducationEffects:!1,userEducationEffectName:"",isTooltipEnabled:!1,showFirstTaskSubtitle:!1,shouldShowSubtitle:!0,draggable:!1,expFlowsAutomatedFolderUI:!1,backupNewLocationHintEnabled:!1,isInsideBackupFolder:!1,ggToCdmMigrationVariant:"OFF",renameInput:void 0,isRenameBarDisabled:void 0},{brwsFilenameContainerDivWidth:a}=this.state;return r.default.createElement("div",{className:i.default("brws-file-name-container",{"brws-file-name-container-resizing-enabled":void 0!==O}),ref:this.setRef},r.default.createElement(p.ThumbnailMediaCell,{file:l,height:S,iconSize:w,width:O},r.default.createElement(c.FileNameCellComponent,Object.assign({},t,{fileNameCellWidth:a?a-64:void 0}))));case m.SortField.RELEVANCE:case m.SortField.MODIFIED:return this.renderModifiedCell(l,void 0,v,O);case m.SortField.SIZE:return r.default.createElement(n.MediaCell,{className:"brws-file-size-cell",key:"size",title:r.default.createElement(I,{file:l}),style:b(O)},void 0);default:case m.SortField.CATEGORY:case m.SortField.EXTENSION:case m.SortField.SHARED_WITH:case m.SortField.TAGS:return E.reportException({err:new Error("FileSharedWithMe.renderCell is not implemented for "+s),severity:E.SEVERITY.NONCRITICAL,tags:["js:search"]}),r.default.createElement(n.MediaCell,{key:s,title:r.default.createElement(T,null),style:b(O)})}}shouldHandleClick(e){return!e.defaultPrevented&&!this.isCheckboxNode(e.target)}render(){const{rowIndex:e,topOffset:t,isSelected:s,isSelectMode:i,visibleColumns:a}=this.props;return r.default.createElement(u.FilesViewRow,{className:"brws-filesharedwithme-row",isSelected:s,topOffset:t,rowIndex:e,isSelectMode:i,onSelect:this.onSelect,onDeselect:this.onDeselect,onNavigateToItem:this.onNavigateToItem},({isHovered:e,isKeyboardFocused:t})=>[r.default.createElement(n.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"},r.default.createElement("div",{className:"brws-vertically-center brws-file-row-checkbox-target",onClick:this.handleCheckboxTouchTargetClick},this.renderCheckbox(e))),...a.map((s,i)=>this.renderCell({isHovered:e,isKeyboardFocused:t,sortField:s.sortField,isLastCell:i===a.length-1}))])}}t.FileSharedWithMeRow=w,w.displayName="FileSharedWithMeRow"})),define("metaserver/static/js/modules/clean/react/files_view/file_snippets",["require","exports","tslib","react","metaserver/static/js/modules/clean/filename_highlights","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/data/selectors/list_selectors"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSnippet=t.FileSnippets=void 0,i=s.__importDefault(i),r=s.__importStar(r);class n extends i.default.PureComponent{render(){const{snippets:e,lineClamp:s}=this.props,r={maxHeight:a.SNIPPET_HEIGHT_PER_ROW*s,WebkitLineClamp:s},n=o.getFirstValidSnippet(e);return n?i.default.createElement("span",{className:"brws-file-snippets",style:r},i.default.createElement(t.FileSnippet,{snippet:n})):null}}t.FileSnippets=n,n.defaultProps={lineClamp:3},n.displayName="FileSnippets",t.FileSnippet=({snippet:e})=>r.highlightReactFromAllHighlightSpans(e.highlight_spans||[]),t.FileSnippet.displayName="FileSnippet"})),define("metaserver/static/js/modules/clean/react/files_view/files_view",["require","exports","tslib","classnames","lodash","immutable","react","react-dom","react-redux","spectrum/media_table_skeleton/index","spectrum/table/index","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/column_manager","metaserver/static/js/modules/clean/react/files_view/constants","metaserver/static/js/modules/clean/react/files_view/data/action_creators","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/column_headers/dig_column_header","metaserver/static/js/modules/clean/react/files_view/drag_drop/drag_and_drop","metaserver/static/js/modules/clean/react/files_view/file_list_empty_folder_table","metaserver/static/js/modules/clean/react/files_view/files_view_logging","metaserver/static/js/modules/clean/react/files_view/list","metaserver/static/js/modules/clean/react/files_view/scroll_updater","metaserver/static/js/modules/clean/react/files_view/tile_grid","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/selectable_list","metaserver/static/js/modules/clean/sharing/access_level","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/browser_detection","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/core/notify","metaserver/static/js/modules/clean/react/files_view/drag_drop/drag_to_select","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors","metaserver/static/js/modules/clean/react/files_view/unity_listener","metaserver/static/js/modules/clean/react/async/loadable","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/browse/data/helpers"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v,T,b,I,w,C,O,F,R,A,y,D,M,N,L,P,j,U){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesView=t.FilesViewComponent=t.getShouldShowSelectAllCheckbox=void 0,i=s.__importDefault(i),r=s.__importStar(r),a=s.__importStar(a),o=s.__importDefault(o),n=s.__importStar(n),j=s.__importStar(j);const x=P.Loadable({loader:()=>new Promise((t,s)=>{e(["typescript/component_libraries/files_components/src/file-drag/index"],t,s)}).then(s.__importStar).then(({InternalFileDrag:e})=>e)}),k=[F.NameSpaceAccess.ACCESS_NO_ACCESS,F.NameSpaceAccess.ACCESS_READER,F.NameSpaceAccess.ACCESS_READER_NO_COMMENT],V={keyboard:w.FilesViewActionSource.KEYBOARD,drag_to_select:w.FilesViewActionSource.DRAG_TO_SELECT},B=[];function W(e){return e.some(H)}function H(e){return e instanceof p.File||e instanceof p.FileSharedWithMe}t.getShouldShowSelectAllCheckbox=W;class G extends o.default.Component{constructor(){super(...arguments),this.internalDragStatusRef=o.default.createRef(),this.state={dropTarget:null,tilesPerRow:1,draggedFiles:null},this.handleCopyToClipboard=()=>{const{selectedFiles:e,onSetClipboard:t}=this.props;e.size&&t({files:e.toArray(),action:"copy"})},this.handleCutToClipboard=()=>{const{selectedFiles:e,onSetClipboard:t}=this.props,s=e.filter(e=>!e.read_only);s.size&&t({files:s.toArray(),action:"cut"})},this.handleNewFolderSubmit=e=>{""===e?(this.props.onNewFolderCancel(),this.handleNewFolderCancel({source:w.NameInputActionSource.SUBMIT})):this.props.onNewFolderSubmit(e)},this.handleNewFolderCancel=({source:e})=>{e!==w.NameInputActionSource.ESC&&D.Notify.error(y.intl.formatMessage({id:"9xXIAi",defaultMessage:"Please provide a name for the new folder."})),this.props.onNewFolderCancel()},this.handleSetFileUploaderPath=e=>{const t=e?e.path:this.props.path;let s=this.props.context.isCurrentPathWriteable();e&&e.hasOwnProperty("hasPermissionToUploadToFolder")&&(s=!!e.hasPermissionToUploadToFolder);const i=!!(null==e?void 0:e.isMovingIntoVault);this.props.setFileUploaderPath({path:t,hasPermissionToUploadToFolder:s,isMovingIntoVault:i,targetSurface:"files_view"})},this.handleDragStart=(e,t=[])=>{var s;const{path:i,selectedFiles:a,user:o,preventSelectionOnDrag:l}=this.props;let c=r.keyBy(t,"fq_path");0!==t.length&&l||(c=Object.assign(Object.assign({},c),a.toJS()));const d=r.values(c),{isInsideBackupFolder:u}=this.props;if(u)return void D.Notify.error(y.intl.formatMessage({id:"+HTDO0",defaultMessage:"Backup contents can’t be moved."}));if(null==d?void 0:d.some(e=>U.isBackupFolder(e)))return void D.Notify.error(y.intl.formatMessage({id:"isN1D3",defaultMessage:"Backups can’t be moved."}));if(d.some(e=>p.File.isTeamSharedFolder(e)))return void D.Notify.error(y.intl.formatMessage({id:"1cIg3V",defaultMessage:"Team folders can’t be moved."}));if(d.some(e=>p.File.isTeamMemberFolder(e)))return void D.Notify.error(y.intl.formatMessage({id:"ZxTpZJ",defaultMessage:"Your member folder can’t be moved."}));const _=e.dataTransfer;if(!_)return;if(this.setState({draggedFiles:d}),_.setDragImage&&(null===(s=this.internalDragStatusRef)||void 0===s?void 0:s.current)){const e=n.findDOMNode(this.internalDragStatusRef.current);e&&_.setDragImage(e,-10,-10)}const m={userId:o.id,fromPath:i,fileInfos:d.map(e=>({target_ns:e.target_ns,file_id:e.file_id,is_dir:e.is_dir,fq_path:e.fq_path}))};_.setData(A.INTERNAL_FILE_DATA_TRANSFER_TYPE,JSON.stringify(m)),_.effectAllowed="copyMove",this.props.onDragStart&&this.props.onDragStart(e,d)},this.handleDragEnter=(e,t,s,i)=>{const{draggedFiles:r}=this.state;r&&U.isBackupFolder(t)&&D.Notify.error(y.intl.formatMessage({id:"rRI7QJ",defaultMessage:"Files can’t be moved into backups."}));const a=null==r?void 0:r.some(e=>e.fq_path===t.fq_path);S.onFileDragEnterItem(t,!!this.props.isDraggingExternalFiles,!!this.props.isDraggingInternalFiles,!!a,i,this.props.context,this.handleSetDropTarget,this.handleSetFileUploaderPath)},this.handleDragEnd=e=>{this.setState({draggedFiles:null}),this.props.onDragEnd&&this.props.onDragEnd(e)},this.handleSetDropTarget=e=>{this.setState({dropTarget:e}),this.props.updateDropTarget&&this.props.updateDropTarget(e)},this.handleSelectionChange=(e,t)=>{const s=t?t in O.SelectableListActionSource?V[t]:t:void 0;this.props.onSelectionChange(e,s)},this.onAllCheckboxDeselectAll=()=>{const{selection:e,onSelectionChange:t}=this.props;t(e.set("selected",a.OrderedSet()),w.FilesViewActionSource.ALL_CHECKBOX)},this.onAllCheckboxSelectAll=()=>{const{items:e,selection:t,onSelectionChange:s}=this.props;s(t.set("selected",a.OrderedSet(e.filter(H).map(e=>"fq_path"in e?this.props.fileToId(e):e.file_id))),w.FilesViewActionSource.ALL_CHECKBOX)},this._handleGetOverflowMenuActions=(e,t)=>{const{getOverflowMenuActions:s,responsive:i}=this.props;return s(e,t,i)},this.handleTTI=()=>{this.props.onComponentTTI("FilesViewController")},this.getIsCurrentPathWriteable=()=>this.props.context.isCurrentPathWriteable(),this.onTilesPerRowChange=e=>{this.setState({tilesPerRow:e})},this.onDeselectAll=()=>{this.props.isSearchMode&&this.props.onFocusSearchBar()},this.logRightClick=e=>{const{selectedFiles:t,user:s,viewType:i}=this.props,r=t?t.count(e=>e.is_dir):0,a=t?t.count()-r:0;u.logRightClickItems({uid:s.id,viewType:i,action_surface:R.ActionSurfaceLogValue.CENTER_PANE,numFilesSelected:a,numFoldersSelected:r})},this.InternalFileDragHelper=()=>{const e=this.state.draggedFiles||B,t=e.length;let s="",i=!1,r="";return t>0&&(s=j.filename(e[0].fq_path),i=e[0].is_dir,r=e[0].icon),o.default.createElement(x,{ref:this.internalDragStatusRef,numberOfFiles:t,firstFileName:s,isFolder:i,icon:r})}}shouldComponentUpdate(e){return e.loadingState!==this.props.loadingState||e.loadingState!==w.LoadingState.LOADING_FIRST_PAGE||(i=e.context,r=this.props.context,!!(i&&r&&i.currentFQPath!==r.currentFQPath||(t=e.items,s=this.props.items,t!==s)));var t,s,i,r}renderEmptyFolderView(){const{context:e,customEmptyFolderView:t,onFocusSearchBar:s,onPasteFromClipboard:i,onNavigateToParentFolder:r,isDraggingExternalFiles:a,isColumnResizingEnabled:n,scrollContainerWidth:l,isInsideBackupFolder:c}=this.props;if(t){const e=t({isDraggingExternalFiles:!!a,handleTTI:this.handleTTI,isColumnResizingEnabled:n,width:l});if(e)return e}const{isInsideSharedFolder:d,currentSharedFolderPermissionRole:u}=e,p=d&&k.includes(u)?void 0:c?y.intl.formatMessage({id:"qgGik0",defaultMessage:"Files added to your device will appear here"}):y.intl.formatMessage({id:"jXqkXG",defaultMessage:"Drag and drop files onto this window to upload."});return o.default.createElement(E.EmptyFolderTable,{title:y.intl.formatMessage({id:"YLBqRL",defaultMessage:"This folder is empty"}),subtitle:p,onTTI:this.handleTTI,onFocusSearchBar:s,onPasteFromClipboard:i,onNavigateToParentFolder:r,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal})}getSelectAllCheckboxCheckedVariant(){const{selectedFiles:e,items:t}=this.props;let s="unchecked";return e.size===t.filter(H).size?s="checked":e.size&&(s="mixed"),s}isCreateFolderUIActive(){const{createNewFolderState:e}=this.props;return e&&"CREATE_FOLDER_INACTIVE"!==e}shouldShowEmptyFolderView(){return this.props.loadingState===w.LoadingState.LOADED&&!this.props.items.size&&!this.isCreateFolderUIActive()}render(){const{id:e,onDelete:t,onShowRename:s,onRenameSubmit:r,onRenameCancel:a,onSwitchViewType:n,onPasteFromClipboard:l,onColumnsChanged:u,onCanDisplayFolderSizesChanged:p,onFocusSearchBar:f,currentSort:h,createNewFolderState:S,context:E,columns:F,dropTargetHighlightMode:A,fileRename:y,getIsFileJumping:D,onAddFileJumpKeyCode:N,onResetFileJump:P,hideViewFileButton:j,items:U,itemIds:x,isCompactMode:k,isSearchMode:V,isDraggingExternalFiles:B,isDraggingInternalFiles:H,isQueryingFolderSizes:G,isFileViewerShown:q,loadingState:z,onSortChange:K,path:Y,responsive:J,selectedFiles:Q,selection:X,renderSharedWithController:Z,onShowShare:$,onPresentInZoom:ee,totalNumFiles:te,user:se,viewType:ie,viewTypeColumns:re,onLocationLinkClick:ae,onNavigateToFileOrFolder:oe,onNavigateToParentFolder:ne,onOpenFileSharedWithMe:le,onOpenPaper:ce,arePostTTIModulesLoaded:de,scrollContainer:ue,sharingServiceInfo:pe,stickyOffsetTop:_e,disabledMultiselect:me,isStickyColumnHeader:fe,onRangeInView:he,highDensity:ge,filteredContactName:Se,sections:Ee,preferredColumns:ve,isDragToSelectEnabled:Te,cutItems:be,numVisibleColumns:Ie,isListView:we,isActive:Ce,enableUnity:Oe,inlineActionBar:Fe,scrollContainerWidth:Re,columnResizeStorageSetting:Ae,isColumnResizingEnabled:ye,expManualTagging:De,useSkinnyCheckboxes:Me,mediaFiltersVariant:Ne,isRightClickEnabled:Le,isBusinessSpaceFound:Pe}=this.props,{isMatchedLarge:je,isMatchedMedium:Ue}=J,{dropTarget:xe,tilesPerRow:ke}=this.state;if(z===w.LoadingState.LOADING_FIRST_PAGE)return de?o.default.createElement(c.MediaTableSkeleton,{numRows:15}):null;const Ve=!!Q.size,Be=!!ye;if(this.shouldShowEmptyFolderView())return o.default.createElement("div",{className:"brws-files-view"},this.renderEmptyFolderView(),Oe&&o.default.createElement(L.UnityListener,{items:this.props.unityItems,userId:se.id}));const We=je?m.DEFAULT_COLUMN_HEADER_HEIGHT:m.COMPACT_COLUMN_HEADER_HEIGHT,He=We+_e,Ge=this.props.scrollPositionOffset||0;return o.default.createElement("div",{className:i.default("brws-files-view",`brws-files-view--${ie.toLowerCase()}`,{"brws-files-view-condensed-list":ie===C.ViewType.CondensedList}),onContextMenu:this.logRightClick},o.default.createElement(_.ColumnManager,{columns:F,viewTypeColumns:re,currentSort:h,onCanDisplayFolderSizesChanged:p,onColumnsChanged:u,isMatchedLarge:je,isMatchedMedium:Ue,isSearchMode:V,viewType:ie,responsiveContainer:V,preferredColumns:ve,isMoreColumnsEnabled:Be,numVisibleColumns:Ie,scrollContainerWidth:Re,columnResizeStorageSetting:Ae,isBusinessSpaceFound:Pe},({visibleColumns:c,handleSelection:u,canDisplayFolderSizes:p,containerWidth:_,handleReorder:b})=>{const w=(V?m.LIST_VIEW_SEARCH_MODE_COLUMN_FLEX:m.LIST_VIEW_COLUMN_FLEX)[c.length];Me&&w&&(w[0]=m.CHECKBOX_CELL_FLEX_RIGHT_RAIL);const C={columnFlex:w,currentSort:h,isCompactMode:k,isSelectMode:Ve,onDeselectAll:this.onAllCheckboxDeselectAll,onSelectAll:this.onAllCheckboxSelectAll,onSelection:(e,t,s)=>{var i,r;e.popoverTriggerLabel!==t.popoverTriggerLabel&&v.logEvent({user:se,action:R.WebUserActionLogEvent.SWITCH_COLUMN_TYPE,extra:{column_position:(s+1).toString(),selected_column_header:null!==(i=e.loggingLabel)&&void 0!==i?i:e.popoverTriggerLabel,open_from_column_header:null!==(r=e.loggingLabel)&&void 0!==r?r:t.popoverTriggerLabel,action_type:c.includes(e)?"deselected":"selected"}}),u(e,t)},onSort:K,onMenuOpen:(e,t)=>{v.logEvent({user:se,action:R.WebUserActionLogEvent.SELECT_COLUMN_MENU,extra:{column_position:(e+1).toString(),column_header:t}})},onReorder:b,onSwitchViewType:n,selectAllCheckboxState:this.getSelectAllCheckboxCheckedVariant(),showSelectAllCheckbox:W(this.props.items),stickyOffsetHeight:We,stickyOffsetTop:_e,columns:F,visibleColumns:c,viewType:ie,isSearchMode:V,presentationOnly:we,isMoreColumnsEnabled:we&&Be,items:U};return we?o.default.createElement(O.SelectableList,{itemIds:x,keyScope:O.SELECTABLE_LIST_KEY_SCOPE,onSelectionChange:this.handleSelectionChange,selection:X,tilesPerRow:ke,onDeselectAll:this.onDeselectAll,isActive:Ce},({focusedFileId:n,handleDeselect:u,handleFocusFile:m,handleSelect:h,isSelectableListEvent:v,updateSelection:b})=>o.default.createElement(M.DragToSelectController,{handleSelect:h,handleDeselect:u,updateSelection:b,selection:X,isDragToSelectEnabled:Te},({registerSelectableItem:b})=>o.default.createElement(d.Table,{"aria-rowcount":te,className:i.default("brws-files-view-list",{"brws-files-view-list-high-density":ge}),columnFlex:w},o.default.createElement(g.ColumnHeader,Object.assign({},C,{variant:ue?"sticky-native":fe?"sticky":"fixed"})),o.default.createElement(T.FilesViewList,{onTTI:this.handleTTI,registerListItem:b,instanceId:e,onDelete:t,onShowRename:s,activeDropTarget:xe,context:E,createNewFolderState:S,dropTargetHighlightMode:A,fileRename:y,focusedFileIndex:n?x.indexOf(n):void 0,getOverflowMenuActions:this._handleGetOverflowMenuActions,getIsCurrentPathWriteable:this.getIsCurrentPathWriteable,getIsFileJumping:D,onAddFileJumpKeyCode:N,onResetFileJump:P,isCompactMode:k,hideViewFileButton:!!j,isDraggingExternalFiles:B,isDraggingInternalFiles:H,isFileViewerShown:q,isSearchMode:V,isSelectMode:Ve,isSelectableListEvent:v,arePostTTIModulesLoaded:de,keyScope:O.SELECTABLE_LIST_KEY_SCOPE,onCopyToClipboard:this.handleCopyToClipboard,onCutToClipboard:this.handleCutToClipboard,onDragStart:this.handleDragStart,onDragEnter:this.handleDragEnter,onDragEnd:this.handleDragEnd,onDeselectFile:u,onFocusFile:m,onFocusSearchBar:f,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal,onLocationLinkClick:ae,onNavigateToFileOrFolder:oe,onNavigateToParentFolder:ne,onNewFolderCancel:this.handleNewFolderCancel,onNewFolderSubmit:this.handleNewFolderSubmit,onOpenFileSharedWithMe:le,onOpenPaper:ce,onPasteFromClipboard:l,onRenameCancel:a,onRenameSubmit:r,onSelectFile:h,onSetDropTarget:this.handleSetDropTarget,onSetFileUploaderPath:this.handleSetFileUploaderPath,responsive:J,scrollPositionOffset:Ge,selectedFiles:Q,selection:X,renderSharedWithController:Z,hrefForFile:this.props.hrefForFile,onShowShare:$,onPresentInZoom:ee,user:se,viewportTopOffset:He,visibleColumns:c,canDisplayFolderSizes:p,scrollContainer:ue,shareButtonLabel:this.props.shareButtonLabel,sharingServiceInfo:pe,showShareButton:this.props.showShareButton,starredState:this.props.starredState,onRangeInView:he,containerWidth:_,highDensity:ge,filteredContactName:Se,fileToId:this.props.fileToId,eligibleForFirstTaskSubtitle:this.props.eligibleForFirstTaskSubtitle,expVaultEnableViewOnlySharing:this.props.expVaultEnableViewOnlySharing,isFirstTaskEmptyState:this.props.isFirstTaskEmptyState,expManualTagging:De,preventSelectionOnDrag:this.props.preventSelectionOnDrag,mediaFiltersVariant:Ne,isRightClickEnabled:Le,renderPrivacyColumnClientAccessCell:this.props.renderPrivacyColumnClientAccessCell})))):o.default.createElement(O.SelectableList,{itemIds:x,keyScope:O.SELECTABLE_TILE_GRID_KEY_SCOPE,onSelectionChange:this.handleSelectionChange,selection:X,tilesPerRow:ke,sectionStartIndices:Ee.sectionStartIndices,isActive:Ce},({handleDeselect:e,handleDeselectAll:i,handleFocusFile:n,handleSelect:c,handleSelectAll:u,updateSelection:p,focusedFileId:_})=>o.default.createElement(M.DragToSelectController,{handleSelect:c,handleDeselect:e,updateSelection:p,selection:X,isDragToSelectEnabled:Te},({registerSelectableItem:p})=>o.default.createElement(o.default.Fragment,null,o.default.createElement(d.Table,{columnFlex:Me?m.GRID_VIEW_COLUMN_FLEX_RIGHT_RAIL:m.GRID_VIEW_COLUMN_FLEX,role:"presentation",style:ue?{position:"sticky",top:_e,zIndex:1}:void 0},o.default.createElement(g.ColumnHeader,Object.assign({},C,{variant:ue?"default":fe?"sticky":"fixed",disableResizing:!0}))),o.default.createElement(I.FilesViewTileGrid,{onDelete:t,disabledMultiselect:me||!1,onShowRename:s,activeDropTarget:xe,arePostTTIModulesLoaded:de,createNewFolderState:S,context:E,deselectAll:i,dropTargetHighlightMode:A,fileRename:y,getOverflowMenuActions:this._handleGetOverflowMenuActions,getIsCurrentPathWriteable:this.getIsCurrentPathWriteable,getIsFileJumping:D,onAddFileJumpKeyCode:N,onResetFileJump:P,onTTI:this.handleTTI,items:U,isCreateFolderUIActive:this.isCreateFolderUIActive(),isDraggingExternalFiles:B,isDraggingInternalFiles:H,isQueryingFolderSizes:G,isSearchMode:V,onCopyToClipboard:this.handleCopyToClipboard,onCutToClipboard:this.handleCutToClipboard,onDeselectFile:e,onDragEnter:this.handleDragEnter,onDragStart:this.handleDragStart,onDragEnd:this.handleDragEnd,onFocusFile:n,onFocusSearchBar:f,onNewFolderCancel:this.handleNewFolderCancel,onNewFolderSubmit:this.handleNewFolderSubmit,onNavigateToFileOrFolder:oe,onOpenFileSharedWithMe:le,onOpenPaper:ce,onOpenKeyboardShortcutModal:this.props.openKeyboardShortcutsModal,onPasteFromClipboard:l,onRangeInView:he,onRenameCancel:a,onRenameSubmit:r,onSelectFile:c,onSetDropTarget:this.handleSetDropTarget,onSortChange:K,onTilesPerRowChange:this.onTilesPerRowChange,path:Y,sections:Ee,selectAll:u,selectedFiles:Q,selection:X,onSetFileUploaderPath:this.handleSetFileUploaderPath,tilesPerRow:ke,totalNumItems:te,user:se,viewportTopOffset:He,viewType:ie,starredState:this.props.starredState,hrefForFile:this.props.hrefForFile,focusedFileIndex:_?x.indexOf(_):void 0,scrollContainer:ue,scrollPositionOffset:Ge,registerSelectableTile:p,cutItems:be,isActive:Ce,inlineActions:Fe,preventSelectionOnDrag:this.props.preventSelectionOnDrag}))))}),o.default.createElement(b.ScrollUpdater,{scrollContainer:ue,path:Y}),this.InternalFileDragHelper(),Oe&&o.default.createElement(L.UnityListener,{items:this.props.unityItems,userId:se.id}))}}t.FilesViewComponent=G,G.defaultProps={fileToId:e=>e.fq_path},G.displayName="FilesViewComponent";t.FilesView=l.connect((e,{id:t})=>Object.assign(Object.assign({},h.selectInstance(e,{instanceId:t})),{itemIds:h.selectItemIds(e,{instanceId:t}),sections:h.selectSections(e,{instanceId:t}),responsive:h.selectResponsive(e,{instanceId:t}),isCompactMode:h.selectIsCompactMode(e,{instanceId:t}),viewType:h.selectViewType(e,{instanceId:t}),preferredColumns:h.selectPreferredColumns(e,{instanceId:t}),cutItems:h.selectCutItems(e,{instanceId:t}),numVisibleColumns:h.selectNumVisibleColumns(e,{instanceId:t}),isListView:h.selectIsListView(e,{instanceId:t}),isActive:N.isActiveFilesView(e,t),unityItems:h.selectItemsForUnityListener(e,{instanceId:t})}),(e,{id:t})=>({openKeyboardShortcutsModal:()=>e(f.openKeyboardShortcutsModal({instanceId:t}))}))(G)})),define("metaserver/static/js/modules/clean/react/files_view/files_view_logging",["require","exports","tslib","metaserver/static/js/modules/clean/react/browse/logger_util"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logEvent=t.logEventWithNumberOfFiles=void 0,t.logEventWithNumberOfFiles=t=>{const{isSearchMode:r,file:a,extra:o,action:n,action_source:l,action_surface:c,user:d}=t;if(r){const t=new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/search/single_page/logger"],t,s)}).then(s.__importStar),r=new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/search/single_page/data/selectors/index"],t,s)}).then(s.__importStar),d=new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/search/single_page/data/store"],t,s)}).then(s.__importStar);Promise.all([t,r,d]).then(([e,t,s])=>{const r=s.getStoreForSearch().getState(),d=t.selectedFiles(r),{num_files_selected:u,num_folders_selected:p}=i.countFilesAndFolders(d),_=Object.assign(Object.assign({},o),{num_files_selected:u.toString(),num_folders_selected:p.toString()});e.logResultAction(n,t.resultsList(r),a,c,l,_)})}else{const t=new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/action_logger"],t,s)}).then(s.__importStar),r=new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/data/store"],t,s)}).then(s.__importStar),u=new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/data/selectors"],t,s)}).then(s.__importStar);Promise.all([t,r,u]).then(([{logBrowseAction:e},{getStoreForBrowse:t},s])=>{const r=s.selectedFiles(t().getState()),{num_files_selected:u,num_folders_selected:p}=i.countFilesAndFolders(r);e({uid:d.id,action:n,result:a,num_files_selected:u,num_folders_selected:p,action_surface:c,action_source:l,extra:o})})}},t.logEvent=({user:t,action:i,extra:r})=>s.__awaiter(void 0,void 0,void 0,(function*(){(yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/action_logger"],t,s)}).then(s.__importStar)).logWebUserAction({user_id:t.id,event_name:i,extra:r})}))})),define("metaserver/static/js/modules/clean/react/files_view/fixed_table_head",["require","exports","tslib","spectrum/vertically_fixed/index","spectrum/table/index","react"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FixedTableHead=void 0,a=s.__importDefault(a),t.FixedTableHead=e=>{var{children:t,offsetHeight:o,style:n={}}=e,l=s.__rest(e,["children","offsetHeight","style"]);const c=void 0===o?n:Object.assign({flexBasis:o},n);return a.default.createElement("thead",Object.assign({className:"mc-table-head mc-table-head-fixed brws-column-header",style:c},l),a.default.createElement(i.VerticallyFixed,{tag:({style:e})=>a.default.createElement(r.TableRow,{className:"mc-table-head-row mc-table-head-row-fixed",style:Object.assign({height:o},e),role:"presentation"},t)}))}})),define("metaserver/static/js/modules/clean/react/files_view/legacy_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("metaserver/static/js/modules/clean/react/files_view/list",["require","exports","tslib","react","react-redux","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/react/files_view/resizing/column_size_context","metaserver/static/js/modules/clean/react/files_view/culled_table_body","metaserver/static/js/modules/clean/react/files_view/data/selectors/list_selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/drag_drop/drag_and_drop","metaserver/static/js/modules/clean/react/files_view/rows/file_shared_with_me_row","metaserver/static/js/modules/clean/react/files_view/keyboard_shortcuts","metaserver/static/js/modules/clean/react/files_view/rows/new_folder_row","metaserver/static/js/modules/clean/react/files_view/rows/paper_row","metaserver/static/js/modules/clean/react/files_view/rows/row_container","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/view_type","metaserver/static/js/modules/clean/react/files_view/rows/user_defined_item_row","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewList=t.FilesViewListComponent=t.isGlobalEvent=void 0,i=s.__importDefault(i);const v=()=>{};t.isGlobalEvent=e=>{const t=["menuitem","treeitem"];switch(e.key){case"ArrowLeft":case"ArrowUp":case"ArrowRight":case"ArrowDown":return!(e.target instanceof Element&&t.includes(e.target.getAttribute("role")||""));default:return!0}};class T extends i.default.Component{constructor(){super(...arguments),this.getIsListEvent=e=>this.props.isSelectableListEvent()&&(!(e.target instanceof Element)||"BUTTON"!==e.target.tagName),this.getSelectedFiles=()=>this.props.selectedFiles,this.getActiveDropTarget=()=>this.props.activeDropTarget,this.getIsDraggingInternalFiles=()=>!!this.props.isDraggingInternalFiles,this.getIsDraggingExternalFiles=()=>!!this.props.isDraggingExternalFiles,this.renderRow=(e,t,s)=>{var r,n,l,c;if("NewFolderRow"===e.type)return i.default.createElement(_.NewFolderRow,{createNewFolderState:e.props.createNewFolderState,isInsideMyTeamFolderTree:e.props.isInsideMyTeamFolderTree,onCancel:this.props.onNewFolderCancel,onSubmit:this.props.onNewFolderSubmit,rowIndex:t,topOffset:s,iconSize:e.props.iconSize});if("PaperRow"===e.type)return i.default.createElement(o.ColumnResizingContext.Consumer,null,({columnSizes:r,columnResizingEnabled:a})=>i.default.createElement(m.PaperRow,{paper:e.props.paper,rowIndex:t,topOffset:s,user:this.props.user,visibleColumns:e.props.visibleColumns,onOpenPaper:this.props.onOpenPaper,arePostTTIModulesLoaded:e.props.arePostTTIModulesLoaded,showSnippets:e.props.showSnippets,snippetRows:e.props.snippetRows,height:e.props.height,showStar:e.props.showStar,columnSizes:a?r:void 0}));if("UserDefinedItemRow"===e.type)return i.default.createElement(S.UserDefinedItemRow,{userDefinedItem:e.props.userDefinedItem,rowIndex:t,topOffset:s});const{selection:d}=this.props,p=e.props.file instanceof a.File?d.selected.last()===this.props.fileToId(e.props.file):d.selected.last()===e.props.file.file_id;if("FileSharedWithMeRow"===e.type)return null===(n=(r=this.props).registerListItem)||void 0===n||n.call(r,e.props.file.file_id,{top:s,height:e.props.height,left:0}),i.default.createElement(o.ColumnResizingContext.Consumer,null,({columnSizes:r,columnResizingEnabled:a})=>i.default.createElement(u.FileSharedWithMeRow,{arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,file:e.props.file,visibleColumns:this.props.visibleColumns,isCompactMode:e.props.isCompactMode,getOverflowMenuActions:this.props.getOverflowMenuActions,onOpenFileSharedWithMe:this.props.onOpenFileSharedWithMe,rowIndex:t,controlsFocusable:p,topOffset:s,user:this.props.user,responsive:this.props.responsive,showSnippets:e.props.showSnippets,snippetRows:e.props.snippetRows,height:e.props.height,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,onSelect:this.props.onSelectFile,onDeselect:this.props.onDeselectFile,isFocused:e.props.isFocused,filteredContactName:this.props.filteredContactName,iconSize:e.props.iconSize,columnSizes:a?r:void 0}));null===(c=(l=this.props).registerListItem)||void 0===c||c.call(l,this.props.fileToId(e.props.file),{top:s,height:e.props.height,left:0});const h={key:e.key,instanceId:this.props.instanceId,itemIndex:e.itemIndex,containerWidth:e.props.containerWidth,file:e.props.file,sharingServiceInfo:e.props.sharingServiceInfo,getOverflowMenuActions:this.props.getOverflowMenuActions,hideViewFileButton:this.props.hideViewFileButton,isActiveDropTarget:e.props.isActiveDropTarget,isAvailableDropTarget:e.props.isAvailableDropTarget,isCompactMode:e.props.isCompactMode,responsive:e.props.responsive,isExtensionsMenuDisabled:e.props.isExtensionsMenuDisabled,isFocused:e.props.isFocused,isSearchMode:e.props.isSearchMode,isSelectMode:e.props.isSelectMode,isSelected:e.props.isSelected,isSharingDisabled:e.props.isSharingDisabled,onDeselect:this.props.onDeselectFile,onDragStart:this.props.onDragStart,onDragEnter:this.props.onDragEnter,onDragEnd:this.props.onDragEnd,onLocationLinkClick:this.props.onLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onRenameCancel:this.props.onRenameCancel,onRenameSubmit:this.props.onRenameSubmit,onSelect:this.props.onSelectFile,renameState:e.props.renameState,rowIndex:t,controlsFocusable:p,topOffset:s,user:this.props.user,visibleColumns:this.props.visibleColumns,canDisplayFolderSizes:this.props.canDisplayFolderSizes,renderSharedWithController:this.props.renderSharedWithController,hrefForFile:this.props.hrefForFile,onShowShare:this.props.onShowShare,onPresentInZoom:this.props.onPresentInZoom,shareButtonLabel:this.props.shareButtonLabel,showShareButton:this.props.showShareButton,filteredContactName:this.props.filteredContactName,fileToId:this.props.fileToId,isFirstTaskEmptyState:this.props.isFirstTaskEmptyState,isCondensedListView:e.props.isCondensedListView,isActionBarEnabled:e.props.isActionBarEnabled,expManualTagging:this.props.expManualTagging,preventSelectionOnDrag:this.props.preventSelectionOnDrag,mediaFiltersVariant:this.props.mediaFiltersVariant,isRightClickEnabled:this.props.isRightClickEnabled,renderPrivacyColumnClientAccessCell:this.props.renderPrivacyColumnClientAccessCell};return i.default.createElement(f.RowContainer,Object.assign({},h))}}componentDidMount(){this.props.onTTI(),this.setupKeyboardShortcuts(),this.setupExternalDragHandler()}componentWillUnmount(){this.cleanupKeyboardShortcuts(),d.cleanupExternalDragHandler(this.props.keyScope)}componentDidUpdate(e){e.isActive!==this.props.isActive&&(this.props.isActive?this.setupKeyboardShortcuts():this.cleanupKeyboardShortcuts())}cleanupKeyboardShortcuts(){p.resetFilesViewKeyboardShortcuts(this.props.keyScope),p.resetFileJumpKeyboardShortcuts(this.props.keyScope)}setupKeyboardShortcuts(){const{user:e,onDelete:t,onShowRename:s,getIsFileJumping:i,onAddFileJumpKeyCode:r,onResetFileJump:a,keyScope:o,onCopyToClipboard:n,onCutToClipboard:l,onNavigateToParentFolder:c,onPasteFromClipboard:d}=this.props;p.setupFileJumpKeyboardShortcuts({scope:o,getIsFileJumping:i,onAddFileJumpKeyCode:r,onResetFileJump:a}),p.setupFilesViewKeyboardShortcuts({user:e,viewType:g.ViewType.List,getIsGlobalEvent:this.getIsGlobalEvent(),getIsItemEvent:this.getIsListEvent,getSelectedFiles:this.getSelectedFiles,isCurrentPathWriteable:this.props.getIsCurrentPathWriteable,selectAllAction:v,deselectAllAction:v,onCopyToClipboard:n,onCutToClipboard:l,onDelete:t,onFocusSearchBar:this.props.onFocusSearchBar,onNavigateToFileOrFolder:e=>this.props.onNavigateToFileOrFolder(e,{actionSource:h.FilesViewActionSource.KEYBOARD}),onNavigateToParentFolder:c,onPasteFromClipboard:d,onShowRename:s,scope:o,onShowHelpMenu:()=>this.props.onOpenKeyboardShortcutModal()})}setupExternalDragHandler(){d.setupExternalDragHandler(this.props.keyScope,this.getIsDraggingInternalFiles,this.getIsDraggingExternalFiles,this.props.onSetFileUploaderPath,".brws-file-row",this.getActiveDropTarget,this.props.onSetDropTarget)}getIsGlobalEvent(){return t.isGlobalEvent}render(){const{scrollPositionOffset:e,viewportTopOffset:t,focusedFileIndex:s,onRangeInView:r,scrollContainer:a,listItems:o,heights:l,itemBuffer:c}=this.props;return i.default.createElement(n.CulledTableBodyWithScrollContainer,{items:o,listItemHeight:l,renderRow:this.renderRow,scrollPositionOffset:e,scrollToRow:s,shouldUseWindowAsScrollContainer:!0,viewportTopOffset:t,onRangeInView:r,scrollContainer:a,itemBuffer:c,id:"files-view-table-container"})}}t.FilesViewListComponent=T,T.defaultProps={isFileViewerShown:()=>!1},T.displayName="FilesViewListComponent";t.FilesViewList=r.connect((e,t)=>({listItems:l.selectListItems(e,t),heights:l.selectListItemHeights(e,t),itemBuffer:l.selectListItemBuffer(e,t),isActive:E.isActiveFilesView(e,t.instanceId),isCheckboxDisabled:c.selectDisabledMultiselect(e,t),cutItems:c.selectCutItems(e,t)}))(T)})),define("metaserver/static/js/modules/clean/react/files_view/rows/new_folder_row",["require","exports","tslib","spectrum/media_table/index","spectrum/table/index","react","spectrum/icon_content/index","metaserver/static/js/modules/clean/react/files_view/name_input","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFolderIcon=t.NewFolderRow=void 0,a=s.__importDefault(a),t.NewFolderRow=e=>{const{createNewFolderState:s,isInsideMyTeamFolderTree:o=!1,onCancel:c,onSubmit:d,rowIndex:u,topOffset:p,iconSize:_}=e;let m;m="SAVING_INPUT"===s?a.default.createElement("p",{className:"brws-new-folder-row-status",role:"status","aria-live":"polite"},l.intl.formatMessage({id:"p58M12",defaultMessage:"Creating new folder…"})):a.default.createElement(n.NameInput,{defaultValue:"",label:l.intl.formatMessage({id:"ss4CO0",defaultMessage:"Folder name"}),onSubmit:d,onCancel:c});const f=a.default.createElement(t.NewFolderIcon,{isInsideMyTeamFolderTree:o,iconSize:_});return a.default.createElement(i.CulledMediaRow,{"aria-rowindex":void 0!==u?u+1:void 0,className:"brws-new-folder-row",topOffset:p},a.default.createElement(r.TableCell,{className:"brws-checkbox-cell"}),a.default.createElement(i.MediaCell,{icon:f},a.default.createElement("div",{className:"brws-new-folder-row-content brws-vertically-center"},m)),a.default.createElement(r.TableCell,null),a.default.createElement(r.TableCell,null))},t.NewFolderIcon=e=>{const{isInsideMyTeamFolderTree:t,iconSize:s}=e,i=e.className||"",r=s?{width:s,height:s}:{};return a.default.createElement(o.IconContent,Object.assign({className:i,name:t?"folder_team-small":"folder-small"},r))}})),define("metaserver/static/js/modules/clean/react/files_view/rows/paper_row",["require","exports","tslib","react","classnames","typescript/component_libraries/retrieval-components/src/highlighted-truncated-string/index","spectrum/media_table/index","spectrum/util/raf_throttle","metaserver/static/js/modules/clean/emoji_utils","metaserver/static/js/modules/clean/filename_highlights","metaserver/static/js/modules/clean/paper_formatting_utils","metaserver/static/js/modules/clean/react/files_view/file_snippets","metaserver/static/js/modules/clean/react/files_view/star","metaserver/static/js/modules/clean/react/files_view/sort_types","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/files_view/rows/row"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g){"use strict";function S(){}Object.defineProperty(t,"__esModule",{value:!0}),t.PaperRow=void 0,i=s.__importDefault(i),r=s.__importDefault(r),l=s.__importStar(l),d=s.__importStar(d),f=s.__importStar(f);const E=e=>void 0===e?{}:{width:e,minWidth:e,maxWidth:e};class v extends i.default.PureComponent{constructor(e){super(e),this.setRef=e=>{this.brwsFilenameContainerDiv=e},this.handleWindowResize=()=>{this.throttledWindowResize.request()},this.handleResize=()=>{if(this.brwsFilenameContainerDiv){const{brwsFilenameContainerDivWidth:e}=this.state,t=this.brwsFilenameContainerDiv.getBoundingClientRect().width;t&&t!==e&&this.setState({brwsFilenameContainerDivWidth:t})}},this.handleOpenNewTabOrNavigate=e=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),this.handleNavigate({openInNewTab:m.hasModifierKey(e)}))},this.handleNavigate=({openInNewTab:e})=>{const{paper:t,onOpenPaper:s}=this.props;e?f.open_tab(t.url):s(t)},this.throttledWindowResize=new n.RafThrottle(()=>this.handleResize()),this.state=this.calcState(e)}UNSAFE_componentWillReceiveProps(e){if(this.props.paper.title!==e.paper.title||this.props.paper.highlight_spans!==e.paper.highlight_spans){const t=this.calcState(e);this.setState(t)}}componentDidMount(){this.handleResize(),window.addEventListener("resize",this.handleWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize)}componentDidUpdate(e){var t,s;(null===(t=e.columnSizes)||void 0===t?void 0:t[_.SortField.FILENAME])!==(null===(s=this.props.columnSizes)||void 0===s?void 0:s[_.SortField.FILENAME])&&this.handleResize()}calcState(e){return{titleParts:d.getPaperDocTitleParts(e.paper,"brws-file-name-cell-icon","brws-file-name-cell-icon-emoji")}}getHighlightedSpansForHighlightedTruncatedString(e){let{title:t,highlight_spans:s,title_highlights:i}=e;const r=s&&s.length>0,a=l.getFirstEmojiFromTitle(t);if(r){if(a){const e={highlight_str:s[0].highlight_str.substr(a.length),is_highlighted:s[0].is_highlighted};s=[e,...s.slice(1)]}return s.map(e=>({string:e.highlight_str,isHighlighted:e.is_highlighted}))}if(i){if(a){t=t.substr(a.length);const e=a.length/2;i=i.slice().map(t=>({pos:t.pos-e,len:t.string.length,string:t.string}))}return c.highlightMatchSections(t,i).map(e=>({string:e.text,isHighlighted:e.isHighlighted}))}}renderTitleElement(e){const{paper:t,showHighlights:s}=this.props,{title:r,highlightedTitle:o}=this.state.titleParts;if(e){const o=i.default.createElement(a.HighlightedTruncatedString,{text:r,className:"brws-file-name-element",fontSize:14,highlightSpans:this.getHighlightedSpansForHighlightedTruncatedString(t),cellBuffer:3,availableWidth:e});return i.default.createElement("a",{className:"brws-paper-doc-name-cell-title",href:t.url,onClick:this.handleOpenNewTabOrNavigate},s?o:i.default.createElement("span",null,r))}return i.default.createElement("a",{className:"brws-paper-doc-name-cell-title",href:t.url,onClick:this.handleOpenNewTabOrNavigate},s?o:i.default.createElement("span",null,r))}renderPaperCellContent(e,t){const{paper:s,user:r,showSnippets:a,snippetRows:n,showStar:l}=this.props;return i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:"brws-paper-doc-name-cell-content brws-vertically-center"},i.default.createElement("div",{className:"brws-paper-doc-name-cell-title-container"},i.default.createElement(o.MediaCellText,{highlight:e,className:"brws-paper-doc-cell-name"},this.renderTitleElement(t))),i.default.createElement(o.MediaCellText,{variant:"subtitle"},h.intl.formatMessage({id:"mvOTrD",defaultMessage:"in Paper"})),a&&i.default.createElement(o.MediaCellText,{key:"snippets",variant:"subtitle"},i.default.createElement("div",{className:"brws-file-snippets-tags-container"},i.default.createElement(u.FileSnippets,{snippets:s.snippets,lineClamp:n})))),l&&i.default.createElement(p.StarContainer,{item:s,user:r,key:"paperStar",className:"brws-file-name-cell-star",starButtonClassName:"brws-file-name-star-button",alwaysShowUnstarred:!0}))}renderDocName(e,t){const{height:s}=this.props,{icon:a}=this.state.titleParts,n={highlight:e,icon:a,style:Object.assign({minHeight:s-1},E(t))},l=r.default("brws-file-name-container",{"brws-file-name-container--action-ui-inline-star":!0}),{brwsFilenameContainerDivWidth:c}=this.state;return i.default.createElement(o.MediaCell,Object.assign({key:"docName"},n),i.default.createElement("div",{className:l,ref:this.setRef},this.renderPaperCellContent(e,c)))}renderDocInfo(e){const{paper:t}=this.props,s=t.last_modified_date||"",r=t.last_editor_name?h.intl.formatMessage({id:"ACVnV9",defaultMessage:"by {modified_by}"},{modified_by:t.last_editor_name}):h.intl.formatMessage({id:"5794tP",defaultMessage:"by you"});return i.default.createElement(o.MediaCell,{key:"docInfo",subtitle:r,title:s,style:E(e)})}renderCell({isHovered:e,sortField:t}){var s;const r=null===(s=this.props.columnSizes)||void 0===s?void 0:s[t];switch(t){case _.SortField.FILENAME:return this.renderDocName(e,r);case _.SortField.RELEVANCE:case _.SortField.MODIFIED:return this.renderDocInfo(r);default:return i.default.createElement(o.MediaCell,{key:t,title:i.default.createElement("span",{"aria-hidden":!0},"--"),style:E(r)})}}render(){const{rowIndex:e,topOffset:t,visibleColumns:s,paper:r}=this.props;return i.default.createElement(g.FilesViewRow,{className:"brws-paper-row",topOffset:t,rowIndex:e,filename:r.title,ariaLabel:r.title,onSelect:S,onDeselect:S,onNavigateToItem:this.handleNavigate},({isHovered:e})=>[i.default.createElement(o.MediaCell,{key:"checkboxCell",className:"brws-checkbox-cell"}),...s.map(t=>this.renderCell({isHovered:e,sortField:t.sortField}))])}}t.PaperRow=v,v.defaultProps={showHighlights:!0},v.displayName="PaperRow"})),define("metaserver/static/js/modules/clean/react/files_view/rows/row",["require","exports","tslib","classnames","react","spectrum/media_table/index","metaserver/static/js/modules/clean/react/files_view/double_click","metaserver/static/js/modules/clean/react/files_view/types","metaserver/static/js/modules/clean/react/files_view/util","metaserver/static/js/modules/clean/react/selectable_list"],(function(e,t,s,i,r,a,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilesViewRow=void 0,i=s.__importDefault(i),r=s.__importDefault(r);const d=({className:e,isSelected:t,isDeleted:s,isDraggable:d,isActiveDropTarget:u,rowIndex:p,ariaLabel:_,filename:m,children:f,onDragEnter:h,isSelectMode:g,onDragStart:S,onDragEnd:E,onNavigateToItem:v,onSelect:T,onDeselect:b,topOffset:I=0,isRightClickEnabled:w})=>{const C=e=>{w&&(e.defaultPrevented||(e.preventDefault(),e.shiftKey?T(c.SelectOptions.EXTEND,n.FilesViewActionSource.ROW_SINGLE_CLICK):e.ctrlKey||e.metaKey?T(c.SelectOptions.DEFAULT,n.FilesViewActionSource.ROW_SINGLE_CLICK):t||T(c.SelectOptions.ONLY,n.FilesViewActionSource.ROW_SINGLE_CLICK)))},O=(e,t)=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),v({openInNewTab:Boolean(l.hasModifierKey(e)),actionSource:t}))};return r.default.createElement(o.WithDoubleClick,{onClick:e=>{e.defaultPrevented||(e.preventDefault(),e.shiftKey?T(c.SelectOptions.EXTEND,n.FilesViewActionSource.ROW_SINGLE_CLICK):e.ctrlKey||e.metaKey?t?b(!1,n.FilesViewActionSource.ROW_SINGLE_CLICK):T(c.SelectOptions.DEFAULT,n.FilesViewActionSource.ROW_SINGLE_CLICK):T(c.SelectOptions.ONLY,n.FilesViewActionSource.ROW_SINGLE_CLICK))},onDoubleClick:e=>{e.defaultPrevented||O(e,n.FilesViewActionSource.ROW_DOUBLE_CLICK)}},({onClick:o})=>r.default.createElement(a.CulledMediaRow,{className:i.default(e,{"brws-file-row-selected":t,"brws-file-row-deleted":s,"brws-file-row-dragover":u,"brws-row-click-selection-method":!0}),variant:(u?"dragover":t&&"selected")||"default",onClick:o,onContextMenu:C,draggable:d,topOffset:I,onDragEnter:h,onDragStart:t?S:void 0,onDragEnd:E,"aria-rowindex":(p||0)+1,"aria-label":_,"data-filename":m,tabIndex:g?-1:0===p?0:-1},f))};d.displayName="FilesViewRowUnmemoed",t.FilesViewRow=r.default.memo(d),t.FilesViewRow.displayName="FilesViewRow"})),define("metaserver/static/js/modules/clean/react/files_view/rows/row_container",["require","exports","tslib","react","react-redux","metaserver/static/js/modules/clean/react/files_view/resizing/column_size_context","metaserver/static/js/modules/clean/react/files_view/data/selectors/instance_selectors","metaserver/static/js/modules/clean/react/files_view/data/selectors/item_selectors","metaserver/static/js/modules/clean/react/files_view/rows/file_row"],(function(e,t,s,i,r,a,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RowContainer=t.RowContainerWithoutRedux=void 0,i=s.__importDefault(i),t.RowContainerWithoutRedux=i.default.memo(e=>i.default.createElement(a.ColumnResizingContext.Consumer,null,({columnSizes:t,columnResizingEnabled:s})=>i.default.createElement(l.FileRow,Object.assign({},e,{columnSizes:s?t:void 0})))),t.RowContainerWithoutRedux.displayName="RowContainerWithoutRedux";t.RowContainer=r.connect((e,t)=>({arePostTTIModulesLoaded:o.selectArePostTTIModulesLoaded(e,t),context:o.selectContext(e,t),isCheckboxDisabled:o.selectDisabledMultiselect(e,t),responsive:o.selectResponsive(e,t),showCDMUserEducationEffects:n.selectShowCDMUserEducationEffects(e,t),height:n.selectRowHeight(e,Object.assign(Object.assign({},t),{numVisibleColumns:t.visibleColumns.length})),iconSize:n.selectIconSize(e,t),isCutToClipboard:n.selectIsCutToClipboard(e,t)}))(t.RowContainerWithoutRedux)})),define("metaserver/static/js/modules/clean/react/files_view/scroll_updater",["require","exports","tslib","react-redux","react","metaserver/static/js/modules/clean/react/files_view/data/selectors/files_view_selectors"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScrollUpdater=void 0,r=s.__importDefault(r),a=s.__importStar(a),t.ScrollUpdater=({scrollContainer:e,path:t})=>{const s=i.useSelector(a.currentScroll),o=t=>{e&&e.current?e.current.scrollTop=t:window.scrollTo(0,t)};return r.default.useEffect(()=>{(()=>{if(!s)return;const{scrollTop:e}=s;o(e)})()},[s]),r.default.useEffect(()=>{o(0)},[t]),null}})),define("metaserver/static/js/modules/clean/react/files_view/sticky_table_head",["require","exports","tslib","spectrum/dimensions/index","spectrum/table/index","react","metaserver/static/js/modules/clean/react/sticky/sticky","metaserver/static/js/modules/clean/react/sticky/container"],(function(e,t,s,i,r,a,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StickyTableHead=void 0,a=s.__importDefault(a),t.StickyTableHead=e=>{var{children:t,columnFlex:l,offsetHeight:c,offsetTop:d}=e,u=s.__rest(e,["children","columnFlex","offsetHeight","offsetTop"]);const p=a.default.createElement(i.Dimensions,{tagName:"tr"},({width:e})=>a.default.createElement("td",{className:"brws-sticky-table-cell"},a.default.createElement(n.StickyContainer,{offsetTop:d},a.default.createElement(o.Sticky,null,a.default.createElement(r.Table,{columnFlex:l,style:{width:e}},a.default.createElement(r.TableHead,Object.assign({},u),t))))));return a.default.createElement("thead",{className:"brws-sticky-table-head"},p)}})),define("metaserver/static/js/modules/clean/react/files_view/thumbnail_media_cell",["require","exports","tslib","react","spectrum/media_table/index","metaserver/static/js/modules/clean/react/files_view/file_thumbnail"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailMediaCell=void 0,i=s.__importDefault(i),t.ThumbnailMediaCell=e=>{var{height:t,width:o,children:n}=e,l=s.__rest(e,["height","width","children"]);const c=void 0===o?{}:{width:o,minWidth:o,maxWidth:o};return i.default.createElement(r.MediaCell,{icon:i.default.createElement(a.FileThumbnail,Object.assign({},l)),style:Object.assign({minHeight:t-1},c),children:n})},t.ThumbnailMediaCell.displayName="ThumbnailMediaCell",t.ThumbnailMediaCell.displayName="ThumbnailMediaCell"})),define("metaserver/static/js/modules/clean/react/files_view/unity_listener",["require","exports","tslib","react","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/core/cancelable_promise","metaserver/static/js/modules/clean/react/browse/models"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnityListener=void 0,i=s.__importDefault(i),r=s.__importStar(r);t.UnityListener=({items:t,userId:n})=>{const[l,c]=i.default.useState(void 0);return i.default.useEffect(()=>{const t=a.makeCancelable(s.__awaiter(void 0,void 0,void 0,(function*(){return yield r.waitForTTI(),(yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/unity_browse_interface"],t,s)}).then(s.__importStar)).unityBrowseInterface})).then(e=>c(e)));return()=>t.cancel()},[]),i.default.useEffect(()=>{null==l||l.browse_visible_change_callback(t.toArray().filter(e=>e instanceof o.File),n,0,t.size-1)},[l,t,n]),null},t.UnityListener.displayName="UnityListener"})),define("metaserver/static/js/modules/clean/react/files_view/rows/user_defined_item_row",["require","exports","tslib","react"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserDefinedItemRow=void 0,i=s.__importDefault(i),t.UserDefinedItemRow=i.default.memo(({rowIndex:e,topOffset:t,userDefinedItem:s})=>s.renderUserDefinedItemRow({rowIndex:e,topOffset:t})),t.UserDefinedItemRow.displayName="UserDefinedItemRow"})),define("metaserver/static/js/modules/clean/react/files_view/view_preferences",["require","exports","metaserver/static/js/modules/core/persistence/storage"],(function(e,t,s){"use strict";function i(e){return Object.assign({},s.UserLocalStorage.get(e,t.VIEW_PREFERENCES_STORAGE_KEY))}function r(e,r,a){const o=i(e),n=Object.assign(Object.assign({},a),{last_updated_ts:Date.now()});for(const e of r)o[e]=Object.assign(Object.assign({},o[e]),n);for(;Object.keys(o).length>t.VIEW_PREFERENCES_STORAGE_LIMIT;){const e=Object.keys(o).reduce((e,t)=>!e||o[t].last_updated_ts<o[e].last_updated_ts?t:e);delete o[e]}s.UserLocalStorage.set(e,t.VIEW_PREFERENCES_STORAGE_KEY,o)}function a(e,t){const s={},r=i(e);return Object.keys(r).forEach(e=>{const i=r[e][t];void 0!==i&&(s[e]=i)}),s}Object.defineProperty(t,"__esModule",{value:!0}),t.setNumVisibleColumns=t.getScopedNumVisibleColumns=t.setSort=t.getScopedSorts=t.setColumnsIndex=t.getScopedColumnsIndex=t.setViewType=t.getViewTypes=t.getPreferences=t.VIEW_PREFERENCES_STORAGE_LIMIT=t.VIEW_PREFERENCES_STORAGE_KEY=void 0,t.VIEW_PREFERENCES_STORAGE_KEY="files_view_preferences",t.VIEW_PREFERENCES_STORAGE_LIMIT=500,t.getPreferences=i,t.getViewTypes=function(e){const t=i(e);if(!t||0===Object.keys(t).length)return null;const s={};return Object.keys(t).forEach(e=>{const i=t[e].file_view_mode;i&&(s[e]=i)}),s},t.setViewType=function(e,t,s){r(e,t,{file_view_mode:s})},t.getScopedColumnsIndex=function(e){return a(e,"columns_index")},t.setColumnsIndex=function(e,t,s){r(e,t,{columns_index:s})},t.getScopedSorts=function(e){return a(e,"sort_state")},t.setSort=function(e,t,s){r(e,t,{sort_state:s})},t.getScopedNumVisibleColumns=function(e){return a(e,"num_visible_columns")},t.setNumVisibleColumns=function(e,t,s){r(e,t,{num_visible_columns:s})}})),define("metaserver/static/js/modules/clean/react/folder_dialog/async",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/components/modal_controller","metaserver/static/js/modules/clean/css/css"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.prewarmFolderDialog=t.showFolderDialog=void 0,i=s.__importDefault(i),t.showFolderDialog=function(t){new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/folder_dialog/folder_dialog"],t,s)}).then(s.__importStar).then(({FolderDialog:e})=>{r.mountModal(i.default.createElement(e,Object.assign({},t)))})},t.prewarmFolderDialog=function(){new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/folder_dialog/folder_dialog"],t,s)}).then(s.__importStar).then(()=>{a.require_css("/static/css/react/folder_picker-vflcMs3jS.css")})}})),define("metaserver/static/js/modules/clean/react/growth/personalization/collection_folder/collection_folder",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/components/css","metaserver/static/js/modules/clean/react/image","metaserver/static/js/modules/clean/static_urls","dig-components/typography","dig-components/buttons","metaserver/static/js/modules/clean/react/growth/personalization/collection_folder/constants","metaserver/static/js/modules/clean/react/growth/personalization/collection_folder/actions","metaserver/static/js/modules/clean/paper/template_library/constants","metaserver/static/js/modules/clean/dropbox_form","metaserver/static/js/modules/clean/react/growth/personalization/collection_folder/logger","metaserver/static/js/modules/clean/growth/smb_funnel/smb_funnel_logger","metaserver/static/js/modules/clean/react/admin/teams/onboarding/web/constants"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionFolder=t.CollectionFolderView=void 0,i=s.__importDefault(i),d=s.__importStar(d),_=s.__importStar(_);class h extends i.default.PureComponent{constructor(){super(...arguments),this.getActionCallback=(e,t,s,i,r,a)=>{switch(i){case c.ActionCallbackType.CREATE_GOOGLE_SHEETS:return()=>d.createGoogleSheets(e,t.currentFQPath);case c.ActionCallbackType.DOWNLOAD:return()=>d.downloadDesktop(e);case c.ActionCallbackType.OPEN_SHARE_MODAL:return()=>d.asyncOpenShareFolderSetting(e,t,a);case c.ActionCallbackType.UPLOAD:return()=>d.uploadFile(s);case c.ActionCallbackType.REDIRECT:return()=>d.redirectToLink(r);default:return()=>{}}},this.logOnActionClicked=(e,t,s)=>{_.userClickedCollectionsFolderAction(e,t),s?s():m.SMBFunnelLogger.log(f.AMPMetrics.ACTIVATION_COLLECTIONS_ACTION_PAPER,{collectionFolderType:String(e),templateName:t})},this.getActionButton=e=>{const{user:t,context:s,handleUploadButtonClick:r}=this.props;if(e.actionCallbackType===c.ActionCallbackType.CREATE_PAPER_TEMPLATE)return i.default.createElement(p.DropboxForm,{method:"post",action:u.REDIRECT_URL+"?slugId="+e.paperTemplateSlugId,target:"_blank"},i.default.createElement(l.Button,{type:"submit",variant:"outline",onClick:()=>this.logOnActionClicked(s.collectionFolderType,e.loggingTitle)},e.buttonText));{const a=this.getActionCallback(t,s,r,e.actionCallbackType,e.redirectLink,e.shareModalSettingsTab);return i.default.createElement(l.Button,{type:"button",variant:"outline",onClick:()=>this.logOnActionClicked(s.collectionFolderType,e.loggingTitle,a)},e.buttonText)}}}render(){const{context:e,role:t}=this.props,s=c.collectionPanelConfig(t,e.collectionFolderType);if(void 0===s)return null;_.userViewCollectionsFolder(e.collectionFolderType,t,s.actions);const r=s.actions.map((e,t)=>i.default.createElement("div",{className:"collection-action-item",key:t},i.default.createElement(a.Image,{alt:c.imageAltString,src:o.static_url(e.imageUrl),srcHiRes:o.static_url(e.imageHiResUrl)}),i.default.createElement("div",{className:"collection-action-item__rc"},i.default.createElement("div",{className:"collection-action-item__rc__title"},i.default.createElement(n.Title,{size:"small",isBold:!0},e.title)),i.default.createElement("div",{className:"collection-action-item__rc__desc"},i.default.createElement(n.Text,null,e.desc)),i.default.createElement("div",{className:"collection-action-item__rc__button"},this.getActionButton(e)))));return i.default.createElement("div",{className:"collection-panel"},i.default.createElement("div",{className:"collection-overview-title"},i.default.createElement(n.Title,{size:"small",isBold:!0},c.overviewTitle)),i.default.createElement("div",{className:"collection-overview-desc"},i.default.createElement("div",{className:"collection-overview-desc__text"},i.default.createElement(n.Text,null,s.overviewDesc))),i.default.createElement("div",{className:"collection-action-title"},i.default.createElement("div",{className:"collection-action-title__text"},i.default.createElement(n.Title,{size:"small",isBold:!0},s.actionsTitle))),i.default.createElement("div",{className:"collection-action-panel"},r))}}t.CollectionFolderView=h,h.displayName="CollectionFolderView",t.CollectionFolder=r.requireCssWithComponent(h,["/static/css/dig-components/index.web-vfl0pq0Fh.css","/static/css/growth/experiments/collection_folder-vflpSIfgG.css"])})),define("metaserver/static/js/modules/clean/react/growth/personalization/collection_folder/constants",["require","exports","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/filetypes"],(function(e,t,s,i){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.overviewTitle=t.collectionPanelConfig=t.imageAltString=t.ActionCallbackType=t.WATERMARK_LINK=t.PAPER_TEMPLATES_LINK=t.FILE_REQUEST_LINK=void 0,t.FILE_REQUEST_LINK="/requests",t.PAPER_TEMPLATES_LINK="/paper/templates",t.WATERMARK_LINK="/features/share/watermark",(function(e){e.DOWNLOAD="download",e.CREATE_GOOGLE_SHEETS="create_google_sheets",e.CREATE_PAPER_TEMPLATE="create_paper_template",e.OPEN_SHARE_MODAL="open_share_modal",e.UPLOAD="upload",e.REDIRECT="redirect"})(r=t.ActionCallbackType||(t.ActionCallbackType={})),t.imageAltString=s.intl.formatMessage({id:"G0BGYo",defaultMessage:"Image loading"});const a={imageUrl:"/static/images/growth/personalization/collections_exp/Get_Smart_Sync_on_desktop-vfllGWHCs.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Get_Smart_Sync_on_desktop@2x-vflXfvyBS.png",title:s.intl.formatMessage({id:"cBBY+o",defaultMessage:"Get Smart Sync on desktop"}),loggingTitle:"smart_sync",desc:s.intl.formatMessage({id:"4PtkZL",defaultMessage:"Store all your computer files in the cloud to save computer space and keep everything backed up."}),buttonText:s.intl.formatMessage({id:"8cyvqx",defaultMessage:"Open the desktop app"}),actionCallbackType:r.DOWNLOAD},o={imageUrl:"/static/images/growth/personalization/collections_exp/Lock_files_when_you_edit_them-vflNkx0x7.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Lock_files_when_you_edit_them@2x-vflEgd1S9.png",title:s.intl.formatMessage({id:"XVzKiX",defaultMessage:"Lock files when you edit them"}),loggingTitle:"lock_files",desc:s.intl.formatMessage({id:"LhuHW+",defaultMessage:"In the desktop app, right click a file in any shared folder to keep others from editing it at the same time."}),buttonText:s.intl.formatMessage({id:"8m53T6",defaultMessage:"Upload file and try"}),actionCallbackType:r.UPLOAD},n={imageUrl:"/static/images/growth/personalization/collections_exp/Work_off_Google_Sheets-vflnZKx1s.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Work_off_Google_Sheets@2x-vflY3NFJm.png",title:s.intl.formatMessage({id:"ZWTwJC",defaultMessage:"Work off Google Sheets"}),loggingTitle:"google_sheet",desc:s.intl.formatMessage({id:"HdzKjx",defaultMessage:"Create and use Google files from within Dropbox to have all your spreadsheets stored in one place."}),buttonText:s.intl.formatMessage({id:"vlzkco",defaultMessage:"Create Google Sheet"}),actionCallbackType:r.CREATE_GOOGLE_SHEETS},l={imageUrl:"/static/images/growth/personalization/collections_exp/Decide_who_can_edit_folders-vfl3MUfmT.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Decide_who_can_edit_folders@2x-vflzQOJeG.png",title:s.intl.formatMessage({id:"vhvaO9",defaultMessage:"Decide who can edit folders"}),loggingTitle:"folder_settings",desc:s.intl.formatMessage({id:"jSmn2k",defaultMessage:"Give specific people permission to edit or view-only access for individual folders."}),buttonText:s.intl.formatMessage({id:"+pTjXN",defaultMessage:"Open folder settings"}),actionCallbackType:r.OPEN_SHARE_MODAL,shareModalSettingsTab:"folder_settings"},c={imageUrl:"/static/images/growth/personalization/collections_exp/Have_total_control_of_shared_links-vflyAyrmd.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Have_total_control_of_shared_links@2x-vflfnAKvn.png",title:s.intl.formatMessage({id:"6oKVMW",defaultMessage:"Have total control of shared links"}),loggingTitle:"link_settings",desc:s.intl.formatMessage({id:"z4ud8c",defaultMessage:"Set passwords, disable downloads, and set expirations dates on anything you share with a link."}),buttonText:s.intl.formatMessage({id:"Q9UABZ",defaultMessage:"Open link settings"}),actionCallbackType:r.OPEN_SHARE_MODAL,shareModalSettingsTab:"view_link_settings"},d={imageUrl:"/static/images/growth/personalization/collections_exp/Watermark_your_PDFs_and_photos-vflkjxZpk.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Watermark_your_PDFs_and_photos@2x-vfl4utj4c.png",title:s.intl.formatMessage({id:"0ZcoHO",defaultMessage:"Watermark your PDFs and photos"}),loggingTitle:"watermark",desc:s.intl.formatMessage({id:"UYiZrN",defaultMessage:"When you preview a file in Dropbox, you can watermark it with your logos or text."}),buttonText:s.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),actionCallbackType:r.REDIRECT,redirectLink:t.WATERMARK_LINK},u={imageUrl:"/static/images/growth/personalization/collections_exp/Comment_and_annotate_on_files-vfl-sZwtU.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Comment_and_annotate_on_files@2x-vflg-KF4w.png",title:s.intl.formatMessage({id:"6uwoJY",defaultMessage:"Comment and annotate on files"}),loggingTitle:"comment_files",desc:s.intl.formatMessage({id:"xqj2eW",defaultMessage:"Mention teammates on specific areas of files for targeted feedback."}),buttonText:s.intl.formatMessage({id:"8m53T6",defaultMessage:"Upload file and try"}),actionCallbackType:r.UPLOAD},p={imageUrl:"/static/images/growth/personalization/collections_exp/Request_files_from_others-vflvy4CGu.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Request_files_from_others@2x-vflms8zVt.png",title:s.intl.formatMessage({id:"bgGX06",defaultMessage:"Request files from others"}),loggingTitle:"request_files",desc:s.intl.formatMessage({id:"BqqQJn",defaultMessage:"Collect and receive large files from anyone-right in your Dropbox account."}),buttonText:s.intl.formatMessage({id:"34LFfx",defaultMessage:"Try file request"}),actionCallbackType:r.REDIRECT,redirectLink:t.FILE_REQUEST_LINK},_={imageUrl:"/static/images/growth/personalization/collections_exp/Brainstorming-vflzwizf3.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Brainstorming@2x-vfljrvaTs.png",title:s.intl.formatMessage({id:"mIVTjA",defaultMessage:"Brainstorming"}),loggingTitle:"brainstorming",desc:s.intl.formatMessage({id:"8yBNxI",defaultMessage:"Collect inspiration, exchange ideas in real-time, and get feedback."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"brainstorm"},m={imageUrl:"/static/images/growth/personalization/collections_exp/Brand_guidelines-vfl73kagH.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Brand_guidelines@2x-vflWEdsrX.png",title:s.intl.formatMessage({id:"qpwvDp",defaultMessage:"Brand guidelines"}),loggingTitle:"brand_guidelines",desc:s.intl.formatMessage({id:"PhOzXb",defaultMessage:"Craft guidelines that help everyone create written and visual materials."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"brand-guidelines"},f={imageUrl:"/static/images/growth/personalization/collections_exp/Creative_brief-vflzoR7nu.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Creative_brief@2x-vflfJwHyd.png",title:s.intl.formatMessage({id:"4HhApp",defaultMessage:"Creative brief"}),loggingTitle:"creative_brief",desc:s.intl.formatMessage({id:"+2jNKl",defaultMessage:"Capture project information, share deliverables, and collect targeted feedback in a single doc."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"creative-brief"},h={imageUrl:"/static/images/growth/personalization/collections_exp/Hiring_doc-vfl7-KGxC.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Hiring_doc@2x-vfltl18DZ.png",title:s.intl.formatMessage({id:"Ob69jI",defaultMessage:"Hiring doc"}),loggingTitle:"hiring_doc",desc:s.intl.formatMessage({id:"/MXP6f",defaultMessage:"Consolidate candidate data, manage interview schedules, and co-edit interview questions."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"hiring-doc"},g={imageUrl:"/static/images/growth/personalization/collections_exp/Launch_plan-vflUr4YEg.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Launch_plan@2x-vflBHVqHw.png",title:s.intl.formatMessage({id:"eJBiUX",defaultMessage:"Launch plan"}),loggingTitle:"launch_plan",desc:s.intl.formatMessage({id:"Dnp+hz",defaultMessage:"Coordinate teams by setting milestones, assigning to-dos, and managing approvals."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"launch-plan"},S={imageUrl:"/static/images/growth/personalization/collections_exp/More_templates-vflPM9mUx.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/More_templates@2x-vflu1bMcB.png",title:s.intl.formatMessage({id:"o6Oqk/",defaultMessage:"More templates"}),loggingTitle:"more_templates",desc:"",buttonText:s.intl.formatMessage({id:"SJ7MeI",defaultMessage:"See all templates"}),actionCallbackType:r.REDIRECT,redirectLink:t.PAPER_TEMPLATES_LINK},E={imageUrl:"/static/images/growth/personalization/collections_exp/New_hire_onboarding-vflhJapds.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/New_hire_onboarding@2x-vfl6PxFtO.png",title:s.intl.formatMessage({id:"ZTukLA",defaultMessage:"New hire onboarding"}),loggingTitle:"new_hire_onboarding",desc:s.intl.formatMessage({id:"eHWzWM",defaultMessage:"Centralize information to help new employees get started during their first few days."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"new-hire-onboarding"},v={imageUrl:"/static/images/growth/personalization/collections_exp/Project_plan-vfleFZaG-.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Project_plan@2x-vfl7tdW9j.png",title:s.intl.formatMessage({id:"WAEQqE",defaultMessage:"Project plan"}),loggingTitle:"project_plan",desc:s.intl.formatMessage({id:"7kQoXu",defaultMessage:"Organize and track work from start to finish. Help your team stay updated on who's doing what."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"project-plan"},T={accounting:[v,{imageUrl:"/static/images/growth/personalization/collections_exp/Team_checklist-vflYtWkbF.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Team_checklist@2x-vfl-cPX_9.png",title:s.intl.formatMessage({id:"FAZpqt",defaultMessage:"Team checklist"}),loggingTitle:"team_checklist",desc:s.intl.formatMessage({id:"k9LVWK",defaultMessage:"Manage team to-dos with task assignments, due dates, and reminder notifications."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"team-checklist"},S],human_resources:[E,h,S],self_employed:[v,_,S],marketing:[g,m,S],art:[f,{imageUrl:"/static/images/growth/personalization/collections_exp/Video_production_plan-vfltPey9e.png",imageHiResUrl:"/static/images/growth/personalization/collections_exp/Video_production_plan@2x-vflnUV7G8.png",title:s.intl.formatMessage({id:"qLearS",defaultMessage:"Video production plan"}),loggingTitle:"video_production_plan",desc:s.intl.formatMessage({id:"w4SaFl",defaultMessage:"Stay organized and on track from pre- to post-production. Add scripts, music, video, timelines, and budgets."}),buttonText:s.intl.formatMessage({id:"KLVfpZ",defaultMessage:"Create doc"}),actionCallbackType:r.CREATE_PAPER_TEMPLATE,paperTemplateSlugId:"video-production-plan"},S]};t.collectionPanelConfig=(e,t)=>{switch(t){case i.CollectionFolderType.SHARING:return{overviewDesc:s.intl.formatMessage({id:"8i5CD2",defaultMessage:"We've got ways to make sure files stay protected—however you decide to share them."}),actionsTitle:s.intl.formatMessage({id:"0Pf729",defaultMessage:"Things to try"}),actions:[l,c,d]};case i.CollectionFolderType.SPREADSHEET:return{overviewDesc:s.intl.formatMessage({id:"rKBrhz",defaultMessage:"If you work on files with other people, here’s how to prevent unwanted changes."}),actionsTitle:s.intl.formatMessage({id:"0Pf729",defaultMessage:"Things to try"}),actions:[a,o,n]};case i.CollectionFolderType.PAPER:return{overviewDesc:s.intl.formatMessage({id:"deyLLm",defaultMessage:"Here are some Dropbox Paper templates we think would be most helpful for your role."}),actionsTitle:s.intl.formatMessage({id:"JI9VaJ",defaultMessage:"Try these templates"}),actions:T[e]};case i.CollectionFolderType.FEEDBACK:return{overviewDesc:s.intl.formatMessage({id:"rwgI/k",defaultMessage:"Whether you prefer comments, requesting docs, or private feedback—these tools can help."}),actionsTitle:s.intl.formatMessage({id:"0Pf729",defaultMessage:"Things to try"}),actions:[p,c,u]};default:return}},t.overviewTitle=s.intl.formatMessage({id:"Dvwua+",defaultMessage:"Overview"})})),define("metaserver/static/js/modules/clean/react/growth/personalization/util",["require","exports","metaserver/static/js/modules/clean/react/onboarding/logging/logging","metaserver/static/js/modules/clean/growth/user_action/trackers/personalization_tracker"],(function(e,t,s,i){"use strict";var r,a,o,n,l,c;function d(e,t){var s;return!!(null===(s=null==t?void 0:t.personalization_action_to_completion_map)||void 0===s?void 0:s[e])}function u(e){return(null==e?void 0:e.firstPath)||r.NONE}function p(e,t){const s=null==t?void 0:t.desktopCtaType;if(s){return u(t)===r.DOWNLOAD_APP.valueOf()?_(e,t)?s:a.ShowWithText:s}return null}function _(e,t){return!!(null==t?void 0:t.enableDownloadAppPanel)&&e<=1}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldFirstPathHaveDropTargetIcon=t.enableCollectionsQuickActions=t.enableDownloadAppPanel=t.enableDesktopCta=t.enableInvitePanel=t.enableHideRightsideActions=t.enableHideFolderOverview=t.getSuggestedFoldersType=t.getDesktopCtaType=t.getRole=t.getFirstPath=t.getFullFunnelM2ExposureLoggingExtra=t.shouldLogFullFunnelM2SharingSnackbarExposure=t.shouldLogFullFunnelM2VideoSnackbarExposure=t.shouldEnableFullFunnelM2VideoSnackbar=t.shouldLogFullFunnelVideoSnackbarExposure=t.shouldEnableFullFunnelVideoSnackbar=t.hasDismissedCreateSuggestedFoldersTooltip=t.getCreateSuggestedFolderTooltipVariant=t.CreateSuggestedFolderTooltipVariant=t.shouldEnableFullFunnelM2SharingSnackbar=t.hasPerformedJtbdPersonalizationAction=t.hasApplicableJtbdForNextStepsOverlay=t.hasApplicableJtbdForCreateButtonTooltip=t.hasApplicableJtbdForUploadButtonTooltip=t.OnboardingSignupCTA=t.OnboardingInterest=t.SlimMode=t.emptyStateType=t.CollectionsQuickActionsRoleGroup=t.DropTargetBgColorType=t.SuggestedFoldersType=t.DesktopCtaType=t.FirstPathId=void 0,(function(e){e.INVITE_MEMBER="invite",e.UPLOAD_FOLDERS="upload",e.SUGGESTED_FOLDERS="folder",e.DOWNLOAD_APP="download",e.EXPLORE="explore",e.COLLECTIONS="collections",e.SUGGESTED_FOLDERS_ITERATION="suggested_folders_iteration",e.NONE=""})(r=t.FirstPathId||(t.FirstPathId={})),(function(e){e[e.ShowWithoutText=1]="ShowWithoutText",e[e.ShowWithText=2]="ShowWithText",e[e.ShowWithTextAsPrimary=3]="ShowWithTextAsPrimary"})(a=t.DesktopCtaType||(t.DesktopCtaType={})),(function(e){e[e.None=0]="None",e[e.SuggestedFoldersAsBar=1]="SuggestedFoldersAsBar",e[e.SuggestedFolders=2]="SuggestedFolders",e[e.SuggestedFoldersWithDismissAll=3]="SuggestedFoldersWithDismissAll"})(o=t.SuggestedFoldersType||(t.SuggestedFoldersType={})),(function(e){e[e.Blue=1]="Blue"})(t.DropTargetBgColorType||(t.DropTargetBgColorType={})),(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.ADMIN_SUPPORT=1]="ADMIN_SUPPORT",e[e.ACCOUNTING_FINANCE=2]="ACCOUNTING_FINANCE",e[e.LEGAL=3]="LEGAL",e[e.IT_INFOSEC=4]="IT_INFOSEC",e[e.ART_DESIGN_CREATIVE=5]="ART_DESIGN_CREATIVE",e[e.MARKETING=6]="MARKETING",e[e.SELF_EMPLOYED_FREELANCE=7]="SELF_EMPLOYED_FREELANCE",e[e.HR=8]="HR"})(t.CollectionsQuickActionsRoleGroup||(t.CollectionsQuickActionsRoleGroup={})),(function(e){e.DROP_TARGET_VIEW="drop_target_view",e.INVITE_VIEW="invite_view",e.SUGGESTED_FOLDERS_VIEW="suggested_folders_view",e.SUGGESTED_FOLDERS_TOGGLE_VIEW="suggested_folders_toggle_view",e.DOWNLOAD_APP_VIEW="download_app_view"})(t.emptyStateType||(t.emptyStateType={})),(function(e){e[e.None=0]="None",e[e.Slim=1]="Slim",e[e.SplitTmfTsdSlim=2]="SplitTmfTsdSlim"})(t.SlimMode||(t.SlimMode={})),(function(e){e[e.UNSET=0]="UNSET",e[e.VIDEO_SHARE=1]="VIDEO_SHARE",e[e.WORK_WITH_EXTERNAL_CLIENTS=2]="WORK_WITH_EXTERNAL_CLIENTS"})(n=t.OnboardingInterest||(t.OnboardingInterest={})),(function(e){e[e.UNSET=0]="UNSET",e[e.UPLOAD_LARGE_VIDEO_FILES=1]="UPLOAD_LARGE_VIDEO_FILES",e[e.FEEDBACK_ON_VIDEO_PROJECTS=2]="FEEDBACK_ON_VIDEO_PROJECTS",e[e.DELIVER_VIDEO_PROJECTS=3]="DELIVER_VIDEO_PROJECTS",e[e.SHARED_FILE_ACCESS_CONTROL=4]="SHARED_FILE_ACCESS_CONTROL",e[e.MANAGE_CLIENT_REVIEWS=5]="MANAGE_CLIENT_REVIEWS",e[e.BRAND_IDENTITY_WHILE_SHARING=6]="BRAND_IDENTITY_WHILE_SHARING"})(l=t.OnboardingSignupCTA||(t.OnboardingSignupCTA={})),t.hasApplicableJtbdForUploadButtonTooltip=function(e){return(null==e?void 0:e.onboarding_interest)===n.VIDEO_SHARE||(null==e?void 0:e.onboarding_interest)===n.WORK_WITH_EXTERNAL_CLIENTS&&(null==e?void 0:e.onboarding_signup_cta)===l.MANAGE_CLIENT_REVIEWS},t.hasApplicableJtbdForCreateButtonTooltip=function(e){return(null==e?void 0:e.onboarding_interest)===n.WORK_WITH_EXTERNAL_CLIENTS&&(null==e?void 0:e.onboarding_signup_cta)===l.SHARED_FILE_ACCESS_CONTROL},t.hasApplicableJtbdForNextStepsOverlay=function(e){return(null==e?void 0:e.onboarding_interest)===n.WORK_WITH_EXTERNAL_CLIENTS&&(null==e?void 0:e.onboarding_signup_cta)===l.UNSET},t.hasPerformedJtbdPersonalizationAction=d,t.shouldEnableFullFunnelM2SharingSnackbar=function(e){return"V1"===(null==e?void 0:e.full_funnel_activation_m2_variant)&&(null==e?void 0:e.onboarding_interest)===n.WORK_WITH_EXTERNAL_CLIENTS&&e.onboarding_signup_cta===l.MANAGE_CLIENT_REVIEWS},(function(e){e.VIDEO_SHARE_AND_REQUEST="videoShareAndRequest"})(c=t.CreateSuggestedFolderTooltipVariant||(t.CreateSuggestedFolderTooltipVariant={})),t.getCreateSuggestedFolderTooltipVariant=function(e){switch(e.onboarding_interest){case n.VIDEO_SHARE:return c.VIDEO_SHARE_AND_REQUEST;default:return}},t.hasDismissedCreateSuggestedFoldersTooltip=function(e){return d(i.PersonalizationActions.DISMISS_CREATE_SUGGESTED_FOLDER_TOOLTIP,e)},t.shouldEnableFullFunnelVideoSnackbar=function(e){return"V2"===(null==e?void 0:e.full_funnel_video_optimization_variant)&&(null==e?void 0:e.onboarding_interest)===n.VIDEO_SHARE},t.shouldLogFullFunnelVideoSnackbarExposure=function(e){return void 0!==(null==e?void 0:e.full_funnel_video_optimization_variant)&&["CONTROL","V2"].includes(e.full_funnel_video_optimization_variant)&&(null==e?void 0:e.onboarding_interest)===n.VIDEO_SHARE},t.shouldEnableFullFunnelM2VideoSnackbar=function(e){return"V1"===(null==e?void 0:e.full_funnel_activation_m2_variant)&&(null==e?void 0:e.onboarding_interest)===n.VIDEO_SHARE},t.shouldLogFullFunnelM2VideoSnackbarExposure=function(e){return["CONTROL","V1"].includes((null==e?void 0:e.full_funnel_activation_m2_variant)||"")&&(null==e?void 0:e.onboarding_interest)===n.VIDEO_SHARE},t.shouldLogFullFunnelM2SharingSnackbarExposure=function(e){return["CONTROL","V1"].includes((null==e?void 0:e.full_funnel_activation_m2_variant)||"")&&(null==e?void 0:e.onboarding_interest)===n.WORK_WITH_EXTERNAL_CLIENTS&&e.onboarding_signup_cta===l.MANAGE_CLIENT_REVIEWS},t.getFullFunnelM2ExposureLoggingExtra=function(e,t){return{variant:null==t?void 0:t.full_funnel_activation_m2_variant,component:e,onboarding_interest:s.getEnumKeyStringForNumberValue(n,null==t?void 0:t.onboarding_interest),onboarding_signup_cta:s.getEnumKeyStringForNumberValue(l,null==t?void 0:t.onboarding_signup_cta)}},t.getFirstPath=u,t.getRole=function(e){return(null==e?void 0:e.role)||""},t.getDesktopCtaType=p,t.getSuggestedFoldersType=function(e){return(null==e?void 0:e.suggestedFoldersType)||o.None},t.enableHideFolderOverview=function(e,t){var s;return!!(null===(s=null==t?void 0:t.hiddenState)||void 0===s?void 0:s.hideFolderOverview)&&e<=4},t.enableHideRightsideActions=function(e){var t;return!!(null===(t=null==e?void 0:e.hiddenState)||void 0===t?void 0:t.hideRightsideActions)},t.enableInvitePanel=function(e){return!!(null==e?void 0:e.enableInvitePanel)},t.enableDesktopCta=function(e,t,s){if(!p(t,s))return!1;const i=u(s);return i===r.UPLOAD_FOLDERS.valueOf()||i===r.SUGGESTED_FOLDERS.valueOf()?t>1:i!==r.INVITE_MEMBER.valueOf()||(e>1||t>1)},t.enableDownloadAppPanel=_,t.enableCollectionsQuickActions=function(e){return!!(null==e?void 0:e.enableCollectionsQuickActions)},t.shouldFirstPathHaveDropTargetIcon=function(e){return void 0!==e&&-1!==[r.COLLECTIONS.valueOf(),r.SUGGESTED_FOLDERS_ITERATION.valueOf()].indexOf(e)}})),define("metaserver/static/js/modules/clean/react/hooks/usePrevious",["require","exports","react"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.usePrevious=void 0,t.usePrevious=function(e){const t=s.useRef();return s.useEffect(()=>{t.current=e},[e]),t.current}})),define("metaserver/static/js/modules/clean/react/new_file_menu/new_file_icon",["require","exports","tslib","react","spectrum/icon_partners/index","metaserver/static/js/modules/clean/static_urls"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFileIcon=void 0,i=s.__importDefault(i);const o={dropbox_form:a.static_url("/static/images/dropbox_form-vfl1f-v2W.svg")};t.NewFileIcon=({iconName:e,displayName:t})=>{const s=o[e];return s?i.default.createElement("img",{alt:t,src:s,width:"24px",height:"24px"}):i.default.createElement(r.IconPartners,{name:e,width:"24px",height:"24px"})},t.NewFileIcon.displayName="NewFileIcon"})),define("metaserver/static/js/modules/clean/react/new_file_menu/new_file_menu",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/typography","dig-components/menu","metaserver/static/js/modules/clean/cloud_docs/constants","metaserver/static/js/modules/clean/cloud_docs/create_api","metaserver/static/js/modules/clean/react/browse/action_logger","metaserver/static/js/modules/clean/react/components/css","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/clean/react/new_file_menu/new_file_icon","metaserver/static/js/modules/clean/react/new_file_menu/new_file_util"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NewFileMenu=t.NewFileTypeRow=t.handleNewFileSelection=void 0,i=s.__importDefault(i),r=s.__importDefault(r),_=s.__importStar(_),t.handleNewFileSelection=e=>{e.handleClick()};class h extends r.default.Component{render(){return r.default.createElement(n.Menu.ActionItem,{key:this.props.item.displayName,value:this.props.item,className:this.props.item.className,withLeftAccessory:r.default.createElement(m.NewFileIcon,{displayName:this.props.item.displayName,iconName:this.props.item.iconName})},r.default.createElement(o.Text,null,this.props.item.displayName))}}t.NewFileTypeRow=h,h.displayName="NewFileTypeRow";class g extends r.default.Component{constructor(){super(...arguments),this.handleCreateNewFile=e=>()=>{const{selection_mode:t,empty_folder:s}=this.props,i=r=>{c.showAsyncFolderDialog({user:this.props.user,source:this.props.source,documentType:e,selection_mode:t,empty_folder:s,handleClickNewFolder:this.props.handleClickNewFolder?this.props.handleClickNewFolder(this.props.user,i):void 0,initialPath:r})};d.logFileCreateClick({uid:this.props.user.id,source:this.props.source,action:f.newFileTypeToLogEvent(e),depth_folder_selected:this.props.path?c.getDepthFromPath(this.props.path):void 0,selection_mode:t,empty_folder:s}),this.props.path?c.createNewFile({user:this.props.user,path:this.props.path,documentType:e,source:this.props.source,selection_mode:t,empty_folder:s}):i()},this.logTriggerClick=()=>{const{empty_folder:e,selection_mode:t,path:s,user:i,source:r}=this.props;d.logFileCreateClick({uid:i.id,source:r,action:p.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU,depth_folder_selected:s?c.getDepthFromPath(s):void 0,selection_mode:t,empty_folder:e})}}getNewFileTypeSections(){const e=[],t=[];this.props.showPaper&&(t.push({displayName:f.NewPaperDocLabel,iconName:"dropbox_paper",className:"action-create-file-paper-doc",handleClick:this.handleCreateNewFile(l.PaperNewFileTypes.PAPER)}),t.push({displayName:f.NewPaperTemplateLabel,iconName:"dropbox_paper_template",className:"action-create-file-paper-template",handleClick:this.handleCreateNewFile(l.PaperNewFileTypes.PAPER_TEMPLATE)})),this.props.showBinder&&t.push({displayName:f.NewPaperBinderDocLabel,iconName:"dropbox_paper_binder",className:"action-create-file-paper-binder",handleClick:this.handleCreateNewFile(l.PaperNewFileTypes.PAPER_BINDER)}),t.push({displayName:f.NewSimplePointerLabel,iconName:"shortcut",className:"action-create-simple-pointer",handleClick:this.handleCreateNewFile(l.PointerFileTypes.SIMPLE_POINTER)}),t.length>0&&e.push(t);const s=[];if(s.push({displayName:f.NewMicrosoftWordDocLabel,iconName:"microsoft_docx",className:"action-create-file-word",handleClick:this.handleCreateNewFile(l.MicrosoftFileTypes.WORD)}),s.push({displayName:f.NewMicrosoftExcelWorkbookLabel,iconName:"microsoft_xlsx",className:"action-create-file-excel",handleClick:this.handleCreateNewFile(l.MicrosoftFileTypes.EXCEL)}),s.push({displayName:f.NewMicrosoftPowerPointPresentationLabel,iconName:"microsoft_pptx",className:"action-create-file-powerpoint",handleClick:this.handleCreateNewFile(l.MicrosoftFileTypes.POWERPOINT)}),e.push(s),this.props.showGdd){const t=[];t.push({displayName:f.NewGoogleDocsLabel,iconName:"google_gdoc",className:"action-create-file-google-doc",handleClick:this.handleCreateNewFile(l.GoogleFileTypes.GOOGLE_DSS_DOC)}),t.push({displayName:f.NewGoogleSheetsLabel,iconName:"google_gsheet",className:"action-create-file-google-sheet",handleClick:this.handleCreateNewFile(l.GoogleFileTypes.GOOGLE_DSS_SHEET)}),t.push({displayName:f.NewGoogleSlidesLabel,iconName:"google_gslides",className:"action-create-file-google-slides",handleClick:this.handleCreateNewFile(l.GoogleFileTypes.GOOGLE_DSS_SLIDES)}),e.push(t)}return e}renderTrigger(e){const t=0===_.USER_LOCALE.indexOf("en")||this.props.forceLongLabel?f.LongNewFileCreateLabel:f.ShortNewFileCreateLabel,s=Object.assign(Object.assign({},e),{disabled:this.props.disabled,className:i.default("primary-action-menu__button","action-create-file"),variant:this.props.enableSecondary?"opacity":"primary"});return r.default.createElement(a.Button,Object.assign({key:f.LongNewFileCreateLabel,withDropdownIcon:!0},s),t)}renderSection(e,t){return r.default.createElement(n.Menu.Segment,{key:t},e.map(e=>r.default.createElement(h,{item:e,key:e.displayName})))}render(){const e=this.getNewFileTypeSections();return r.default.createElement(n.Menu.Wrapper,{onToggle:this.logTriggerClick,onSelection:t.handleNewFileSelection},({getContentProps:t,getTriggerProps:s})=>r.default.createElement(r.default.Fragment,null,this.renderTrigger(s()),r.default.createElement(n.Menu.Content,Object.assign({},t()),e.map(this.renderSection))))}}g.defaultProps={},g.displayName="NewFileMenu";const S=u.requireCssWithComponent(g,["/static/css/dig-components/index.web-vfl0pq0Fh.css","/static/css/cloud_docs/create_pointer_modal-vflATc8Dt.css"]);t.NewFileMenu=S})),define("metaserver/static/js/modules/clean/react/new_file_menu/new_file_util",["require","exports","metaserver/static/js/modules/clean/cloud_docs/constants","metaserver/static/js/modules/clean/web_user_action_events","metaserver/static/js/modules/core/i18n"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newFileTypeToLogEvent=t.NewSimplePointerLabel=t.NewPaperBinderDocLabel=t.NewPaperTemplateLabel=t.NewPaperDocLabel=t.NewMicrosoftWordDocLabel=t.NewMicrosoftPowerPointPresentationLabel=t.NewMicrosoftExcelWorkbookLabel=t.NewGoogleSlidesLabel=t.NewGoogleSheetsLabel=t.NewGoogleDocsLabel=t.ShortNewFileCreateLabel=t.LongNewFileCreateLabel=void 0,t.LongNewFileCreateLabel=r.intl.formatMessage({id:"8/w9ir",defaultMessage:"Create new file"}),t.ShortNewFileCreateLabel=r.intl.formatMessage({id:"o96TiK",defaultMessage:"Create"}),t.NewGoogleDocsLabel=r.intl.formatMessage({id:"+HsOFj",defaultMessage:"Google Docs"}),t.NewGoogleSheetsLabel=r.intl.formatMessage({id:"cpuRML",defaultMessage:"Google Sheets"}),t.NewGoogleSlidesLabel=r.intl.formatMessage({id:"PcJCVL",defaultMessage:"Google Slides"}),t.NewMicrosoftExcelWorkbookLabel=r.intl.formatMessage({id:"0rYKaW",defaultMessage:"Excel Workbook"}),t.NewMicrosoftPowerPointPresentationLabel=r.intl.formatMessage({id:"e9uLbL",defaultMessage:"PowerPoint Presentation"}),t.NewMicrosoftWordDocLabel=r.intl.formatMessage({id:"yY5byF",defaultMessage:"Word Document"}),t.NewPaperDocLabel=r.intl.formatMessage({id:"neBk7u",defaultMessage:"Dropbox Paper"}),t.NewPaperTemplateLabel=r.intl.formatMessage({id:"Rvv7NR",defaultMessage:"Dropbox Paper Template"}),t.NewPaperBinderDocLabel=r.intl.formatMessage({id:"sbO30Y",defaultMessage:"Dropbox Binder (Beta)"}),t.NewSimplePointerLabel=r.intl.formatMessage({id:"4gEt6j",defaultMessage:"Shortcut"}),t.newFileTypeToLogEvent=e=>{switch(e){case s.MicrosoftFileTypes.WORD:return i.WebUserActionLogEvent.FILE_CREATE_WORD;case s.MicrosoftFileTypes.EXCEL:return i.WebUserActionLogEvent.FILE_CREATE_EXCEL;case s.MicrosoftFileTypes.POWERPOINT:return i.WebUserActionLogEvent.FILE_CREATE_POWERPOINT;case s.GoogleFileTypes.GOOGLE_DSS_DOC:return i.WebUserActionLogEvent.FILE_CREATE_GOOGLE_DOC;case s.GoogleFileTypes.GOOGLE_DSS_SHEET:return i.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SHEET;case s.GoogleFileTypes.GOOGLE_DSS_SLIDES:return i.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SLIDES;case s.PaperNewFileTypes.PAPER:return i.WebUserActionLogEvent.FILE_CREATE_PAPER;case s.PaperNewFileTypes.PAPER_TEMPLATE:return i.WebUserActionLogEvent.FILE_CREATE_PAPER_TEMPLATE;case s.PaperNewFileTypes.PAPER_BINDER:return i.WebUserActionLogEvent.FILE_CREATE_BINDER;case s.PointerFileTypes.SIMPLE_POINTER:return i.WebUserActionLogEvent.FILE_CREATE_SIMPLE_POINTER}}})),define("metaserver/static/js/modules/clean/react/path_breadcrumbs",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/menu","dig-components/typography","spectrum/icon_content/index","metaserver/static/js/modules/clean/em_string","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/icon/icon_helper","metaserver/static/js/modules/clean/react/title_bubble","metaserver/static/js/modules/clean/user_education/react/user_education_effect","metaserver/static/js/modules/clean/web_timing_logger","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/react/sticky_position","metaserver/static/js/modules/clean/react/flows/components/badge_async","metaserver/static/js/modules/clean/pnm/utils"],(function(e,t,s,i,r,a,o,n,l,c,d,u,p,_,m,f,h,g,S,E,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BreadcrumbMenuItem=t.BreadcrumbSegment=t.PathBreadcrumbs=t.PathBreadcrumbsSize=t.generateBreadcrumbData=void 0,i=s.__importDefault(i),r=s.__importDefault(r),n=s.__importStar(n),p=s.__importStar(p);function T(e,t,s=20){return s-(t?2.625:new u.Emstring(e).length)}function b(e,t,s,i,r=20,a){const o=null!=a?a:"",n=e.substring(o.length).split("/").filter(Boolean),l=[{path:o,icon:"folder_dropbox-small",folderName:t,alt:s}],c=_.spectrumFolderIcon({size:_.SpectrumIconSize.Small});for(let t=0;t<n.length;t++)e=`${o}/${n.slice(0,t+1).join("/")}`,l.push({path:e,folderName:v.getDisplayedFilename(p.filename(e)),icon:c,alt:g.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"})});if(l.length<3)return{dropdownCrumbs:[],inlineCrumbs:l,root:l[0]};const d=T(l[0]&&l[0].folderName||"",!1,r),m=l.map(e=>new u.Emstring(e.folderName||"").length);let f=1,h=m[l.length-1];for(let e=l.length-2;e>=1&&(h+=1.64,h+=m[e],!(h>d));e--)f+=1;l.length===f+1&&(f+=1),1===f&&i===I.SMALL&&f++;const S=l.length-f;return{dropdownCrumbs:l.slice(0,S),inlineCrumbs:l.slice(S),root:l[0]}}var I;t.generateBreadcrumbData=b,(function(e){e.LARGE="LARGE",e.SMALL="SMALL"})(I=t.PathBreadcrumbsSize||(t.PathBreadcrumbsSize={}));class w extends r.default.PureComponent{constructor(e){super(e),this._breadcrumbContainerElement=null,this._flowsBadgeElement=null,this.resizeListener=()=>{const e=this.getBreadcrumbsContainerSpan();if(e){let t=e.getBoundingClientRect().width;if(this.props.mobileWebInvites&&(t-=20),this.props.flowsFolderRule){const e=this.getFlowsBadgeSpan(),s=16;t-=e?e.getBoundingClientRect().width+s:0}const s=Math.max(0,this.getMaxWidthInEm(t));s!==this.state.maxWidthInEm&&s>0&&this.setState({maxWidthInEm:s})}},this.handleTitleClick=e=>t=>{const s=e.path;if(0===t.button){if(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)return void t.stopPropagation();t.preventDefault(),t.stopPropagation(),this.props.setUrl({path:s})}};const t=this.getBreadcrumbsContainerSpan();this.state={maxWidthInEm:t?this.getMaxWidthInEm(t.getBoundingClientRect().width):20}}getBreadcrumbsContainerSpan(){if(!this._breadcrumbContainerElement){const e=document.getElementsByClassName("maestro-app-content");e&&1===e.length&&(this._breadcrumbContainerElement=e[0])}return this._breadcrumbContainerElement}getFlowsBadgeSpan(){const e=document.querySelector(".flows-badge");return!this._flowsBadgeElement&&e&&(this._flowsBadgeElement=e),this._flowsBadgeElement}getMaxWidthInEm(e){return(e-100)/22}componentDidMount(){window.addEventListener("resize",this.resizeListener),h.waitForTTI().then(()=>this.resizeListener())}componentWillUnmount(){window.removeEventListener("resize",this.resizeListener)}componentDidUpdate(e){e.mobileWebInvites!==this.props.mobileWebInvites&&this.resizeListener()}render(){const e=this.props.path,{firstBreadcrumbName:t,firstBreadcrumbAlt:s,firstBreadcrumbPath:a,shouldHighlightDropTargets:o,setFileUploaderPath:n,getUrlForPath:l,setUrl:d,size:u,enableDragging:_,flowsFolderRule:m,expFlowsAutomatedFolderUI:h}=this.props,S=this.state.maxWidthInEm?this.state.maxWidthInEm:20,{dropdownCrumbs:v,inlineCrumbs:w,root:O}=b(e,t,s,u,S,a),R=T(O&&O.folderName||"",v.length>0,S),A=i.default({"brws-path-breadcrumbs":!0,"brws-path-breadcrumbs--small":this.props.size===I.SMALL});if(w.length>1||v.length>0)return r.default.createElement("span",{className:A},r.default.createElement("h1",{className:"ax-visually-hidden"},p.filename(e)),r.default.createElement("nav",{className:"page-header-text u-l-fl",id:"path-breadcrumbs","aria-label":g.intl.formatMessage({id:"SzftTr",defaultMessage:"Folder hierarchy"}),role:"navigation"},v.length>0&&r.default.createElement(F,{crumbs:v,currentPath:e,shouldHighlightDropTargets:o,setFileUploaderPath:n,setUrl:d,enableDragging:!!_,onTitleClick:this.handleTitleClick,getUrlForPath:l}),w.map((t,s)=>r.default.createElement(C,Object.assign({},t,{key:encodeURI(t.path),isOnlyCrumb:0===s&&1===w.length&&0===v.length,index:s,isLastCrumb:s===w.length-1,maxWidth:R,currentPath:e,shouldHighlightDropTargets:o,setFileUploaderPath:n,getUrlForPath:l,setUrl:d,size:u,enableDragging:!!_,onTitleClick:this.handleTitleClick(t)})))),!!m&&r.default.createElement(E.AsyncBadgeComponent,{type:m,isInUnifiedModal:!!h,isFolderFocused:!0}));{const e=u===I.SMALL?c.Text:c.Title,s=u===I.SMALL?"small":"standard";return r.default.createElement(f.UserEducationEffect,{containerName:"PathBreadcrumbs",name:"HomeTitle",useSpan:!0},r.default.createElement(e,{size:s,className:"page-header-text"},t))}}}t.PathBreadcrumbs=w,w.defaultProps={path:"/",shouldHighlightDropTargets:!1,setFileUploaderPath:()=>{},size:I.LARGE,enableDragging:!1},w.displayName="PathBreadcrumbs";class C extends r.default.Component{constructor(e){super(e),this.handleDragEnter=e=>{e.preventDefault(),e.target!==this.lastEnteredElement&&this.props.enableDragging&&(this.lastEnteredElement=e.target,this.dragEnterCount+=1,this.setState({isDraggedOver:!0}),this.props.isLastCrumb||this.props.setFileUploaderPath({path:this.props.path,targetSurface:"breadcrumb"}))},this.handleDragLeave=e=>{e.preventDefault(),this.props.enableDragging&&(this.lastEnteredElement=null,this.dragEnterCount-=1,this.dragEnterCount<1&&(this.dragEnterCount=0,this.state.isDraggedOver&&(this.props.setFileUploaderPath({path:this.props.currentPath}),this.setState({isDraggedOver:!1}))))},this.handleDrop=()=>{this.setState({isDraggedOver:!1})},this.handleDragOver=e=>{e.preventDefault(),e.stopPropagation()},this.handleMouseEnter=()=>{this.props.enableDragging||this.setState({isDraggedOver:!0})},this.handleMouseLeave=()=>{this.state.isDraggedOver&&this.setState({isDraggedOver:!1})},this.handleMouseUp=()=>{this.state.isDraggedOver&&this.setState({isDraggedOver:!1})},this.eventHandlers={onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,onDragOver:this.handleDragOver,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp},this.state={isDraggedOver:!1}}componentDidMount(){this.dragEnterCount=0,this.lastEnteredElement=null}render(){const{getUrlForPath:e,path:t,index:s,isOnlyCrumb:a,maxWidth:l,isLastCrumb:d,shouldHighlightDropTargets:p,size:_}=this.props,h=a?this.props.folderName:u.Emstring.em_snippet(this.props.folderName,l),g={"breadcrumb-segment":!0,"breadcrumb-text-dragged-over":!d&&p&&this.state.isDraggedOver},E=_===I.SMALL?c.Text:c.Title,v=_===I.SMALL?"small":"standard";let T;return T=d?r.default.createElement(E,Object.assign({size:v,"aria-current":"page"},this.eventHandlers,{"data-testid":"breadcrumb-segment"}),h):r.default.createElement("span",Object.assign({className:"breadcrumb-segment__wrapper"},this.eventHandlers),r.default.createElement(f.UserEducationEffect,{containerName:"BreadcrumbSegment",name:`link-${s}`,useSpan:!0},r.default.createElement(E,{size:v,color:"faint"},r.default.createElement("a",{href:e(t).toString(),onClick:this.props.onTitleClick,className:i.default(g),"data-testid":"breadcrumb-segment"},h),r.default.createElement(o.UIIcon,{src:n.ChevronRightLine,size:"small",className:"breadcrumb__spacer"})))),this.props.folderName!==h?r.default.createElement(m.TitleBubble,{content:this.props.folderName,position:S.StickyPosition.BOTTOM,className:"list-label__title-bubble"},T):T}}t.BreadcrumbSegment=C,C.defaultProps={isOnlyCrumb:!1,shouldHighlightDropTargets:!1,disableDragging:!1},C.displayName="BreadcrumbSegment";class O extends r.default.Component{constructor(e){super(e),this.handleDragEnter=e=>{e.preventDefault(),e.target!==this.lastEnteredElement&&this.props.enableDragging&&(this.lastEnteredElement=e.target,this.dragEnterCount+=1,this.setState({isDraggedOver:!0}),this.props.setFileUploaderPath({path:this.props.path,targetSurface:"breadcrumb"}))},this.handleDragLeave=e=>{e.preventDefault(),this.props.enableDragging&&(this.lastEnteredElement=null,this.dragEnterCount-=1,this.dragEnterCount<1&&(this.dragEnterCount=0,this.state.isDraggedOver&&(this.props.setFileUploaderPath({path:this.props.currentPath}),this.setState({isDraggedOver:!1}))))},this.handleDrop=e=>{this.setState({isDraggedOver:!1}),this.dragEnterCount=0,this.props.onClose()},this.handleDragOver=e=>{e.preventDefault(),e.stopPropagation()},this.handleMouseEnter=()=>{this.props.enableDragging&&this.setState({isDraggedOver:!0})},this.handleMouseLeave=()=>{this.state.isDraggedOver&&(this.setState({isDraggedOver:!1}),this.props.onClose())},this.handleMouseUp=()=>{this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.enableDragging&&!this.props.isLastCrumb&&this.props.onClose()},this.state={isDraggedOver:!1}}componentDidMount(){this.dragEnterCount=0,this.lastEnteredElement=null}render(){const{icon:e,alt:t,folderName:s}=this.props,a={"breadcrumb-text-dragged-over":this.state.isDraggedOver};return r.default.createElement(l.Menu.LinkItem,{href:this.props.href,onClick:this.props.onCrumbClick,className:i.default(a),withLeftAccessory:r.default.createElement(d.IconContent,{name:e,"aria-label":t,role:"img",className:"breadcrumb-menu-item-icon"}),onDragEnter:this.handleDragEnter,onDragLeave:this.handleDragLeave,onDrop:this.handleDrop,onDragOver:this.handleDragOver,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp},u.Emstring.em_snippet(s,20))}}t.BreadcrumbMenuItem=O,O.defaultProps={isHighlightedDropTarget:!1,onClose(){},alt:"",disableDragging:!1},O.displayName="BreadcrumbMenuItem";class F extends r.default.Component{constructor(){super(...arguments),this.state={menuVisible:!1},this.handleDragOver=e=>t=>{this.props.enableDragging&&(t.preventDefault(),e({autoFocus:!1}),this.setState({menuVisible:!0}))},this.handleInnerDragEnter=e=>{e.preventDefault(),this.dragEnterCount++},this.handleDragLeave=e=>t=>{t.preventDefault(),this.dragEnterCount--,this.dragEnterCount<1&&(this.dragEnterCount=0,this.state.menuVisible&&(this.setState({menuVisible:!1}),e({autoFocus:!1})))},this.handleMouseEnter=e=>t=>{this.props.enableDragging&&(t.preventDefault(),this.setState({menuVisible:!0}),e({autoFocus:!1}))},this.handleCrumbSelected=e=>{this.props.setUrl({path:e})},this.handlePopoverToggle=({isOpen:e})=>{this.setState({menuVisible:e})},this.handleClose=()=>{this.dragEnterCount=0,this.handlePopoverToggle({isOpen:!1})}}componentDidMount(){this.dragEnterCount=0}render(){const e=[...this.props.crumbs].reverse(),{currentPath:t,shouldHighlightDropTargets:s,setFileUploaderPath:i,enableDragging:u,onTitleClick:p}=this.props,_=g.intl.formatMessage({id:"JY5LSc",defaultMessage:"Show parent folders (descending)"});return r.default.createElement(r.default.Fragment,null,r.default.createElement(l.Menu.Wrapper,{onSelection:this.handleCrumbSelected,shouldPropagateClickOutsideMouseEvents:!0,className:"breadcrumb-menu-wrapper"},({getContentProps:o,getTriggerProps:n,openMenu:c,closeMenu:m})=>r.default.createElement(r.default.Fragment,null,r.default.createElement(a.IconButton,Object.assign({variant:"transparent",onDragOver:this.handleDragOver(c),onMouseEnter:this.handleMouseEnter(c)},n()),r.default.createElement(d.IconContent,{name:"folder_dropdown-small","aria-label":_,role:"img",className:"breadcrumb-menu-icon"})),r.default.createElement(l.Menu.Content,Object.assign({},o(),{onDragEnter:this.handleInnerDragEnter,onDragLeave:this.handleDragLeave(m)}),r.default.createElement(l.Menu.Segment,null,e.map(e=>r.default.createElement(O,{key:encodeURI(e.path),path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:t,isHighlightedDropTarget:s,setFileUploaderPath:i,onClose:this.handleClose,enableDragging:u,onCrumbClick:p(e),href:this.props.getUrlForPath(e.path).toString()})))))),r.default.createElement(c.Text,{color:"faint",className:"breadcrumb-menu-icon-parent"},r.default.createElement(o.UIIcon,{src:n.ChevronRightLine,className:"breadcrumb__spacer",size:"small"})))}}F.defaultProps={shouldHighlightDropTargets:!1},F.displayName="BreadcrumbMenu"})),define("metaserver/static/js/modules/clean/react/share_download/api",["require","exports","tslib","metaserver/static/js/modules/clean/deprecated_ajax/ajax_as_promised_jquery"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDownloadUrl=t.testDownload=t.TooLargeError=t.DownloadError=void 0,i=s.__importStar(i);class r extends class{constructor(e){this.message=e}}{}t.DownloadError=r;class a extends r{}t.TooLargeError=a,t.testDownload=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){let s;try{s=yield i.SilentBackgroundRequest({url:e,data:{rlkey:t}})}catch(e){throw new r}if("OK"!==s)throw 0===s.indexOf("err:")?new a:new r}))},t.fetchDownloadUrl=function(e,t,s){return i.SilentBackgroundRequest({url:"/sharing/fetch_user_content_link",data:{url:e,rlkey:t,origin:s}})}})),define("metaserver/static/js/modules/clean/redux/tests/store",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mockExtraArguments=void 0,t.mockExtraArguments=()=>({})})),define("metaserver/static/js/modules/clean/react/upload_kit/lib/processors",["require","exports","tslib","metaserver/static/js/modules/clean/react/upload_kit/lib/types","metaserver/static/js/modules/clean/react/upload_kit/utils/makers","metaserver/static/js/modules/clean/react/upload_kit/utils/path","metaserver/static/js/modules/clean/react/upload_kit/utils/file","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/core/uri"],(function(e,t,s,i,r,a,o,n,l){"use strict";function c(e){return s.__awaiter(this,void 0,void 0,(function*(){return e.map(([e,t])=>r.makeFileUploadItem(e,i.isWebkitFile(e)&&""!==e.webkitRelativePath?e.webkitRelativePath:e.name,t))}))}function d(e,t,s){return Promise.resolve([r.makeFileUploadItem(e,t,s)])}function u(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const i=yield Promise.all(e.map(e=>s.__awaiter(this,void 0,void 0,(function*(){if(null==e?void 0:e.isFile){const s=yield o.getFile(e);return[r.makeFileUploadItem(s,a.getDestPath(e),t)]}if(null==e?void 0:e.isDirectory){const s=e;return u(yield p(s),t)}return null})))),n=[];return i.forEach(e=>{e&&n.push(...e)}),n}))}function p(e){return s.__awaiter(this,void 0,void 0,(function*(){return(function e(t){return s.__awaiter(this,void 0,void 0,(function*(){return new Promise((i,r)=>t.readEntries(r=>s.__awaiter(this,void 0,void 0,(function*(){r.length>0?i([...r,...yield e(t)]):i(r)})),e=>r(e)))}))})(e.createReader())}))}function _(e){const t={};return e.map(e=>n.parent_dir(e.destPath)).forEach(e=>{""!==e&&"/"!==e&&(t[e]=e)}),Object.keys(t).map(e=>r.makeDirectoryUploadItem(e))}function m(e){const t={};return e.forEach(e=>{n.parent_dirs(e.destPath).forEach(e=>{""!==e&&"/"!==e&&(t[e]=e)})}),Object.keys(t).map(e=>r.makeDirectoryUploadItem(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.processFilesWithRenamingRecursive=t.processFilesWithRenaming=t.resolveDuplicates=t.collectDirectoriesRecursive=t.collectDirectories=t.readDirectory=t.preprocessFileSystemEntries=t.preprocessDataTransfer=t.preprocessDropboxFiles=t.preprocessBlob=t.preprocessFiles=void 0,t.preprocessFiles=c,t.preprocessBlob=d,t.preprocessDropboxFiles=function(e){return s.__awaiter(this,void 0,void 0,(function*(){return e.map(([e,t])=>r.makeChooserUploadItem(e,t))}))},t.preprocessDataTransfer=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const{files:s,items:i,types:r}=e;if(r&&r.length>0&&-1===r.indexOf("Files")){const s=o.getDataTransferUrl(e),i=l.URI.parse(s).getAuthority();return d(o.makeLinkBlob(s),`#${i}.url`,t)}if(i&&i.length>0&&i[0]&&i[0].webkitGetAsEntry)return u(Array.from(i).map(e=>e.webkitGetAsEntry()),t);if(s&&s.length>0){return c(Array.from(s).map(e=>[e,t||{}]))}return Promise.resolve([])}))},t.preprocessFileSystemEntries=u,t.readDirectory=p,t.collectDirectories=_,t.collectDirectoriesRecursive=m,t.resolveDuplicates=(e,t=[])=>{const s=new Set,i=new Set,r=[];return t&&t.forEach(e=>{i.add(e.id),s.add(a.getNameAtRoot(e.destPath).toLowerCase())}),e.forEach(e=>{if(i.has(e.id))return;const t=-1!==e.destPath.indexOf("/");let o,l=1,c=a.getNameAtRoot(e.destPath);const d=n.split_filename(c);if(s.has(c.toLowerCase()))do{o=`${d.name} (${l})`,c=d.ext?`${o}.${d.ext}`:o,l++}while(s.has(c.toLowerCase()));if(t){const t=e.destPath.split("/");t[0]=c,e.destPath=t.join("/")}else e.destPath=c;i.add(e.id),s.add(e.destPath.toLowerCase()),r.push(e)}),r},t.processFilesWithRenaming=(e,s,i)=>Promise.resolve(t.resolveDuplicates(e,i)).then(e=>({errors:s,items:e.concat(_(e))})),t.processFilesWithRenamingRecursive=(e,s,i)=>Promise.resolve(t.resolveDuplicates(e,i)).then(e=>({errors:s,items:e.concat(m(e))}))})),define("metaserver/static/js/modules/clean/react/upload_kit/lib/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadErrorType=t.UploadStatus=t.FileSource=t.isChooserFile=t.isWebkitFile=void 0,t.isWebkitFile=e=>"webkitRelativePath"in e,t.isChooserFile=e=>"bytes"in e,(function(e){e.Dropbox="dropbox",e.Computer="computer",e.Server="server"})(t.FileSource||(t.FileSource={})),(function(e){e.Staged="staged",e.Queued="queued",e.Uploading="uploading",e.Success="success",e.Error="error",e.Cancelling="cancelling"})(t.UploadStatus||(t.UploadStatus={})),(function(e){e.CloudDoc="cloud_doc",e.EmptyFile="empty_file",e.IgnoredFile="ignored_file",e.OverMaxFileSize="over_max_file_size",e.PointerFile="pointer_file",e.TemporaryFile="temporary_file",e.InvalidChar="invalid_char",e.NotFound="not_found",e.NoPermission="no_permission",e.Restricted="restricted",e.InvalidArgs="invalid_args",e.Unknown="unknown"})(t.UploadErrorType||(t.UploadErrorType={}))})),define("metaserver/static/js/modules/clean/react/upload_kit/lib/upload_block",["require","exports","metaserver/static/js/modules/clean/csrf","metaserver/static/js/modules/core/uri"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadBlock=void 0,t.uploadBlock=(e,t,r,a)=>{const o=new i.URI({scheme:"https",authority:"dl-web.dropbox.com",path:"/put_block_returning_token",query:{owner_id:e.toString(),_subject_uid:e.toString(),t:s.readCsrfToken()||"",reported_block_size:a.size.toString(),num_blocks:Math.ceil(r/a.size).toString(),ns_id_for_routing:t.toString()}});return new Promise((e,t)=>{const s=new XMLHttpRequest;return s.withCredentials=!0,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE)if(200===s.status){const i=JSON.parse(s.responseText);i.token?e(i.token):t("Server token empty or undefined error.")}else t(`Server error ${s.status}`)},s.open("POST",o.toString(),!0),s.setRequestHeader("Content-Type","application/octet-stream"),s.send(a),s})}})),define("metaserver/static/js/modules/clean/react/upload_kit/uploader/async_controller",["require","exports","tslib"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncUploadController=void 0;t.AsyncUploadController=class{constructor(e){var{onLoaded:t}=e,i=s.__rest(e,["onLoaded"]);this.onLoaded=t,this.controllerProps=i}get(){return this.promise||(this.promise=new Promise(t=>s.__awaiter(this,void 0,void 0,(function*(){const{UploadController:i}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/upload_kit/uploader/controller"],t,s)}).then(s.__importStar),r=new i(this.controllerProps);this.onLoaded(r),t(r)})))),this.promise}}})),define("metaserver/static/js/modules/clean/react/upload_kit/uploader/context",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/components/helpers","metaserver/static/js/modules/clean/react/upload_kit/uploader/async_controller","metaserver/static/js/modules/clean/react/upload_kit/lib/processors"],(function(e,t,s,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withUploadConsumer=t.UploadConsumer=t.withCustomUploadProvider=t.UploadProvider=void 0;const n=(i=s.__importDefault(i)).default.createContext({});let l=0;class c extends i.default.PureComponent{constructor(e){super(e),this.fileField=i.default.createRef(),this.folderField=i.default.createRef(),this.chooseHandled=new Set,this.state={uploadItems:[],isUploading:!1},this.setInitialUploadedItems=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).setInitialUploadedItems(...e)})),this.cancelUploadItem=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).cancelUploadItem(...e)})),this.chooseFiles=()=>s.__awaiter(this,void 0,void 0,(function*(){const e=this.fileField?this.fileField.current:null;return this.chooseLocalFiles(e)})),this.chooseFolder=()=>s.__awaiter(this,void 0,void 0,(function*(){const e=this.folderField?this.folderField.current:null;return this.chooseLocalFiles(e)})),this.chooseLocalFiles=(function(e,t=100){let s;return(...i)=>(s||(s=e(...i),setTimeout(()=>{s=void 0},t)),s)})((e=null)=>(this.asyncController.get(),new Promise((t,i)=>{if(!e)return void i();e.dataset.uploadKitId||(e.dataset.uploadKitId=String(l++));const r=e.dataset.uploadKitId,a=()=>s.__awaiter(this,void 0,void 0,(function*(){if(this.chooseHandled.delete(r),e.removeEventListener("change",a),e.files)try{const s=yield this.asyncController.get(),i=yield s.addFiles(Array.from(e.files));t(i)}catch(e){i(e)}else i()}));this.chooseHandled.has(r)||(this.chooseHandled.add(r),e.addEventListener("change",a)),e.value="",e.click()}))),this.chooseDropboxFiles=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).chooseDropboxFiles(...e)})),this.handleDrop=(e,t)=>s.__awaiter(this,void 0,void 0,(function*(){if(!e)return Promise.reject();const[s,i]=yield Promise.all([o.preprocessDataTransfer(e,{parentPath:t}),this.asyncController.get()]);return i.addUploadItems(s)})),this.makeDirectory=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).makeDirectory(...e)})),this.moveUploadItem=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).moveUploadItem(...e)})),this.removeUploadItem=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).removeUploadItem(...e)})),this.renameUploadItem=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).renameUploadItem(...e)})),this.startUploading=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).startUploading(...e)})),this.stopUploading=(...e)=>s.__awaiter(this,void 0,void 0,(function*(){return(yield this.asyncController.get()).stopUploading(...e)})),this.asyncController=new a.AsyncUploadController(Object.assign(Object.assign({},e),{onLoaded:e=>{this.subscription=e=>{this.setState(e)},e.subscribe(this.subscription)}}))}componentWillUnmount(){return s.__awaiter(this,void 0,void 0,(function*(){if(this.subscription){(yield this.asyncController.get()).unsubscribe(this.subscription)}}))}render(){const{children:e,fileExtensions:t,selectMultiple:s}=this.props,r=Object.assign(Object.assign({},this.state),{setInitialUploadedItems:this.setInitialUploadedItems,cancelUploadItem:this.cancelUploadItem,chooseFiles:this.chooseFiles,chooseFolder:this.chooseFolder,chooseDropboxFiles:this.chooseDropboxFiles,handleDrop:this.handleDrop,makeDirectory:this.makeDirectory,moveUploadItem:this.moveUploadItem,removeUploadItem:this.removeUploadItem,renameUploadItem:this.renameUploadItem,startUploading:this.startUploading,stopUploading:this.stopUploading});return i.default.createElement(n.Provider,{value:r},e,i.default.createElement("input",{type:"file",ref:this.fileField,id:"uploader-file-field",style:{display:"none"},multiple:!!s,accept:t?t.join(","):void 0}),i.default.createElement("input",Object.assign({type:"file",ref:this.folderField,id:"uploader-folder-field",style:{display:"none"}},{webkitdirectory:""})))}}t.UploadProvider=c,c.displayName="UploadProvider",t.withCustomUploadProvider=function(e,t){const s=s=>i.default.createElement(t,Object.assign({},s),i.default.createElement(e,Object.assign({},s)));return s.displayName=`withCustomUploadProvider(${r.getDisplayName(e)}, ${r.getDisplayName(t)})`,s},t.UploadConsumer=n.Consumer,t.withUploadConsumer=function(e){const s=s=>i.default.createElement(t.UploadConsumer,null,t=>i.default.createElement(e,Object.assign({},s,t)));return s.displayName=`WithUploadConsumer(${r.getDisplayName(e)})`,s}})),define("metaserver/static/js/modules/clean/react/upload_kit/utils/file",["require","exports","tslib","metaserver/static/js/modules/clean/react/upload_kit/lib/types"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeLinkBlob=t.getDataTransferUrl=t.getSize=t.getFile=void 0,t.getFile=e=>s.__awaiter(void 0,void 0,void 0,(function*(){return new Promise(t=>e.file(e=>t(e)))})),t.getSize=e=>e?i.isChooserFile(e)?e.bytes:e.size:0,t.getDataTransferUrl=function(e){let t;return t=e.getData("Url")||e.getData("text/x-moz-url")||e.getData("text/uri-list")||"",t=t.split("\n")[0],t},t.makeLinkBlob=function(e){return new Blob([`[InternetShortcut]\r\nURL=${e}\r\n`],{type:"text/plain"})}})),define("metaserver/static/js/modules/clean/react/upload_kit/utils/makers",["require","exports","metaserver/static/js/modules/clean/react/upload_kit/lib/types","metaserver/static/js/modules/clean/uuid/uuid"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeChooserUploadItem=t.makeDirectoryUploadItem=t.makeFileUploadItem=void 0,t.makeFileUploadItem=function(e,t,r){return Object.assign(Object.assign({},r),{bytes:e.size,bytesUploaded:0,destPath:t,file:e,id:i.UUID.v4(),isDir:!1,source:s.FileSource.Computer,status:s.UploadStatus.Staged})},t.makeDirectoryUploadItem=function(e){return{bytes:0,bytesUploaded:0,destPath:e,id:i.UUID.v4(),isDir:!0,source:s.FileSource.Computer,status:s.UploadStatus.Staged}},t.makeChooserUploadItem=function(e,t){return Object.assign(Object.assign({},t),{bytes:e.bytes,bytesUploaded:0,destPath:e.name,file:e,id:e.id,isDir:e.isDir,source:s.FileSource.Dropbox,status:s.UploadStatus.Staged})}})),define("metaserver/static/js/modules/clean/react/upload_kit/utils/path",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNameAtRoot=t.getRootDir=t.getDestPath=t.reparentFilename=t.renameFilename=void 0,t.renameFilename=function(e,t){const s=e.split("/");return s[s.length-1]=t,s.join("/")},t.reparentFilename=function(e,t){return`${t}/${e.split("/").pop()}`},t.getDestPath=e=>e.fullPath?e.fullPath.startsWith("/")?e.fullPath.substring(1):e.fullPath:e.name,t.getRootDir=e=>-1===e.indexOf("/")?"/":e.split("/")[0],t.getNameAtRoot=e=>e.split("/")[0]})),define("metaserver/static/js/modules/clean/search/api",["require","exports","tslib","metaserver/static/js/modules/clean/analytics","metaserver/static/js/api_v2/user_client","metaserver/static/js/modules/clean/react/browse/models","metaserver/static/js/modules/clean/search/api_helpers","metaserver/static/js/modules/clean/search/constants","metaserver/static/js/modules/clean/search/search_helpers","metaserver/static/js/modules/clean/search/types","metaserver/static/js/api_v2/error"],(function(e,t,s,i,r,a,o,n,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.searchApiClient=t.SearchApiClient=void 0,n=s.__importStar(n),l=s.__importStar(l);class u{constructor(){this._activeRequest=null}abortPreviousLoading(){null!=this._activeRequest&&this._activeRequest.abort()}loadResults({user:e,path:t,query:s,start:i,maxResults:r,searchSessionId:a,nsId:n,fileNameOnly:c,loadDeleted:d,showPaperResults:u,isDropdown:p,isAdminConsole:_,webTimer:m,onSuccess:f,onError:h}){const g=o.getCurrentTimezoneOffset(),S={query:s,search_token:l.getSearchCsrfToken(),fq_path:t,ns_id:n,filename_only:!!c,max_results:r,deleted:!!d,start:i,show_paper_results:!!u,is_dropdown:!!p,is_admin_console:!!_,show_unmounted_results:!0,timezone_offset:g,include_browse_context:!0,include_shared_docs:!0,include_snippets:!0};this._fetchResults({requestData:S,nextOffset:i,user:e,searchSessionId:a,onSuccess:f,onError:h,webTimer:m})}_getSearchType(e){return e.is_image_content_search?"image_search":e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"}loadPartialResults(e){const t=this._prepareSearchApiRequestData(e);(()=>{this._fetchResults({requestData:t,nextOffset:e.start,user:e.user,searchSessionId:e.searchSessionId,onSuccess:e.onSuccess,onError:e.onError,webTimer:e.webTimer,skipLogging:e.skipLogging})})()}_fetchResults({requestData:e,nextOffset:t,user:s,searchSessionId:n,onSuccess:c,onError:u,webTimer:p,skipLogging:m}){if(null!=this._activeRequest&&this._activeRequest.abort(),this._activeRequestController&&(this._activeRequestController.abort(),this._activeRequestController=null),_(e))return;const f=l.fileCategoryStringToLogValue(e.file_categories),h={path_scoped:"/"!==e.fq_path,search_type:this._getSearchType(e),query_string:e.query,start:t,search_session_id:n,timezone_offset:e.timezone_offset,file_type_filters:f,user_filter_account_id:e.user_filter_account_id};m||i.SearchClientActivityLogger.log("query_started",s.id,h);let g=void 0;void 0!==window.AbortController&&(g=new AbortController,this._activeRequestController=g);const S=new r.UserApiV2Client,E=s=>{const{result:i,headers:r}=s;this._activeRequestController=null;const n=r["x-dropbox-request-id"];let l;i.spell_correction&&(l={query:i.spell_correction.query,score:0,isCorrected:i.spell_correction.is_corrected,requestId:n});const d={results:o.extractSearchV2ResultsList(i.matches,t,n),hasMore:i.has_more,cursor:i.cursor,spellCorrection:l};c({context:new a.BrowseContext({blockHash:i.root_block_hash}),searchResults:d,deleted:!!e.deleted,requestId:n}),p&&p.end(n||void 0)},v=e=>{if(void 0===g||!g.signal.aborted){let t="",s="";(d.isApiError(e)||d.isBadRequestError(e)||d.isAuthError(e)||d.isAppError(e)||d.isServerError(e)||d.isRateLimitError(e))&&(t=e.toString(),e.headers&&(s=e.headers["x-dropbox-request-id"])),"function"==typeof u&&u(t,s)}p&&p.abort()};if(e.cursor)S.ns("files").rpcWithResponseHeaders("search/continue_v2",{cursor:e.cursor},{subjectUserId:s.id,signal:null==g?void 0:g.signal}).then(E).catch(v);else{const t=o.convertRequestDataToV2(e);S.ns("files").rpcWithResponseHeaders("search_v2",t,{subjectUserId:s.id,signal:null==g?void 0:g.signal}).then(E).catch(v)}}loadPopularFiltersResults(e){const t=this._prepareSearchApiRequestData(e);(()=>{this._fetchPopularFiltersResults({requestData:t,user:e.user,onSuccess:e.onSuccess,onError:e.onError,webTimer:e.webTimer})})()}_fetchPopularFiltersResults({requestData:e,user:t,onSuccess:s,onError:i,webTimer:a}){if(this._popularFiltersActiveRequestController&&(this._popularFiltersActiveRequestController.abort(),this._popularFiltersActiveRequestController=null),_(e))return;let n=void 0;void 0!==window.AbortController&&(n=new AbortController,this._popularFiltersActiveRequestController=n);const l=new r.UserApiV2Client,c=o.convertRequestDataToV2(e);l.ns("files").rpcWithResponseHeaders("popular_filters_search_aggregations",c,{subjectUserId:t.id,signal:null==n?void 0:n.signal}).then(e=>{const{result:t,headers:i}=e;this._popularFiltersActiveRequestController=null;const r=i["x-dropbox-request-id"];s({popularFiltersResult:t,requestId:r}),a&&a.end(r||void 0)}).catch(e=>{if(void 0===n||!n.signal.aborted){let t="",s="";(d.isApiError(e)||d.isBadRequestError(e)||d.isAuthError(e)||d.isAppError(e)||d.isServerError(e)||d.isRateLimitError(e))&&(t=e.toString(),e.headers&&(s=e.headers["x-dropbox-request-id"])),"function"==typeof i&&i(t,s)}a&&a.abort()})}_prepareSearchApiRequestData(e){const t=p(e.isPaperEnabled,!0),s=p(e.searchTags,!1),i=p(e.dateTaken,c.DateRange.Any),r=p(e.selectedDimensions,[]),a=p(e.media_filters_enabled,!1),o=p(e.media_metadata_search_enable,!1),d=p(e.queries_for_fields,[]),u=p(e.searchDocClassification,!1);let _=e.fileCategories;e.searchType===n.SearchType.IMAGE&&(_=void 0);const m=_&&!l.allCategoriesChecked(_,t)?l.fileCategoriesToString(_):"",f=e.sortOrder?l.sortFieldToOrderBy(e.sortOrder.sortField):"",h=e.sortOrder?l.sortDirectionToReverseOrder(e.sortOrder.sortDirection):"";return Object.assign(Object.assign({query:e.query,fq_path:e.path,cursor:e.cursor,max_results:e.maxResults,show_paper_results:e.searchType!==n.SearchType.IMAGE,include_browse_context:e.includeBrowseContext,search_session_id:e.searchSessionId},m&&{file_categories:m}),{is_image_content_search:e.searchType===n.SearchType.IMAGE,order_by:f,reverse_order:h,include_shared_docs:!0,include_snippets:e.searchType===n.SearchType.ALL,user_filter_account_id:e.filteredAccountId,search_tags:s,selected_dimensions:r,date_taken:i,custom_date_taken_range:e.customDateTakenRange,media_filters_enabled:a,media_metadata_search_enable:o,queries_for_fields:d,search_doc_classification:u})}}function p(e,t){return void 0===e?t:e}function _(e){var t;return o.isSearchArgsInvalid(null!==(t=e.media_filters_enabled)&&void 0!==t&&t,(function(e){var t;if(!(null===(t=e.queries_for_fields)||void 0===t?void 0:t.length))return;const{raw_query:s,fields:i}=e.queries_for_fields[0];if(!(null==i?void 0:i.length))return;const r=i[0]===c.SearchFields.FileName?"names":i[0]===c.SearchFields.ImageMetadata?"metadata":void 0;if(!r)return;return{query:s,type:r}})(e),(function(e){var t,s,i;return{query:e.query,path:e.fq_path,filteredAccountId:e.user_filter_account_id,fileCategoriesString:null!==(t=e.file_categories)&&void 0!==t?t:"",searchType:e.is_image_content_search?n.SearchType.IMAGE:n.SearchType.ALL,dateTaken:null!==(s=e.date_taken)&&void 0!==s?s:c.DateRange.Any,dimensions:null!==(i=e.selected_dimensions)&&void 0!==i?i:[]}})(e))}t.SearchApiClient=u,t.searchApiClient=new u})),define("metaserver/static/js/modules/clean/search/single_page/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionTypes=void 0,(function(e){e.SET_VARIANT="SEARCH/SET_VARIANT",e.SET_USER="SEARCH/SET_USER",e.SET_EXPERIMENTS="SEARCH/SET_EXPERIMENTS",e.SET_PATH="SEARCH/SET_PATH",e.SET_QUERY="SEARCH/SET_QUERY",e.SET_FILE_CATEGORIES="SEARCH/SET_FILE_CATEGORIES",e.SET_RESULTS="SEARCH/SET_RESULTS",e.CLEAR_RESULTS="SEARCH/CLEAR_RESULTS",e.APPEND_RESULTS="SEARCH/APPEND_RESULTS",e.SET_LOADING_STATE="SEARCH/SET_LOADING_STATE",e.SET_SESSION_ID="SEARCH/SET_SESSION_ID",e.SET_REQUEST_ID="SEARCH/SET_REQUEST_ID",e.SET_SELECTION="SEARCH/SET_SELECTION",e.SET_PREVIEW_FILE_ID="SEARCH/SET_PREVIEW_FILE",e.SET_PREVIEW_COMMENTS_THREAD_ID="SEARCH/SET_PREVIEW_COMMENTS_THREAD_ID",e.SET_SORT_ORDER="SEARCH/SET_SORT_ORDER",e.ADD_TTI_COMPONENT="SEARCH/ADD_TTI_COMPONENT",e.CLEAR_TTI_COMPONENTS="SEARCH/CLEAR_TTI_COMPONENTS",e.SET_SEARCH_TYPE="SEARCH/SET_SEARCH_TYPE",e.SET_IMAGE_SUGGESTION="SEARCH/SET_IMAGE_SUGGESTION",e.UPDATE_FILE_IN_RESULTS="SEARCH/UPDATE_FILE_IN_RESULTS",e.UPDATE_RESULTS="SEARCH/UPDATE_RESULTS",e.REMOVE_RESULTS="SEARCH/REMOVE_RESULTS",e.RENAME_FILE="SEARCH/RENAME_FILE",e.DELETE_FILES="SEARCH/DELETE_FILES",e.PURGE_FILES="SEARCH/PURGE_FILES",e.RESTORE_FILES="SEARCH/RESTORE_FILES",e.SET_QUERY_HISTORY="SEARCH/SET_QUERY_HISTORY",e.SET_HIGHLIGHTED_ROW="SEARCH/SET_HIGHLIGHTED_ROW",e.UPDATE_QUERY_SUGGESTIONS_CACHE="SEARCH/UPDATE_QUERY_SUGGESTIONS_CACHE",e.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED="SEARCH/SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED",e.SET_FILTERED_ACCOUNT_ID="SEARCH/SET_FILTERED_ACCOUNT_ID",e.SET_SUGGESTED_PEOPLE_FOR_FILTERS="SEARCH/SET_SUGGESTED_PEOPLE_FOR_FILTERS",e.UPDATE_PEOPLE_SUGGESTIONS_CACHE="SEARCH/UPDATE_PEOPLE_SUGGESTIONS_CACHE",e.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED="SEARCH/SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED",e.SET_DWELL_TIME="SEARCH/SET_DWELL_TIME",e.SET_QUERY_START_TIME="SEARCH/SET_QUERY_START_TIME",e.SET_IS_CREATING_SHARED_LINK="SEARCH/SET_IS_CREATING_SHARED_LINK",e.UPDATE_TAGS_SUGGESTIONS_CACHE="SEARCH/UPDATE_TAGS_SUGGESTIONS_CACHE",e.SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED="SEARCH/SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED",e.UPDATE_POPULAR_FILTERS_CACHE="SEARCH/UPDATE_POPULAR_FILTERS_CACHE",e.SET_LAST_QUERY_WITH_POPULAR_FILTERS_LOADED="SEARCH/SET_LAST_QUERY_WITH_POPULAR_FILTERS_LOADED",e.SET_FILTERED_SEARCH_SUGGESTION="SEARCH/SET_FILTERED_SEARCH_SUGGESTION",e.SET_LAST_MODIFIED_DATE="SEARCH/SET_LAST_MODIFIED_DATE",e.SET_DATE_TAKEN="SEARCH/SET_DATE_TAKEN_VALUE",e.SET_SELECTED_DIMENSIONS="SEARCH/SET_SELECTED_DIMENSIONS",e.SET_MEDIA_DATA="SEARCH/SET_MEDIA_DATA",e.UPDATE_RESULT_SUGGESTIONS_CACHE="SEARCH/UPDATE_RESULT_SUGGESTIONS_CACHE",e.SET_EXPANDED_BLADE="SEARCH/SET_EXPANDED_BLADE"})(t.ActionTypes||(t.ActionTypes={}))})),define("metaserver/static/js/modules/clean/react/growth/teams_web_actions_logger_events",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TopLevelContentManagementEvents=t.DefaultPermissionsWebUploadsEvents=t.TeamSpaceTsdAccessVisibilityEvents=t.TeamSpaceEmptyZoneCTALoggerEvents=t.CollectionsFolderActionsLoggerEvents=t.TeamSpaceEmptyZoneLoggerEvents=t.SuggestedFoldersLoggerEvents=t.DownloadAppZoneLoggerEvents=t.OpenInDesktopCtaLoggerEvents=t.InviteFacepileLoggerEvents=t.EmptyStateDropTargetLoggerEvents=t.TeamJoinerLoggerEvents=t.TeamInstallLoggerEvents=t.OnboardingLoggerEvents=void 0,(function(e){e.ESSENTIAL_SETUP_STEPS="essential_setup_steps",e.ESSENTIAL_SETUP_START="essential_setup_start",e.ESSENTIAL_SETUP_FINISH="essential_setup_finish",e.ESSENTIAL_SETUP_STEP_CHANGE="essential_setup_step_change",e.INSTALL_PAGE_ESCAPE="install_page_escape",e.DOCSEND_ONBOARD_PAGE_ESCAPE="docsend_onboard_page_escape",e.OPEN_DESKTOP_BANNER="open_desktop_banner",e.OPEN_DESKTOP_CLICK="open_desktop_click",e.RESEND_VERIFICATION_EMAIL="resend_verification_email",e.STEP_RENDER="setup_render",e.SUBMIT_TEAM_INFO="submit_team_info",e.TRANSITION_OPEN_GMAIL="transition_open_gmail",e.TRANSITION_OPEN_OUTLOOK="transition_open_outlook",e.TRIGGER_CLIENT_CHECK="trigger_client_check",e.TRIGGER_CLIENT_RESULT="trigger_client_result",e.TRIGGER_DOWNLOAD="trigger_download",e.TRIGGER_DOWNLOAD_AGAIN="trigger_download_again",e.TRIGGER_MAGIC_PAIRING="trigger_magic_pairing",e.UJ_CLINK_DOWNLOAD="uj_clink_download",e.SELECT_ESSENTIAL_SETUP_DESKTOP_APP_BUTTON="select_essential_setup_desktop_app_button",e.ROLE_OPTION_SELECTED="role_option_selected",e.VIEW_SUGGESTIONS_LOADING_SCREEN="view_suggestions_loading_screen",e.COLLABORATION_TYPE_SELECTED="collaboration_type_selected",e.SETUP_SKIP_ADD_MEMBERS="setup_skip_add_members",e.SETUP_INVITE_MEMBERS_IMPORT="setup_invite_members_import",e.SETUP_INVITE_MEMBERS_COPY_LINK="setup_invite_members_copy_link",e.SETUP_INVITE_MEMBERS_ADD_EMAIL="setup_invite_members_add_email",e.SETUP_INVITE_MEMBERS_ADD_MORE_CLICKED="setup_invite_members_add_more_clicked",e.SETUP_ADD_MEMBERS="setup_add_members",e.SETUP_ADD_MEMBERS_SUBMITTED="setup_add_members_submitted",e.SETUP_ADD_MEMBERS_FAILED="setup_add_members_failed",e.SHARE_INVITE_CLICK="share_invite_click",e.SHARE_INVITE_SHEET_ACTION="share_invite_sheet_action",e.SHARE_INVITE_SHEET_DISMISS="share_invite_sheet_dismiss",e.SHARE_INVITE_COPIED="share_invite_copied",e.INVITE_PAGE_ESCAPE="invite_page_escape",e.MW_APP_STORE_REDIRECT="mw_app_store_redirect",e.MW_CLINK_FLOW_REDIRECT="mw_clink_flow_redirect",e.INSTALL_APP_PAGE_ESCAPE="install_app_page_escape",e.INSTALL_PAGE_REDIRECT="install_page_redirect",e.MOBILE_ICON_CLICK="mobile_icon_click",e.SEND_MOBILE_APP_LINK="send_mobile_app_link",e.MW_STEP_NOT_RENDER="mw_step_not_render",e.REC_FOLDER_LOADED="rec_folder_loaded",e.REC_FOLDER_LOAD_FAILED="rec_folder_load_failed",e.SETUP_ADD_MEMBERS_REC_LOADED="setup_add_members_rec_loaded",e.SETUP_ADD_MEMBERS_REC_LOAD_FAILED="setup_add_members_rec_load_failed",e.REC_FOLDER_CHECK="rec_folder_check",e.REC_FOLDER_UNCHECK="rec_folder_uncheck",e.REC_FOLDER_CLK_NEXT="rec_folder_clk_next",e.CONF_FOLDER_CLK_MOVE="conf_folder_clk_move",e.CONF_FOLDER_MOVE_SUCCEEDED="conf_folder_move_succeeded",e.CONF_FOLDER_MOVE_PARTIAL="conf_folder_move_partial_fail",e.CONF_FOLDER_MOVE_FAILED="conf_folder_move_failed",e.CONF_FOLDER_MOVE_INDIVIDUAL_ERROR="conf_folder_move_individual_error",e.CONF_FOLDER_MOVE_INTERRUPTED="conf_folder_move_interrupted",e.SETUP_CONFIRM_MOVE_FOLDERS_IMPRESSION="setup_confirm_move_folders_impression",e.SETUP_RESULTS_MOVE_FOLDERS_IMPRESSION="setup_results_move_folders_impression",e.SETUP_SELECT_FOLDERS_IMPRESSION="setup_select_folders_impression",e.SETUP_MOVE_FOLDERS_KEEP_PERSONAL="setup_move_folders_keep_personal",e.SETUP_ADD_MEMBERS_UNCHECK="setup_add_members_uncheck",e.SETUP_ADD_MEMBERS_CHECK="setup_add_members_check",e.SETUP_ADD_MEMBERS_MORE_RECOS="setup_add_members_more_recos",e.SCROLL_EVENT="scroll_event",e.ACCESS_FOLDER_CHECK="access_folder_check",e.ACCESS_FOLDER_UNCHECK="access_folder_uncheck",e.FLOW_STEPS_DOES_NOT_MATCH="flow_steps_does_not_match",e.FLOW_STEPS_DOES_NOT_MATCH_V2="flow_steps_does_not_match_v2",e.FLOW_STEPS_DOES_NOT_MATCH_V3="flow_steps_does_not_match_v3",e.FLOW_CONT_URL_DOES_NOT_MATCH="flow_cont_url_does_not_match",e.RIGHTSIZING_CLICK_MULTIPLE="rightsizing_clk_filter_screen_multiple",e.RIGHTSIZING_CLICK_YOU="rightsizing_clk_filter_screen_you",e.RIGHTSIZING_VIEW="rightsizing_view_filter_screen",e.BUSINESS_ONBOARDING_QUIZ_IMPRESSION="business_onboarding_quiz_answer",e.BUSINESS_ONBOARDING_QUIZ_RESPONSE="business_onboarding_quiz_response",e.BUSINESS_ONBOARDING_QUIZ_UNDEFINED_ANSWER="huhy_undefined_answer"})(t.OnboardingLoggerEvents||(t.OnboardingLoggerEvents={})),(function(e){e.UJ_CLINK_DOWNLOAD_AGAIN="uj_clink_download_again",e.UJ_CLINK_SKIP_AFTER_DOWNLOAD="uj_clink_skip_after_download",e.SETUP_RENDER="setup_render",e.UJ_CLINK_DOWNLOAD_MOBILE_REROUTE="uj_clink_download_mobile_reroute",e.UJ_CLINK_DOWNLOAD="uj_clink_download",e.UJ_CLINK_SKIP="uj_clink_skip",e.OPEN_DESKTOP_CLICK="open_desktop_click"})(t.TeamInstallLoggerEvents||(t.TeamInstallLoggerEvents={})),(function(e){e.CLK_YES_TO_CREATE="clk_yes_to_create",e.CLK_NO_TO_COMBINE="clk_no_to_combine",e.CLK_CREATE_JOINER="clk_create_joiner",e.CLK_CREATE_NEW="clk_create_new",e.CLK_COMBINE="clk_combine",e.SETUP_RENDER="setup_render",e.MERGE_ACCOUNTS="joiner_merge_accounts",e.CREATE_NEW_PERSONAL="joiner_create_new_personal",e.SIGNUP="joiner_signup",e.SIGNIN="joiner_signin"})(t.TeamJoinerLoggerEvents||(t.TeamJoinerLoggerEvents={})),(function(e){e.VIEW_CONTENT_EMPTY_STATE="view_content_empty_state",e.CLICK_BROWSE_UPLOAD_CTA="click_browse_upload_cta"})(t.EmptyStateDropTargetLoggerEvents||(t.EmptyStateDropTargetLoggerEvents={})),(function(e){e.VIEW_INVITE_EMPTY_STATE="view_invite_empty_state",e.INVITE_MEMBERS_PRIMARY_CTA_CLK="invite_members_primary_cta_clk"})(t.InviteFacepileLoggerEvents||(t.InviteFacepileLoggerEvents={})),(function(e){e.DESKTOP_ICON_TOOLTIP="desktop_icon_tooltip",e.DESKTOP_ICON_CLICK="desktop_icon_click",e.DESKTOP_ICON_CLICK_RESULT="desktop_icon_click_result",e.DESKTOP_ICON_TOOLTIP_DISMISS="desktop_icon_tooltip_dismiss"})(t.OpenInDesktopCtaLoggerEvents||(t.OpenInDesktopCtaLoggerEvents={})),(function(e){e.VIEW_MOBILE_EMPTY_STATE="view_mobile_empty_state",e.DISMISS_MOBILE_EMPTY_STATE="dismiss_mobile_empty_state",e.SEND_MOBILE_LINK_CLK="send_mobile_link_clk",e.SEND_MOBILE_LINK_SUCCESS="send_mobile_link_success",e.SEND_MOBILE_LINK_FAIL="send_mobile_link_fail"})(t.DownloadAppZoneLoggerEvents||(t.DownloadAppZoneLoggerEvents={})),(function(e){e.MOUNT_SUGGESTED_FOLDERS="mount_suggested_folders",e.VIEW_SUGGESTED_FOLDERS="view_suggested_folders",e.SUGGESTED_FOLDER_ADD_CLICKED="suggested_folder_add_clicked",e.SUGGESTED_FOLDERS_HIDE_CLICKED="suggested_folders_hide_clicked",e.SUGGESTED_FOLDER_CREATED="suggested_folder_created",e.SUGGESTED_FOLDER_FAILED="suggested_folder_failed",e.SUGGESTED_FOLDER_ACCESS_VIEW="suggested_folder_access_view",e.SUGGESTED_FOLDER_ACCESS_CHANGE="suggested_folder_access_change",e.VIEW_SUGGESTED_FOLDERS_MINIMIZED="view_suggested_folders_minimized",e.VIEW_SUGGESTED_FOLDERS_OPEN="view_suggested_folders_open",e.SUGGESTED_FOLDERS_DISMISS_ALL="suggested_folder_dismiss_all"})(t.SuggestedFoldersLoggerEvents||(t.SuggestedFoldersLoggerEvents={})),(function(e){e.VIEW_EXPLORE_CONTENT_STATE="view_explore_content_state",e.VIEW_EXPLORE_EMPTY_STATE="view_explore_empty_state"})(t.TeamSpaceEmptyZoneLoggerEvents||(t.TeamSpaceEmptyZoneLoggerEvents={})),(function(e){e.SUGGESTIONS_PAGE_IMPRESSION="suggestions_page_impression",e.SUGGESTIONS_PAGE_CLICK_CTA="suggestions_page_clk_cta"})(t.CollectionsFolderActionsLoggerEvents||(t.CollectionsFolderActionsLoggerEvents={})),(function(e){e.UPLOAD_FILES_CLICKED="upload_files_clk",e.CREATE_FOLDER_CLICKED="create_folder_clk"})(t.TeamSpaceEmptyZoneCTALoggerEvents||(t.TeamSpaceEmptyZoneCTALoggerEvents={})),(function(e){e.CREATE_FOLDER_MODAL_OPEN="tsd_create_folder_modal_open",e.CREATE_FOLDER_CLICK="tsd_create_folder_click",e.PERMISSIONS_AT_UPLOAD_MODAL_OPEN="tsd_upload_folder_modal_open",e.PERMISSIONS_AT_UPLOAD_CLICK="tsd_upload_folder_click"})(t.TeamSpaceTsdAccessVisibilityEvents||(t.TeamSpaceTsdAccessVisibilityEvents={})),(function(e){e.ACCOUNT_PREF_DEFAULT_PERMISSION_TOGGLE="account_pref_default_permission_toggle",e.DEFAULT_PERMISSION_MODAL_IMPRESSION="default_permission_modal_impression",e.DEFAULT_PERMISSION_MODAL_ACCEPT="default_permission_modal_accept",e.DEFAULT_PERMISSION_MODAL_DISMISS="default_permission_modal_dismiss",e.DEFAULT_PERMISSION_MODAL_ACCOUNT_PREF_CTA="default_permission_modal_account_pref_cta"})(t.DefaultPermissionsWebUploadsEvents||(t.DefaultPermissionsWebUploadsEvents={})),(function(e){e.TOP_LEVEL_CONTENT_MANAGEMENT_MODAL_VIEWED="top_level_content_management_modal_viewed",e.TOP_LEVEL_CONTENT_MANAGEMENT_MODAL_CANCEL="top_level_content_management_modal_cancel",e.TOP_LEVEL_CONTENT_MANAGEMENT_MODAL_SAVE="top_level_content_management_modal_save",e.TOP_LEVEL_CONTENT_MANAGEMENT_SETTING_CHANGED="top_level_content_management_setting_changed"})(t.TopLevelContentManagementEvents||(t.TopLevelContentManagementEvents={}))})),define("metaserver/static/js/modules/clean/react/file_uploader/web_upload_action_logger",["require","exports","tslib","metaserver/static/js/modules/clean/deprecated_ajax/ajax_jquery"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebUploadActionLogClass=t.WebUploadActionLog=t.MAX_ERRORS=void 0,i=s.__importStar(i),t.MAX_ERRORS=3;class r{constructor(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}log(e,s,r){return r=Object.assign(Object.assign(Object.assign({},r),r.extra),{extra:void 0}),this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise((a,o)=>{i.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:s,extra_params:JSON.stringify(r)},error:e=>{429===e.status?this.errorCount=t.MAX_ERRORS:this.errorCount++,this.lastError=Date.now(),o(e)},success:e=>{try{const t=JSON.parse(e);t&&!t.continue_sending&&(this.shouldReport=!1),this.errorCount=0,a(e)}catch(e){throw this.errorCount++,this.lastError=Date.now(),o(e),e}}})}):Promise.resolve({})}}t.WebUploadActionLog=new r,t.WebUploadActionLogClass=r})),define("metaserver/static/js/modules/core/custom_protocol",["require","exports","tslib","metaserver/static/js/modules/core/browser_detection"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canLaunchUri=t.launchUriForMicrosoftBrowsers=t.launchUriByIframe=t.launchUri=void 0;const r=(i=s.__importStar(i)).chrome?1e3:2e3;function a(e){const t=document.createElement("iframe");t.src=e,t.setAttribute("style","display: none;"),document.body.appendChild(t)}function o(e,t,s){const i=window.navigator;i&&i.msLaunchUri?i.msLaunchUri(e,t,s):s()}t.launchUri=function(e){let t=null;return new Promise((s,n)=>{function l(){window.removeEventListener("blur",l),null!==t&&clearTimeout(t),s()}window.addEventListener("blur",l),t=setTimeout(()=>{window.removeEventListener("blur",l),n()},r),i.chromium()?window.location.assign(e):i.mozilla||i.safari?a(e):(i.msie||i.edge)&&o(e,s,n)})},t.launchUriByIframe=a,t.launchUriForMicrosoftBrowsers=o,t.canLaunchUri=function(){return i.msie?i.windowsInfo.win8OrHigher:!!(i.mozilla||i.safari||i.chrome)}})),define("metaserver/static/js/modules/clean/react/vault/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENCRYPTED_DOWNLOAD_ARGS_QUERY_PARAM_KEY=t.ENCRYPTED_OWNER_QUERY_PARAM_KEY=t.VAULT_OWNER_DISPLAY_NAME_QUERY_PARAM_KEY=t.VAULT_OWNER_FNAME_QUERY_PARAM_KEY=t.DEFAULT_APPS_PATH=t.SECURITY_CHECKUP_RELATIVE_URL=t.VAULT_STYLESHEETS=t.VAULT_NAME=t.VAULT_HASH_MODAL_KEY=t.VAULT_HASH_TAB_KEY=t.VAULT_URL=void 0,t.VAULT_URL="/vault",t.VAULT_HASH_TAB_KEY="tab",t.VAULT_HASH_MODAL_KEY="modal",t.VAULT_NAME="Vault",t.VAULT_STYLESHEETS=["/static/css/spectrum/index.web-vfliw9181.css","/static/css/dig-components/index.web-vfl0pq0Fh.css","/static/js/typescript/component_libraries/vault/src/index.web-vflDlO13I.css","/static/css/vault/vault-vflbqmnaC.css"],t.SECURITY_CHECKUP_RELATIVE_URL="/security_checkup",t.DEFAULT_APPS_PATH="/account/default_apps",t.VAULT_OWNER_FNAME_QUERY_PARAM_KEY="vo_fn",t.VAULT_OWNER_DISPLAY_NAME_QUERY_PARAM_KEY="vo_dn",t.ENCRYPTED_OWNER_QUERY_PARAM_KEY="vo",t.ENCRYPTED_DOWNLOAD_ARGS_QUERY_PARAM_KEY="enc"})),define("metaserver/static/js/modules/clean/react/vault/lib/browse_utils",["require","exports","tslib","metaserver/static/js/modules/clean/filepath/filepath","metaserver/static/js/modules/clean/react/vault/constants"],(function(e,t,s,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVaultFqPath=t.isInsideVault=t.logShareFromInsideVault=void 0,i=s.__importStar(i),t.logShareFromInsideVault=function(t){return s.__awaiter(this,void 0,void 0,(function*(){const{logProductAnalyticsEvent:i}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/vault/lib/api"],t,s)}).then(s.__importStar),{AnalyticsEventAction:r,AnalyticsEventObject:a,AnalyticsEventActionSurface:o}=yield new Promise((t,s)=>{e(["typescript/component_libraries/vault/src/common/logging-types"],t,s)}).then(s.__importStar);i({eventAction:r.SELECT,eventObject:t?a.SHARE_FOLDER:a.SHARE_FILE,actionSurface:o.VAULT_HOME})}))},t.isInsideVault=function(e){const t=e.split("/");return("/"===e[0]?t[1]:t[0])===r.VAULT_NAME},t.getVaultFqPath=function(){return i.normalize(r.VAULT_NAME)}})),define("typescript/libraries/comments2/src/components/folder_overview_utils/index",["require","exports","typescript/libraries/comments2/src/components/folder_overview_utils/description_utils"],(function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyDescription=void 0,Object.defineProperty(t,"isEmptyDescription",{enumerable:!0,get:function(){return s.isEmptyDescription}})})),define("typescript/libraries/comments2/src/components/folder_overview_utils/description_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEmptyDescription=void 0,t.isEmptyDescription=e=>{if(!e)return!0;if(0===e.blocks.length)return!0;if(e.blocks.length>1)return!1;if("unstyled"!==e.blocks[0].type)return!1;return 0===e.blocks.map(e=>e.text).join("\n").replace(/%u200B/g,"").trim().length}})),define("metaserver/static/js/dropbox/proto/hql_events/browse/web_browse",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/dropbox/proto/hql_events/extensions"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.hql_events=void 0;const r=(i=s.__importStar(i)).Reader,a=i.Writer,o=(i.util,i.roots.default||(i.roots.default={}));var n;t.default=o,t.hql_events=o.hql_events=((n=o.hql_events||{}).WebBrowseSelectRow=(function(e){function e(e){if(e)for(let t=Object.keys(e),s=0;s<t.length;++s)null!=e[t[s]]&&(this[t[s]]=e[t[s]])}return e.prototype.actionSource="",e.prototype.hqlMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.actionSource&&Object.hasOwnProperty.call(e,"actionSource")&&t.uint32(10).string(e.actionSource),null!=e.hqlMetadata&&Object.hasOwnProperty.call(e,"hqlMetadata")&&o.hql_events.HQLMetadata.encode(e.hqlMetadata,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof r||(e=r.create(e));let s=void 0===t?e.len:e.pos+t,i=new o.hql_events.WebBrowseSelectRow;for(;e.pos<s;){let t=e.uint32();switch(t>>>3){case 1:i.actionSource=e.string();break;case 2:i.hqlMetadata=o.hql_events.HQLMetadata.decode(e,e.uint32());break;default:e.skipType(7&t)}}return i},e.getTypeUrl=function(){return"type.googleapis.com/hql_events.WebBrowseSelectRow"},e})(n.WebBrowseSelectRow||{}),n)})),define("metaserver/static/js/modules/clean/react/upload_kit/scheduler/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadScheduler=void 0;t.UploadScheduler=class{constructor(e){}}}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&__createBinding(t,e,s);return __setModuleDefault(t,e),t};define("metaserver/static/js/modules/clean/react/browse/fss_experiment_carousel_util",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowFssExpr=void 0,t.asyncShowFssExpr=(t,s,i,r)=>{new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/browse/fss_experiment_carousel"],t,s)}).then(__importStar).then(e=>{e.showFssExpr(t,s,i,r)})}})),define("metaserver/static/js/modules/clean/react/flows/components/badge_async",["require","exports","tslib","react"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncBadgeComponent=void 0,i=s.__importStar(i);const{lazy:r,Suspense:a}=i,o=r(()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{FlowsFolderBadge:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/react/flows/components/badge"],t,s)}).then(s.__importStar);return{default:t}})));t.AsyncBadgeComponent=({type:e,isInUnifiedModal:t,isFolderFocused:s})=>i.createElement(a,{fallback:i.createElement("div",null)},i.createElement(o,{type:e,isInUnifiedModal:t,isFolderFocused:s})),t.AsyncBadgeComponent.displayName="AsyncBadgeComponent"})),define("metaserver/static/js/modules/clean/media_filters/gating",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrganizedRetrievalSurveyEnabled=t.isPopularFiltersSearchEnabled=t.isMediaMetadataSearchEnabled=t.isMediaFiltersEnabled=t.isMediaInformationEnabled=void 0,t.isMediaInformationEnabled=function(e){return!!e&&["V1","V2","V3","V4","V1_SURVEY","V2_SURVEY","V3_SURVEY","V4_SURVEY"].includes(e)},t.isMediaFiltersEnabled=function(e){return!!e&&["V2","V3","V4","V2_SURVEY","V3_SURVEY","V4_SURVEY"].includes(e)},t.isMediaMetadataSearchEnabled=function(e){return!!e&&["V3","V4","V3_SURVEY","V4_SURVEY"].includes(e)},t.isPopularFiltersSearchEnabled=function(e){return!!e&&["V4","V4_SURVEY"].includes(e)},t.isOrganizedRetrievalSurveyEnabled=function(e){return!!e&&["SURVEY","V1_SURVEY","V2_SURVEY","V3_SURVEY","V4_SURVEY"].includes(e)}})),define("metaserver/static/js/modules/clean/media_filters/media_search_snippet_loader",["require","exports","tslib","metaserver/static/js/modules/clean/react/async/loadable","react","metaserver/static/js/modules/clean/web_timing_logger"],(function(e,t,s,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncMediaSearchSnippet=void 0,r=s.__importDefault(r);const o=i.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){yield a.waitForTTI();const{MediaSearchSnippet:t}=yield new Promise((t,s)=>{e(["metaserver/static/js/modules/clean/media_filters/media_search_snippet"],t,s)}).then(s.__importStar);return t}))});t.AsyncMediaSearchSnippet=e=>r.default.createElement(o,Object.assign({},e)),t.AsyncMediaSearchSnippet.displayName="AsyncMediaSearchSnippet"}));
//# sourceMappingURL=pkg-browse.min.js-vflF3gxbq.map