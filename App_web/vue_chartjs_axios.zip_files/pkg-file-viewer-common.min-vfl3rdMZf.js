define("metaserver/static/js/modules/clean/react/file_viewer/utils",["require","exports","tslib","react","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/clean/react/file_viewer/constants","metaserver/static/js/modules/core/i18n","metaserver/static/js/modules/clean/file_store/utils","metaserver/static/js/modules/clean/previews/data/preview_type_util","metaserver/static/js/modules/core/uri","metaserver/static/js/modules/clean/react/previews/constants","metaserver/static/js/modules/clean/react/previews/image_helpers","metaserver/static/js/modules/clean/previews/api","metaserver/static/js/modules/clean/auth/login_or_register/types","typescript/libraries/file-viewer/src/core/config","metaserver/static/js/modules/clean/open_in_app/types","metaserver/static/js/modules/core/browser_detection","metaserver/static/js/modules/constants/python","metaserver/static/js/modules/clean/react/snackbar","typescript/libraries/file-viewer/src/file_extension/extension_constants","metaserver/static/js/modules/clean/react/file_viewer/sdk_file_viewer/experiments","metaserver/static/js/modules/clean/web_user_action_logger","metaserver/static/js/modules/clean/web_user_action_events"],(function(e,t,r,n,i,s,o,a,l,c,u,d,m,p,S,v,w,g,f,_,E,b,F){"use strict";function O(){return new c.URI({path:"/login",query:{cont:i.get_href()}}).toString()}function C(e){return!e}function h(e){if(e)switch(e){case g.FileViewOriginType.BROWSE:return u.PreviewSourceContext.Browse;case g.FileViewOriginType.COLLECTIONS:return u.PreviewSourceContext.Collections;case g.FileViewOriginType.COMMERCE:return u.PreviewSourceContext.Commerce;case g.FileViewOriginType.HELLOSIGN:return u.PreviewSourceContext.Hellosign;case g.FileViewOriginType.HOME:return u.PreviewSourceContext.Home;case g.FileViewOriginType.PHOTOS:return u.PreviewSourceContext.Photos;case g.FileViewOriginType.RECENTS:return u.PreviewSourceContext.Recents;case g.FileViewOriginType.SEARCH:return u.PreviewSourceContext.Search;case g.FileViewOriginType.STARRED:return u.PreviewSourceContext.Starred;case g.FileViewOriginType.TRANSFER:return u.PreviewSourceContext.Transfer}const t=i.get_uri().path;return/^\/h$/.test(t)?u.PreviewSourceContext.Home:/^\/starred$/.test(t)?u.PreviewSourceContext.Starred:/^\/recents$/.test(t)?u.PreviewSourceContext.Recents:/^\/search$/.test(t)?u.PreviewSourceContext.Search:/^\/(s|scl\/fi)\//.test(t)?u.PreviewSourceContext.SharedLinkFile:/^\/(sh|scl\/fo)\//.test(t)?u.PreviewSourceContext.SharedLinkFolder:/^\/sc\//.test(t)?u.PreviewSourceContext.SharedLinkCollection:/^\/history/.test(t)?u.PreviewSourceContext.VersionHistory:/^\/(home|work|personal)/.test(t)?u.PreviewSourceContext.Browse:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.isExcelPreview=t.getOpenInAppUrls=t.showDocSendSnackbar=t.showAuthModal=t.isResponsiveEnabled=t.fetchRivieraStatusCode=t.isFvsdkPdfEditorEnabled=t.isPaperEmbedEnabled=t.getMobileWebRevampBrowseVariant=t.translateExcelSupport=t.getMobileWebRevampOobVariant=t.isPreviewPageRevampEnabled=t.preloadImages=t.getSourceAction=t.getSourceContext=t.canDownloadFile=t.isFileEditable=t.isMountedFile=t.sharedLinkLoginUrl=t.getSharedLinkLoginUrl=t.cleanupPrerenderPreview=t.getSplitButtonUserActionContext=void 0,n=r.__importDefault(n),i=r.__importStar(i),d=r.__importStar(d),w=r.__importStar(w),t.getSplitButtonUserActionContext=function(e,t){if(e===s.SplitButtonActionLocation.Main){if(t===s.FileViewerPane.TitleBar)return s.UserActionContext.TitleBarMain;if(t===s.FileViewerPane.PreviewContent)return s.UserActionContext.PreviewContentMain}else if(e===s.SplitButtonActionLocation.Split){if(t===s.FileViewerPane.TitleBar)return s.UserActionContext.TitleBarSplitButton;if(t===s.FileViewerPane.PreviewContent)return s.UserActionContext.PreviewContentSplitButton}return s.UserActionContext.Unknown},t.cleanupPrerenderPreview=function(){const e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,e=>{e.style.display="none"})},t.getSharedLinkLoginUrl=O,t.sharedLinkLoginUrl=O(),t.isMountedFile=C,t.isFileEditable=e=>!!e&&(a.isBrowseFile(e)&&!e.read_only),t.canDownloadFile=function(e,t){return C(e)||t&&t.canDownloadRoles.length>0},t.getSourceContext=h,t.getSourceAction=function(){switch(h()){case u.PreviewSourceContext.SharedLinkFile:case u.PreviewSourceContext.SharedLinkFolder:return u.PreviewSourceAction.Visit;default:return u.PreviewSourceAction.Click}},t.preloadImages=function(e,t){if(0===e.length)return;const r=[];[0,1,2,3,4,5,6,-1,-2].forEach((function(n){const i=(t+n+e.length)%e.length;-1===r.indexOf(i)&&r.push(i)})),r.forEach((function(t){if(e.length>t&&l.isImage(e[t])){const r=e[t];if(r){const e=r.content.thumbnail_url_tmpl||r.preview_url;e&&d.preloadResponsiveImage(e)}}}))};const P=["ON","AD_FREE","EXPOSED"];t.isPreviewPageRevampEnabled=()=>P.includes(E.fileViewerFeatureExperiments.previewPageRevamp);const x=["SIGNUP","DOWNLOAD"],A=["COPYLINK","SHARE"];t.getMobileWebRevampOobVariant=e=>x.includes(E.fileViewerFeatureExperiments.mobileWebFvsdkVariant)||"DOWNLOAD"===E.fileViewerFeatureExperiments.mobileWebFvsdkOobLoggedIn?e?E.fileViewerFeatureExperiments.mobileWebFvsdkOobLoggedIn:E.fileViewerFeatureExperiments.mobileWebFvsdkVariant:null,t.translateExcelSupport=(e,t)=>{const r="ms_view_embed"===t?{embed_support:"ms_view_embed"}:{embed_support:"unsupported"};let n;switch(e){case"OFF":case"CONTROL":n={support:"excel1"};break;case"P0":n={support:"excel2",phase:0};break;case"P1":n={support:"excel2",phase:1};break;case"P2":n={support:"excel2",phase:2};break;case"P3":n={support:"excel2",phase:3};break;case"P4":n={support:"excel2",phase:4};break;default:n={support:"excel1"}}return Object.assign(Object.assign({},n),r)},t.getMobileWebRevampBrowseVariant=e=>e&&A.includes(E.fileViewerFeatureExperiments.mobileWebFvsdkBrowse)?E.fileViewerFeatureExperiments.mobileWebFvsdkBrowse:null,t.isPaperEmbedEnabled=()=>E.fileViewerFeatureExperiments.enableFvsdkPaperEmbed;const L=["ON"];t.isFvsdkPdfEditorEnabled=()=>L.includes(E.fileViewerFeatureExperiments.enableFvsdkPdfEditor),t.fetchRivieraStatusCode=(e,t,r=(()=>{}))=>{const n=new XMLHttpRequest;return n.open("GET",e),n.withCredentials=!0,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){const e=m.getParsedDropboxMetadataHeader(n);e.rivieraStatusCode?t(e.rivieraStatusCode):r()}},n.send(),n},t.isResponsiveEnabled=function(){return h()!==u.PreviewSourceContext.VersionHistory};const R={[S.AuthMode.LOGIN]:p.Mode.LOGIN,[S.AuthMode.REGISTER]:p.Mode.REGISTER},T={[S.LoginOrRegisterKind.COMMENT]:p.LoginOrRegisterKind.COMMENT,[S.LoginOrRegisterKind.DOWNLOAD]:p.LoginOrRegisterKind.DOWNLOAD,[S.LoginOrRegisterKind.IMMEDIATE]:p.LoginOrRegisterKind.IMMEDIATE,[S.LoginOrRegisterKind.POSTDOWNLOAD]:p.LoginOrRegisterKind.POSTDOWNLOAD,[S.LoginOrRegisterKind.SIDEBAR]:p.LoginOrRegisterKind.SIDEBAR},M={[S.CommentTextVariant.DEFAULT]:p.CommentTextVariant.DEFAULT,[S.CommentTextVariant.POST]:p.CommentTextVariant.POST,[S.CommentTextVariant.SUBSCRIBE]:p.CommentTextVariant.SUBSCRIBE};t.showAuthModal=function({mode:t,kind:i,sharedLinkUrl:s,encryptionOptions:o,commentParams:a,loggingExtra:l}){return r.__awaiter(this,void 0,void 0,(function*(){const[{Modal:c},{LoginOrRegisterModal:u}]=yield Promise.all([new Promise((t,r)=>{e(["metaserver/static/js/modules/clean/react/components/modal"],t,r)}).then(r.__importStar),new Promise((t,r)=>{e(["metaserver/static/js/modules/clean/auth/login_or_register/modal"],t,r)}).then(r.__importStar)]);c.showInstance(n.default.createElement(u,{downloadAction:null,id:"shared-link-immediate-signup-modal",initialMode:R[t],kind:T[i],onCancel:()=>{},onAuthenticateSuccess:()=>window.location.reload(),commentParams:a?{stream:a.stream,variant:M[a.variant]}:void 0,signup_tag:"shmodel_modal_register",showGoogleRegistration:!0,googleRegisterProps:s?{signupContinuationUrl:s}:void 0,encryptionOptions:o,loggingExtra:l}))}))},t.showDocSendSnackbar=function(e){setTimeout(()=>{f.Snackbar.show(n.default.createElement(f.Snackbar,{title:o.intl.formatMessage({id:"d93ce2",defaultMessage:"Always save signed documents in Dropbox? You can change this anytime in DocSend settings."}),closeButtonText:o.intl.formatMessage({id:"6NGNJV",defaultMessage:"Not now"}),actionButtonText:o.intl.formatMessage({id:"gM7OF1",defaultMessage:"Yes"}),id:"sync-from-docsend",onActionClick:()=>{e&&b.WebUserActionLog.log(e.id,F.WebUserActionLogEvent.CLICK_DOCSEND_SNACKBAR_YES,{}),window.open("https://docsend.com/settings/company/users/redirect?anchor=apps-settings","_blank")},onCloseClick:()=>{e&&b.WebUserActionLog.log(e.id,F.WebUserActionLogEvent.CLICK_DOCSEND_SNACKBAR_NOT_NOW,{})}}))},0)},t.getOpenInAppUrls=function(e,t,r,n){if(e&&t&&r)return e.open_in_app_data;if(w.iOS&&n){const t=encodeURIComponent(e.fq_path),r=encodeURIComponent(n.id);return{platform:v.OpenInMobileAppPlatform.IPHONE,iOSAppUrl:`dbapi-5://1/viewPath?path=${t}&userId=${r}`,iOSAppStoreUrl:"https://itunes.apple.com/us/app/dropbox/id327630330?mt=8e"}}if(w.is_android()){const e="/dl/home/mobile?mobile_app_fallback";return{platform:v.OpenInMobileAppPlatform.ANDROID_MARKET,androidAppUrl:e}}},t.isExcelPreview=function(e){const t="."+a.getExtension(e);return".csv"!==t&&_.MSOFFICE_EXCEL_EXTS.includes(t)}})),define("metaserver/static/js/modules/clean/auth/login_or_register/types",["require","exports"],(function(e,t){"use strict";var r,n,i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Mode=t.LoginOrRegisterKind=t.DownloadAction=t.CommentTextVariant=void 0,(function(e){e.COMMENT="comment",e.DOWNLOAD="download",e.IMMEDIATE="immediate",e.SIDEBAR="sidebar",e.POSTDOWNLOAD="postdownload",e.MOUNT="mount"})(r||(r={})),t.LoginOrRegisterKind=r,(function(e){e.DIRECT_DOWNLOAD="direct_download",e.SAVE_TO_DROPBOX="add_to_dropbox"})(n||(n={})),t.DownloadAction=n,(function(e){e[e.LOGIN=0]="LOGIN",e[e.REGISTER=1]="REGISTER"})(i||(i={})),t.Mode=i,(function(e){e.DEFAULT="",e.POST="post_comment_variant",e.SUBSCRIBE="subscribe_variant"})(s||(s={})),t.CommentTextVariant=s})),define("metaserver/static/js/modules/clean/react/file_viewer/full_screen_helpers",["require","exports","metaserver/static/js/modules/clean/react/file_viewer/data/store","metaserver/static/js/modules/clean/react/file_viewer/data/actions","metaserver/static/js/modules/clean/react/file_viewer/logging","metaserver/static/js/modules/clean/react/file_viewer/constants"],(function(e,t,r,n,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toggleFullScreen=t.isBrowserFullScreen=t.browserSupportFullScreen=t.exitFullScreen=t.enterFullScreen=void 0;const o=r.getStoreForFileViewer(),a=()=>o.dispatch(n.closeFullScreen());let l=a;function c(){v()||S(s.UserActionContext.Browser)}function u(){S(s.UserActionContext.Browser)}function d(){var e;e=c,document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e),(function(e){window.addEventListener("popstate",e)})(u)}function m(){var e;e=c,document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e),(function(e){window.removeEventListener("popstate",e)})(u)}function p({dispatchFunction:e,logContext:t,shouldDispatchReduxAction:r=!0}){(function(e=a){l=e})(e),r&&o.dispatch(n.openFullScreen()),(function(){const e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()})(),d(),t&&i.logUserAction(s.UserAction.ToggleFullscreenOn,t)}function S(e){m(),l(),(function(){const e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()})(),e&&i.logUserAction(s.UserAction.ToggleFullscreenOff,e)}function v(){const e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}t.enterFullScreen=p,t.exitFullScreen=S,t.browserSupportFullScreen=function(){const e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen},t.isBrowserFullScreen=v,t.toggleFullScreen=function(e,t){return e||v()?S(t):p({logContext:t})}})),define("metaserver/static/js/modules/clean/react/file_viewer_sidebar/widgets/seen_states",["require","exports","tslib","react","metaserver/static/js/modules/clean/react/async/loadable","metaserver/static/js/modules/clean/previews/util"],(function(e,t,r,n,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncSeenStatesProviderWrapper=t.AsyncSeenStateFacepileConsumer=t.AsyncSeenStateFacepileProvider=void 0,n=r.__importDefault(n),t.AsyncSeenStateFacepileProvider=i.Loadable({loader:()=>new Promise((t,r)=>{e(["metaserver/static/js/modules/clean/react/pass/seen_state_facepile_controller"],t,r)}).then(r.__importStar).then(({SeenStateFacepileProvider:e})=>e)}),t.AsyncSeenStateFacepileConsumer=i.Loadable({loader:()=>new Promise((t,r)=>{e(["metaserver/static/js/modules/clean/react/pass/seen_state_facepile_consumer"],t,r)}).then(r.__importStar).then(({SeenStateFacepileConsumer:e})=>e)}),t.AsyncSeenStatesProviderWrapper=({children:e,file:r,source:i,isSeenStatesEnabled:o,isVersionHistoryMode:a,isViewingFileSubpath:l,isViewMetadataDisabled:c,sharedLinkInfo:u,sizeClass:d,soloAccessText:m,user:p})=>!o||a||null===r.ns_id||s.isCloudDocPreview(r)?n.default.createElement(n.default.Fragment,null,e):n.default.createElement(t.AsyncSeenStateFacepileProvider,{file:r,source:i,isViewMetadataDisabled:c,isViewingFileSubpath:!!l,sharedLinkInfo:u,sizeClass:d,soloAccessText:m,user:p},e),t.AsyncSeenStatesProviderWrapper.displayName="AsyncSeenStatesProviderWrapper"}));
//# sourceMappingURL=pkg-file-viewer-common.min.js-vflwA5U03.map