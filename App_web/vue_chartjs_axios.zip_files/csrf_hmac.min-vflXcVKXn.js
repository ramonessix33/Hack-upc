define(["require","exports","tslib","metaserver/static/js/modules/clean/security/crypto","metaserver/static/js/modules/clean/security/util","metaserver/static/js/modules/clean/csrf","metaserver/static/js/modules/core/uri"],(function(e,t,r,n,o,i,s){"use strict";function c(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=encodeURIComponent(e),r=o.stringToBytes(t),s=i.readCsrfToken();if(""===s||null===s)throw new Error("Missing CSRF token");const c=o.stringToBytes(s),d=yield n.hmacMessage(c,r);return btoa(o.bytesToString(d))}))}function d(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=s.URI.parse(e),o=yield c(n);return r.updateQuery({[t]:o}),r.toString()}))}Object.defineProperty(t,"__esModule",{value:!0}),t.readHmacCookieToken=t.addHeaderRedirectToken=t.addUrltoken=t.csrfHmacUrltoken=void 0,t.csrfHmacUrltoken=c,t.addUrltoken=d,t.addHeaderRedirectToken=function(e){return r.__awaiter(this,void 0,void 0,(function*(){return yield d(e,"rtoken","header_redirect")}))},t.readHmacCookieToken=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const r=e.split(":");if(3!==r.length)return null;const[s,c,d]=r;if("1"!==s)return null;const a=(new TextEncoder).encode(c);let u=decodeURIComponent(d);try{u=atob(u)}catch(e){return null}const l=o.stringToBytes(u),f=(new TextEncoder).encode(null!=t?t:i.readCsrfToken());return(yield n.verifyMessageHmac(f,a,l))?decodeURIComponent(c):null}))}}));
//# sourceMappingURL=csrf_hmac.min.js-vfll27eLA.map