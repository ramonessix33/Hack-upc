define("metaserver/static/js/modules/clean/devtools/panels/performance/perf_hub_actions",["require","exports","metaserver/static/js/modules/clean/devtools/panels/performance/perf_hub_action_types","metaserver/static/js/modules/clean/flux/dispatcher"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PerfHubActions=void 0;t.PerfHubActions=new class{add_ajax_profile(e,t,s,r){const o=r;return n.Dispatcher.dispatch({type:i.ActionTypes.PROFILED_AJAX_LOAD_FINISHED,data:{url:e,serverResponseTime:t,profileRequestId:s,traceId:o}})}add_web_timing_details(e){return n.Dispatcher.dispatch({type:i.ActionTypes.WEB_TIMING_FETCHED,data:e})}add_visually_complete(e){return n.Dispatcher.dispatch({type:i.ActionTypes.VISUALLY_COMPLETE,time:e})}}})),define("metaserver/static/js/modules/clean/metrics/coin",["require","exports","apex-metrics/index","metaserver/static/js/dropbox/proto/apex_metrics_web/apex_metrics_web","metaserver/static/js/google/protobuf/timestamp","metaserver/static/js/google/protobuf/empty"],(function(e,t,i,n,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.observeCoin=t.APIv2CoinToProtobufCoin=t.protobufCoinToAPIv2Coin=t.newCoinState=void 0,t.newCoinState=function(){return n.apex_metrics_web.ApexMetricsCacheData.CoinState.create({lastFlipTime:null,lastResult:!1,numTimesChecked:0})},t.protobufCoinToAPIv2Coin=function(e){let t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit){case"independent":t={".tag":"independent"};break;case"permanent":t={".tag":"permanent"};break;case"nResults":t={".tag":"n_results",n_results:e.stickiness.nResults};break;case"nSeconds":t={".tag":"n_seconds",n_seconds:e.stickiness.nSeconds}}return{fraction:null!==e.fraction?e.fraction:void 0,stickiness:t?{limit:t}:void 0}},t.APIv2CoinToProtobufCoin=function(e){let t=void 0;if(e.stickiness&&e.stickiness.limit)switch(e.stickiness.limit[".tag"]){case"independent":t={independent:r.google.protobuf.Empty.create()};break;case"permanent":t={permanent:r.google.protobuf.Empty.create()};break;case"n_results":t={nResults:e.stickiness.limit.n_results};break;case"n_seconds":t={nSeconds:e.stickiness.limit.n_seconds}}return n.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.create({fraction:e.fraction,stickiness:t?n.apex_metrics_web.RecordNamespace.StickinessV2.create(t):void 0})},t.observeCoin=function(e,t,n){if(!t.stickiness||!t.stickiness.limit)return{nextState:n,result:!1};const r=Date.now()/1e3,{lastFlipTime:o=s.google.protobuf.Timestamp.create({seconds:0,nanos:0}),lastResult:a,numTimesChecked:c=0}=n;let l=!1;switch(t.stickiness.limit[".tag"]){case"n_results":l=null===c||c%t.stickiness.limit.n_results==0;break;case"n_seconds":if(!o){l=!0;break}l=i.Instant.toMilliseconds({value:(d=r,u=o.seconds,"number"!=typeof d?d.sub(u).toNumber():"number"==typeof u?d-u:u.sub(d).negate().toNumber()),unit:i.TimeUnit.SECONDS})>i.Instant.toMilliseconds({value:t.stickiness.limit.n_seconds,unit:i.TimeUnit.SECONDS});break;case"permanent":l=0===c;break;case"independent":l=!0;break;case"other":default:return{nextState:n,result:!1}}var d,u;if(l){const i=e()<(t.fraction||0);return{nextState:{lastFlipTime:s.google.protobuf.Timestamp.create({seconds:r,nanos:0}),lastResult:i,numTimesChecked:c?c+1:1},result:i}}return{nextState:Object.assign(Object.assign({},n),{numTimesChecked:c?c+1:1}),result:!!a}}})),define("metaserver/static/js/modules/clean/metrics/database",["require","exports","tslib","metaserver/static/js/modules/clean/metrics/instrumentation"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadInstrumentation=t.storeInstrumentation=t.storeIncomingSetSpans=t.storeIncomingSpans=t.checkAndSetPublishTime=t.getDatabase=t.getNamespaceRange=t.INSTRUMENTATION_STORE_KEY=t.INSTRUMENTATION_STORE=t.CONTROL_VALUE_LASTPUBLISHTIME=t.CONTROL_VALUE_STORE=t.NAMESPACE_INDEX=t.SET_STORE=t.SPAN_STORE=t.DATABASE_VERSION=void 0;function s(e,i,n){const s=e.result,r=e=>{s.removeEventListener("error",r),n(e)};s.addEventListener("error",r),e.transaction.addEventListener("complete",()=>{s.removeEventListener("error",r)}),e.transaction.addEventListener("error",e=>{s.removeEventListener("error",r),n(e)});const o=(e,t)=>e.oldVersion<t&&(null===e.newVersion||e.newVersion&&e.newVersion>=t);if(o(i,1))try{s.createObjectStore(t.SPAN_STORE,{keyPath:["namespace","tagNames","tagValues"]}).createIndex(t.NAMESPACE_INDEX,"namespace",{unique:!1}),s.createObjectStore(t.CONTROL_VALUE_STORE,{keyPath:"name"})}catch(e){return void r(e)}if(o(i,2)){const i=e.transaction.objectStore(t.SPAN_STORE).openCursor();i.addEventListener("success",e=>{const t=i.result;if(!t)return;let n=!1;for(const e in t.value.spans)t.value.spans.hasOwnProperty(e)&&(n=!0,t.value.spans[e]={spanCount:0,samples:t.value.spans[e]});n&&t.update(t.value),t.continue()})}if(o(i,3))try{s.createObjectStore(t.INSTRUMENTATION_STORE,{keyPath:"name"})}catch(e){return void r(e)}if(o(i,4))try{e.transaction.objectStore(t.SPAN_STORE).clear(),e.transaction.objectStore(t.INSTRUMENTATION_STORE).clear()}catch(e){return void r(e)}if(o(i,5))try{s.createObjectStore(t.SET_STORE,{keyPath:["namespace","tagNames","tagValues"]}).createIndex(t.NAMESPACE_INDEX,"namespace",{unique:!1})}catch(e){return void r(e)}}function r(e,t,i,n){return Promise.all(t.map(t=>new Promise((s,r)=>{let o;try{o=e.transaction(i,"readwrite")}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return void s();throw e}const a=o.objectStore(i);o.addEventListener("complete",e=>s()),o.addEventListener("error",e=>r(e));const c=[],l=[];for(const e in t.tags)t.tags.hasOwnProperty(e)&&(c.push(e),l.push(t.tags[e]));const d=a.get([t.namespace,c,l]);d.addEventListener("success",e=>{const i=d.result?d.result:{namespace:t.namespace,tagNames:c,tagValues:l,spans:{}};i.spans[t.metricName]||(i.spans[t.metricName]={spanCount:0,samples:[]}),i.spans[t.metricName].spanCount++,i.spans[t.metricName].samples=n(i.spans[t.metricName].samples.concat(t.samples)),a.put(i)})})))}function o(e,t,i){try{return e.transaction(t,i)}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return null;throw e}}function a(e,t){return new Promise((i,n)=>{const s=e.get(t);s.addEventListener("success",e=>{i(s.result)}),s.addEventListener("error",e=>{n(e)})})}t.DATABASE_VERSION=5,t.SPAN_STORE="spans",t.SET_STORE="set_spans",t.NAMESPACE_INDEX="namespace",t.CONTROL_VALUE_STORE="controlValues",t.CONTROL_VALUE_LASTPUBLISHTIME="lastPublishTime",t.INSTRUMENTATION_STORE="selfInstrumentation",t.INSTRUMENTATION_STORE_KEY="instrumentation",t.getNamespaceRange=function(e,i){return new Promise((n,s)=>{const r=e.index(t.NAMESPACE_INDEX).getKey(IDBKeyRange.lowerBound(i,!0));r.addEventListener("success",e=>{if(r.result){const e=r.result[0];n(IDBKeyRange.bound([i],[e],!1,!0))}else n(IDBKeyRange.lowerBound([i]))}),r.addEventListener("error",e=>{s(e)})})},t.getDatabase=function(e=t.DATABASE_VERSION){return i.__awaiter(this,void 0,void 0,(function*(){let t=null;if("undefined"==typeof indexedDB)return t;try{t=yield new Promise((t,i)=>{indexedDB.open("unused",1);const n=indexedDB.open("apexMetrics",e);n.addEventListener("success",()=>{t(n.result)}),n.addEventListener("error",e=>{i(e)}),n.addEventListener("upgradeneeded",e=>{try{s(n,e,i)}catch(e){i(e)}})})}catch(i){i.target&&i.target.error&&i.target.error.name&&"VersionError"===i.target.error.name&&(yield new Promise((e,t)=>{const i=indexedDB.deleteDatabase("apexMetrics");i.addEventListener("success",()=>e()),i.addEventListener("error",e=>t(e))}),t=yield new Promise((t,i)=>{const n=indexedDB.open("apexMetrics",e);n.addEventListener("success",()=>t(n.result)),n.addEventListener("error",e=>i(e)),n.addEventListener("upgradeneeded",e=>{try{s(n,e,i)}catch(e){i(e)}})}))}return t}))},t.checkAndSetPublishTime=function(e,n,s){return new Promise((r,o)=>i.__awaiter(this,void 0,void 0,(function*(){let i;try{i=e.transaction(t.CONTROL_VALUE_STORE,"readwrite").objectStore(t.CONTROL_VALUE_STORE)}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return void r(!1);throw e}const a=i.get(t.CONTROL_VALUE_LASTPUBLISHTIME);a.addEventListener("success",e=>{const c=a.result;if(c&&n-+c.value<s)return void r(!1);const l=i.put({name:t.CONTROL_VALUE_LASTPUBLISHTIME,value:n});l.addEventListener("success",()=>{r(!0)}),l.addEventListener("error",e=>{o(e)})}),a.addEventListener("error",e=>{o(e)})})))},t.storeIncomingSpans=function(e,i){return r(e,i,t.SPAN_STORE,e=>(e.sort(),e))},t.storeIncomingSetSpans=function(e,i){return r(e,i,t.SET_STORE,e=>[...new Set(e)])},t.storeInstrumentation=function(e,s){return new Promise((r,c)=>i.__awaiter(this,void 0,void 0,(function*(){var i,l;const d=o(e,t.INSTRUMENTATION_STORE,"readwrite");if(null===d)return void r();const u=d.objectStore(t.INSTRUMENTATION_STORE);d.addEventListener("complete",()=>{r()}),d.addEventListener("error",c);const m=null!==(l=null===(i=yield a(u,t.INSTRUMENTATION_STORE_KEY))||void 0===i?void 0:i.value)&&void 0!==l?l:n.Instrumentation.empty(),p=n.Instrumentation.merge(s,m);yield(function(e,t){return new Promise((i,n)=>{const s=e.put(t);s.addEventListener("success",e=>{i()}),s.addEventListener("error",e=>{n(e)})})})(u,{name:t.INSTRUMENTATION_STORE_KEY,value:p})})))},t.loadInstrumentation=function(e,s){return new Promise((r,c)=>i.__awaiter(this,void 0,void 0,(function*(){var i,l;const d=o(e,t.INSTRUMENTATION_STORE,"readwrite");if(null===d)return void r(s);d.addEventListener("error",c);const u=d.objectStore(t.INSTRUMENTATION_STORE),m=null!==(l=null===(i=yield a(u,t.INSTRUMENTATION_STORE_KEY))||void 0===i?void 0:i.value)&&void 0!==l?l:n.Instrumentation.empty();d.addEventListener("complete",()=>{r(n.Instrumentation.merge(s,m))}),(function(e,t){new Promise((i,n)=>{const s=e.delete(t);s.addEventListener("success",e=>{i()}),s.addEventListener("error",e=>{n(e)})})})(u,t.INSTRUMENTATION_STORE_KEY)})))}})),define("metaserver/static/js/modules/clean/metrics/filter",["require","exports","tslib","metaserver/static/js/modules/clean/metrics/coin","metaserver/static/js/modules/clean/metrics/database","metaserver/static/js/modules/clean/metrics/serialization","apex-metrics/hyperloglog"],(function(e,t,i,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpanGroupFilter=t.makeNamespaceMap=void 0;function a(e,t){return i.__awaiter(this,void 0,void 0,(function*(){let i=null;if(crypto.subtle&&window.TextEncoder){const e=new TextEncoder,n=yield crypto.subtle.digest("SHA-256",e.encode(t));i=new Uint32Array(n).reduce((e,t)=>e^t)}return null===i?0:((i^e)>>>0)/4294967296}))}t.makeNamespaceMap=function(e,t){const i={};for(const s of e){const e=s.metric_namespace;i[e]={dropFractionOfHostsPerMetric:s.drop_fraction_of_hosts_per_metric||null,dropPeriodCoin:s.drop_periods?{config:s.drop_periods,state:t.namespaceCoinState&&t.namespaceCoinState[e]&&t.namespaceCoinState[e].dropPeriodCoin||n.newCoinState()}:null,dropSamplesCoin:s.drop_samples?{config:s.drop_samples,state:t.namespaceCoinState&&t.namespaceCoinState[e]&&t.namespaceCoinState[e].dropSamplesCoin||n.newCoinState()}:null}}return i};class c{constructor(e,t,i,n,s,r){this.filterID=e,this.randomEngine=t,this.clock=i,this.maxScopes=n,this.namespaceMap=s,this.configuredNamespaces=r}extend(e,t,i){return new c(this.filterID,this.randomEngine,this.clock,e||this.maxScopes,Object.assign(Object.assign({},this.namespaceMap),t),i)}getState(){const e={filterID:this.filterID,namespaceCoinState:{}};for(const t in this.namespaceMap)this.namespaceMap.hasOwnProperty(t)&&(e.namespaceCoinState[t]={dropPeriodCoin:this.namespaceMap[t].dropPeriodCoin?Object.assign({},this.namespaceMap[t].dropPeriodCoin.state):null,dropSamplesCoin:this.namespaceMap[t].dropSamplesCoin?Object.assign({},this.namespaceMap[t].dropSamplesCoin.state):null});return e}getConfiguredNamespaces(){return this.configuredNamespaces}partitionAndSerializeSpans(e,t,c,l){return i.__awaiter(this,void 0,void 0,(function*(){return new Promise((d,u)=>{const m=[];let p=0;const _=new Map;let h,g=0;const f=new Set;try{h=e.transaction([s.SPAN_STORE,s.SET_STORE],"readwrite")}catch(e){if(e instanceof DOMException&&("InvalidStateError"===e.name||11===e.code))return void d({scopes:[],storedNamespaces:f,spansRetained:0,samplesRetainedByNs:new Map,observationsRetained:0});throw e}const v=new Map,S=new Set;h.addEventListener("complete",()=>d({scopes:m,storedNamespaces:f,spansRetained:p,samplesRetainedByNs:_,observationsRetained:g})),h.addEventListener("error",e=>u(e));const w=[{storeName:s.SPAN_STORE,serializeSamplesFunc:(e,t,i,n,s)=>{var r;l.includes(n)||(p+=s,_.set(n,(null!==(r=_.get(n))&&void 0!==r?r:0)+i.length)),(function(e,t,i){t.metrics.push({name:{value:{".tag":"string_value",string_value:e}},data:{".tag":"numerical_data",samples:i}})})(e,t,i)}},{storeName:s.SET_STORE,serializeSamplesFunc:(e,t,i,n,s)=>{l.includes(n)||(g+=i.length),(function(e,t,i){i.length>80?t.metrics.push({name:{value:{".tag":"string_value",string_value:e}},data:{".tag":"set_data",hyperloglog:{registers:new o.HyperLogLog(i).compressed()}}}):t.metrics.push({name:{value:{".tag":"string_value",string_value:e}},data:{".tag":"set_data",samples:i}})})(e,t,i)}}];for(const{storeName:e,serializeSamplesFunc:o}of w){const l=h.objectStore(e);let d;try{d=l.index(s.NAMESPACE_INDEX)}catch(e){return void u(e)}const p=d.openKeyCursor(null,"nextunique");p.addEventListener("success",()=>i.__awaiter(this,void 0,void 0,(function*(){var e;const d=p.result;if(!d)return;const _=d.key;if(0!==this.maxScopes&&m.length===this.maxScopes&&!S.has(_))return;if(f.add(_),!this.configuredNamespaces.has(_))return void d.continue();const{dropPeriodCoin:h,dropSamplesCoin:g,dropFractionOfHostsPerMetric:w}=this.namespaceMap[_]||{};let b;try{b=yield s.getNamespaceRange(l,_)}catch(e){return void u(e)}if(h){const{result:e,nextState:t}=n.observeCoin(this.randomEngine,h.config,h.state);if(h.state=t,e)return l.delete(b),void d.continue()}const T=null!==(e=v.get(_))&&void 0!==e?e:{metric_namespace:_,timestamp_sec:c,tags:r.formatTags(t),descendants:[]};v.set(_,T);const E=l.openCursor(b);E.addEventListener("success",()=>i.__awaiter(this,void 0,void 0,(function*(){const e=E.result;if(!e)return T.descendants.length>0&&!S.has(_)&&(m.push(T),S.add(_)),void d.continue();const t={tags:r.zipTags(e.value.tagNames,e.value.tagValues),metrics:[]},i=e.value.spans;for(const e in i){if(!i.hasOwnProperty(e))continue;if(w){if((yield a(this.filterID,e))<w)continue}let s=i[e].samples;if(g&&(s=s.filter(e=>{const{result:t,nextState:i}=n.observeCoin(this.randomEngine,g.config,g.state);return g.state=i,!t})),0===s.length)continue;const r=i[e].spanCount;o(e,t,s,_,r)}t.metrics.length>0&&T.descendants.push(t),e.delete(),e.continue()})))})))}})}))}}t.SpanGroupFilter=c})),define("metaserver/static/js/modules/clean/metrics/index",["require","exports","tslib","apex-metrics/index","metaserver/static/js/modules/clean/metrics/database","metaserver/static/js/modules/clean/metrics/apiv2_sink","metaserver/static/js/modules/clean/metrics/unload","metaserver/static/js/modules/clean/metrics/server_view_sink","metaserver/static/js/modules/core/browser_detection","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/clean/uuid/insecure_uuid"],(function(e,t,i,n,s,r,o,a,c,l,d){"use strict";function u(){return new n.BrowserPerformanceClock}function m(){return i.__awaiter(this,void 0,void 0,(function*(){const{NoAuthApiV2Client:t}=yield new Promise((t,i)=>{e(["metaserver/static/js/api_v2/noauth_client"],t,i)}).then(i.__importStar);return new t}))}function p(){const e=[[!!c.chrome,"chrome"],[!!c.edge,"edge"],[!!c.mozilla,"firefox"],[!!c.msie,"msie"],[!!c.safari,"safari"]];for(const t of e)if(t[0])return t[1];return"other"}function _(){return c.mac?{name:{".tag":"mac"},version:"unknown"}:c.windows?{name:{".tag":"windows"},version:(e=c.windowsInfo,e.windowsXP||e.windowsXPx64?"XP":e.windowsVista?"Vista":e.windows7?"7":e.windows8?"8":e.windows8_1?"8.1":e.windows10?"10 Unknown":"unknown")}:c.is_android()?{name:{".tag":"android"},version:"unknown"}:c.iOS?{name:{".tag":"ios"},version:"unknown"}:{name:{".tag":"unknown_os"},version:"unknown"};var e}Object.defineProperty(t,"__esModule",{value:!0}),t.getUnloadMetricsReporter=t.getMetricsReporter=void 0,c=i.__importStar(c),l=i.__importStar(l);const h=r.makeDefaultCacheFactory(),g={detectBrowser:p,detectOS:_};function f(e){if(void 0===e&&(e=window.sinkSingleton?window.sinkSingleton.clientFactory:m),window.sinkSingleton)return window.sinkSingleton.clientFactory=e,window.sinkSingleton;const t=new r.Apiv2MetricsSink(e,u(),r.makeDefaultInitialization(e,g,l),h,new n.SetTimeoutExecutor(()=>({value:5*Math.random(),unit:n.TimeUnit.SECONDS})),Math.random,s.getDatabase,g,l,()=>d.InsecureUUID.v4());return window.sinkSingleton=t,t}const v=new a.ServerViewMetricsSink;t.getMetricsReporter=function(){const e=f();return void 0!==window._clientBridge?n.MetricsReporterImpl.root(v,u(),e.getOriginId()):n.MetricsReporterImpl.root(e,u(),e.getOriginId())},t.getUnloadMetricsReporter=function(){const e=f(),t=(function(e){if(void 0===e&&(e=window.sinkSingleton?window.sinkSingleton.clientFactory:m),window.unloadSinkSingleton)return window.sinkSingleton.clientFactory=e,window.unloadSinkSingleton;const t=new o.UnloadSink(h,f(e));return window.unloadSinkSingleton=t,t})();return n.MetricsReporterImpl.root(t,u(),e.getOriginId())}})),define("metaserver/static/js/modules/clean/metrics/instrumentation",["require","exports","apex-metrics/index","metaserver/static/js/modules/clean/metrics/serialization"],(function(e,t,i,n){"use strict";function s(e,t,i,n){i("samples_sink/submitted_spans",e.submittedSpans),i("samples_sink/submitted_samples",e.submittedSamples);for(const[t,n]of Object.entries(e.submittedSamplesByNs))i("samples_sink/submitted_samples_by_ns",n,{namespace:t});i("samples_sink/retained_spans",e.retainedSpans),i("samples_sink/retained_samples",e.retainedSamples);for(const[t,n]of Object.entries(e.retainedSamplesByNs))i("samples_sink/retained_samples_by_ns",n,{namespace:t});i("samples_sink/request/dropped_samples",e.requestDroppedSamples),i("samples_sink/request/dropped_spans",e.requestDroppedSpans),i("samples_sink/request/attempts",e.requestAttempts),i("samples_sink/request/latency",t),i("samples_sink/submitted_set_observations",e.setObservations);for(const[t,n]of Object.entries(e.setObservationsByNs))i("samples_sink/submitted_set_observations_by_ns",n,{namespace:t});i("samples_sink/request/dropped_set_observations",e.requestDroppedSetObservations),n("samples_sink/reporting_hosts")}Object.defineProperty(t,"__esModule",{value:!0}),t.Instrumentation=t.SELF_INSTRUMENTATION_NAMESPACE=void 0,t.SELF_INSTRUMENTATION_NAMESPACE="amp_client",(function(e){function r(e,t){var i;const n=Object.assign({},e);for(const[e,s]of Object.entries(t))n[e]=(null!==(i=n[e])&&void 0!==i?i:0)+s;return n}e.empty=function(){return{submittedSpans:0,submittedSamples:0,submittedSamplesByNs:{},retainedSpans:0,retainedSamples:0,retainedSamplesByNs:{},requestDroppedSamples:0,requestDroppedSpans:0,requestAttempts:0,setObservations:0,setObservationsByNs:{},requestDroppedSetObservations:0}},e.incrementSubmittedSamples=function(e,t,i){e.submittedSamples+=i;const n=e.submittedSamplesByNs[t];e.submittedSamplesByNs[t]=(null!=n?n:0)+i},e.incrementSetObservations=function(e,t,i){e.setObservations+=i;const n=e.setObservationsByNs[t];e.setObservationsByNs[t]=(null!=n?n:0)+i},e.incrementRetainedSamples=function(e,t,i){e.retainedSamples+=i;const n=e.retainedSamplesByNs[t];e.retainedSamplesByNs[t]=(null!=n?n:0)+i},e.report=function(i,n,r,o){if(0===i.retainedSamples)return i.requestAttempts=0,i;const a=n.child({client_version:o.toString()});return s(i,r,(e,i,n)=>{a.createStats({ns:t.SELF_INSTRUMENTATION_NAMESPACE,name:e},n).record(i)},e=>{a.createSet({ns:t.SELF_INSTRUMENTATION_NAMESPACE,name:e}).observeOriginId()}),e.empty()},e.toScope=function(e,r,o,a){const c=[];return s(e,o,(e,t,i)=>{c.push({tags:i?n.formatTags(i):[],metrics:[{name:{value:{".tag":"string_value",string_value:e}},data:{".tag":"numerical_data",samples:[t]}}]})},e=>{c.push({metrics:[{name:{value:{".tag":"string_value",string_value:e}},data:{".tag":"set_data",samples:[i.hash(r)]}}]})}),{metric_namespace:t.SELF_INSTRUMENTATION_NAMESPACE,timestamp_sec:Math.floor(Date.now()/1e3),tags:n.formatTags(a),descendants:c}},e.merge=function(e,t){var i,n,s,o,a,c,l,d,u,m,p,_;return{submittedSpans:e.submittedSpans+(null!==(i=t.submittedSpans)&&void 0!==i?i:0),submittedSamples:e.submittedSamples+(null!==(n=t.submittedSamples)&&void 0!==n?n:0),submittedSamplesByNs:r(e.submittedSamplesByNs,null!==(s=t.submittedSamplesByNs)&&void 0!==s?s:{}),retainedSpans:e.retainedSpans+(null!==(o=t.retainedSpans)&&void 0!==o?o:0),retainedSamples:e.retainedSamples+(null!==(a=t.retainedSamples)&&void 0!==a?a:0),retainedSamplesByNs:r(e.retainedSamplesByNs,null!==(c=t.retainedSamplesByNs)&&void 0!==c?c:{}),requestDroppedSamples:e.requestDroppedSamples+(null!==(l=t.requestDroppedSamples)&&void 0!==l?l:0),requestDroppedSpans:e.requestDroppedSpans+(null!==(d=t.requestDroppedSpans)&&void 0!==d?d:0),requestAttempts:e.requestAttempts+(null!==(u=t.requestAttempts)&&void 0!==u?u:0),setObservations:e.setObservations+(null!==(m=t.setObservations)&&void 0!==m?m:0),setObservationsByNs:r(e.setObservationsByNs,null!==(p=t.setObservationsByNs)&&void 0!==p?p:{}),requestDroppedSetObservations:e.requestDroppedSetObservations+(null!==(_=t.requestDroppedSetObservations)&&void 0!==_?_:0)}}})(t.Instrumentation||(t.Instrumentation={}))})),define("metaserver/static/js/modules/clean/metrics/serialization",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zipTags=t.formatTags=void 0,t.formatTags=function(e){const t=[];for(const i in e)if(e.hasOwnProperty(i)){const n=e[i];t.push({name:{value:{".tag":"string_value",string_value:i}},value:{value:{".tag":"string_value",string_value:n}}})}return t},t.zipTags=function(e,t){if(e.length!==t.length)throw new Error("Cannot zip values of different dimensions!");return e.map((e,i)=>({name:{value:{".tag":"string_value",string_value:e}},value:{value:{".tag":"string_value",string_value:t[i]}}}))}})),define("metaserver/static/js/modules/clean/metrics/apiv2_sink",["require","exports","tslib","apex-metrics/index","eventemitter3","metaserver/static/js/modules/clean/metrics/coin","metaserver/static/js/modules/clean/metrics/database","metaserver/static/js/modules/clean/metrics/filter","metaserver/static/js/modules/clean/metrics/instrumentation","metaserver/static/js/google/protobuf/timestamp","metaserver/static/js/dropbox/proto/apex_metrics_web/apex_metrics_web","metaserver/static/js/proto_utils/unpack"],(function(e,t,i,n,s,r,o,a,c,l,d,u){"use strict";var m;Object.defineProperty(t,"__esModule",{value:!0}),t.Apiv2MetricsSink=t._ORIGIN_IDENTIFIER_KEY=t.makeDefaultCacheFactory=t._PERSISTENTCACHE_KEY=t.makeDefaultInitialization=t.makeNopPlatformDetector=t.CLIENT_VERSION=t.PublishType=void 0,s=i.__importDefault(s),(function(e){e.ALLOWED="allowed",e.DENIED="denied"})(m=t.PublishType||(t.PublishType={}));const p={".tag":"trigger_heartbeat"},_={".tag":"trigger_publish"};t.CLIENT_VERSION=19;function h(e,i,n,s,r){const o=[];return i.forEach(e=>o.push(e)),{scopes:e,known_namespaces:o,environment:"prod",artifact_name:"dropbox-web",artifact_version:"0000000000000000000000000000000000000000",client_metadata:{client_version:t.CLIENT_VERSION,implementation:{".tag":"typescript"}},trigger:n,os:s,origin_identifier:r}}t.makeNopPlatformDetector=function(){return{detectBrowser:()=>"other",detectOS:()=>({name:{".tag":"unknown_os"},version:"unknown"})}},t.makeDefaultInitialization=function(e,n,s){return(o,a)=>i.__awaiter(this,void 0,void 0,(function*(){let i=[];if(o){const e=(function(e,i){const n=e.getItem(t._PERSISTENTCACHE_KEY);if(null===n)return null;const s=Date.now()/1e3;let o,a=[];try{o=u.unpackProto(n,d.apex_metrics_web.ApexMetricsCacheData)}catch(e){return i.reportException({err:e,tags:["js:web:amp-sink","js:web:amp-sink/local-storage"],severity:"non-critical"}),null}if(!o.config||!o.state||!o.timeStored)return i.reportStack("Sink cache was missing data",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"]}),null;const c=(function(e,t){if("number"!=typeof e)return e.sub(t).toNumber();if("number"==typeof t)return e-t;return t.sub(e).negate().toNumber()})(s,o.timeStored.seconds);if(c<0)return i.reportStack("Sink cache was stored in the future instead of the past",{tags:["js:web:amp-sink","js:web:amp-sink/local-storage"],exc_extra:{cacheDataAge:c}}),null;const l={};o.config&&(a=o.config.reportingConfigs.map(e=>e.metricNamespace),l.reporting_configs=o.config.reportingConfigs?o.config.reportingConfigs.filter(e=>c<e.maxTimeUntilRefreshSeconds).map(e=>({metric_namespace:e.metricNamespace,max_time_until_refresh_seconds:e.maxTimeUntilRefreshSeconds,stop_publication_for_seconds:e.stopPublicationForSeconds,drop_samples:e.dropSamples?r.protobufCoinToAPIv2Coin(e.dropSamples):void 0,drop_periods:e.dropPeriods?r.protobufCoinToAPIv2Coin(e.dropPeriods):void 0,drop_fraction_of_hosts_per_metric:e.dropFractionOfHostsPerMetric,aggregation_interval_seconds:e.aggregationIntervalSeconds})):[],l.publication_interval_seconds=o.config.publicationIntervalSeconds,l.max_scopes_per_request=o.config.maxScopesPerRequest,l.stop_publication_for_seconds=o.config.stopPublicationForSeconds,l.debug_infos=o.config.debugInfos);return{config:l,state:o.state,knownNamespaces:a}})(o,s);if(e){i=e.knownNamespaces;const t=new Set;if(e.config.reporting_configs.forEach(e=>t.add(e.metric_namespace)),!i.some(e=>!t.has(e)))return e}}const c=new Set;i.forEach(e=>c.add(e));const l=n.detectOS(),m=yield e();return{knownNamespaces:i,config:yield m.ns("client_metrics").rpc("record",h([],c,p,l,a),{}),state:{filterID:Math.floor(4294967296*Math.random())>>>0,namespaceCoinState:{}}}}))},t._PERSISTENTCACHE_KEY="amp-sink-cache",t.makeDefaultCacheFactory=function(){return()=>{try{return window.localStorage||null}catch(e){return null}}},t._ORIGIN_IDENTIFIER_KEY="amp-sink-origin-id";t.Apiv2MetricsSink=class{constructor(e,i,n,r,o,a,l,d,u,m){this.clientFactory=e,this.clock=i,this.initializer=n,this.cacheFactory=r,this.executor=o,this.randomEngine=a,this.databaseFactory=l,this.platformDetector=d,this.excReporter=u,this.nextRequest=null,this.knownNamespaces=new Set,this.bufferedSpans=[],this.bufferedSetSpans=[],this.instrumentation=c.Instrumentation.empty(),this.eventEmitter=new s.default,this.cache=this.cacheFactory(),this.originIdentifier=(function(e,i){if(e){let n=e.getItem(t._ORIGIN_IDENTIFIER_KEY);return null===n&&(n=i(),e.setItem(t._ORIGIN_IDENTIFIER_KEY,n)),n}return""})(this.cache,m),this.currentRequest=this.initializer(this.cache,this.originIdentifier).then(e=>(e&&this.updateConfiguration(e.config,e.state),this.eventEmitter.emit("initialized"),e.config||null))}getOriginId(){return this.originIdentifier}updateConfiguration(e,i){const{reporting_configs:s=[],stop_publication_for_seconds:o,publication_interval_seconds:a}=e,c=new Set;s.forEach(e=>{this.knownNamespaces.add(e.metric_namespace),c.add(e.metric_namespace)}),this.updateBlackoutCallback({value:o,unit:n.TimeUnit.SECONDS}),this.updatePublishTimer({value:a,unit:n.TimeUnit.SECONDS}),this.updateSpanGroupFilter(e,i,c),this.cache&&(function(e,i,n){try{const s=Math.floor(Date.now()/1e3),o=d.apex_metrics_web.ApexMetricsCacheData.create({config:d.apex_metrics_web.RecordNamespace.RecordResponse.create({reportingConfigs:i.reporting_configs?i.reporting_configs.map(e=>d.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.create({metricNamespace:e.metric_namespace,maxTimeUntilRefreshSeconds:e.max_time_until_refresh_seconds,stopPublicationForSeconds:e.stop_publication_for_seconds,dropSamples:e.drop_samples?r.APIv2CoinToProtobufCoin(e.drop_samples):void 0,dropPeriods:e.drop_periods?r.APIv2CoinToProtobufCoin(e.drop_periods):void 0,dropFractionOfHostsPerMetric:e.drop_fraction_of_hosts_per_metric,aggregationIntervalSeconds:e.aggregation_interval_seconds})):[],publicationIntervalSeconds:i.publication_interval_seconds,maxScopesPerRequest:i.max_scopes_per_request,stopPublicationForSeconds:i.stop_publication_for_seconds,debugInfos:i.debug_infos||[]}),timeStored:l.google.protobuf.Timestamp.create({seconds:s,nanos:0}),state:n});e.setItem(t._PERSISTENTCACHE_KEY,u.packProto(o))}catch(e){}})(this.cache,e,i)}updateSpanGroupFilter(e,t,i){const{reporting_configs:n=[],max_scopes_per_request:s}=e,r=new Set,o=i.values();for(let e=o.next();!e.done;e=o.next())r.add(e.value);const c=a.makeNamespaceMap(n,t);this.spanGroupFilter=this.spanGroupFilter?this.spanGroupFilter.extend(s,c,r):new a.SpanGroupFilter(t.filterID,this.randomEngine,this.clock,s,c,r)}updateBlackoutCallback(e){0!==e.value?(this.blackoutCallback=()=>(this.blackoutCallback=null,this.eventEmitter.emit("publicationResumed"),!1),this.eventEmitter.emit("publicationPaused"),this.executor.executeEvery(e,this.blackoutCallback)):this.blackoutCallback=null}updatePublishTimer(e){const t=e.unit===n.TimeUnit.SECONDS?e.value:n.Instant.toMilliseconds(e)/1e3;if(0===e.value)return void(this.publishTimer=null);if(this.publishTimer&&n.Instant.toMilliseconds(this.publishTimer.period)===n.Instant.toMilliseconds(e))return;const s={period:e,callback:()=>this.publishTimer===s&&(this.nextRequest=this.currentRequest.then(()=>i.__awaiter(this,void 0,void 0,(function*(){this.nextRequest=null;const e=Math.floor(Date.now()/1e3),i=yield this.getDB();if(i)try{(yield o.checkAndSetPublishTime(i,e,t))&&(this.currentRequest=this.send())}catch(e){this.excReporter.reportException({err:e,tags:["js:web:amp-sink"],severity:"operational"})}}))),!0)};this.publishTimer=s,this.executor.executeEvery(this.publishTimer.period,this.publishTimer.callback)}send(){return i.__awaiter(this,void 0,void 0,(function*(){if(this.blackoutCallback)return this.eventEmitter.emit("publish",m.DENIED),null;const e=Math.floor(Date.now()/1e3),t={browser:this.platformDetector.detectBrowser()},i=yield this.getDB();if(!i)return null;let n,s,r,a,l;try{({scopes:n,storedNamespaces:s,spansRetained:r,samplesRetainedByNs:a,observationsRetained:l}=yield this.spanGroupFilter.partitionAndSerializeSpans(i,t,e,[c.SELF_INSTRUMENTATION_NAMESPACE]))}catch(e){return this.excReporter.reportException({err:e,tags:["js:web:amp-sink"],severity:"operational"}),null}let d=c.Instrumentation.empty();d.retainedSpans+=r;let u=0;a.forEach((e,t)=>{c.Instrumentation.incrementRetainedSamples(d,t,e),u+=e});let p=n.length>0;if(this.knownNamespaces.forEach(e=>s.add(e)),!p){const e=this.spanGroupFilter.getConfiguredNamespaces(),t=s.values();for(let i=t.next();!i.done;i=t.next())if(!e.has(i.value)){p=!0;break}}let g=null;if(p){d=yield o.loadInstrumentation(i,d);const e=this.platformDetector.detectOS(),a=h(n,s,_,e,this.originIdentifier),c=this.clock.now();d.requestAttempts++;try{const i=yield this.clientFactory();g=yield i.ns("client_metrics").rpc("record",a,{}),d=yield this.reportInstrumentation(e,d,c,t)}catch(e){d.requestDroppedSpans+=r,d.requestDroppedSamples+=u,d.requestDroppedSetObservations+=l}g&&this.updateConfiguration(g,this.spanGroupFilter.getState())}return yield o.storeInstrumentation(i,d),this.eventEmitter.emit("publish",m.ALLOWED),g}))}reportInstrumentation(e,s,r,o){return i.__awaiter(this,void 0,void 0,(function*(){const i=n.Instant.toMilliseconds(this.clock.now())-n.Instant.toMilliseconds(r);if((function(e){return!!e.name&&("android"===e.name[".tag"]||"ios"===e.name[".tag"])})(e))try{const n=Object.assign({client_version:t.CLIENT_VERSION.toString()},o),r=h([c.Instrumentation.toScope(s,this.originIdentifier,i,n)],new Set([c.SELF_INSTRUMENTATION_NAMESPACE]),_,e,this.originIdentifier),a=yield this.clientFactory();return yield a.ns("client_metrics").rpc("record",r,{}),c.Instrumentation.empty()}catch(e){return s}return c.Instrumentation.report(s,n.MetricsReporterImpl.root(this,this.clock,this.originIdentifier),i,t.CLIENT_VERSION)}))}getDB(){return i.__awaiter(this,void 0,void 0,(function*(){return this.database||(this.database=yield this.databaseFactory()),this.database}))}recordSpan(e){if(e.namespace!==c.SELF_INSTRUMENTATION_NAMESPACE){let t="UNCONFIGURED";this.spanGroupFilter&&this.spanGroupFilter.getConfiguredNamespaces().has(e.namespace)&&(t=e.namespace),this.instrumentation.submittedSpans++,c.Instrumentation.incrementSubmittedSamples(this.instrumentation,t,e.samples.length)}this.knownNamespaces.add(e.namespace),this.bufferedSpans.push(e),this.maybeScheduleNextRequest()}recordSetSpan(e){if(e.namespace!==c.SELF_INSTRUMENTATION_NAMESPACE){let t="UNCONFIGURED";this.spanGroupFilter&&this.spanGroupFilter.getConfiguredNamespaces().has(e.namespace)&&(t=e.namespace),c.Instrumentation.incrementSetObservations(this.instrumentation,t,e.samples.length)}this.knownNamespaces.add(e.namespace),this.bufferedSetSpans.push(e),this.maybeScheduleNextRequest()}maybeScheduleNextRequest(){this.nextRequest||(this.nextRequest=this.currentRequest.then(()=>i.__awaiter(this,void 0,void 0,(function*(){const e=yield this.getDB();if(!e)return;const t=this.bufferedSpans,i=this.bufferedSetSpans;this.bufferedSpans=[],this.bufferedSetSpans=[];const n=this.instrumentation;this.instrumentation=c.Instrumentation.empty();try{yield Promise.all([o.storeIncomingSpans(e,t),o.storeIncomingSetSpans(e,i),o.storeInstrumentation(e,n)])}catch(e){this.excReporter.reportException({err:e,tags:["js:web:amp-sink"],severity:"operational"})}this.publishTimer||(this.currentRequest=this.send()),this.nextRequest=null}))))}}})),define("metaserver/static/js/modules/clean/metrics/server_view_sink",["require","exports","tslib"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerViewMetricsSink=void 0;t.ServerViewMetricsSink=class{constructor(){this.spans=[],this.bridgeInitialized=!1}recordSpan(e){this.spans.push(e),this.bridgeInitialized||this.initializeBridgeSink()}recordSetSpan(e){}initializeBridgeSink(){return i.__awaiter(this,void 0,void 0,(function*(){this.bridgeInitialized=!0;const t=yield new Promise((t,i)=>{e(["metaserver/static/js/modules/clean/server_side_client_view_bridge"],t,i)}).then(i.__importStar);(yield t.IsBridgeFunctionSupported("reportMetricsV2"))?(setInterval(()=>{this.spans.length>0&&(t.ReportMetrics(this.spans),this.spans=[])},5e3),window.addEventListener("beforeunload",()=>{this.spans.length>0&&(console.log(`Attempting to send ${this.spans.length} pending AMP spans`),t.ReportMetrics(this.spans),this.spans=[])})):setInterval((function(){this.spans=[]}),6e4)}))}}})),define("metaserver/static/js/modules/clean/metrics/unload",["require","exports","tslib","eventemitter3"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnloadSink=void 0,n=i.__importDefault(n);t.UnloadSink=class{constructor(e,t){this.cacheFactory=e,this.innerSink=t,this.eventEmitter=new n.default,this.onUnloadChange=()=>{this.isUnload()||this.flushToInner()},this.persistor=new r(this.cacheFactory()),this.listener=new s(this.onUnloadChange),this.onUnloadChange()}flushToInner(){this.persistor.getAllAndClear().forEach(e=>{this.recordSpanToInner(e)})}isUnload(){return Boolean(this.listener.isUnload)}recordSpan(e){if(this.isUnload())return this.persistor.persistSpans([e]),void this.eventEmitter.emit("spansPersistedInUnload");this.recordSpanToInner(e)}recordSetSpan(e){}recordSpanToInner(e){const t=Object.assign(Object.assign({},e),{fromUnloadSink:!0});this.innerSink.recordSpan(t)}};class s{constructor(e){this.onUnloadChange=e,this._isUnload=!1,this.listenForNavigationChanges()}get isUnload(){return this._isUnload}set isUnload(e){this._isUnload!==e&&(this._isUnload=e,this.onUnloadChange())}listenForNavigationChanges(){if("undefined"!=typeof window&&"function"==typeof window.addEventListener&&"function"==typeof document.addEventListener){const e=()=>{"hidden"===document.visibilityState?this.isUnload=!0:"visible"===document.visibilityState&&(this.isUnload=!1)},t=()=>{this.isUnload=!0,window.removeEventListener("pagehide",t),document.removeEventListener("visibilitychange",e)};window.addEventListener("pagehide",t),document.addEventListener("visibilitychange",e)}}}class r{constructor(e){this.cache=e,this.CACHE_KEY="amp-persisted-spans-v2",this.OLD_CACHE_KEY="amp-persisted-spans"}getAllAndClear(){if(!this.cache)return[];const e=this.retrieveSpans();try{this.cache.setItem(this.CACHE_KEY,JSON.stringify([])),this.cache.removeItem(this.OLD_CACHE_KEY)}catch(e){}return e}persistSpans(e){if(!this.cache||!e)return;const t=this.retrieveSpans();t.push(...e);try{this.cache.setItem(this.CACHE_KEY,JSON.stringify(t))}catch(e){}}retrieveSpans(){let e=[];try{e=JSON.parse(this.cache.getItem(this.CACHE_KEY))}catch(e){}return e||[]}}})),define("metaserver/static/js/modules/clean/perf_tools/resource_utils",["require","exports","tslib","metaserver/static/js/modules/clean/js_client_stopwatch","metaserver/static/js/modules/clean/perf_tools/cpu_utils"],(function(e,t,i,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.summarizePerformanceResourceTimings=t.logResourceTiming=t.logResourcesData=void 0,s=i.__importStar(s),t.logResourcesData=function(e){(function(e){const t=window.requireContexts;if(!t)return;const i=s.listExecutionPerfMeasurementsForRequireContexts(t),r=n.JSStopwatch.createDetachedStopwatch("resource_init_timeline",e);i.forEach(e=>{const t=r.startSpan(e.name,{startTime:e.startTime});r.addSpanAnnotation(e.name,"totalTimeNs",Math.round(1e6*e.totalTime).toString(),t),r.endSpan(e.name,{endTime:e.startTime+e.totalTime,spanId:t})}),r.logData()})(e),(function(e){const t=n.JSStopwatch.createDetachedStopwatch("resource_timeline",e),i={},s=window.performance.getEntriesByType("resource");if(s instanceof Array)for(const e of s){let n=o(e);if(!n)continue;const s=i[n]||0;i[n]=s+1,s>0&&(n=`${n}-${s}`);const r=t.startSpan(n,{startTime:e.startTime,async:!0}),c=a(e);t.addSpanAnnotation(n,"type",c,r),0===e.transferSize?t.addSpanAnnotation(n,"cached","true",r):void 0===e.transferSize?t.addSpanAnnotation(n,"cached","unknown",r):t.addSpanAnnotation(n,"cached","false",r),e.responseEnd<e.startTime?(t.addSpanAnnotation(n,"negativeSpanLength",(e.responseEnd-e.startTime).toString(),r),t.endSpan(n,{endTime:e.startTime,spanId:r})):t.endSpan(n,{endTime:e.responseEnd,spanId:r})}t.logData()})(e)};const r=document&&document.createElement?document.createElement("a"):null;function o(e){if(r){if(r.href=e.name,r.host.match(/dropboxstatic.com$/)&&r.pathname.match(/^\/static/)){let e=r.pathname;const t=e.match(/vfl[a-zA-Z0-9]*\.[a-z]*$/);t&&t.index&&(e=e.substring(0,t.index-1));const i=["/static/js/","/static/"];for(const t of i)e.startsWith(t)&&(e=e.substring(t.length));return e}return r.host.match(/photos-[0-9]+.dropbox.com$/)&&r.pathname.match(/^\/t\/2/)?"/thumbnail":void 0}}function a(e){const{name:t,initiatorType:i}=e,n=t.lastIndexOf(".");if(n>0){const e=t.substring(n);if([".png",".gif",".jpg",".svg"].indexOf(e)>-1)return"img";if(".js"===e)return"script";if(".css"===e)return"css"}return-1===["css","img","script","link"].indexOf(i)?"xmlhttprequest"===i?"ajax":"other":i}t.logResourceTiming=function(e){const t=window.performance.getEntriesByType("resource").filter(t=>-1!==t.name.indexOf(e))[0];if(!t||!t.responseEnd)return;const i=`resource_response_end_${e}`;return n.JSStopwatch.create_stopwatch_if_not_exist("resource_timing"),n.JSStopwatch.recordTrace(i,{stopwatchName:"resource_timing",traceTime:t.responseEnd}),t},t.summarizePerformanceResourceTimings=function(e,t){const i={pre:{},total:{}};if(n.JSStopwatch.create_stopwatch_if_not_exist("resource_timeline"),e instanceof Array)for(const n of e){const e=a(n),s=[];t&&n.responseEnd<=t&&(e in i.pre||(i.pre[e]={count:0,total_time:0,last_transfer_end:0}),s.push(i.pre[e])),e in i.total||(i.total[e]={count:0,total_time:0,last_transfer_end:0}),s.push(i.total[e]),s.forEach((function(t){var i;t.count++,t.total_time+=n.duration,t.last_transfer_end=Math.max(t.last_transfer_end,n.responseEnd),"css"!==(i=e)&&"script"!==i&&"img"!==i||void 0===n.transferSize||void 0===n.encodedBodySize||(t.total_size=t.total_size||0,t.transfer_size=t.transfer_size||0,0!==n.transferSize&&(t.transfer_size+=n.encodedBodySize),t.total_size=t.total_size||0,t.total_size+=n.encodedBodySize)}))}return i}})),define("metaserver/static/js/modules/clean/perf_tools/cpu_utils",["require","exports","metaserver/static/js/modules/clean/js_client_stopwatch"],(function(e,t,i){"use strict";var n;function s(e){if(e.require&&e.require.perfMeasurements){let t=0;return e.require.perfMeasurements.map(({name:e,startTime:i,totalTime:n})=>(e.endsWith("anon")&&(e+="-"+t++),{jsExecutionType:c(e),name:e,startTime:i,totalTime:n}))}{const t=e.module_callback_times;return Object.keys(t).filter(e=>t[e].callbackDuration&&t[e].callbackTime).map(e=>({jsExecutionType:c(e),name:e,startTime:t[e].callbackTime,totalTime:t[e].callbackDuration}))}}function r(e){let t=[];for(const i in e)if(e.hasOwnProperty(i)){const n=e[i];t=t.concat(s(n))}return t}function o(e){return Object.keys(e).map(t=>{const i=e[t];return{measurement:{jsExecutionType:a(t),name:t,startTime:i.start,totalTime:i.end-i.start},annotations:i.annotations}})}function a(e){return e.startsWith("dws-processChunk")?n.DWS:n.UNKNOWN}function c(e){return e.startsWith("execCb.anon")||e.startsWith("overhead.anon")||e.startsWith("execCb.require-tier")||e.startsWith("overhead.require-tier")?n.OTHER:e.startsWith("execCb")||e.startsWith("overhead")?n.MODULE:n.UNKNOWN}Object.defineProperty(t,"__esModule",{value:!0}),t.logCumulativeExecutionTimes=t.cumulativeExecutionTimesBefore=t.listAnnotatedExecutionPerfMeasurementsForEnsemble=t.listExecutionPerfMeasurementsForRequireContexts=t.getAllGlobalExecutionPerfMeasurements=t.ALL_JS_EXECUTION_TYPES=t.JSExecutionType=void 0,(function(e){e.DWS="dws",e.MODULE="module",e.OTHER="other",e.UNKNOWN="unknown"})(n=t.JSExecutionType||(t.JSExecutionType={})),t.ALL_JS_EXECUTION_TYPES=[n.DWS,n.MODULE,n.OTHER,n.UNKNOWN],t.getAllGlobalExecutionPerfMeasurements=function(){let e=[];return window.ensemble&&window.ensemble.getJSStopwatchData&&(e=e.concat(o(window.ensemble.getJSStopwatchData()).map(({measurement:e})=>e))),window.requireContexts&&(e=e.concat(r(window.requireContexts))),e},t.listExecutionPerfMeasurementsForRequireContexts=r,t.listAnnotatedExecutionPerfMeasurementsForEnsemble=o,t.cumulativeExecutionTimesBefore=function(e,t){const i={};for(const n in e)if(e.hasOwnProperty(n)){const s=e[n];i[n]={},t.forEach(e=>{0<e.startTime&&e.startTime<s&&(i[n][e.jsExecutionType]=i[n][e.jsExecutionType]||0,i[n][e.jsExecutionType]+=e.totalTime)})}return i},t.logCumulativeExecutionTimes=function(e,n){const s=i.JSStopwatch.createDetachedStopwatch("cumulative_cpu_time",e);for(const e in n)n.hasOwnProperty(e)&&t.ALL_JS_EXECUTION_TYPES.forEach(t=>{s.recordTrace(`cpu_before_${e}_due_to_${t}`,n[e][t]||0)});s.logData()}})),define("metaserver/static/js/modules/clean/perf_tools/browser_perf_utils",["require","exports","tslib","metaserver/static/js/modules/core/xhr","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/clean/js_client_stopwatch","metaserver/static/js/modules/constants/webtiming"],(function(e,t,i,n,s,r,o){"use strict";function a(e){const t=window.performance.timing,i={navigation_start:t.navigationStart,unload_event_start:t.unloadEventStart,unload_event_end:t.unloadEventEnd,redirect_start:t.redirectStart,redirect_end:t.redirectEnd,fetch_start:t.fetchStart,domain_lookup_start:t.domainLookupStart,domain_lookup_end:t.domainLookupEnd,connect_start:t.connectStart,secure_connect_start:t.secureConnectionStart,connect_end:t.connectEnd,request_start:t.requestStart,response_start:t.responseStart,response_end:t.responseEnd,dom_loading:t.domLoading,dom_interactive:t.domInteractive,dom_content_loaded_event_start:t.domContentLoadedEventStart,dom_content_loded_event_end:t.domContentLoadedEventEnd,dom_complete:t.domComplete,load_event_start:t.loadEventStart,load_event_end:t.loadEventEnd},a={};a.request_id=s.REQUEST_ID,a.referrer=document.referrer;const c=r.JSStopwatch.createDetachedStopwatch("browser_perf",e);for(const e in i)i.hasOwnProperty(e)&&(a[e]=i[e],i[e]&&c.recordTrace(e,i[e]-t.navigationStart));c.logData(),o.LOG_BROWSER_PERFORMANCE_INFO&&n.sendXhr("/alternate_wtl_browser_performance_info",a)}Object.defineProperty(t,"__esModule",{value:!0}),t.logBrowserPerformanceInfo=t.logBrowserPerfData=void 0,n=i.__importStar(n),s=i.__importStar(s),o=i.__importStar(o),t.logBrowserPerfData=function(e){(function(e){const t=r.JSStopwatch.createDetachedStopwatch("performance_marks",e),i=window.performance.getEntriesByType("mark");if(i instanceof Array)for(const e of i)t.recordTrace(e.name,e.startTime);t.logData()})(e),a(e)},t.logBrowserPerformanceInfo=a})),define("metaserver/static/js/modules/clean/perf_tools/web_timing_logger_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebTimerEvent=t.NavigationType=void 0;class i{static getFromNavigation(e){switch(e.type){case e.TYPE_NAVIGATE:return i.NAVIGATE;case e.TYPE_RELOAD:return i.RELOAD;case e.TYPE_BACK_FORWARD:return i.BACK_FORWARD}}}t.NavigationType=i,i.NAVIGATE="navigate",i.RELOAD="reload",i.BACK_FORWARD="back_forward";class n{constructor(e,t,i=!1,s=!0,r){this.name=e,this.flag=1<<t,this.triggersLogging=i,this.timestampPrefix=r||e,this.ordered=s,n.allEvents.push(this)}}t.WebTimerEvent=n,n.allEvents=[],n.APPLICATION_START=new n("application_code_start",1),n.LOAD_END=new n("load_end",2,!0,!1),n.MARK_TIME_TO_VIEW=new n("mark_time_to_view",3,!0,!0,"TTV"),n.FETCHED_DATA_FOR_TTI=new n("fetched_data_required_for_tti",4),n.MARK_TIME_TO_INTERACTIVE=new n("mark_time_to_interactive",5),n.TIME_TO_INTERACTIVE=new n("time_to_interactive",6,!0,!0,"TTI")})),define("metaserver/static/js/modules/clean/perf_tools/web_timing_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CancellableCallback=t.WebTimingUtil=void 0;class i{static generateCorrelationId(){return Math.random().toString(36).substring(2)}static getNow(){const e=window.performance;return Math.floor((e.timeOrigin||e.timing.navigationStart)+e.now())}static newContext(e,t="unnamed_timer"){let n;if(e)n=i.getNow();else{const e=window.performance;n=Math.floor(e.timeOrigin||e.timing.navigationStart)}return{initialized:!1,is_pagelet:!1,is_dws:!1,is_dws2:!1,is_early_ensemble:!1,log_time_to_view:!1,log_time_to_interactive:!1,ttv_at_dom_interactive:!1,tti_at_dom_interactive:!1,source_type:"web",subtypes:{},tti_exclusion_flow:"",have_logged_web_timing:!1,delayed_tti_for_css:!1,js_preloads_enabled:!1,require_preloads_enabled:!1,css_preloads_enabled:!1,previews_preconnect_enabled:!1,alternative_css_load_strategy_enabled:!1,rollup_format:"off",timing_results:null,start_time:n,time_to_view:null,time_to_interactive:null,correlation_id:i.generateCorrelationId(),timesStagesWereReached:{},context_name:t}}}t.WebTimingUtil=i;t.CancellableCallback=class{constructor(e){this.canceled=!1,this.callback=e}exec(){this.canceled||this.callback()}cancel(){this.canceled=!0}isCanceled(){return this.canceled}}})),define("metaserver/static/js/modules/clean/uuid/insecure_uuid",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InsecureUUID=void 0;const i=(()=>{let e,t;const i=[];for(t=0,e=t;t<=255;t++,e=t)i.push((e+256).toString(16).substr(1));return i})();t.InsecureUUID=class{static bytesToHex(e){return e.map(e=>i[e]).join("")}static toByte(e){return 255&e}static bytesToUUIDString(e){return[e.slice(0,4),e.slice(4,6),e.slice(6,8),e.slice(8,10),e.slice(10,16)].map(e=>this.bytesToHex(e)).join("-")}static getRandomBytes(){const e=new Array(16);return this.getInsecureRandomValues(e),e.map(e=>this.toByte(e))}static getInsecureRandomValues(e){const t=Math.pow(2,8);for(let i=0;i<e.length;i++)e[i]=Math.floor(Math.random()*t);return e}static v4(){const e=this.getRandomBytes();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,this.bytesToUUIDString(e)}}})),define("metaserver/static/js/modules/clean/visibility_logging",["require","exports","metaserver/static/js/modules/clean/js_client_stopwatch","metaserver/static/js/modules/clean/js_basic_stopwatch"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logVisibilityChangeEvents=t.logPaintPerformance=void 0,t.logPaintPerformance=function(e){if(!window.performance||!window.performance.getEntriesByType)return;const t=window.performance.getEntriesByType("paint").map(e=>({type:n.TimingDataType.Trace,name:e.name,endTime:e.startTime}));if(t.length>0){const n=i.JSStopwatch.createDetachedStopwatch("paint",e);n.recordEntries(t),n.logData()}},t.logVisibilityChangeEvents=function(e,t){if(!window.performance||!window.performance.getEntriesByType)return;let s=Number.MAX_VALUE;e.time_to_interactive&&(s=e.time_to_interactive-e.start_time);const r=window.performance.getEntriesByType("mark").filter(e=>e.name.startsWith("VisibilityState.")).map(e=>({visibility:e.name,time:e.startTime})),o={"VisibilityState.visible":0,"VisibilityState.hidden":0};let a;const c=e=>{a&&a.time<s&&(o[a.visibility]=(o[a.visibility]||0)+Math.min(e,s)-a.time)},l=[];r.forEach((e,t)=>{c(e.time),l.push({type:n.TimingDataType.Trace,name:`visibility-change-${t}`,endTime:e.time,annotations:{visibility:e.visibility}}),a=0===t?{visibility:e.visibility,time:0}:e}),c(window.performance.now());for(const e in o)o.hasOwnProperty(e)&&l.push({type:n.TimingDataType.Trace,name:`total-${e}-time`,endTime:o[e]});const d=i.JSStopwatch.createDetachedStopwatch("visibility",t);d.recordEntries(l),d.logData()}})),define("metaserver/static/js/modules/clean/web_module_timing",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.add_module=t.get_module_times=void 0,t.get_module_times=function(){const e=[];for(const t in window.requireContexts){const i=window.requireContexts[t].module_callback_times;for(const t in i)if(i.hasOwnProperty(t)){const n=i[t];if(null!=n.loadTime){const t={load_time:n.loadTime,callback_duration:n.callbackDuration,callback_time:n.callbackTime,name:n.name,url:n.url,parent:n.parent};e.push(t)}}}return e},t.add_module=function(){}})),define("metaserver/static/js/modules/clean/web_timing_logger",["require","exports","tslib","apex-metrics/index","metaserver/static/js/modules/clean/active_user","metaserver/static/js/modules/clean/metrics/index","metaserver/static/js/modules/clean/devtools/panels/performance/perf_hub_actions","metaserver/static/js/modules/clean/event_load","metaserver/static/js/modules/clean/web_module_timing","metaserver/static/js/modules/clean/window_util","metaserver/static/js/modules/clean/perf_tools/resource_utils","metaserver/static/js/modules/clean/perf_tools/web_timing_logger_types","metaserver/static/js/modules/clean/perf_tools/web_timing_utils","metaserver/static/js/modules/clean/js_client_stopwatch","metaserver/static/js/modules/clean/perf_tools/browser_perf_utils","metaserver/static/js/modules/clean/init_react","metaserver/static/js/modules/clean/perf_tools/cpu_utils","metaserver/static/js/modules/clean/js_basic_stopwatch","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/constants/page_load","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/exception","metaserver/static/js/modules/core/xhr","metaserver/static/js/dropbox/proto/js_init_data/web_timing_logger/web_timing_logger","metaserver/static/js/modules/clean/visibility_logging","metaserver/static/js/modules/clean/user_centric_perf_metrics/metrics_logger"],(function(e,t,i,n,s,r,o,a,c,l,d,u,m,p,_,h,g,f,v,S,w,b,T,E,y,O,I,N){"use strict";var C;Object.defineProperty(t,"__esModule",{value:!0}),t.log_js_modules_fetched_data_required_for_tti=t.log_js_modules_application_code_start=t.waitForTTI=t.mark_time_to_interactive=t.mark_time_to_view=t.set_tti_exclusion_flow=t.time_since_start=t.start_time=t.reset=t.initialize=t.initialize_module=t.time_to_interactive=t.time_to_view=t.delete_timer=t.get_timer=t.perfHubClassName=void 0,a=i.__importStar(a),l=i.__importStar(l),v=i.__importStar(v),S=i.__importStar(S),w=i.__importStar(w),T=i.__importStar(T),E=i.__importStar(E),y=i.__importStar(y),(function(e){e[e.NEW=1]="NEW",e[e.RUNNING=2]="RUNNING",e[e.ABORTED=3]="ABORTED",e[e.CLOSED=4]="CLOSED"})(C||(C={})),t.perfHubClassName="perf-hub-link-container";const A=["navigation_type","referrer","repo_rev","source_type","active_user_id"],x=["tti_flow","tti_exclusion_flow","is_dws2"];function M(){return"hidden"===window.document.visibilityState}const R=[[u.WebTimerEvent.APPLICATION_START,u.WebTimerEvent.MARK_TIME_TO_VIEW,u.WebTimerEvent.FETCHED_DATA_FOR_TTI,u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE],[u.WebTimerEvent.TIME_TO_INTERACTIVE]].reverse();let k=1;const D=["requirejs_start","ensemble_payload_start","body_start"];const L=["craft_fast_prefetch_done","dws_core_externals_loaded","dws_ensemble_init","dws-processChunk-embedded-app-done-1","dws-processChunk-embedded-app-require_config-1","module_init","last_js_const_end","pagelet_render_on_page_embedded-app","pagelet_css_loaded_embedded-app"];class P{constructor(){p.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),this.shouldLogJsModuleTimes=()=>Math.random()<.001}buildBaseParams(e,t,i={}){const n=e.start_time,r=e.subtypes||{};e.tti_flow&&(r.tti_flow=e.tti_flow);const o={log_source:t.name,subtypes:JSON.stringify(r),correlation_id:e.correlation_id};let a,c;e.extra_columns&&Object.keys(e.extra_columns).forEach(t=>{const i=e.extra_columns[t];i&&(o[t]=i)}),Object.keys(i).forEach(e=>{const t=i[e];t&&(o[e]=t)}),v.IS_HTTP2&&(o.is_spdy=!0),e.is_pagelet&&(o.is_pagelet=!0),e.is_dws&&(o.is_dws=!0),e.is_early_ensemble&&(o.is_early_ensemble=!0),o.delayed_tti_for_css=e.delayed_tti_for_css,""!==e.tti_exclusion_flow&&(o.tti_exclusion_flow=e.tti_exclusion_flow),a=e.log_time_to_view&&null!=e.time_to_view?e.time_to_view-n:null,c=e.log_time_to_interactive&&null!=e.time_to_interactive?e.time_to_interactive-n:null;const l={navigation_type:this.get_navigation_type(),server_request_start_time:v.REQUEST_START_TIME,extra_columns:JSON.stringify(o),subtypes:JSON.stringify(r),source_type:e.source_type,page_load_time:e.end_time-e.start_time,repo_rev:w.REPO_REV};return this.shouldLogJsModuleTimes()&&Z(l),e.log_time_to_view&&(l.time_to_view=a),e.log_time_to_interactive&&(l.time_to_interactive=c),l.url=T.get_href(),0===l.url.indexOf("/dws2/")&&(l.url=l.url.substring("/dws2/".length-1)),l.active_user_id=s.getActiveUserId(),l.referrer=document.referrer,l.request_id=e.request_id||v.REQUEST_ID,l.request_tracing_enabled=v.REQUEST_TRACING_ENABLED,window.ensemble&&window.ensemble.viewer&&(l.dws_page_name=window.ensemble.getPageName()),window.EDISON_PAGE_NAME&&(l.edison_page_name=window.EDISON_PAGE_NAME),l}get_navigation_type(){return u.NavigationType.getFromNavigation(window.performance.navigation)}log(e,i,n=!1){const s=p.JSStopwatch.startSpan("wtl_endpoint",{stopwatchName:"web_timing_logger"});p.JSStopwatch.addSpanAnnotation("wtl_endpoint","navigation_type",i.navigation_type,{stopwatchName:"web_timing_logger",spanId:s});const r=y.sendXhr("/alternate_wtl",i);r.onreadystatechange=e=>{if(r.readyState===XMLHttpRequest.DONE&&200===r.status){p.JSStopwatch.endSpan("wtl_endpoint",{stopwatchName:"web_timing_logger",spanId:s});const e=document.getElementsByClassName(t.perfHubClassName);if(n&&e.length){const e=JSON.parse(r.responseText);e.status&&o.PerfHubActions.add_web_timing_details(e)}}}}}class j extends P{constructor(){super()}shouldLog(e){return e.initialized&&!e.have_logged_web_timing&&void 0!==e.end_time&&(!e.log_time_to_view||null!=e.time_to_view)&&(!e.log_time_to_interactive||null!=e.time_to_interactive)}logTiming(e,t){e.have_logged_web_timing=!0;const i=this.buildBaseParams(e,t),n=z(e,i);return this.log(e,i,!1),n}get_navigation_type(){return"ajax"}}class U extends P{constructor(){super()}shouldLog(e){if(!e.initialized||e.have_logged_web_timing)return!1;const t=window.performance.timing,i=e.start_time,n=e.end_time;return!(!i||!n)&&(!(e.log_time_to_view&&!(e.ttv_at_dom_interactive&&t.domInteractive||null!=e.time_to_view))&&!(e.log_time_to_interactive&&!(e.tti_at_dom_interactive&&t.domInteractive||null!=e.time_to_interactive)))}logTiming(e,t){const i=window.performance,s=i.timing,o=g.getAllGlobalExecutionPerfMeasurements();let a=e.timesStagesWereReached["dws_embedded-app_require_config_callback"];void 0===a?a=e.timesStagesWereReached.application_code_start:e.timesStagesWereReached.hasOwnProperty("application_code_start")&&(a=Math.min(a,e.timesStagesWereReached.application_code_start)),p.JSStopwatch.startSpan("process_nav_timing",{stopwatchName:"web_timing_logger"});const c=this.buildBaseParams(e,t,{}),l=z(e,c),m=window.ensemble&&window.ensemble.getJSStopwatchData?window.ensemble.getJSStopwatchData():{},f="function"==typeof i.getEntriesByType?d.summarizePerformanceResourceTimings(i.getEntriesByType("resource"),a):{pre:{},total:{}};c.browser_time=(s.redirectStart||s.fetchStart)-e.start_time,c.redirect_time=s.fetchStart-e.start_time,c.dns_time=s.domainLookupEnd-e.start_time,c.tcp_connect_time=(s.secureConnectionStart||s.requestStart)-e.start_time,c.ssl_connect_time=s.requestStart-e.start_time,c.time_to_first_byte=s.responseStart-e.start_time,c.time_to_last_byte=s.responseEnd-e.start_time,c.dom_load_time=s.domContentLoadedEventEnd-e.start_time,c.idle_cpu_time=e.timing_results?Math.round(e.timing_results.idleCPUTime):void 0,c.total_tracked_cpu_time=e.timing_results?Math.round(e.timing_results.totalTrackedCPUTime):void 0,c.untracked_time_after_first_byte=e.timing_results&&null!=e.timing_results.untrackedTimeAfterFirstByte?Math.round(e.timing_results.untrackedTimeAfterFirstByte):void 0,(function(e,t){for(const i in e)e.hasOwnProperty(i)&&(t[`resource_${i}_count`]=e[i].count,t[`resource_${i}_avg_time`]=e[i].total_time/e[i].count||1,void 0!==e[i].total_size&&(t[`resource_${i}_total_size`]=e[i].total_size),void 0!==e[i].transfer_size&&(t[`resource_${i}_transfer_size`]=e[i].transfer_size))})(f.total,c),(function(e,t){let i;for(i in e)if(e.hasOwnProperty(i)){const n=e[i];for(const e in n)if(n.hasOwnProperty(e)){const s=n[e].transfer_size,r=n[e].total_size,o=n[e].count,a=n[e].total_time;if(t.recordTrace(`${i}_${e}_count`,o),t.recordTrace(`${i}_${e}_total_time`,a),void 0!==s&&void 0!==r&&r>0){const n=s/r;t.recordTrace(`${i}_${e}_transferred_size`,s),t.recordTrace(`${i}_${e}_total_size`,r),t.recordTrace(`${i}_percent_${e}_transferred`,100*n)}t.recordTrace(`${i}_last_${e}_transfer_end`,n[e].last_transfer_end)}}t.logData()})(f,p.JSStopwatch.createDetachedStopwatch("resources_percent_transferred",l)),p.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_resources","1",{stopwatchName:"web_timing_logger"}),this.shouldLogJsModuleTimes()&&Z(c),p.JSStopwatch.addSpanAnnotation("process_nav_timing","logged_modules","1",{stopwatchName:"web_timing_logger"}),p.JSStopwatch.endSpan("process_nav_timing",{stopwatchName:"web_timing_logger"}),e.is_pagelet&&Object.getOwnPropertyNames(m).length>0&&(function(e,t,i){const n=(function(e,t){const i=g.listAnnotatedExecutionPerfMeasurementsForEnsemble(t),n=p.JSStopwatch.createDetachedStopwatch("ensemble",e),s=i.map(({measurement:e,annotations:t})=>({name:e.name,startTime:e.startTime,endTime:e.startTime+e.totalTime,annotations:t}));return Y(n,s),n})(i,t);let s=void 0,r=void 0;for(const i in t)t.hasOwnProperty(i)&&(X.includes(i)&&(e.timesStagesWereReached[i]=t[i].start),["dws_embedded-app_require_config_callback"].includes(i)&&(s=s?Math.min(s,t[i].end):t[i].end),Q.test(i)&&(r=r?Math.max(r,t[i].end):t[i].end));r&&n.recordTrace("last_js_const_end",r);s&&n.recordTrace("module_init",s)})(e,m,l),_.logBrowserPerfData(l),(function(e,t,i){g.logCumulativeExecutionTimes(e,g.cumulativeExecutionTimesBefore(t,i))})(l,e.timesStagesWereReached,o),this.get_navigation_type()===u.NavigationType.NAVIGATE&&((function(e){const t=h.getReactInitData();Y(p.JSStopwatch.createDetachedStopwatch("init_react",e),t)})(l),d.logResourcesData(l)),p.JSStopwatch.log_stored_results();const v=(function(e,t){const i={is_dws:String(e.is_dws),source_type:String(e.source_type),js_preloads_enabled:String(e.js_preloads_enabled),require_preloads_enabled:String(e.require_preloads_enabled),css_preloads_enabled:String(e.css_preloads_enabled),alternative_css_load_strategy_enabled:String(e.alternative_css_load_strategy_enabled),previews_preconnect_enabled:String(e.previews_preconnect_enabled),rollup_format:e.rollup_format};let n="";return e.subtypes.amp_tti_flow?n=e.subtypes.amp_tti_flow:t.dws_page_name?n=`dws_page_name:${t.dws_page_name}`:t.edison_page_name&&(n=`edison_page_name:${t.edison_page_name}`),""!==n&&(i.product=n),t.navigation_type&&(i.navigation_type=t.navigation_type),i})(e,c),S=r.getMetricsReporter().child(v),w=(function(e,t){return t.navigation_type===u.NavigationType.NAVIGATE||"ajax"===t.navigation_type})(0,c),b=r.getUnloadMetricsReporter().child(v);return N.logUserCentricPerfMetrics(b,w),w&&((function(e,t){if(e.time_to_interactive){t.createStats({ns:"web_timing",name:"temp/time-to-interactive"}).recordDuration(e.time_to_interactive,n.TimeUnit.MILLISECONDS)}})(c,S),(function(e,t){let i;for(i in e)if(e.hasOwnProperty(i)){const s=e[i];for(const e in s)if(s.hasOwnProperty(e)){const{transfer_size:r,total_size:o,count:a,total_time:c,last_transfer_end:l}=s[e];t.createStats({ns:"web_timing",name:`temp/resources/${i}/${e}/count`}).record(a),t.createStats({ns:"web_timing",name:`temp/resources/${i}/${e}/total-time`}).recordDuration(c,n.TimeUnit.MILLISECONDS),t.createStats({ns:"web_timing",name:`temp/resources/${i}/${e}/last-transfer-end`}).recordDuration(l,n.TimeUnit.MILLISECONDS),void 0!==r&&void 0!==o&&o>0&&(t.createStats({ns:"web_timing",name:`temp/resources/${i}/${e}/transferred-size`}).record(r),t.createStats({ns:"web_timing",name:`temp/resources/${i}/${e}/total-size`}).record(o))}}})(f,S),e.is_pagelet&&Object.getOwnPropertyNames(m).length>0&&(function(e,t,i){const s=g.listAnnotatedExecutionPerfMeasurementsForEnsemble(t);let r=void 0,o=void 0;s.forEach(({measurement:t})=>{const s=t.startTime+t.totalTime;-1!==L.indexOf(t.name)&&i.createStats({ns:"web_timing",name:`temp/ensemble-timing/${t.name}`}).recordDuration(s,n.TimeUnit.MILLISECONDS),X.includes(t.name)&&(e.timesStagesWereReached[t.name]=t.startTime),["dws_embedded-app_require_config_callback"].includes(t.name)&&(r=r?Math.min(r,s):s),Q.test(t.name)&&(o=o?Math.max(o,s):s)}),void 0!==o&&i.createStats({ns:"web_timing",name:"temp/last-js-const-end"}).recordDuration(o,n.TimeUnit.MILLISECONDS),void 0!==r&&i.createStats({ns:"web_timing",name:"temp/module-init"}).recordDuration(r,n.TimeUnit.MILLISECONDS)})(e,m,S),(function(e,t){e.getEntriesByType("mark").filter(e=>D.indexOf(e.name)>-1).forEach(e=>{t.createStats({ns:"web_timing",name:`temp/browser-perf/marks/${e.name}`}).recordDuration(e.startTime,n.TimeUnit.MILLISECONDS)})})(i,S),(function(e,t){const[i=null]=e.getEntriesByType("navigation");i&&([["temp/browser-perf/navigation/unload-event-start",i.unloadEventStart],["temp/browser-perf/navigation/unload-event-end",i.unloadEventEnd],["temp/browser-perf/navigation/dom-interactive",i.domInteractive],["temp/browser-perf/navigation/dom-content-loaded-event-start",i.domContentLoadedEventStart],["temp/browser-perf/navigation/dom-content-loaded-event-end",i.domContentLoadedEventEnd],["temp/browser-perf/navigation/dom-complete",i.domComplete],["temp/browser-perf/navigation/load-event-start",i.loadEventStart],["temp/browser-perf/navigation/load-event-end",i.loadEventEnd],["temp/browser-perf/navigation/redirect-count",i.redirectCount],["temp/browser-perf/navigation/worker-start",i.workerStart],["temp/browser-perf/navigation/redirect-start",i.redirectStart],["temp/browser-perf/navigation/redirect-end",i.redirectEnd],["temp/browser-perf/navigation/fetch-start",i.fetchStart],["temp/browser-perf/navigation/domain-lookup-start",i.domainLookupStart],["temp/browser-perf/navigation/domain-lookup-end",i.domainLookupEnd],["temp/browser-perf/navigation/connect-start",i.connectStart],["temp/browser-perf/navigation/connect-end",i.connectEnd],["temp/browser-perf/navigation/secure-connect-start",i.secureConnectionStart],["temp/browser-perf/navigation/request-start",i.requestStart],["temp/browser-perf/navigation/response-start",i.responseStart],["temp/browser-perf/navigation/response-end",i.responseEnd],["temp/browser-perf/navigation/transfer-size",i.transferSize]].forEach(([e,i])=>{if("number"==typeof i){t.createStats({ns:"web_timing",name:e}).recordDuration(i,n.TimeUnit.MILLISECONDS)}}),[["temp/browser-perf/navigation/encoded-body-size",i.encodedBodySize],["temp/browser-perf/navigation/decoded-body-size",i.decodedBodySize]].forEach(([e,i])=>{if("number"==typeof i){t.createStats({ns:"web_timing",name:e}).record(i)}}))})(i,S)),I.logPaintPerformance(l),I.logVisibilityChangeEvents(e,l),e.have_logged_web_timing=!0,this.log(e,c,!0),l}log(e,t,i=!1){super.log(e,t,i)}}class q{constructor(e,t,i,n){this.childSpans=[],this.spanName=e,this.startTime=void 0!==i?i:m.WebTimingUtil.getNow(),this.originTs=t,this.startTimeOffsetMS=this.startTime-t,this.endCallback=n}startSpan(e){const t=new q(e,this.originTs);return this.childSpans.push(t),t}markSpan(e,t){const i=new q(e,this.originTs,this.startTime);this.childSpans.push(i),i.endSpan(t)}endSpan(e){this.endTime=void 0!==e?e:m.WebTimingUtil.getNow(),this.childSpans.forEach(e=>{e.hasEnded()||e.endSpan(this.endTime)}),this.endCallback&&this.endCallback(this)}getEndTimeOffsetMS(){return void 0!==this.endTime?this.endTime-this.originTs:void 0}hasEnded(){return void 0!==this.endTime}}class V{constructor(e,t,i,n=!1){this.timerState=C.RUNNING,this.loggedEvents=0,this.activeSpans=[],this.endedSpans=[],this.context=e,this.timingStopwatch=t,this.userStopwatch=i,this.id=k++,this.strictAssert=n}startSpan(e){const t=new q(e,this.context.start_time,void 0,e=>{this.endSpan(e)});return this.activeSpans.push(t),t}markSpan(e,t={}){if(this.userStopwatch){const i=void 0===t.startTime?0:t.startTime,n=this.timeSinceStart(t.endTime),s=this.userStopwatch.startSpan(e,{startTime:i});this.userStopwatch.endSpan(e,{spanId:s,endTime:n})}else{const i=new q(e,this.context.start_time,t.startTime);i.endSpan(t.endTime),this.endedSpans.push(i)}}endSpan(e){const t=this.activeSpans.indexOf(e);t>=0&&(delete this.activeSpans[t],this.userStopwatch?this.recordSpan(e):this.endedSpans.push(e))}recordSpan(e){const t=this.userStopwatch.startSpan(e.spanName,{startTime:e.startTimeOffsetMS});e.childSpans.forEach(e=>{this.recordSpan(e)}),this.userStopwatch.endSpan(e.spanName,{spanId:t,endTime:e.getEndTimeOffsetMS()})}getContextName(){return this.context.context_name}applicationStart(){this.logEvent(u.WebTimerEvent.APPLICATION_START)}fetchedDataRequiredForTTI(){this.logEvent(u.WebTimerEvent.FETCHED_DATA_FOR_TTI)}startTime(){return this.context.start_time}timeSinceStart(e){return(e||m.WebTimingUtil.getNow())-this.context.start_time}timeToView(){return this.context.time_to_view}timeToInteractive(){return this.context.time_to_interactive}reportTTIAfterPaint(){const e=new m.CancellableCallback(()=>{this.reportTTI()});return window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{e.exec()})}),e}setExtraColumns(e){this.context.extra_columns=e}excludeFromTTI(e){""!==this.context.tti_exclusion_flow&&(this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+","),this.context.tti_exclusion_flow=this.context.tti_exclusion_flow+e}logEvent(e,t){this.logEventInternal(e,!0,t)}logSilentEvent(e,t){this.logEventInternal(e,!1,t)}logEventInternal(e,t,i){this.loggedEvents|=e.flag,e.ordered&&this.validateEventOrder(e);const n=this.timeSinceStart(i);this.context.timesStagesWereReached[e.name]=n,this.timingStopwatch.recordTrace(e.name,n),console.timeStamp&&console.timeStamp(e.timestampPrefix),window.performance.mark&&window.performance.mark(e.name),t&&e.triggersLogging&&this.logIfReady(e)}validateEventOrder(e){let t=0;for(const i of R){if(i.includes(e))break;for(const e of i)t|=e.flag}const i=t&this.loggedEvents;if(i>0){const t=u.WebTimerEvent.allEvents.filter(e=>(e.flag&i)>0).map(e=>e.name);this.reportSwMisuse(`Received ${e.name} after [${t.join(",")}]`)}}logIfReady(e){if(this.logger.shouldLog(this.context)){this.addEventBasedTiming();const t=this.logger.logTiming(this.context,e);G(this.timingStopwatch,t),G(this.userStopwatch,t),this.timingStopwatch.logData(),this.userStopwatch.logData(),this.timerState=C.CLOSED}}addEventBasedTiming(){const e=window.performance.timing;this.context.ttv_at_dom_interactive&&(this.context.is_pagelet&&window.ensemble?this.context.time_to_view=window.ensemble.getEmbeddedAppDOMInteractive():this.context.time_to_view=e.domInteractive,this.logSilentEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),this.context.tti_at_dom_interactive&&(this.context.time_to_interactive=e.domInteractive,this.logSilentEvent(u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE,this.context.time_to_interactive),this.logSilentEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive))}reportSwMisuse(e){e=`WebTimer: ${e}`,this.strictAssert?b.assert(!1,e):E.reportStack(e,{severity:E.SEVERITY.NONCRITICAL,tags:["web_timing_logger"]})}}class B extends V{constructor(e){super(e,p.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),p.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1),this.logger=new j}initialize(e){this.context.initialized||(this.context.initialized=!0,this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.tti_flow=e.url,this.timingStopwatch.url=this.context.tti_flow,this.userStopwatch.url=this.context.tti_flow)}start(){this.isUsable()&&this.timerState===C.NEW&&(this.context.start_time=m.WebTimingUtil.getNow(),this.timerState=C.RUNNING)}restart(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.have_logged_web_timing=!1,this.context.correlation_id=m.WebTimingUtil.generateCorrelationId(),this.context.start_time=m.WebTimingUtil.getNow(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=C.RUNNING,p.JSStopwatch.deleteStopwatch(this.timingStopwatch),this.timingStopwatch=p.JSStopwatch.createDetachedStopwatch("maestro_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id}),p.JSStopwatch.deleteStopwatch(this.userStopwatch),this.userStopwatch=p.JSStopwatch.createDetachedStopwatch("user_tracing",{request_id:this.context.request_id,url:this.context.tti_flow,correlation_id:this.context.correlation_id})}abort(){this.timerState!==C.CLOSED&&(this.timerState=C.ABORTED)}markTimeToView(){this.isUsable()&&(null==this.context.time_to_view&&(this.context.time_to_view=m.WebTimingUtil.getNow()),this.logEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW))}markTimeToInteractive(){this.isUsable()&&(this.logEvent(u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),M()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())}reportTTI(){if(null!=this.context.time_to_interactive)return;this.context.time_to_interactive=m.WebTimingUtil.getNow(),this.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE),new Promise((t,i)=>{e(["metaserver/static/js/modules/clean/logging/telemetry"],t,i)}).then(i.__importStar).then(({getGlobalTelemetrySingleton:e})=>{e().sendOnce()});const t=this.timeSinceStart(this.context.time_to_interactive);ee(this.id,t)}end(e){this.isUsable()&&(void 0===this.context.end_time&&(this.context.end_time=m.WebTimingUtil.getNow()),this.context.request_id=e,this.timingStopwatch.request_id=e,this.userStopwatch.request_id=e,this.logEvent(u.WebTimerEvent.LOAD_END))}waitForTTI(e){return new Promise((t,i)=>{if(null!=this.context.time_to_interactive)return void t();let n;const s=e=>{window.removeEventListener("TTI."+this.id,s),clearTimeout(n),t()};window.addEventListener("TTI."+this.id,s),e&&void 0!==e.timeoutMS&&(n=setTimeout(s,e.timeoutMS))})}isUsable(){return this.timerState===C.NEW||this.timerState===C.RUNNING}}class F extends V{constructor(e){super(e,p.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:e.correlation_id}),p.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:e.correlation_id}),!1),this.logger=new U}initialize(e){if(!this.context.initialized){this.context.log_time_to_view=e.requireTTV,this.context.log_time_to_interactive=e.requireTTI,this.context.is_pagelet=!!e.is_pagelet,this.context.is_dws=!!e.is_dws,this.context.is_dws2=!!e.is_dws2,this.context.is_early_ensemble=!!e.is_early_ensemble,this.context.ttv_at_dom_interactive=!!e.ttv_at_dom_interactive,this.context.tti_at_dom_interactive=!!e.tti_at_dom_interactive,this.context.source_type=null!=e.source_type?e.source_type:"web",this.context.subtypes=null!=e.subtypes?e.subtypes:{},this.context.tti_exclusion_flow=null!=e.tti_exclusion_flow?e.tti_exclusion_flow:"",this.context.have_logged_web_timing=!1,this.context.delayed_tti_for_css=!1,this.context.js_preloads_enabled=e.js_preloads_enabled||!1,this.context.require_preloads_enabled=e.require_preloads_enabled||!1,this.context.css_preloads_enabled=e.css_preloads_enabled||!1,this.context.alternative_css_load_strategy_enabled=e.alternative_css_load_strategy_enabled||!1,this.context.previews_preconnect_enabled=e.previews_preconnect_enabled||!1,this.context.rollup_format=e.rollup_format||"off",this.context.initialized=!0,e.url&&(this.context.tti_flow=e.url,this.timingStopwatch.url=e.url,this.userStopwatch.url=e.url),this.context.subtypes.tti_flow&&(this.context.tti_flow=this.context.subtypes.tti_flow);let t=0;if(S.LOG_TIMING_DELAY&&(t=600),p.JSStopwatch.create_stopwatch_if_not_exist("web_timing_logger"),a.window_load(()=>{setTimeout(()=>this.end(),t)}),l.onPageRestore(e=>{const t=p.JSStopwatch.createDetachedStopwatch("browser_perf",{correlation_id:this.context.correlation_id});t.recordTrace("page_restore"),t.logData()}),!this.context.ttv_at_dom_interactive&&window._timingData&&(null!=window._timingData.ttv&&(this.context.time_to_view=window._timingData.ttv.getTime(),this.logEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)),null!=window._timingData.tti)){this.context.time_to_interactive=window._timingData.tti.getTime(),this.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),ee(void 0,this.timeSinceStart(this.context.time_to_interactive))}}}start(){this.isUsable()&&this.timerState===C.NEW&&(this.timerState=C.RUNNING)}restart(){this.TTICallback&&(this.TTICallback.cancel(),this.TTICallback=void 0),this.loggedEvents=0,this.context.correlation_id=m.WebTimingUtil.generateCorrelationId(),this.context.end_time=void 0,this.context.time_to_view=null,this.context.time_to_interactive=null,this.timerState=C.RUNNING,this.timingStopwatch=p.JSStopwatch.createDetachedStopwatch("maestro_tracing",{correlation_id:this.context.correlation_id}),this.userStopwatch=p.JSStopwatch.createDetachedStopwatch("user_tracing",{correlation_id:this.context.correlation_id})}abort(){this.timerState!==C.CLOSED&&(this.timerState=C.ABORTED)}markTimeToView(){this.isUsable()&&(null!=this.context.time_to_view||this.context.ttv_at_dom_interactive||(window._timingData&&null!=window._timingData.ttv?this.context.time_to_view=window._timingData.ttv.getTime():this.context.time_to_view=m.WebTimingUtil.getNow(),this.logEvent(u.WebTimerEvent.MARK_TIME_TO_VIEW,this.context.time_to_view)))}markTimeToInteractive(){if(window.ensemble&&window.ensemble.waitingForCss)return this.context.delayed_tti_for_css=!0,void(window.ensemble.mark_tti_callback=()=>{this.markTimeToInteractive()});null!=this.context.time_to_interactive||this.context.tti_at_dom_interactive||(this.logEvent(u.WebTimerEvent.MARK_TIME_TO_INTERACTIVE),M()?this.reportTTI():this.TTICallback=this.reportTTIAfterPaint())}reportTTI(){if(null==this.context.time_to_interactive)if(window._timingData&&null!=window._timingData.tti?this.context.time_to_interactive=window._timingData.tti.getTime():this.context.time_to_interactive=m.WebTimingUtil.getNow(),console.timeStamp&&console.timeStamp("TTI"),window.ensemble&&window.ensemble.snapshotTimingProfile&&(this.context.timing_results=window.ensemble.snapshotTimingProfile()||null),window.RUNNING_IN_EDISON)new Promise((t,i)=>{e(["metaserver/static/js/modules/clean/edison/edison"],t,i)}).then(i.__importStar).then(({Edison:e})=>{const t=e.getPrefetchCounts(),i={};for(const e of Object.keys(t))i[e]=t[e].toString();this.context.subtypes=Object.assign(Object.assign({},i),this.context.subtypes),this.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),ee(void 0,this.timeSinceStart(this.context.time_to_interactive))});else{this.logEvent(u.WebTimerEvent.TIME_TO_INTERACTIVE,this.context.time_to_interactive),ee(void 0,this.timeSinceStart(this.context.time_to_interactive))}}end(e){this.isUsable()&&void 0===this.context.end_time&&(this.context.end_time=m.WebTimingUtil.getNow(),this.logEvent(u.WebTimerEvent.LOAD_END),this.context.tti_at_dom_interactive&&ee())}waitForTTI(e){return new Promise((t,i)=>{if(window.ensemble){if(window.ensemble.ttiMarked)return void t()}else if(null!=this.context.time_to_interactive)return void t();let n;const s=e=>{window.removeEventListener("TTI",s),clearTimeout(n),t()};window.addEventListener("TTI",s),e&&void 0!==e.timeoutMS&&(n=setTimeout(s,e.timeoutMS))})}isUsable(){return this.timerState===C.NEW||this.timerState===C.RUNNING}}const W={};let H;function z(e,t){const i={};for(const e of A){const n=t[e];n&&(i[e]=String(n))}const n=e;for(const e of x){const t=n[e];t&&(i[e]=String(t))}return{correlation_id:e.correlation_id,request_id:t.request_id,annotations:i}}function G(e,t){if(t.annotations)for(const i in t.annotations)if(t.annotations.hasOwnProperty(i)){const n=t.annotations[i];n&&e.addAnnotation(i,String(n))}t.correlation_id&&e.addAnnotation(p.ReservedAnnotationKey.CORRELATION_ID.id,t.correlation_id),t.request_id&&e.addAnnotation(p.ReservedAnnotationKey.REQUEST_ID.id,t.request_id),t.url&&e.addAnnotation(p.ReservedAnnotationKey.URL.id,t.url)}function $(e){return e?(function(e){const t=e;return W[t]||(W[t]=new B(m.WebTimingUtil.newContext(!0,e))),W[t]})(e):(H||K(),H)}function J(e={}){$().initialize({requireTTV:!!e.log_time_to_view,requireTTI:!!e.log_time_to_interactive,is_pagelet:e.is_pagelet,is_dws:e.is_dws,is_dws2:e.is_dws2,is_early_ensemble:e.is_early_ensemble,ttv_at_dom_interactive:e.ttv_at_dom_interactive,tti_at_dom_interactive:e.tti_at_dom_interactive,source_type:e.source_type,subtypes:e.subtypes,tti_exclusion_flow:e.tti_exclusion_flow,url:e.url,js_preloads_enabled:e.js_preloads_enabled,require_preloads_enabled:e.require_preloads_enabled,css_preloads_enabled:e.css_preloads_enabled,alternative_css_load_strategy_enabled:e.alternative_css_load_strategy_enabled,previews_preconnect_enabled:e.previews_preconnect_enabled,rollup_format:e.rollup_format})}function K(){H=new F(m.WebTimingUtil.newContext(!1,"default_timer"))}function Y(e,t){e.recordEntries(t.map(e=>({type:0!==e.startTime?f.TimingDataType.Span:f.TimingDataType.Trace,name:e.name,startTime:e.startTime,endTime:e.endTime,annotations:e.annotations}))),e.logData()}K(),t.get_timer=$,t.delete_timer=function(e){delete W[e]},t.time_to_view=function(){return $().timeToView()},t.time_to_interactive=function(){return $().timeToInteractive()},t.initialize_module=J,t.initialize=function(e,t){const i=t.dwsOpts;let n;switch(t.sourceType){case O.web_timing_logger.WebTimingLoggerServerContext.SourceType.UNKNOWN:n="unknown";break;case O.web_timing_logger.WebTimingLoggerServerContext.SourceType.MOBILE_WEB:n="mobile";break;case O.web_timing_logger.WebTimingLoggerServerContext.SourceType.DESKTOP_WEB:n="web"}const s={is_pagelet:t.isDws,is_dws:t.isDws,is_dws2:null!=i&&i.isDws2,is_early_ensemble:null!=i&&i.isEarlyEnsemble,subtypes:Object.assign(Object.assign({},t.subtypes),{js_preloading:null!=i&&i.jsPreloading?"true":"false"}),source_type:n,url:t.url};J(Object.assign(Object.assign({},s),e))},t.reset=K,t.start_time=function(){return $().startTime()},t.time_since_start=function(){return $().timeSinceStart()},t.set_tti_exclusion_flow=function(e){$().excludeFromTTI(e)};const X=["dws_ensemble_init","dws_embedded-app_require_config_callback","dws-processChunk-embedded-app-require_config-1"],Q=new RegExp("dws-processChunk-embedded-app-const_module.*");function Z(e){const t=c.get_module_times(),i=[];for(const e of t){const t=e.url;if(void 0===t&&e.name&&-1===e.name.indexOf("!")){E.reportStack(`Module ${e.name} with invalid map object fetched by requirejs`,{severity:E.SEVERITY.NONCRITICAL,tags:["log_js_module_timing"]});continue}let n=[];if(t&&(n=window.performance.getEntriesByName(t,"resource")),0!==n.length)e.start_time=n[0].startTime+n[0].duration;else{if(!("callback_duration"in e))continue;e.start_time=0}i.push(e)}e.js_module_times=JSON.stringify(i)}function ee(e,t){if(window.ensemble&&window.ensemble.markTTI)window.ensemble.markTTI();else{const i=new CustomEvent(void 0!==e?`TTI.${e}`:"TTI",{detail:{value:t},bubbles:!0,cancelable:!0});window.dispatchEvent(i)}}t.mark_time_to_view=function(){$().markTimeToView()},t.mark_time_to_interactive=function(e={}){const t=$();t.setExtraColumns(e),t.markTimeToInteractive()},t.waitForTTI=function(e){return $().waitForTTI(e)},t.log_js_modules_application_code_start=function(){$().applicationStart()},t.log_js_modules_fetched_data_required_for_tti=function(){$().fetchedDataRequiredForTTI()}})),define("metaserver/static/js/modules/clean/window_util",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onPageRestore=t.onBeforeUnload=void 0,t.onBeforeUnload=function(e){window.addEventListener("beforeunload",(function t(){e(),window.removeEventListener("beforeunload",t)}))},t.onPageRestore=function(e){window.addEventListener("pageshow",(function t(i){i.persisted&&(e(),window.removeEventListener("pageshow",t))}))}})),define("metaserver/static/js/modules/clean/js_basic_stopwatch",["require","exports","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/core/exception"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createStopwatch=t.NoopStopwatchInstance=t.JSBasicStopwatchImpl=t.TimingDataType=void 0;const s=!(!window.performance||!window.performance.now);let r=0;var o;(function(e){e[e.Span=1]="Span",e[e.AsyncSpan=2]="AsyncSpan",e[e.Trace=3]="Trace"})(o=t.TimingDataType||(t.TimingDataType={}));class a{constructor(e,t,i,n=!1,s){this.name=e,this.strictAssert=t,this.activeSpans={},this.aggregateSpans={},this._annotations=Object.assign({},s),this.spanStack=[],this.stopwatchTags=i||[],this.detached=n}reset(){this.activeSpans={},this.spanStack=[],this.aggregateSpans={},this._annotations={}}get annotations(){return this._annotations}addAnnotation(e,t){this._annotations[e]=t}removeAnnotation(e){delete this._annotations[e]}popResolvedSpans(){if(this.detached)return{};{const e=this.aggregateSpans;return this.aggregateSpans={},e}}peekResolvedSpans(){return this.detached?{}:this.aggregateSpans}static newSpanID(){const e=String(r);return r++,e}static resolveTime(e){return void 0===e&&(e=window.performance.now()),Math.round(e)}_resolveParent(e){if(e.type!==o.Span)return void(e.parent="");const t=this.spanStack[this.spanStack.length-1];if(t)if(t!==e.name)this._report_sw_misuse(`Closing ${t} while the latest open span is ${e.name}.\n        You are either mixing sync and async spans or closing sync spans out of order.`);else{this.spanStack.pop();let t="";for(const e of this.spanStack)t+=`${e}#`;e.parent=t}else this._report_sw_misuse(`${e.name} isn't a synchronous span and has to be started with "async:true".`)}recordTrace(e,t={}){const i=a.resolveTime(t.traceTime),n=a.newSpanID(),s={name:e,span_id:n,start_time:0,end_time:i,annotations:Object.assign({},t.annotations),type:o.Trace,parent:""};return this.recordSpan(this.stopwatchTags,s),n}start(e,t={}){e||this._report_sw_misuse("Reporting a span without a name");const i=a.resolveTime(t.startTime);t.async||this.spanStack.push(e);const n=a.newSpanID(),s={name:e,span_id:n,start_time:i||0,annotations:Object.assign({},t.annotations),type:t.async?o.AsyncSpan:o.Span};return e in this.activeSpans||(this.activeSpans[e]=[]),this.activeSpans[e].push(s),n}end(e,t={}){const i=this.findTimerDataIndex(e,t.spanId);if(-1===i)return;const n=this.activeSpans[e],s=n[i];n.splice(i,1),this._resolveParent(s);const r=a.resolveTime(t.endTime);if(!(r<s.start_time))return s.end_time=r,this.recordSpan(this.stopwatchTags,s),s.span_id;this._report_sw_misuse(`span ${e} has set an endTime earlier than start_time`)}addSpanAnnotation(e,t,i,n){const s=this.findTimerDataIndex(e,n);-1!==s&&(this.activeSpans[e][s].annotations[t]=i)}attach(){this.detached=!1}findTimerDataIndex(e,t){if(!(e in this.activeSpans)||0===this.activeSpans[e].length)return this._report_sw_misuse(`tried to find ${e} but that span doesn't exist`),-1;let i=-1;const n=this.activeSpans[e];if(void 0===t)i=0;else for(let e=0;e<n.length;e++)if(n[e].span_id===t){i=e;break}return-1===i&&this._report_sw_misuse(`tried to find ${e} with id ${t} but that span doesn't exist`),i}_report_sw_misuse(e){e=`JSBasicStopwatch ${this.name}: ${e}`,this.strictAssert?i.assert(!1,e):n.reportStack(e,{severity:n.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})}recordSpan(e,t){const i=`${t.parent}${t.name}`;i in this.aggregateSpans||(this.aggregateSpans[i]={name:t.name,start_time:t.start_time,total_time:0,num_calls:0,annotations:Object.keys(t.annotations).length>0?t.annotations:void 0,parent:t.parent||"",stopwatch_tags:e.length>0?e:void 0,type:t.type});const n=this.aggregateSpans[i];if(void 0!==t.end_time){if(n.type===o.Trace?(n.total_time=t.end_time-t.start_time,n.num_calls=1):(n.total_time+=t.end_time-t.start_time,n.num_calls+=1),Object.keys(t.annotations).length>0)if(n.annotations)for(const e in t.annotations)t.annotations.hasOwnProperty(e)&&(n.annotations[e]=t.annotations[e]);else n.annotations=t.annotations}else this._report_sw_misuse(`Span ${i} reported with undefined end_time`)}}t.JSBasicStopwatchImpl=a;t.NoopStopwatchInstance=new class{constructor(){this.name="",this.annotations={}}reset(){}attach(){}addAnnotation(e,t){}removeAnnotation(e){}popResolvedSpans(){return{}}peekResolvedSpans(){return{}}start(e,t){}end(e,t){}recordTrace(e,t){}addSpanAnnotation(e,t,i,n){}},t.createStopwatch=function(e,i,n,r=!1,o){return s?new a(e,i,n,r,o):t.NoopStopwatchInstance}})),define("metaserver/static/js/modules/clean/js_client_stopwatch",["require","exports","tslib","metaserver/static/js/modules/core/xhr","metaserver/static/js/modules/clean/js_basic_stopwatch","metaserver/static/js/modules/constants/request","metaserver/static/js/modules/core/assert","metaserver/static/js/modules/core/browser","metaserver/static/js/modules/core/exception"],(function(e,t,i,n,s,r,o,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSStopwatch=t.ReservedAnnotationKey=void 0,r=i.__importStar(r),a=i.__importStar(a);class l{constructor(e){this.id=e}}t.ReservedAnnotationKey=l,l.REQUEST_ID=new l("dropbox.js_client_stopwatch.request_id"),l.CORRELATION_ID=new l("dropbox.js_client_stopwatch.correlation_id"),l.URL=new l("dropbox.js_client_stopwatch.url");class d{constructor(){this.GLOBAL_SW_NAME="GLOBAL_STOPWATCH",this.flush_interval=6e4,this.debugEnabled=!0,this.strictAssert=!1,this.intervalId=null,this.clientStopwatchCounter=1,this.reset()}reset(){this.globalStopwatches={},this.clientStopwatches={},this.clientStopwatchCounter=1,this.sentInitialData=!1,this.create_stopwatch(this.GLOBAL_SW_NAME),this.intervalId&&clearInterval(this.intervalId),this.intervalId=null}reset_individual_stopwatch(e){this.stopwatch_exists(e)?this.globalStopwatches[e].reset():this._report_sw_misuse(`tried to reset the stopwatch ${e} but it does not exist`)}stopwatch_exists(e){return e in this.globalStopwatches}create_stopwatch(e,t){this.stopwatch_exists(e)?this._report_sw_misuse(`tried to create a new stopwatch ${e} but it already exists`):this.globalStopwatches[e]=s.createStopwatch(e,this.strictAssert,t)}createDetachedStopwatch(e,t={}){const i=s.createStopwatch(e,this.strictAssert,t.tags,!0,t.annotations),n=new u(this.clientStopwatchCounter++,e,i,t.request_id,t.correlation_id,t.url);return this.clientStopwatches[n.id]=n,n}deleteStopwatch(e){delete this.clientStopwatches[e.id]}create_stopwatch_if_not_exist(e,t){this.stopwatch_exists(e)||this.create_stopwatch(e,t)}getStopwatch(e){return this.stopwatch_exists(e)?this.globalStopwatches[e]:(this._report_sw_misuse(`${e} doesn't exist`),null)}recordTrace(e,t={}){const i=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null==i)return;const n={traceTime:t.traceTime};return i.recordTrace(e,n)}startSpan(e,t={}){const i=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null==i)return;const n={startTime:t.startTime,async:t.async};return i.start(e,n)}endSpan(e,t={}){const i=this.getStopwatch(t.stopwatchName||this.GLOBAL_SW_NAME);if(null!=i)return i.end(e,{spanId:t.spanId,endTime:t.endTime})}addSpanAnnotation(e,t,i,n={}){const s=this.getStopwatch(n.stopwatchName||this.GLOBAL_SW_NAME);null!=s&&s.addSpanAnnotation(e,t,i,n.spanId)}log_stored_results(){this.sentInitialData?this._report_sw_misuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.flush_current_data(),this.sentInitialData=!0,this.intervalId=setInterval(this.flush_current_data.bind(this),this.flush_interval))}_report_sw_misuse(e){e=`ClientStopwatch: ${e}`,this.strictAssert?o.assert(!1,e):c.reportStack(e,{severity:c.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})}flush_current_data(){for(const e in this.globalStopwatches)this.globalStopwatches.hasOwnProperty(e)&&d.logStopwatchData(this.globalStopwatches[e]);for(const e in this.clientStopwatches)this.clientStopwatches.hasOwnProperty(e)&&d.logStopwatchData(this.clientStopwatches[e].stopwatch)}static logStopwatchData(e){const t=e.popResolvedSpans(),i=e.name,n={};if(Object.keys(t).length>d.MAXSPANS){let s=0;n[i]={};for(const r in t)t.hasOwnProperty(r)&&(n[i][r]=t[r],s===d.MAXSPANS&&(n[i].annotations=e.annotations,d.send_spans(n),s=0,n[i]={}),s++)}else n[i]=t;0!==Object.keys(n[i]).length&&(n[i].annotations=e.annotations,d.send_spans(n))}static send_spans(e){const t=JSON.stringify(e),i={request_id:r.REQUEST_ID,url:a.get_href().replace("/dws2",""),aggregated_sw_data:t};n.sendXhr("/log_js_sw_data",i)}print_stopwatches_debug(){const e=this.get_debug_data();console.table&&console.groupCollapsed&&console.groupEnd&&e&&e.length>0&&(console.groupCollapsed("Request timeline"),console.table(e),console.groupEnd())}get_debug_data(){const e=[];for(const t in this.globalStopwatches)if(this.globalStopwatches.hasOwnProperty(t)){const i=this.globalStopwatches[t].peekResolvedSpans();for(const n in i)if(i.hasOwnProperty(n)){const r=i[n],o={stopwatchName:t,spanName:r.name,time:r.start_time+r.total_time};r.type!==s.TimingDataType.AsyncSpan&&r.type!==s.TimingDataType.Span||(o.startTime=r.start_time),r.type===s.TimingDataType.Span&&(o.info=`Total time: ${r.total_time}ms`),e.push(o)}}return e.sort((e,t)=>e.time-t.time),e}}d.MAXSPANS=2e3,t.JSStopwatch=new d;class u{constructor(e,t,i,n,s,r){this.sentInitialData=!1,this.strictAssert=!1,this.id=e,this.stopwatch=i,this._request_id=n,this._correlation_id=s,this._url=r,this._request_id&&this.stopwatch.addAnnotation(l.REQUEST_ID.id,this._request_id),this._correlation_id&&this.stopwatch.addAnnotation(l.CORRELATION_ID.id,this._correlation_id),this._url&&this.stopwatch.addAnnotation(l.URL.id,this._url)}set request_id(e){this._request_id=e,this._request_id?this.stopwatch.addAnnotation(l.REQUEST_ID.id,this._request_id):this.stopwatch.removeAnnotation(l.REQUEST_ID.id)}set correlation_id(e){this._correlation_id=e,this._correlation_id?this.stopwatch.addAnnotation(l.CORRELATION_ID.id,this._correlation_id):this.stopwatch.removeAnnotation(l.CORRELATION_ID.id)}set url(e){this._url=e,this._url?this.stopwatch.addAnnotation(l.URL.id,this._url):this.stopwatch.removeAnnotation(l.URL.id)}startSpan(e,t){return this.stopwatch.start(e,t)}endSpan(e,t){return this.stopwatch.end(e,t)}addSpanAnnotation(e,t,i,n){this.stopwatch.addSpanAnnotation(e,t,i,n)}recordTrace(e,t,i){this.stopwatch.recordTrace(e,{traceTime:t,annotations:i})}recordEntries(e){for(const t of e)if(t.type===s.TimingDataType.Trace)this.recordTrace(t.name,t.endTime,t.annotations);else{const e=t.startTime||0,i=this.startSpan(t.name,{startTime:Math.min(e,t.endTime),async:t.type===s.TimingDataType.AsyncSpan,annotations:t.annotations});t.endTime<e&&this.addSpanAnnotation(t.name,"negativeSpanLength",(t.endTime-e).toString(),i),this.endSpan(t.name,{spanId:i,endTime:Math.max(e,t.endTime)})}}logData(){this.sentInitialData?this.reportMisuse("ClientStopwatch tried to log stored results, but the stopwatch is set to log immediately"):(this.stopwatch.attach(),this.sentInitialData=!0,setTimeout(()=>{t.JSStopwatch.flush_current_data()},0))}addAnnotation(e,t){this.stopwatch.addAnnotation(e,t)}removeAnnotation(e){this.stopwatch.removeAnnotation(e)}reportMisuse(e){e=`ClientStopwatch: ${e}`,this.strictAssert?o.assert(!1,e):c.reportStack(e,{severity:c.SEVERITY.NONCRITICAL,tags:["log_js_stopwatch"]})}}})),define("apex-metrics/index",["require","exports","tslib","apex-metrics/clock","apex-metrics/executor","apex-metrics/instant","apex-metrics/internal","apex-metrics/metrics","apex-metrics/metrics_reporter","apex-metrics/no_op","apex-metrics/types","apex-metrics/validate","apex-metrics/murmur","apex-metrics/hyperloglog"],(function(e,t,i,n,s,r,o,a,c,l,d,u,m,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.__exportStar(n,t),i.__exportStar(s,t),i.__exportStar(r,t),i.__exportStar(o,t),i.__exportStar(a,t),i.__exportStar(c,t),i.__exportStar(l,t),i.__exportStar(d,t),i.__exportStar(u,t),i.__exportStar(m,t),i.__exportStar(p,t)})),define("apex-metrics/clock",["require","exports","apex-metrics/types"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserPerformanceClock=void 0;t.BrowserPerformanceClock=class{now(){return{value:performance.now(),unit:i.TimeUnit.MILLISECONDS}}}})),define("apex-metrics/executor",["require","exports","apex-metrics/instant"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetTimeoutExecutor=void 0;t.SetTimeoutExecutor=class{constructor(e){this.jitterStrategy=e}executeEvery(e,t){const n=i.Instant.toMilliseconds(e),s=i.Instant.toMilliseconds(this.jitterStrategy());setTimeout(()=>{t()&&this.executeEvery(e,t)},n+s)}}})),define("apex-metrics/instant",["require","exports","apex-metrics/types"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Instant=void 0;t.Instant=class{static toMilliseconds(e){switch(e.unit){case i.TimeUnit.NANOSECONDS:return e.value/1e6;case i.TimeUnit.MILLISECONDS:return e.value;case i.TimeUnit.SECONDS:return 1e3*e.value;case i.TimeUnit.MINUTES:return 6e4*e.value;case i.TimeUnit.HOURS:return 36e5*e.value;case i.TimeUnit.DAYS:return 24*e.value*36e5}}}})),define("apex-metrics/internal",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("apex-metrics/metrics",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})})),define("apex-metrics/metrics_reporter",["require","exports","apex-metrics/instant","apex-metrics/validate","apex-metrics/hyperloglog"],(function(e,t,i,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsReporterImpl=void 0;class r{constructor(e,t,i,n={}){this.sink=e,this.clock=t,this.originId=i,this.tags=n}static root(e,t,i=""){return new r(e,t,i)}child(e){return new r(this.sink,this.clock,this.originId,Object.assign(Object.assign({},this.tags),n.validateTags(e)))}createStats(e,t={}){return new o(n.validateMetric(e),Object.assign(Object.assign({},this.tags),n.validateTags(t)),this.sink)}createCounter(e,t={}){return new a(n.validateMetric(e),Object.assign(Object.assign({},this.tags),n.validateTags(t)),this.sink)}createTimer(e,t={}){return new c(n.validateMetric(e),Object.assign(Object.assign({},this.tags),n.validateTags(t)),this.sink,this.clock)}createSet(e,t={}){return new l(n.validateMetric(e),Object.assign(Object.assign({},this.tags),n.validateTags(t)),this.sink,this.originId)}}t.MetricsReporterImpl=r;class o{constructor(e,t,i){this.metric=e,this.tags=t,this.sink=i}record(e){d(e,this.metric,this.tags,this.sink)}recordDuration(e,t){d(i.Instant.toMilliseconds({value:e,unit:t}),this.metric,this.tags,this.sink)}}class a{constructor(e,t,i,n=0){this.metric=e,this.tags=t,this.sink=i,this.value=n}decrement(e=1){this.value-=e}increment(e=1){this.value+=e}reset(e=0){this.value=e}record(){d(this.value,this.metric,this.tags,this.sink),this.reset()}}class c{constructor(e,t,n,s,r=0){this.metric=e,this.tags=t,this.sink=n,this.clock=s,this.value=r,this.value=i.Instant.toMilliseconds(this.clock.now())}record(){d(i.Instant.toMilliseconds(this.clock.now())-this.value,this.metric,this.tags,this.sink),this.reset()}reset(){this.value=i.Instant.toMilliseconds(this.clock.now())}}class l{constructor(e,t,i,n){this.metric=e,this.tags=t,this.sink=i,this.originId=n}observe(e){if("string"!=typeof e)throw new Error("value must be a string");const t=s.hash(e);this.sink.recordSetSpan({namespace:this.metric.ns,metricName:this.metric.name,tags:this.tags,samples:[t],type:"set"})}observeOriginId(){this.observe(this.originId)}}function d(e,t,i,n){if("number"!=typeof e)throw new Error("value must be a number");n.recordSpan({namespace:t.ns,metricName:t.name,tags:i,samples:[e],type:"histogram"})}})),define("apex-metrics/no_op",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoOpExecutor=t.NoOpSink=void 0;t.NoOpSink=class{recordSpan(){}recordSetSpan(){}};t.NoOpExecutor=class{executeEvery(){}}})),define("apex-metrics/types",["require","exports"],(function(e,t){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TimeUnit=void 0,(i=t.TimeUnit||(t.TimeUnit={}))[i.NANOSECONDS=0]="NANOSECONDS",i[i.MILLISECONDS=1]="MILLISECONDS",i[i.SECONDS=2]="SECONDS",i[i.MINUTES=3]="MINUTES",i[i.HOURS=4]="HOURS",i[i.DAYS=5]="DAYS"})),define("apex-metrics/validate",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateMetricName=t.validateNamespace=t.validateTags=t.validateMetric=void 0;const i=new RegExp("^[^0-9a-zA-Z]+"),n=new RegExp("[^0-9a-zA-Z._-]","g"),s=n,r=new RegExp("[^0-9a-zA-Z/._-]","g"),o=n;function a(e){return l(e,"namespace",256,i,s)}function c(e){return l(e,"metric name",256,i,r)}function l(e,t,i,n,s){const r=[];if("string"!=typeof e&&r.push("identifier is not a string"),n&&n.test(e)&&r.push("invalid prefix"),s&&s.test(e)&&r.push("invalid characters"),e.length>i&&r.push(`exceeds ${i} characters`),0===e.length&&r.push("is empty"),0!==r.length)throw new Error(`${t} identifier '${e}' is invalid: ${r}`);return e}t.validateMetric=function(e){return{ns:a(e.ns),name:c(e.name)}},t.validateTags=function(e){const t={};for(const n in e)if(e.hasOwnProperty(n)){t[l(n,"tag name",256,i,o)]=l(e[n],"tag value",256)}return t},t.validateNamespace=a,t.validateMetricName=c})),define("apex-metrics/hyperloglog",["require","exports","apex-metrics/murmur"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stripCompress=t.HyperLogLog=t.hash=void 0;const n=Math.pow(2,32),s=[1,.5,.25,.125,.0625,.03125,.015625,.0078125,.00390625,.001953125,.0009765625,.00048828125,.000244140625,.0001220703125,6103515625e-14,30517578125e-15,152587890625e-16,762939453125e-17,3814697265625e-18,19073486328125e-19,9.5367431640625e-7,4.76837158203125e-7,2.384185791015625e-7,1.1920928955078125e-7,5.960464477539063e-8,2.9802322387695312e-8,1.4901161193847656e-8,7.450580596923828e-9,3.725290298461914e-9,1.862645149230957e-9,9.313225746154785e-10,4.656612873077393e-10,2.3283064365386963e-10],r=Math.pow(2,5);t.hash=function(e){return i.hash32(i.stringToUtf8ByteArray(e),538513424)};function o(e){if(8!=e.length)throw new Error("Number of registers in stripCompress routine is not 8");const t=[];let i=0;for(let t=0;t<8;t++){if(i*=r,e[t]>=r)throw new Error("Register in HLL greater than max allowed value");i+=e[t]}for(let e=0;e<5;e++)t.unshift(Number(i%256)),i=Math.floor(i/256);return t}t.HyperLogLog=class{constructor(e=[]){this.registers=new Array(512).fill(0),e.forEach(e=>this.add(e))}add(e){if(e>=n)throw new Error("add only accepts 32-bit unsigned integers");const t=(function(e,t){let i=1;for(;(2147483648&e)>>>0==0&&i<=t;)i++,e=e<<1>>>0;return i})(e<<9>>>0,23),i=e>>>23;t>this.registers[i]&&(this.registers[i]=t)}count(){let e=this.registers.reduce((e,t)=>e+s[t],0),t=this.registers.reduce((e,t)=>e+(0==t?1:0),0);if(512==t)return 0;let i=188686.82445861166/e;return i<=1280?t>0&&(i=512*Math.log(512/t)):i>1/30*n&&(i=-n*Math.log(1-i/n)),i}merge(e){for(let t=0;t<512;t++){const i=e.registers[t];i>this.registers[t]&&(this.registers[t]=i)}}compressed(){const e=[];for(let t=0;t<64;t++){const i=o(this.registers.slice(8*t,8*(t+1)));for(const t of i)e.push(t)}return String.fromCharCode(...e)}},t.stripCompress=o})),define("apex-metrics/murmur",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToUtf8ByteArray=t.hash32=void 0;function i(e){if(4!=e.length)throw new Error("strToUint32 expected length 4 byte array");return e[0]+(e[1]<<8)+(e[2]<<16)+(e[3]<<24)}t.hash32=function(e,t){let n=t;const s=Math.floor(e.length/4);for(let t=0;t<s;t++){let s=i(e.slice(4*t,4*t+4));s=Math.imul(s,3432918353),s=(s<<15>>>0|s>>>17)>>>0,s=Math.imul(s,461845907),n^=s,n>>>=0,n=(n<<13>>>0|n>>>19)>>>0,n=Math.imul(n,5)+3864292196>>>0}let r=e.slice(4*s),o=0;const a=3&r.length;return 3==a&&(o^=r[2]<<16>>>0,o>>>=0),a>=2&&(o^=r[1]<<8>>>0,o>>>=0),a>=1&&(o^=r[0],o=Math.imul(o,3432918353),o=(o<<15>>>0|o>>>17)>>>0,o=Math.imul(o,461845907),n^=o,n>>>=0),n^=e.length,n>>>=0,n^=n>>>16,n>>>=0,n=Math.imul(n,2246822507),n^=n>>>13,n>>>=0,n=Math.imul(n,3266489909),n^=n>>>16,n>>>=0,n},t.stringToUtf8ByteArray=function(e){const t=[];let i=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);s<128?t[i++]=s:s<2048?(t[i++]=s>>6|192,t[i++]=63&s|128):(t[i++]=s>>12|224,t[i++]=s>>6&63|128,t[i++]=63&s|128)}return t}})),define("metaserver/static/js/dropbox/proto/js_init_data/web_timing_logger/web_timing_logger",["require","exports","tslib","protobufjs/minimal"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.web_timing_logger=void 0;const s=(n=i.__importStar(n)).Reader,r=n.Writer,o=n.util,a=n.roots.default||(n.roots.default={});var c;t.default=a,t.web_timing_logger=a.web_timing_logger=((c=a.web_timing_logger||{}).WebTimingLoggerServerContext=(function(e){function e(e){if(this.subtypes={},e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.isDws=!1,e.prototype.dwsOpts=null,e.prototype.sourceType=0,e.prototype.subtypes=o.emptyObject,e.prototype.url="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=r.create()),null!=e.isDws&&Object.hasOwnProperty.call(e,"isDws")&&t.uint32(8).bool(e.isDws),null!=e.dwsOpts&&Object.hasOwnProperty.call(e,"dwsOpts")&&a.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.encode(e.dwsOpts,t.uint32(18).fork()).ldelim(),null!=e.sourceType&&Object.hasOwnProperty.call(e,"sourceType")&&t.uint32(24).int32(e.sourceType),null!=e.subtypes&&Object.hasOwnProperty.call(e,"subtypes"))for(let i=Object.keys(e.subtypes),n=0;n<i.length;++n)t.uint32(34).fork().uint32(10).string(i[n]).uint32(18).string(e.subtypes[i[n]]).ldelim();return null!=e.url&&Object.hasOwnProperty.call(e,"url")&&t.uint32(42).string(e.url),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i,n,r=void 0===t?e.len:e.pos+t,c=new a.web_timing_logger.WebTimingLoggerServerContext;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:c.isDws=e.bool();break;case 2:c.dwsOpts=a.web_timing_logger.WebTimingLoggerServerContext.DWSOptions.decode(e,e.uint32());break;case 3:c.sourceType=e.int32();break;case 4:{c.subtypes===o.emptyObject&&(c.subtypes={});let t=e.uint32()+e.pos;for(i="",n="";e.pos<t;){let t=e.uint32();switch(t>>>3){case 1:i=e.string();break;case 2:n=e.string();break;default:e.skipType(7&t)}}c.subtypes[i]=n;break}case 5:c.url=e.string();break;default:e.skipType(7&t)}}return c},e.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext"},e.DWSOptions=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.isDws2=!1,e.prototype.isEarlyEnsemble=!1,e.prototype.jsPreloading=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),null!=e.isDws2&&Object.hasOwnProperty.call(e,"isDws2")&&t.uint32(8).bool(e.isDws2),null!=e.isEarlyEnsemble&&Object.hasOwnProperty.call(e,"isEarlyEnsemble")&&t.uint32(16).bool(e.isEarlyEnsemble),null!=e.jsPreloading&&Object.hasOwnProperty.call(e,"jsPreloading")&&t.uint32(24).bool(e.jsPreloading),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.web_timing_logger.WebTimingLoggerServerContext.DWSOptions;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.isDws2=e.bool();break;case 2:n.isEarlyEnsemble=e.bool();break;case 3:n.jsPreloading=e.bool();break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/web_timing_logger.WebTimingLoggerServerContext.DWSOptions"},e})(e.DWSOptions||{}),e.SourceType=(function(){const e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="DESKTOP_WEB"]=1,t[e[2]="MOBILE_WEB"]=2,t})(),e})(c.WebTimingLoggerServerContext||{}),c)})),define("metaserver/static/js/dropbox/proto/apex_metrics_web/apex_metrics_web",["require","exports","tslib","protobufjs/minimal","metaserver/static/js/google/protobuf/empty","metaserver/static/js/google/protobuf/timestamp"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.apex_metrics_web=void 0;const s=(n=i.__importStar(n)).Reader,r=n.Writer,o=n.util,a=n.roots.default||(n.roots.default={});var c;t.default=a,t.apex_metrics_web=a.apex_metrics_web=((c=a.apex_metrics_web||{}).RecordNamespace=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.RecordNamespace;for(;e.pos<i;){let t=e.uint32();e.skipType(7&t)}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace"},e.MetricReportingConfigV2=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.metricNamespace="",e.prototype.maxTimeUntilRefreshSeconds=0,e.prototype.stopPublicationForSeconds=0,e.prototype.dropSamples=null,e.prototype.dropPeriods=null,e.prototype.dropFractionOfHostsPerMetric=0,e.prototype.aggregationIntervalSeconds=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),null!=e.metricNamespace&&Object.hasOwnProperty.call(e,"metricNamespace")&&t.uint32(10).string(e.metricNamespace),null!=e.maxTimeUntilRefreshSeconds&&Object.hasOwnProperty.call(e,"maxTimeUntilRefreshSeconds")&&t.uint32(16).uint32(e.maxTimeUntilRefreshSeconds),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(24).uint32(e.stopPublicationForSeconds),null!=e.dropSamples&&Object.hasOwnProperty.call(e,"dropSamples")&&a.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropSamples,t.uint32(34).fork()).ldelim(),null!=e.dropPeriods&&Object.hasOwnProperty.call(e,"dropPeriods")&&a.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.encode(e.dropPeriods,t.uint32(42).fork()).ldelim(),null!=e.dropFractionOfHostsPerMetric&&Object.hasOwnProperty.call(e,"dropFractionOfHostsPerMetric")&&t.uint32(49).double(e.dropFractionOfHostsPerMetric),null!=e.aggregationIntervalSeconds&&Object.hasOwnProperty.call(e,"aggregationIntervalSeconds")&&t.uint32(56).uint32(e.aggregationIntervalSeconds),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.RecordNamespace.MetricReportingConfigV2;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.metricNamespace=e.string();break;case 2:n.maxTimeUntilRefreshSeconds=e.uint32();break;case 3:n.stopPublicationForSeconds=e.uint32();break;case 4:n.dropSamples=a.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 5:n.dropPeriods=a.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2.decode(e,e.uint32());break;case 6:n.dropFractionOfHostsPerMetric=e.double();break;case 7:n.aggregationIntervalSeconds=e.uint32();break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.MetricReportingConfigV2"},e})(e.MetricReportingConfigV2||{}),e.StickyBiasedCoinV2=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.fraction=0,e.prototype.stickiness=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),null!=e.fraction&&Object.hasOwnProperty.call(e,"fraction")&&t.uint32(9).double(e.fraction),null!=e.stickiness&&Object.hasOwnProperty.call(e,"stickiness")&&a.apex_metrics_web.RecordNamespace.StickinessV2.encode(e.stickiness,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.RecordNamespace.StickyBiasedCoinV2;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.fraction=e.double();break;case 2:n.stickiness=a.apex_metrics_web.RecordNamespace.StickinessV2.decode(e,e.uint32());break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickyBiasedCoinV2"},e})(e.StickyBiasedCoinV2||{}),e.StickinessV2=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}let t;return e.prototype.independent=null,e.prototype.permanent=null,e.prototype.nResults=0,e.prototype.nSeconds=0,Object.defineProperty(e.prototype,"limit",{get:o.oneOfGetter(t=["independent","permanent","nResults","nSeconds"]),set:o.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),null!=e.independent&&Object.hasOwnProperty.call(e,"independent")&&a.google.protobuf.Empty.encode(e.independent,t.uint32(10).fork()).ldelim(),null!=e.permanent&&Object.hasOwnProperty.call(e,"permanent")&&a.google.protobuf.Empty.encode(e.permanent,t.uint32(18).fork()).ldelim(),null!=e.nResults&&Object.hasOwnProperty.call(e,"nResults")&&t.uint32(24).uint32(e.nResults),null!=e.nSeconds&&Object.hasOwnProperty.call(e,"nSeconds")&&t.uint32(37).float(e.nSeconds),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.RecordNamespace.StickinessV2;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.independent=a.google.protobuf.Empty.decode(e,e.uint32());break;case 2:n.permanent=a.google.protobuf.Empty.decode(e,e.uint32());break;case 3:n.nResults=e.uint32();break;case 4:n.nSeconds=e.float();break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.StickinessV2"},e})(e.StickinessV2||{}),e.RecordResponse=(function(e){function e(e){if(this.reportingConfigs=[],this.debugInfos=[],e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.reportingConfigs=o.emptyArray,e.prototype.publicationIntervalSeconds=0,e.prototype.maxScopesPerRequest=0,e.prototype.stopPublicationForSeconds=0,e.prototype.debugInfos=o.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=r.create()),null!=e.reportingConfigs&&e.reportingConfigs.length)for(let i=0;i<e.reportingConfigs.length;++i)a.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.encode(e.reportingConfigs[i],t.uint32(10).fork()).ldelim();if(null!=e.publicationIntervalSeconds&&Object.hasOwnProperty.call(e,"publicationIntervalSeconds")&&t.uint32(24).uint32(e.publicationIntervalSeconds),null!=e.maxScopesPerRequest&&Object.hasOwnProperty.call(e,"maxScopesPerRequest")&&t.uint32(32).uint32(e.maxScopesPerRequest),null!=e.stopPublicationForSeconds&&Object.hasOwnProperty.call(e,"stopPublicationForSeconds")&&t.uint32(40).uint32(e.stopPublicationForSeconds),null!=e.debugInfos&&e.debugInfos.length)for(let i=0;i<e.debugInfos.length;++i)t.uint32(50).string(e.debugInfos[i]);return t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.RecordNamespace.RecordResponse;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.reportingConfigs&&n.reportingConfigs.length||(n.reportingConfigs=[]),n.reportingConfigs.push(a.apex_metrics_web.RecordNamespace.MetricReportingConfigV2.decode(e,e.uint32()));break;case 3:n.publicationIntervalSeconds=e.uint32();break;case 4:n.maxScopesPerRequest=e.uint32();break;case 5:n.stopPublicationForSeconds=e.uint32();break;case 6:n.debugInfos&&n.debugInfos.length||(n.debugInfos=[]),n.debugInfos.push(e.string());break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.RecordNamespace.RecordResponse"},e})(e.RecordResponse||{}),e})(c.RecordNamespace||{}),c.ApexMetricsCacheData=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.config=null,e.prototype.timeStored=null,e.prototype.state=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),null!=e.config&&Object.hasOwnProperty.call(e,"config")&&a.apex_metrics_web.RecordNamespace.RecordResponse.encode(e.config,t.uint32(10).fork()).ldelim(),null!=e.timeStored&&Object.hasOwnProperty.call(e,"timeStored")&&a.google.protobuf.Timestamp.encode(e.timeStored,t.uint32(18).fork()).ldelim(),null!=e.state&&Object.hasOwnProperty.call(e,"state")&&a.apex_metrics_web.ApexMetricsCacheData.FilterState.encode(e.state,t.uint32(26).fork()).ldelim(),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.ApexMetricsCacheData;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.config=a.apex_metrics_web.RecordNamespace.RecordResponse.decode(e,e.uint32());break;case 2:n.timeStored=a.google.protobuf.Timestamp.decode(e,e.uint32());break;case 3:n.state=a.apex_metrics_web.ApexMetricsCacheData.FilterState.decode(e,e.uint32());break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData"},e.CoinState=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.lastFlipTime=null,e.prototype.lastResult=!1,e.prototype.numTimesChecked=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),null!=e.lastFlipTime&&Object.hasOwnProperty.call(e,"lastFlipTime")&&a.google.protobuf.Timestamp.encode(e.lastFlipTime,t.uint32(10).fork()).ldelim(),null!=e.lastResult&&Object.hasOwnProperty.call(e,"lastResult")&&t.uint32(16).bool(e.lastResult),null!=e.numTimesChecked&&Object.hasOwnProperty.call(e,"numTimesChecked")&&t.uint32(24).uint32(e.numTimesChecked),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.ApexMetricsCacheData.CoinState;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.lastFlipTime=a.google.protobuf.Timestamp.decode(e,e.uint32());break;case 2:n.lastResult=e.bool();break;case 3:n.numTimesChecked=e.uint32();break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.CoinState"},e})(e.CoinState||{}),e.NamespaceCoinState=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.dropPeriodCoin=null,e.prototype.dropSamplesCoin=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=r.create()),null!=e.dropPeriodCoin&&Object.hasOwnProperty.call(e,"dropPeriodCoin")&&a.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropPeriodCoin,t.uint32(10).fork()).ldelim(),null!=e.dropSamplesCoin&&Object.hasOwnProperty.call(e,"dropSamplesCoin")&&a.apex_metrics_web.ApexMetricsCacheData.CoinState.encode(e.dropSamplesCoin,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i=void 0===t?e.len:e.pos+t,n=new a.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.dropPeriodCoin=a.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;case 2:n.dropSamplesCoin=a.apex_metrics_web.ApexMetricsCacheData.CoinState.decode(e,e.uint32());break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState"},e})(e.NamespaceCoinState||{}),e.FilterState=(function(e){function e(e){if(this.namespaceCoinState={},e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.filterID=0,e.prototype.namespaceCoinState=o.emptyObject,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=r.create()),null!=e.filterID&&Object.hasOwnProperty.call(e,"filterID")&&t.uint32(8).uint32(e.filterID),null!=e.namespaceCoinState&&Object.hasOwnProperty.call(e,"namespaceCoinState"))for(let i=Object.keys(e.namespaceCoinState),n=0;n<i.length;++n)t.uint32(18).fork().uint32(10).string(i[n]),a.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.encode(e.namespaceCoinState[i[n]],t.uint32(18).fork()).ldelim().ldelim();return t},e.decode=function(e,t){e instanceof s||(e=s.create(e));let i,n,r=void 0===t?e.len:e.pos+t,c=new a.apex_metrics_web.ApexMetricsCacheData.FilterState;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 1:c.filterID=e.uint32();break;case 2:{c.namespaceCoinState===o.emptyObject&&(c.namespaceCoinState={});let t=e.uint32()+e.pos;for(i="",n=null;e.pos<t;){let t=e.uint32();switch(t>>>3){case 1:i=e.string();break;case 2:n=a.apex_metrics_web.ApexMetricsCacheData.NamespaceCoinState.decode(e,e.uint32());break;default:e.skipType(7&t)}}c.namespaceCoinState[i]=n;break}default:e.skipType(7&t)}}return c},e.getTypeUrl=function(){return"type.googleapis.com/apex_metrics_web.ApexMetricsCacheData.FilterState"},e})(e.FilterState||{}),e})(c.ApexMetricsCacheData||{}),c)})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.waitForPageHidden=t.waitForPageLoad=void 0,t.waitForPageLoad=()=>"complete"===document.readyState?Promise.resolve():new Promise((e,t)=>{window.addEventListener("load",()=>{e()})}),t.waitForPageHidden=()=>new Promise((e,t)=>{const i=t=>{"pagehide"!==t.type&&"hidden"!==document.visibilityState||(document.removeEventListener("visibilitychange",i,!0),window.removeEventListener("pagehide",i,!0),e())};document.addEventListener("visibilitychange",i,!0),window.addEventListener("pagehide",i,!0)})})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/annotations",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationNameEnum=void 0,(function(e){e.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS="long_input_delay_callback_latency_overhead_ms",e.AVG_LONG_INPUT_DELAY_MS="long_input_delay_ms",e.VC_IN_VIEWPORT_MUTATION_OBSERVED_COUNT="vc_in_viewport_mutation_observed_count",e.VC_INTERSECTIONS_SCHEDULED_COUNT="vc_intersections_scheduled_count",e.VC_MUTATIONS_OBSERVED_COUNT="vc_mutations_observed_count",e.VC_INTERSECTIONS_OBSERVED_COUNT="vc_intersections_observed_count",e.VC_TOTAL_MUTATION_CALLBACK_LATENCY_OVERHEAD_MS="vc_total_mutation_callback_latency_overhead_ms",e.VC_TOTAL_INTERSECTION_CALLBACK_LATENCY_OVERHEAD_MS="vc_total_intersection_callback_latency_overhead_ms",e.VC_TOTAL_CALLBACK_LATENCY_OVERHEAD_MS="vc_total_callback_latency_overhead_ms",e.VC_ELEMENTS_SCHEDULED_FOR_OBSERVATION_BUT_NOT_OBSERVED_COUNT="vc_elements_scheduled_for_observation_but_not_observed_count"})(t.AnnotationNameEnum||(t.AnnotationNameEnum={}))})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/in_viewport_mutation_observer",["require","exports","metaserver/static/js/modules/clean/user_centric_perf_metrics/annotations"],(function(e,t,i){"use strict";var n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.ElementWrapperFactory=t.Mutation=t.InViewportMutationRecordToMutationsProcessor=t.InViewportMutationObserver=t.HTMLAttribute=t.MutationReason=void 0,(function(e){e.STYLE_ATTRIBUTE_MODIFIED="STYLE_ATTRIBUTE_MODIFIED",e.HIDDEN_ATTRIBUTE_MODIFIED="HIDDEN_ATTRIBUTE_MODIFIED",e.DOM_NODE_ADDED="DOM_NODE_ADDED",e.IMAGE_ATTRIBUTE_MODIFIED="IMAGE_ATTRIBUTE_MODIFIED",e.IMAGE_DOM_NODE_ADDED="IMAGE_DOM_NODE_ADDED"})(n=t.MutationReason||(t.MutationReason={})),(function(e){e.ATTRIBUTE_NAME="data-visuallycomplete",e.IGNORE_VALUE="IGNORE"})(s=t.HTMLAttribute||(t.HTMLAttribute={}));const r=new Set;t.InViewportMutationObserver=class{constructor(e){var t,i,n;this.pendingMutations=new Map,this.mutationObserverConfig={attributeFilter:["hidden","style","src"],attributeOldValue:!0,attributes:!0,characterData:!0,childList:!0,subtree:!0},this.isObserving=!1,this.intersectionsScheduledCount=0,this.mutatationsObservedCount=0,this.intersectionsObservedCount=0,this.totalMutationCallbackLatencyOverhead=0,this.totalIntersectionCallbackLatencyOverhead=0,this.pageHasImages=!1,this.wasDocumentHiddenAtSomePoint=!1,this.loadingImagesPromise=new Promise((e,t)=>{const i=t=>{this.intersectionImageObserver.unobserve(t.target),r.delete(t.target),0===r.size&&(e(performance.now()),window.document.removeEventListener("load",i),window.document.removeEventListener("error",i))};window.document.addEventListener("load",i,{capture:!0}),window.document.addEventListener("error",i,{capture:!0})}),this.waitForLoadingImages=()=>this.pageHasImages?this.loadingImagesPromise:Promise.resolve(0),this.mutationObserverCallback=e=>{const t=performance.now();this.mutatationsObservedCount+=e.length,o.processMutationRecords(e).forEach(e=>{this.isDocumentHidden()?this.callback(e):this.scheduleIntersectionObservation(e)}),this.totalMutationCallbackLatencyOverhead+=performance.now()-t},this.intersectionObserverCallback=e=>{const t=performance.now();this.intersectionsObservedCount+=e.length,e.forEach(e=>{const t=e.target;if(e.isIntersecting&&(this.intersectionObserver.unobserve(t),t instanceof HTMLElement&&this.pendingMutations.get(t))){const i=this.pendingMutations.get(t);i.intersectionObserverEntry=e,this.pendingMutations.delete(t),this.callback(i)}}),this.totalIntersectionCallbackLatencyOverhead+=performance.now()-t},this.imageIntersectionObserverCallback=e=>{e.forEach(e=>{e.isIntersecting&&(this.pageHasImages=!0,r.add(e.target))})},this.callback=e.callback;const s=null!==(t=e.MutationObserverClass)&&void 0!==t?t:MutationObserver,a=null!==(i=e.IntersectionObserverClass)&&void 0!==i?i:IntersectionObserver;this.mutationObserver=new s(this.mutationObserverCallback),this.intersectionObserver=new a(this.intersectionObserverCallback),this.intersectionImageObserver=new IntersectionObserver(this.imageIntersectionObserverCallback),this.supportsVisibilityState=void 0!==document.visibilityState||void 0!==document.hidden,this.addAnnotation=null!==(n=e.addAnnotation)&&void 0!==n?n:()=>{}}observe(e){this.isObserving=!0,this.mutationObserver.observe(e,this.mutationObserverConfig)}disconnect(){this.isObserving&&(this.isObserving=!1,this.addAnnotations(),this.mutationObserver.disconnect(),this.intersectionObserver.disconnect(),this.pendingMutations.clear(),this.intersectionImageObserver.disconnect())}scheduleIntersectionObservation(e){this.intersectionsScheduledCount++,this.pendingMutations.set(e.target,e),this.intersectionObserver.observe(e.target),e.target.querySelectorAll("img").forEach(e=>{e&&!e.complete&&this.intersectionImageObserver.observe(e)})}addAnnotations(){this.addAnnotation(i.AnnotationNameEnum.VC_INTERSECTIONS_SCHEDULED_COUNT,this.intersectionsScheduledCount),this.addAnnotation(i.AnnotationNameEnum.VC_MUTATIONS_OBSERVED_COUNT,this.mutatationsObservedCount),this.addAnnotation(i.AnnotationNameEnum.VC_INTERSECTIONS_OBSERVED_COUNT,this.intersectionsObservedCount),this.addAnnotation(i.AnnotationNameEnum.VC_TOTAL_MUTATION_CALLBACK_LATENCY_OVERHEAD_MS,this.totalMutationCallbackLatencyOverhead),this.addAnnotation(i.AnnotationNameEnum.VC_TOTAL_INTERSECTION_CALLBACK_LATENCY_OVERHEAD_MS,this.totalIntersectionCallbackLatencyOverhead),this.addAnnotation(i.AnnotationNameEnum.VC_TOTAL_CALLBACK_LATENCY_OVERHEAD_MS,this.totalMutationCallbackLatencyOverhead+this.totalIntersectionCallbackLatencyOverhead),this.addAnnotation(i.AnnotationNameEnum.VC_ELEMENTS_SCHEDULED_FOR_OBSERVATION_BUT_NOT_OBSERVED_COUNT,this.pendingMutations.size)}isDocumentHidden(){const e=this.supportsVisibilityState&&void 0!==document.visibilityState?"hidden"===document.visibilityState:document.hidden;return e&&!this.wasDocumentHiddenAtSomePoint&&(this.wasDocumentHiddenAtSomePoint=!0),e}};class o{constructor(e){this.mutationRecord=e,this.elementWrapper=l.makeElementWrapper(e.target)}static processMutationRecords(e){const t=[];for(const i of e)t.push(...new o(i).toMutations());return t}toMutations(){return this.elementWrapper.isInRenderTree()?this.didAddNodes()?this.findMutationsWithinNodeList(this.mutationRecord.addedNodes):this.didModifyHiddenAttribute()?[this.toMutation(n.HIDDEN_ATTRIBUTE_MODIFIED)]:this.didModifyStyleAttribute()?[this.toMutation(n.STYLE_ATTRIBUTE_MODIFIED)]:this.didModifyImageAttributes()?[this.toMutation(n.IMAGE_ATTRIBUTE_MODIFIED)]:[]:[]}toMutation(e){return new a(this.elementWrapper,e)}didAddNodes(){var e;return"childList"===this.mutationRecord.type&&(null===(e=this.mutationRecord.addedNodes)||void 0===e?void 0:e.length)}didModifyHiddenAttribute(){return"hidden"===this.mutationRecord.attributeName&&!this.elementWrapper.isHidden}didModifyStyleAttribute(){return"style"===this.mutationRecord.attributeName&&this.elementWrapper.doesStyleHideElement(this.mutationRecord.oldValue)&&!this.elementWrapper.doesStyleHideElement()}didModifyImageAttributes(){return"IMG"===this.elementWrapper.element.tagName&&"src"===this.mutationRecord.attributeName}findMutationsWithinNodeList(e){const t=[];return l.fromNodeList(e).forEach(e=>{t.push(new a(e,n.DOM_NODE_ADDED))}),t}}t.InViewportMutationRecordToMutationsProcessor=o;class a{constructor(e,t){this.reason=t,this.timestamp=performance.now(),this.targetWrapper=e,this.target=e.element}}t.Mutation=a;class c{constructor(e){this.element=e}get isIgnored(){return(this.element.getAttribute(s.ATTRIBUTE_NAME)||"").toLowerCase()===s.IGNORE_VALUE.toLowerCase()}get isHidden(){return this.doesStyleHideElement()||this.element.hasAttribute("hidden")}get isHTMLElement(){return this.element instanceof HTMLElement}isInRenderTree(){let e=this.element;for(;e;){const t=l.makeElementWrapper(e);if(!t.isHTMLElement||t.isHidden||t.isIgnored)return!1;e=e.parentElement}return!0}doesStyleHideElement(e){return void 0===e&&(e=this.element.getAttribute("style")),null!==e&&""!==e&&((e=e.replace(/ /g,"")).includes("visibility:hidden")||e.includes("display:none")||e.includes("content-visibility:hidden"))}}class l{static fromNodeList(e){return Array.from(e).map(e=>this.makeElementWrapper(e)).filter(e=>e.isInRenderTree())}static makeElementWrapper(e){return new c(e)}}t.ElementWrapperFactory=l})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/visually_complete_calculator",["require","exports","tslib","metaserver/static/js/modules/clean/user_centric_perf_metrics/in_viewport_mutation_observer","metaserver/static/js/modules/clean/user_centric_perf_metrics/annotations","metaserver/static/js/modules/clean/user_centric_perf_metrics/utils"],(function(e,t,i,n,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PageLoadVisuallyCompleteCalculator=t.VisuallyCompleteCalculator=void 0;class o{constructor(e){var t,i;if(this.hasInitialized=!1,this.hasUserInteractedWithPage=!1,this.mutations=[],this.isSupportedEnvironment=o.isSupportedEnvironment(),this.userInteractionEvents=["click"],this.mutationObserverCallback=e=>{this.mutations.push(e)},this.onUserInteraction=()=>{this.hasUserInteractedWithPage||(this.hasUserInteractedWithPage=!0),this.removeEventListeners()},!this.isSupportedEnvironment)return;this.target=e.target,this.calculationStartTimestamp=null!==(t=e.calculationStartTimestamp)&&void 0!==t?t:0,this.addAnnotation=e.addAnnotation||(()=>{});const s=null!==(i=e.InViewportMutationObserverClass)&&void 0!==i?i:n.InViewportMutationObserver;this.inViewportMutationObserver=new s({callback:this.mutationObserverCallback,addAnnotation:this.addAnnotation})}static isSupportedEnvironment(){var e;return void 0!==window&&"MutationObserver"in window&&"IntersectionObserver"in window&&"function"==typeof document.querySelectorAll&&(null===(e=window.performance)||void 0===e?void 0:e.timing)}start(){this.isSupportedEnvironment&&(this.hasInitialized=!0,this.inViewportMutationObserver.observe(this.target),this.addEventListeners())}attemptMeasurement(){return i.__awaiter(this,void 0,void 0,(function*(){if(!this.isSupportedEnvironment)return null;if(!this.hasInitialized)throw new Error("Programmer error: must call `start` before `attemptMeasurement`");if(this.stopObserving(),!this.mutations.length)return null;const e=yield this.inViewportMutationObserver.waitForLoadingImages();return this.addAnnotation(s.AnnotationNameEnum.VC_IN_VIEWPORT_MUTATION_OBSERVED_COUNT,this.mutations.length),this.hasUserInteractedWithPage||this.inViewportMutationObserver.wasDocumentHiddenAtSomePoint?null:"number"==typeof e?Math.max(this.getLastDOMMutationTimestamp()-this.calculationStartTimestamp,e):this.getLastDOMMutationTimestamp()-this.calculationStartTimestamp}))}getLastDOMMutationTimestamp(){if(!this.mutations.length)throw new Error("Programmer error - getLastDOMMutationTimestamp should only be called if there are mutations");return Math.max(...this.mutations.map(e=>e.timestamp))}stopObserving(){this.inViewportMutationObserver.disconnect(),this.removeEventListeners()}addEventListeners(){this.userInteractionEvents.forEach(e=>{window.addEventListener(e,this.onUserInteraction)})}removeEventListeners(){this.userInteractionEvents.forEach(e=>{window.removeEventListener(e,this.onUserInteraction)})}}t.VisuallyCompleteCalculator=o;t.PageLoadVisuallyCompleteCalculator=class extends o{constructor(e={}){o.isSupportedEnvironment()?super(Object.assign(Object.assign({},e),{target:document.querySelector("body")})):super(e)}attemptMeasurement(){const e=Object.create(null,{attemptMeasurement:{get:()=>super.attemptMeasurement}});return i.__awaiter(this,void 0,void 0,(function*(){return yield r.waitForPageLoad(),e.attemptMeasurement.call(this)}))}}})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/long_input_delay_observer",["require","exports","tslib","metaserver/static/js/modules/constants/webtiming","metaserver/static/js/modules/clean/user_centric_perf_metrics/annotations"],(function(e,t,i,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LongInputDelayObserver=void 0,n=i.__importStar(n);class r{constructor(e){var t;if(this.delayThresholdMS=50,this._isSupportedEnvironment=r.isSupportedEnvironment(),this.totalInputDelayCallbackLatencyOverheadMS=0,this.totalInputDelayMS=0,this.totalInputEntryCount=0,this.avgInputDelayMS=0,this.performanceObserverCallback=e=>{const t=performance.now(),i=[],n=e.getEntries(),r=n.length;for(let e=0;e<r;e++){const t=n[e],s=t.processingStart-t.startTime;s>=this.delayThresholdMS&&(t.delay=s,i.push(t),this.totalInputDelayMS+=s)}i.length&&(this.totalInputEntryCount+=i.length,this.avgInputDelayMS=this.totalInputDelayMS/this.totalInputEntryCount,this.callback(i)),this.totalInputDelayCallbackLatencyOverheadMS+=performance.now()-t,this.addAnnotation(s.AnnotationNameEnum.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS,this.totalInputDelayCallbackLatencyOverheadMS),this.addAnnotation(s.AnnotationNameEnum.AVG_LONG_INPUT_DELAY_MS,this.avgInputDelayMS)},!this._isSupportedEnvironment)return;const i=null!==(t=e.PerformanceObserverClass)&&void 0!==t?t:window.PerformanceObserver;this.performanceObserver=new i(this.performanceObserverCallback),this.delayThresholdMS=e.delayThresholdMS||this.delayThresholdMS,this.addAnnotation=e.addAnnotation||(()=>{}),this.callback=e.callback}static isSupportedEnvironment(e=n.LOG_BETA_USER_CENTRIC_PERF_METRICS){return void 0!==window&&"PerformanceObserver"in window&&"PerformanceEventTiming"in window&&e}observe(){this._isSupportedEnvironment&&this.performanceObserver.observe({entryTypes:["event"]})}disconnect(){this.performanceObserver&&this.performanceObserver.disconnect()}}t.LongInputDelayObserver=r})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/metrics_collector",["require","exports","tslib","web-vitals","metaserver/static/js/modules/clean/user_centric_perf_metrics/long_input_delay_observer","metaserver/static/js/modules/clean/user_centric_perf_metrics/visually_complete_calculator","metaserver/static/js/modules/clean/user_centric_perf_metrics/utils"],(function(e,t,i,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsCollector=void 0;t.MetricsCollector=class{constructor(e={}){var t,i;this.numLongInputDelays=0,this.annotations=new Map,this.getLCP=n.getLCP,this.getCLS=n.getCLS,this.getFID=n.getFID,this.onLongInputDelay=e=>{this.numLongInputDelays+=e.length},this.addAnnotation=(e,t)=>{this.annotations.set(e,t)};const o=null!==(t=e.LongInputDelayObserverClass)&&void 0!==t?t:s.LongInputDelayObserver;this.longInputDelayObserver=new o({callback:this.onLongInputDelay,addAnnotation:this.addAnnotation});const a=null!==(i=e.VisuallyCompleteCalculatorClass)&&void 0!==i?i:r.PageLoadVisuallyCompleteCalculator;this.visuallyCompleteCalculator=new a({addAnnotation:this.addAnnotation}),this.visuallyCompleteCalculator.start()}getVC(e){return i.__awaiter(this,void 0,void 0,(function*(){const t=yield this.visuallyCompleteCalculator.attemptMeasurement();null!==t&&e(t)}))}getLongInputDelays(e){return i.__awaiter(this,void 0,void 0,(function*(){yield o.waitForPageLoad(),this.longInputDelayObserver.observe(),yield o.waitForPageHidden(),this.longInputDelayObserver.disconnect(),e(this.numLongInputDelays)}))}}})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/metrics_logger",["require","exports","apex-metrics/index","metaserver/static/js/modules/clean/user_centric_perf_metrics/metrics_collector","metaserver/static/js/modules/clean/user_centric_perf_metrics/annotations","metaserver/static/js/modules/clean/user_centric_perf_metrics/visually_complete_logger","metaserver/static/js/modules/clean/logging/hive/schemas/web-visually_complete"],(function(e,t,i,n,s,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logUserCentricPerfMetrics=t.MetricsLogger=void 0;class a{constructor(e=null,t=new n.MetricsCollector){this.AMP_NAMESPACE="user_centric_perf",this.shouldLogToAmp=!1,e&&(this._metricsReporter=e),this.metricsCollector=t}static getSingleton(){return a.instance||(a.instance=new a),a.instance}get metricsReporter(){if(!this._metricsReporter)throw new Error("Must set `metricsReporter` on MetricsLogger before deriving metrics");return this._metricsReporter}set metricsReporter(e){this._metricsReporter=e}deriveAndLogAllMetrics(){this.deriveAndLogLargestContentfulPaint(),this.deriveAndLogFirstInputDelay(),this.deriveAndLogCumulativeLayoutShift(),this.deriveAndLogTimeToVisuallyComplete(),this.deriveAndLogNumLongInputDelays(),this.deriveAndLogTimeToConsistentlyInteractive(),this.observeRageClicks()}deriveAndLogLargestContentfulPaint(){this.metricsCollector.getLCP(e=>{this.logMetricToAmp("time_to_largest_contentful_paint_ms",e.value)})}deriveAndLogFirstInputDelay(){this.metricsCollector.getFID(e=>{const t=e.entries[0].startTime;this.logMetricToAmp("time_to_first_input_ms",t),this.logMetricToAmp("first_input_delay_ms",e.value)})}deriveAndLogCumulativeLayoutShift(){this.metricsCollector.getCLS(e=>{this.logMetricToAmp("cumulative_layout_shift",e.value,null)})}deriveAndLogTimeToVisuallyComplete(){this.metricsCollector.getVC(e=>{const t=this.metricsCollector.annotations;this.logMetricToAmp("time_to_visually_complete_ms",e,i.TimeUnit.MILLISECONDS),r.timeToVisuallyCompleteLogger.log(new o.VisuallyCompleteEventRow({time_to_visually_complete:Math.round(e)}));const n=t.get(s.AnnotationNameEnum.VC_TOTAL_CALLBACK_LATENCY_OVERHEAD_MS);"number"==typeof n&&this.logMetricToAmp("visually_complete_calculation_overhead_ms",n,i.TimeUnit.MILLISECONDS);const a=new CustomEvent("visually_complete",{detail:{value:e}});window.dispatchEvent(a),performance.mark("visually_complete",{startTime:e}),t.forEach((e,t)=>{t.startsWith("vc_")&&performance.mark(`visually_complete-${t}`,{startTime:e})})})}deriveAndLogNumLongInputDelays(){this.metricsCollector.getLongInputDelays(e=>{this.logMetricToAmp("num_long_input_delays",e,null);const t=this.metricsCollector.annotations.get(s.AnnotationNameEnum.LONG_INPUT_DELAY_CALLBACK_LATENCY_OVERHEAD_MS),i=this.metricsCollector.annotations.get(s.AnnotationNameEnum.AVG_LONG_INPUT_DELAY_MS);"number"==typeof t&&this.logMetricToAmp("long_input_delay_observation_overhead_ms",t),"number"==typeof i&&this.logMetricToAmp("avg_long_input_delay_ms",i)})}deriveAndLogTimeToConsistentlyInteractive(){}observeRageClicks(){}logMetricToAmp(e,t,n=i.TimeUnit.MILLISECONDS,s){if(!this.shouldLogToAmp)return;const r=this.metricsReporter.createStats(this.createAMPMetric(e));n?r.recordDuration(t,i.TimeUnit.MILLISECONDS):r.record(t)}createAMPMetric(e){return{ns:this.AMP_NAMESPACE,name:`browser/${e}`}}}t.MetricsLogger=a,void 0!==window&&a.getSingleton(),t.logUserCentricPerfMetrics=(e,t)=>{const i=a.getSingleton();i.metricsReporter=e,i.shouldLogToAmp=t,i.deriveAndLogAllMetrics()}})),define("metaserver/static/js/modules/clean/user_centric_perf_metrics/visually_complete_logger",["require","exports","metaserver/static/js/modules/clean/logging/telemetry"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timeToVisuallyCompleteLogger=void 0,t.timeToVisuallyCompleteLogger=new i.HiveLogger})),define("metaserver/static/js/modules/clean/logging/hive/schemas/web-visually_complete",["require","exports","metaserver/static/js/modules/constants/request"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisuallyCompleteEventRow=void 0;t.VisuallyCompleteEventRow=class{constructor(e){this.category="web-visually_complete",this.user_id=null,this.country=null,this.referrer=null,this.session_id=null,this.user_agent=null,this.ua_browser_name=null,this.ua_browser_version=null,this.time_to_visually_complete=e.time_to_visually_complete,this.request_id=i.REQUEST_ID,Object.seal(this)}}})),define("metaserver/static/js/modules/core/transport/query_string_helpers",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TRACKING_PARAMS_LIST=t.parseQueryString=t.filterQueryObject=t.getQueryString=t.getTrackingParamsAsJSON=t.getTrackingParams=t.getParsedQueryString=void 0;const i=["gclid","oqa","trigger","_tk","_camp","_ad","_net","_kw","utm_campaign","utm_content","utm_medium","utm_source","utm_term","cont"];function n(e=window){return e.location.search}function s(e){const t={};if(e.length){const i=e.substring(1).replace(/&amp;/g,"&").split("&");for(const e of i){let[i,n]=e.split("=");i&&n&&(i=i.trim(),n=n.trim(),i.length&&n.length&&(t[i]=decodeURIComponent(n.replace(/\+/g," "))))}}return t}function r(e,t){return t.reduce((t,i)=>(e.hasOwnProperty(i)&&(t[i]=e[i]),t),{})}function o(e){return r(e||s(n()),i)}t.TRACKING_PARAMS_LIST=i,t.getQueryString=n,t.parseQueryString=s,t.getParsedQueryString=function(){return s(n())},t.filterQueryObject=r,t.getTrackingParams=o,t.getTrackingParamsAsJSON=function(){const e=o();return JSON.stringify(e)}})),define("metaserver/static/js/prod_assets_web_modules/web-vitals",["exports"],(function(e){"use strict";var t,i,n,s,r=function(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},o=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var i=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return i.observe({type:e,buffered:!0}),i}}catch(e){}},a=function(e,t){var i=function i(n){"pagehide"!==n.type&&"hidden"!==document.visibilityState||(e(n),t&&(removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0)))};addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)},c=function(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)},l=function(e,t,i){var n;return function(s){t.value>=0&&(s||i)&&(t.delta=t.value-(n||0),(t.delta||void 0===n)&&(n=t.value,e(t)))}},d=-1,u=function(){return"hidden"===document.visibilityState?0:1/0},m=function(){a((function(e){var t=e.timeStamp;d=t}),!0)},p=function(){return d<0&&(d=u(),m(),c((function(){setTimeout((function(){d=u(),m()}),0)}))),{get firstHiddenTime(){return d}}},_=function(e,t){var i,n=p(),s=r("FCP"),a=function(e){"first-contentful-paint"===e.name&&(u&&u.disconnect(),e.startTime<n.firstHiddenTime&&(s.value=e.startTime,s.entries.push(e),i(!0)))},d=performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],u=d?null:o("paint",a);(d||u)&&(i=l(e,s,t),d&&a(d),c((function(n){s=r("FCP"),i=l(e,s,t),requestAnimationFrame((function(){requestAnimationFrame((function(){s.value=performance.now()-n.timeStamp,i(!0)}))}))})))},h=!1,g=-1,f={passive:!0,capture:!0},v=new Date,S=function(e,s){t||(t=s,i=e,n=new Date,T(removeEventListener),w())},w=function(){if(i>=0&&i<n-v){var e={entryType:"first-input",name:t.type,target:t.target,cancelable:t.cancelable,startTime:t.timeStamp,processingStart:t.timeStamp+i};s.forEach((function(t){t(e)})),s=[]}},b=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?(function(e,t){var i=function(){S(e,t),s()},n=function(){s()},s=function(){removeEventListener("pointerup",i,f),removeEventListener("pointercancel",n,f)};addEventListener("pointerup",i,f),addEventListener("pointercancel",n,f)})(t,e):S(t,e)}},T=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,b,f)}))},E=new Set;e.getCLS=function(e,t){h||(_((function(e){g=e.value})),h=!0);var i,n=function(t){g>-1&&e(t)},s=r("CLS",0),d=0,u=[],m=function(e){if(!e.hadRecentInput){var t=u[0],n=u[u.length-1];d&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(d+=e.value,u.push(e)):(d=e.value,u=[e]),d>s.value&&(s.value=d,s.entries=u,i())}},p=o("layout-shift",m);p&&(i=l(n,s,t),a((function(){p.takeRecords().map(m),i(!0)})),c((function(){d=0,g=-1,s=r("CLS",0),i=l(n,s,t)})))},e.getFCP=_,e.getFID=function(e,n){var d,u=p(),m=r("FID"),_=function(e){e.startTime<u.firstHiddenTime&&(m.value=e.processingStart-e.startTime,m.entries.push(e),d(!0))},h=o("first-input",_);d=l(e,m,n),h&&a((function(){h.takeRecords().map(_),h.disconnect()}),!0),h&&c((function(){var o;m=r("FID"),d=l(e,m,n),s=[],i=-1,t=null,T(addEventListener),o=_,s.push(o),w()}))},e.getLCP=function(e,t){var i,n=p(),s=r("LCP"),d=function(e){var t=e.startTime;t<n.firstHiddenTime&&(s.value=t,s.entries.push(e)),i()},u=o("largest-contentful-paint",d);if(u){i=l(e,s,t);var m=function(){E.has(s.id)||(u.takeRecords().map(d),u.disconnect(),E.add(s.id),i(!0))};["keydown","click"].forEach((function(e){addEventListener(e,m,{once:!0,capture:!0})})),a(m,!0),c((function(n){s=r("LCP"),i=l(e,s,t),requestAnimationFrame((function(){requestAnimationFrame((function(){s.value=performance.now()-n.timeStamp,E.add(s.id),i(!0)}))}))}))}},e.getTTFB=function(e){var t,i=r("TTFB");t=function(){try{var t=performance.getEntriesByType("navigation")[0]||(function(){var e=performance.timing,t={entryType:"navigation",startTime:0};for(var i in e)"navigationStart"!==i&&"toJSON"!==i&&(t[i]=Math.max(e[i]-e.navigationStart,0));return t})();if(i.value=i.delta=t.responseStart,i.value<0)return;i.entries=[t],e(i)}catch(e){}},"complete"===document.readyState?setTimeout(t,0):addEventListener("pageshow",t)},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=pkg-timing.min.js-vflPIFMMU.map